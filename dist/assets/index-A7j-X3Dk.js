var JV=Object.defineProperty;var XV=(n,e,t)=>e in n?JV(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ct=(n,e,t)=>XV(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var m4=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jc(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var b6={exports:{}},Kw={},E6={exports:{}},yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hg=Symbol.for("react.element"),ZV=Symbol.for("react.portal"),eB=Symbol.for("react.fragment"),tB=Symbol.for("react.strict_mode"),nB=Symbol.for("react.profiler"),rB=Symbol.for("react.provider"),sB=Symbol.for("react.context"),iB=Symbol.for("react.forward_ref"),aB=Symbol.for("react.suspense"),oB=Symbol.for("react.memo"),lB=Symbol.for("react.lazy"),g4=Symbol.iterator;function uB(n){return n===null||typeof n!="object"?null:(n=g4&&n[g4]||n["@@iterator"],typeof n=="function"?n:null)}var S6={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T6=Object.assign,C6={};function _f(n,e,t){this.props=n,this.context=e,this.refs=C6,this.updater=t||S6}_f.prototype.isReactComponent={};_f.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};_f.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function I6(){}I6.prototype=_f.prototype;function JI(n,e,t){this.props=n,this.context=e,this.refs=C6,this.updater=t||S6}var XI=JI.prototype=new I6;XI.constructor=JI;T6(XI,_f.prototype);XI.isPureReactComponent=!0;var _4=Array.isArray,x6=Object.prototype.hasOwnProperty,ZI={current:null},k6={key:!0,ref:!0,__self:!0,__source:!0};function P6(n,e,t){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)x6.call(e,r)&&!k6.hasOwnProperty(r)&&(s[r]=e[r]);var o=arguments.length-2;if(o===1)s.children=t;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in o=n.defaultProps,o)s[r]===void 0&&(s[r]=o[r]);return{$$typeof:Hg,type:n,key:i,ref:a,props:s,_owner:ZI.current}}function cB(n,e){return{$$typeof:Hg,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function ex(n){return typeof n=="object"&&n!==null&&n.$$typeof===Hg}function dB(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var y4=/\/+/g;function _S(n,e){return typeof n=="object"&&n!==null&&n.key!=null?dB(""+n.key):e.toString(36)}function k0(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case Hg:case ZV:a=!0}}if(a)return a=n,s=s(a),n=r===""?"."+_S(a,0):r,_4(s)?(t="",n!=null&&(t=n.replace(y4,"$&/")+"/"),k0(s,e,t,"",function(u){return u})):s!=null&&(ex(s)&&(s=cB(s,t+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(y4,"$&/")+"/")+n)),e.push(s)),1;if(a=0,r=r===""?".":r+":",_4(n))for(var o=0;o<n.length;o++){i=n[o];var l=r+_S(i,o);a+=k0(i,e,t,l,s)}else if(l=uB(n),typeof l=="function")for(n=l.call(n),o=0;!(i=n.next()).done;)i=i.value,l=r+_S(i,o++),a+=k0(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Ny(n,e,t){if(n==null)return n;var r=[],s=0;return k0(n,r,"","",function(i){return e.call(t,i,s++)}),r}function hB(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Ss={current:null},P0={transition:null},fB={ReactCurrentDispatcher:Ss,ReactCurrentBatchConfig:P0,ReactCurrentOwner:ZI};function A6(){throw Error("act(...) is not supported in production builds of React.")}yt.Children={map:Ny,forEach:function(n,e,t){Ny(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Ny(n,function(){e++}),e},toArray:function(n){return Ny(n,function(e){return e})||[]},only:function(n){if(!ex(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};yt.Component=_f;yt.Fragment=eB;yt.Profiler=nB;yt.PureComponent=JI;yt.StrictMode=tB;yt.Suspense=aB;yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fB;yt.act=A6;yt.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=T6({},n.props),s=n.key,i=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=ZI.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)x6.call(e,l)&&!k6.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];r.children=o}return{$$typeof:Hg,type:n.type,key:s,ref:i,props:r,_owner:a}};yt.createContext=function(n){return n={$$typeof:sB,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:rB,_context:n},n.Consumer=n};yt.createElement=P6;yt.createFactory=function(n){var e=P6.bind(null,n);return e.type=n,e};yt.createRef=function(){return{current:null}};yt.forwardRef=function(n){return{$$typeof:iB,render:n}};yt.isValidElement=ex;yt.lazy=function(n){return{$$typeof:lB,_payload:{_status:-1,_result:n},_init:hB}};yt.memo=function(n,e){return{$$typeof:oB,type:n,compare:e===void 0?null:e}};yt.startTransition=function(n){var e=P0.transition;P0.transition={};try{n()}finally{P0.transition=e}};yt.unstable_act=A6;yt.useCallback=function(n,e){return Ss.current.useCallback(n,e)};yt.useContext=function(n){return Ss.current.useContext(n)};yt.useDebugValue=function(){};yt.useDeferredValue=function(n){return Ss.current.useDeferredValue(n)};yt.useEffect=function(n,e){return Ss.current.useEffect(n,e)};yt.useId=function(){return Ss.current.useId()};yt.useImperativeHandle=function(n,e,t){return Ss.current.useImperativeHandle(n,e,t)};yt.useInsertionEffect=function(n,e){return Ss.current.useInsertionEffect(n,e)};yt.useLayoutEffect=function(n,e){return Ss.current.useLayoutEffect(n,e)};yt.useMemo=function(n,e){return Ss.current.useMemo(n,e)};yt.useReducer=function(n,e,t){return Ss.current.useReducer(n,e,t)};yt.useRef=function(n){return Ss.current.useRef(n)};yt.useState=function(n){return Ss.current.useState(n)};yt.useSyncExternalStore=function(n,e,t){return Ss.current.useSyncExternalStore(n,e,t)};yt.useTransition=function(){return Ss.current.useTransition()};yt.version="18.3.1";E6.exports=yt;var Y=E6.exports;const It=Jc(Y);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pB=Y,mB=Symbol.for("react.element"),gB=Symbol.for("react.fragment"),_B=Object.prototype.hasOwnProperty,yB=pB.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,vB={key:!0,ref:!0,__self:!0,__source:!0};function R6(n,e,t){var r,s={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)_B.call(e,r)&&!vB.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:mB,type:n,key:i,ref:a,props:s,_owner:yB.current}}Kw.Fragment=gB;Kw.jsx=R6;Kw.jsxs=R6;b6.exports=Kw;var V=b6.exports,oT={},N6={exports:{}},ci={},O6={exports:{}},L6={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(z,Q){var ee=z.length;z.push(Q);e:for(;0<ee;){var se=ee-1>>>1,le=z[se];if(0<s(le,Q))z[se]=Q,z[ee]=le,ee=se;else break e}}function t(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var Q=z[0],ee=z.pop();if(ee!==Q){z[0]=ee;e:for(var se=0,le=z.length,ye=le>>>1;se<ye;){var ve=2*(se+1)-1,de=z[ve],Me=ve+1,B=z[Me];if(0>s(de,ee))Me<le&&0>s(B,de)?(z[se]=B,z[Me]=ee,se=Me):(z[se]=de,z[ve]=ee,se=ve);else if(Me<le&&0>s(B,ee))z[se]=B,z[Me]=ee,se=Me;else break e}}return Q}function s(z,Q){var ee=z.sortIndex-Q.sortIndex;return ee!==0?ee:z.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],u=[],h=1,f=null,p=3,y=!1,_=!1,b=!1,S=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(z){for(var Q=t(u);Q!==null;){if(Q.callback===null)r(u);else if(Q.startTime<=z)r(u),Q.sortIndex=Q.expirationTime,e(l,Q);else break;Q=t(u)}}function I(z){if(b=!1,v(z),!_)if(t(l)!==null)_=!0,ue(L);else{var Q=t(u);Q!==null&&ae(I,Q.startTime-z)}}function L(z,Q){_=!1,b&&(b=!1,E(x),x=-1),y=!0;var ee=p;try{for(v(Q),f=t(l);f!==null&&(!(f.expirationTime>Q)||z&&!D());){var se=f.callback;if(typeof se=="function"){f.callback=null,p=f.priorityLevel;var le=se(f.expirationTime<=Q);Q=n.unstable_now(),typeof le=="function"?f.callback=le:f===t(l)&&r(l),v(Q)}else r(l);f=t(l)}if(f!==null)var ye=!0;else{var ve=t(u);ve!==null&&ae(I,ve.startTime-Q),ye=!1}return ye}finally{f=null,p=ee,y=!1}}var R=!1,P=null,x=-1,N=5,M=-1;function D(){return!(n.unstable_now()-M<N)}function F(){if(P!==null){var z=n.unstable_now();M=z;var Q=!0;try{Q=P(!0,z)}finally{Q?$():(R=!1,P=null)}}else R=!1}var $;if(typeof C=="function")$=function(){C(F)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,G=H.port2;H.port1.onmessage=F,$=function(){G.postMessage(null)}}else $=function(){S(F,0)};function ue(z){P=z,R||(R=!0,$())}function ae(z,Q){x=S(function(){z(n.unstable_now())},Q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(z){z.callback=null},n.unstable_continueExecution=function(){_||y||(_=!0,ue(L))},n.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<z?Math.floor(1e3/z):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(z){switch(p){case 1:case 2:case 3:var Q=3;break;default:Q=p}var ee=p;p=Q;try{return z()}finally{p=ee}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(z,Q){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var ee=p;p=z;try{return Q()}finally{p=ee}},n.unstable_scheduleCallback=function(z,Q,ee){var se=n.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?se+ee:se):ee=se,z){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=ee+le,z={id:h++,callback:Q,priorityLevel:z,startTime:ee,expirationTime:le,sortIndex:-1},ee>se?(z.sortIndex=ee,e(u,z),t(l)===null&&z===t(u)&&(b?(E(x),x=-1):b=!0,ae(I,ee-se))):(z.sortIndex=le,e(l,z),_||y||(_=!0,ue(L))),z},n.unstable_shouldYield=D,n.unstable_wrapCallback=function(z){var Q=p;return function(){var ee=p;p=Q;try{return z.apply(this,arguments)}finally{p=ee}}}})(L6);O6.exports=L6;var gm=O6.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wB=Y,ai=gm;function he(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var M6=new Set,Ym={};function Xc(n,e){Dh(n,e),Dh(n+"Capture",e)}function Dh(n,e){for(Ym[n]=e,n=0;n<e.length;n++)M6.add(e[n])}var Uo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),lT=Object.prototype.hasOwnProperty,bB=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,v4={},w4={};function EB(n){return lT.call(w4,n)?!0:lT.call(v4,n)?!1:bB.test(n)?w4[n]=!0:(v4[n]=!0,!1)}function SB(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function TB(n,e,t,r){if(e===null||typeof e>"u"||SB(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ts(n,e,t,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var Vr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Vr[n]=new Ts(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Vr[e]=new Ts(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Vr[n]=new Ts(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Vr[n]=new Ts(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Vr[n]=new Ts(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Vr[n]=new Ts(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Vr[n]=new Ts(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Vr[n]=new Ts(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Vr[n]=new Ts(n,5,!1,n.toLowerCase(),null,!1,!1)});var tx=/[\-:]([a-z])/g;function nx(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(tx,nx);Vr[e]=new Ts(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(tx,nx);Vr[e]=new Ts(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(tx,nx);Vr[e]=new Ts(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Vr[n]=new Ts(n,1,!1,n.toLowerCase(),null,!1,!1)});Vr.xlinkHref=new Ts("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Vr[n]=new Ts(n,1,!1,n.toLowerCase(),null,!0,!0)});function rx(n,e,t,r){var s=Vr.hasOwnProperty(e)?Vr[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(TB(e,t,s,r)&&(t=null),r||s===null?EB(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Jo=wB.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Oy=Symbol.for("react.element"),sh=Symbol.for("react.portal"),ih=Symbol.for("react.fragment"),sx=Symbol.for("react.strict_mode"),uT=Symbol.for("react.profiler"),D6=Symbol.for("react.provider"),F6=Symbol.for("react.context"),ix=Symbol.for("react.forward_ref"),cT=Symbol.for("react.suspense"),dT=Symbol.for("react.suspense_list"),ax=Symbol.for("react.memo"),xl=Symbol.for("react.lazy"),$6=Symbol.for("react.offscreen"),b4=Symbol.iterator;function Ap(n){return n===null||typeof n!="object"?null:(n=b4&&n[b4]||n["@@iterator"],typeof n=="function"?n:null)}var bn=Object.assign,yS;function Kp(n){if(yS===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);yS=e&&e[1]||""}return`
`+yS+n}var vS=!1;function wS(n,e){if(!n||vS)return"";vS=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,o=i.length-1;1<=a&&0<=o&&s[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||s[a]!==i[o]){var l=`
`+s[a].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=a&&0<=o);break}}}finally{vS=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Kp(n):""}function CB(n){switch(n.tag){case 5:return Kp(n.type);case 16:return Kp("Lazy");case 13:return Kp("Suspense");case 19:return Kp("SuspenseList");case 0:case 2:case 15:return n=wS(n.type,!1),n;case 11:return n=wS(n.type.render,!1),n;case 1:return n=wS(n.type,!0),n;default:return""}}function hT(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case ih:return"Fragment";case sh:return"Portal";case uT:return"Profiler";case sx:return"StrictMode";case cT:return"Suspense";case dT:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case F6:return(n.displayName||"Context")+".Consumer";case D6:return(n._context.displayName||"Context")+".Provider";case ix:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case ax:return e=n.displayName||null,e!==null?e:hT(n.type)||"Memo";case xl:e=n._payload,n=n._init;try{return hT(n(e))}catch{}}return null}function IB(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hT(e);case 8:return e===sx?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function uu(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function j6(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function xB(n){var e=j6(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Ly(n){n._valueTracker||(n._valueTracker=xB(n))}function U6(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=j6(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function cv(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function fT(n,e){var t=e.checked;return bn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function E4(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=uu(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function V6(n,e){e=e.checked,e!=null&&rx(n,"checked",e,!1)}function pT(n,e){V6(n,e);var t=uu(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?mT(n,e.type,t):e.hasOwnProperty("defaultValue")&&mT(n,e.type,uu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function S4(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function mT(n,e,t){(e!=="number"||cv(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Qp=Array.isArray;function bh(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+uu(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function gT(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(he(91));return bn({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function T4(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(he(92));if(Qp(t)){if(1<t.length)throw Error(he(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:uu(t)}}function B6(n,e){var t=uu(e.value),r=uu(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function C4(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function z6(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _T(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?z6(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var My,G6=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(My=My||document.createElement("div"),My.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=My.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Jm(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var _m={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},kB=["Webkit","ms","Moz","O"];Object.keys(_m).forEach(function(n){kB.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),_m[e]=_m[n]})});function W6(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||_m.hasOwnProperty(n)&&_m[n]?(""+e).trim():e+"px"}function H6(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=W6(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var PB=bn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yT(n,e){if(e){if(PB[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(he(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(he(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(he(61))}if(e.style!=null&&typeof e.style!="object")throw Error(he(62))}}function vT(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wT=null;function ox(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var bT=null,Eh=null,Sh=null;function I4(n){if(n=Qg(n)){if(typeof bT!="function")throw Error(he(280));var e=n.stateNode;e&&(e=Zw(e),bT(n.stateNode,n.type,e))}}function q6(n){Eh?Sh?Sh.push(n):Sh=[n]:Eh=n}function K6(){if(Eh){var n=Eh,e=Sh;if(Sh=Eh=null,I4(n),e)for(n=0;n<e.length;n++)I4(e[n])}}function Q6(n,e){return n(e)}function Y6(){}var bS=!1;function J6(n,e,t){if(bS)return n(e,t);bS=!0;try{return Q6(n,e,t)}finally{bS=!1,(Eh!==null||Sh!==null)&&(Y6(),K6())}}function Xm(n,e){var t=n.stateNode;if(t===null)return null;var r=Zw(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(he(231,e,typeof t));return t}var ET=!1;if(Uo)try{var Rp={};Object.defineProperty(Rp,"passive",{get:function(){ET=!0}}),window.addEventListener("test",Rp,Rp),window.removeEventListener("test",Rp,Rp)}catch{ET=!1}function AB(n,e,t,r,s,i,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var ym=!1,dv=null,hv=!1,ST=null,RB={onError:function(n){ym=!0,dv=n}};function NB(n,e,t,r,s,i,a,o,l){ym=!1,dv=null,AB.apply(RB,arguments)}function OB(n,e,t,r,s,i,a,o,l){if(NB.apply(this,arguments),ym){if(ym){var u=dv;ym=!1,dv=null}else throw Error(he(198));hv||(hv=!0,ST=u)}}function Zc(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function X6(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function x4(n){if(Zc(n)!==n)throw Error(he(188))}function LB(n){var e=n.alternate;if(!e){if(e=Zc(n),e===null)throw Error(he(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return x4(s),n;if(i===r)return x4(s),e;i=i.sibling}throw Error(he(188))}if(t.return!==r.return)t=s,r=i;else{for(var a=!1,o=s.child;o;){if(o===t){a=!0,t=s,r=i;break}if(o===r){a=!0,r=s,t=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===t){a=!0,t=i,r=s;break}if(o===r){a=!0,r=i,t=s;break}o=o.sibling}if(!a)throw Error(he(189))}}if(t.alternate!==r)throw Error(he(190))}if(t.tag!==3)throw Error(he(188));return t.stateNode.current===t?n:e}function Z6(n){return n=LB(n),n!==null?e8(n):null}function e8(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=e8(n);if(e!==null)return e;n=n.sibling}return null}var t8=ai.unstable_scheduleCallback,k4=ai.unstable_cancelCallback,MB=ai.unstable_shouldYield,DB=ai.unstable_requestPaint,An=ai.unstable_now,FB=ai.unstable_getCurrentPriorityLevel,lx=ai.unstable_ImmediatePriority,n8=ai.unstable_UserBlockingPriority,fv=ai.unstable_NormalPriority,$B=ai.unstable_LowPriority,r8=ai.unstable_IdlePriority,Qw=null,Ga=null;function jB(n){if(Ga&&typeof Ga.onCommitFiberRoot=="function")try{Ga.onCommitFiberRoot(Qw,n,void 0,(n.current.flags&128)===128)}catch{}}var sa=Math.clz32?Math.clz32:BB,UB=Math.log,VB=Math.LN2;function BB(n){return n>>>=0,n===0?32:31-(UB(n)/VB|0)|0}var Dy=64,Fy=4194304;function Yp(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function pv(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~s;o!==0?r=Yp(o):(i&=a,i!==0&&(r=Yp(i)))}else a=t&~s,a!==0?r=Yp(a):i!==0&&(r=Yp(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-sa(e),s=1<<t,r|=n[t],e&=~s;return r}function zB(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function GB(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var a=31-sa(i),o=1<<a,l=s[a];l===-1?(!(o&t)||o&r)&&(s[a]=zB(o,e)):l<=e&&(n.expiredLanes|=o),i&=~o}}function TT(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function s8(){var n=Dy;return Dy<<=1,!(Dy&4194240)&&(Dy=64),n}function ES(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function qg(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-sa(e),n[e]=t}function WB(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-sa(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function ux(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-sa(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var qt=0;function i8(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var a8,cx,o8,l8,u8,CT=!1,$y=[],Kl=null,Ql=null,Yl=null,Zm=new Map,eg=new Map,Nl=[],HB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function P4(n,e){switch(n){case"focusin":case"focusout":Kl=null;break;case"dragenter":case"dragleave":Ql=null;break;case"mouseover":case"mouseout":Yl=null;break;case"pointerover":case"pointerout":Zm.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":eg.delete(e.pointerId)}}function Np(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Qg(e),e!==null&&cx(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function qB(n,e,t,r,s){switch(e){case"focusin":return Kl=Np(Kl,n,e,t,r,s),!0;case"dragenter":return Ql=Np(Ql,n,e,t,r,s),!0;case"mouseover":return Yl=Np(Yl,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return Zm.set(i,Np(Zm.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,eg.set(i,Np(eg.get(i)||null,n,e,t,r,s)),!0}return!1}function c8(n){var e=gc(n.target);if(e!==null){var t=Zc(e);if(t!==null){if(e=t.tag,e===13){if(e=X6(t),e!==null){n.blockedOn=e,u8(n.priority,function(){o8(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function A0(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=IT(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);wT=r,t.target.dispatchEvent(r),wT=null}else return e=Qg(t),e!==null&&cx(e),n.blockedOn=t,!1;e.shift()}return!0}function A4(n,e,t){A0(n)&&t.delete(e)}function KB(){CT=!1,Kl!==null&&A0(Kl)&&(Kl=null),Ql!==null&&A0(Ql)&&(Ql=null),Yl!==null&&A0(Yl)&&(Yl=null),Zm.forEach(A4),eg.forEach(A4)}function Op(n,e){n.blockedOn===e&&(n.blockedOn=null,CT||(CT=!0,ai.unstable_scheduleCallback(ai.unstable_NormalPriority,KB)))}function tg(n){function e(s){return Op(s,n)}if(0<$y.length){Op($y[0],n);for(var t=1;t<$y.length;t++){var r=$y[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Kl!==null&&Op(Kl,n),Ql!==null&&Op(Ql,n),Yl!==null&&Op(Yl,n),Zm.forEach(e),eg.forEach(e),t=0;t<Nl.length;t++)r=Nl[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Nl.length&&(t=Nl[0],t.blockedOn===null);)c8(t),t.blockedOn===null&&Nl.shift()}var Th=Jo.ReactCurrentBatchConfig,mv=!0;function QB(n,e,t,r){var s=qt,i=Th.transition;Th.transition=null;try{qt=1,dx(n,e,t,r)}finally{qt=s,Th.transition=i}}function YB(n,e,t,r){var s=qt,i=Th.transition;Th.transition=null;try{qt=4,dx(n,e,t,r)}finally{qt=s,Th.transition=i}}function dx(n,e,t,r){if(mv){var s=IT(n,e,t,r);if(s===null)NS(n,e,r,gv,t),P4(n,r);else if(qB(s,n,e,t,r))r.stopPropagation();else if(P4(n,r),e&4&&-1<HB.indexOf(n)){for(;s!==null;){var i=Qg(s);if(i!==null&&a8(i),i=IT(n,e,t,r),i===null&&NS(n,e,r,gv,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else NS(n,e,r,null,t)}}var gv=null;function IT(n,e,t,r){if(gv=null,n=ox(r),n=gc(n),n!==null)if(e=Zc(n),e===null)n=null;else if(t=e.tag,t===13){if(n=X6(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return gv=n,null}function d8(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(FB()){case lx:return 1;case n8:return 4;case fv:case $B:return 16;case r8:return 536870912;default:return 16}default:return 16}}var $l=null,hx=null,R0=null;function h8(){if(R0)return R0;var n,e=hx,t=e.length,r,s="value"in $l?$l.value:$l.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===s[i-r];r++);return R0=s.slice(n,1<r?1-r:void 0)}function N0(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function jy(){return!0}function R4(){return!1}function di(n){function e(t,r,s,i,a){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?jy:R4,this.isPropagationStopped=R4,this}return bn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=jy)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=jy)},persist:function(){},isPersistent:jy}),e}var yf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fx=di(yf),Kg=bn({},yf,{view:0,detail:0}),JB=di(Kg),SS,TS,Lp,Yw=bn({},Kg,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:px,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Lp&&(Lp&&n.type==="mousemove"?(SS=n.screenX-Lp.screenX,TS=n.screenY-Lp.screenY):TS=SS=0,Lp=n),SS)},movementY:function(n){return"movementY"in n?n.movementY:TS}}),N4=di(Yw),XB=bn({},Yw,{dataTransfer:0}),ZB=di(XB),ez=bn({},Kg,{relatedTarget:0}),CS=di(ez),tz=bn({},yf,{animationName:0,elapsedTime:0,pseudoElement:0}),nz=di(tz),rz=bn({},yf,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),sz=di(rz),iz=bn({},yf,{data:0}),O4=di(iz),az={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},oz={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lz={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function uz(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=lz[n])?!!e[n]:!1}function px(){return uz}var cz=bn({},Kg,{key:function(n){if(n.key){var e=az[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=N0(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?oz[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:px,charCode:function(n){return n.type==="keypress"?N0(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?N0(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),dz=di(cz),hz=bn({},Yw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),L4=di(hz),fz=bn({},Kg,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:px}),pz=di(fz),mz=bn({},yf,{propertyName:0,elapsedTime:0,pseudoElement:0}),gz=di(mz),_z=bn({},Yw,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),yz=di(_z),vz=[9,13,27,32],mx=Uo&&"CompositionEvent"in window,vm=null;Uo&&"documentMode"in document&&(vm=document.documentMode);var wz=Uo&&"TextEvent"in window&&!vm,f8=Uo&&(!mx||vm&&8<vm&&11>=vm),M4=" ",D4=!1;function p8(n,e){switch(n){case"keyup":return vz.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function m8(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ah=!1;function bz(n,e){switch(n){case"compositionend":return m8(e);case"keypress":return e.which!==32?null:(D4=!0,M4);case"textInput":return n=e.data,n===M4&&D4?null:n;default:return null}}function Ez(n,e){if(ah)return n==="compositionend"||!mx&&p8(n,e)?(n=h8(),R0=hx=$l=null,ah=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return f8&&e.locale!=="ko"?null:e.data;default:return null}}var Sz={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function F4(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!Sz[n.type]:e==="textarea"}function g8(n,e,t,r){q6(r),e=_v(e,"onChange"),0<e.length&&(t=new fx("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var wm=null,ng=null;function Tz(n){x8(n,0)}function Jw(n){var e=uh(n);if(U6(e))return n}function Cz(n,e){if(n==="change")return e}var _8=!1;if(Uo){var IS;if(Uo){var xS="oninput"in document;if(!xS){var $4=document.createElement("div");$4.setAttribute("oninput","return;"),xS=typeof $4.oninput=="function"}IS=xS}else IS=!1;_8=IS&&(!document.documentMode||9<document.documentMode)}function j4(){wm&&(wm.detachEvent("onpropertychange",y8),ng=wm=null)}function y8(n){if(n.propertyName==="value"&&Jw(ng)){var e=[];g8(e,ng,n,ox(n)),J6(Tz,e)}}function Iz(n,e,t){n==="focusin"?(j4(),wm=e,ng=t,wm.attachEvent("onpropertychange",y8)):n==="focusout"&&j4()}function xz(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Jw(ng)}function kz(n,e){if(n==="click")return Jw(e)}function Pz(n,e){if(n==="input"||n==="change")return Jw(e)}function Az(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var ca=typeof Object.is=="function"?Object.is:Az;function rg(n,e){if(ca(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!lT.call(e,s)||!ca(n[s],e[s]))return!1}return!0}function U4(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function V4(n,e){var t=U4(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=U4(t)}}function v8(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?v8(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function w8(){for(var n=window,e=cv();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=cv(n.document)}return e}function gx(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function Rz(n){var e=w8(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&v8(t.ownerDocument.documentElement,t)){if(r!==null&&gx(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=V4(t,i);var a=V4(t,r);s&&a&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Nz=Uo&&"documentMode"in document&&11>=document.documentMode,oh=null,xT=null,bm=null,kT=!1;function B4(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;kT||oh==null||oh!==cv(r)||(r=oh,"selectionStart"in r&&gx(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),bm&&rg(bm,r)||(bm=r,r=_v(xT,"onSelect"),0<r.length&&(e=new fx("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=oh)))}function Uy(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var lh={animationend:Uy("Animation","AnimationEnd"),animationiteration:Uy("Animation","AnimationIteration"),animationstart:Uy("Animation","AnimationStart"),transitionend:Uy("Transition","TransitionEnd")},kS={},b8={};Uo&&(b8=document.createElement("div").style,"AnimationEvent"in window||(delete lh.animationend.animation,delete lh.animationiteration.animation,delete lh.animationstart.animation),"TransitionEvent"in window||delete lh.transitionend.transition);function Xw(n){if(kS[n])return kS[n];if(!lh[n])return n;var e=lh[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in b8)return kS[n]=e[t];return n}var E8=Xw("animationend"),S8=Xw("animationiteration"),T8=Xw("animationstart"),C8=Xw("transitionend"),I8=new Map,z4="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xu(n,e){I8.set(n,e),Xc(e,[n])}for(var PS=0;PS<z4.length;PS++){var AS=z4[PS],Oz=AS.toLowerCase(),Lz=AS[0].toUpperCase()+AS.slice(1);xu(Oz,"on"+Lz)}xu(E8,"onAnimationEnd");xu(S8,"onAnimationIteration");xu(T8,"onAnimationStart");xu("dblclick","onDoubleClick");xu("focusin","onFocus");xu("focusout","onBlur");xu(C8,"onTransitionEnd");Dh("onMouseEnter",["mouseout","mouseover"]);Dh("onMouseLeave",["mouseout","mouseover"]);Dh("onPointerEnter",["pointerout","pointerover"]);Dh("onPointerLeave",["pointerout","pointerover"]);Xc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Xc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Xc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Xc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Xc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Xc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mz=new Set("cancel close invalid load scroll toggle".split(" ").concat(Jp));function G4(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,OB(r,e,void 0,n),n.currentTarget=null}function x8(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==i&&s.isPropagationStopped())break e;G4(s,o,u),i=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==i&&s.isPropagationStopped())break e;G4(s,o,u),i=l}}}if(hv)throw n=ST,hv=!1,ST=null,n}function ln(n,e){var t=e[OT];t===void 0&&(t=e[OT]=new Set);var r=n+"__bubble";t.has(r)||(k8(e,n,2,!1),t.add(r))}function RS(n,e,t){var r=0;e&&(r|=4),k8(t,n,r,e)}var Vy="_reactListening"+Math.random().toString(36).slice(2);function sg(n){if(!n[Vy]){n[Vy]=!0,M6.forEach(function(t){t!=="selectionchange"&&(Mz.has(t)||RS(t,!1,n),RS(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Vy]||(e[Vy]=!0,RS("selectionchange",!1,e))}}function k8(n,e,t,r){switch(d8(e)){case 1:var s=QB;break;case 4:s=YB;break;default:s=dx}t=s.bind(null,e,t,n),s=void 0,!ET||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function NS(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;a=a.return}for(;o!==null;){if(a=gc(o),a===null)return;if(l=a.tag,l===5||l===6){r=i=a;continue e}o=o.parentNode}}r=r.return}J6(function(){var u=i,h=ox(t),f=[];e:{var p=I8.get(n);if(p!==void 0){var y=fx,_=n;switch(n){case"keypress":if(N0(t)===0)break e;case"keydown":case"keyup":y=dz;break;case"focusin":_="focus",y=CS;break;case"focusout":_="blur",y=CS;break;case"beforeblur":case"afterblur":y=CS;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=N4;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=ZB;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=pz;break;case E8:case S8:case T8:y=nz;break;case C8:y=gz;break;case"scroll":y=JB;break;case"wheel":y=yz;break;case"copy":case"cut":case"paste":y=sz;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=L4}var b=(e&4)!==0,S=!b&&n==="scroll",E=b?p!==null?p+"Capture":null:p;b=[];for(var C=u,v;C!==null;){v=C;var I=v.stateNode;if(v.tag===5&&I!==null&&(v=I,E!==null&&(I=Xm(C,E),I!=null&&b.push(ig(C,I,v)))),S)break;C=C.return}0<b.length&&(p=new y(p,_,null,t,h),f.push({event:p,listeners:b}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",p&&t!==wT&&(_=t.relatedTarget||t.fromElement)&&(gc(_)||_[Vo]))break e;if((y||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,y?(_=t.relatedTarget||t.toElement,y=u,_=_?gc(_):null,_!==null&&(S=Zc(_),_!==S||_.tag!==5&&_.tag!==6)&&(_=null)):(y=null,_=u),y!==_)){if(b=N4,I="onMouseLeave",E="onMouseEnter",C="mouse",(n==="pointerout"||n==="pointerover")&&(b=L4,I="onPointerLeave",E="onPointerEnter",C="pointer"),S=y==null?p:uh(y),v=_==null?p:uh(_),p=new b(I,C+"leave",y,t,h),p.target=S,p.relatedTarget=v,I=null,gc(h)===u&&(b=new b(E,C+"enter",_,t,h),b.target=v,b.relatedTarget=S,I=b),S=I,y&&_)t:{for(b=y,E=_,C=0,v=b;v;v=jd(v))C++;for(v=0,I=E;I;I=jd(I))v++;for(;0<C-v;)b=jd(b),C--;for(;0<v-C;)E=jd(E),v--;for(;C--;){if(b===E||E!==null&&b===E.alternate)break t;b=jd(b),E=jd(E)}b=null}else b=null;y!==null&&W4(f,p,y,b,!1),_!==null&&S!==null&&W4(f,S,_,b,!0)}}e:{if(p=u?uh(u):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var L=Cz;else if(F4(p))if(_8)L=Pz;else{L=xz;var R=Iz}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(L=kz);if(L&&(L=L(n,u))){g8(f,L,t,h);break e}R&&R(n,p,u),n==="focusout"&&(R=p._wrapperState)&&R.controlled&&p.type==="number"&&mT(p,"number",p.value)}switch(R=u?uh(u):window,n){case"focusin":(F4(R)||R.contentEditable==="true")&&(oh=R,xT=u,bm=null);break;case"focusout":bm=xT=oh=null;break;case"mousedown":kT=!0;break;case"contextmenu":case"mouseup":case"dragend":kT=!1,B4(f,t,h);break;case"selectionchange":if(Nz)break;case"keydown":case"keyup":B4(f,t,h)}var P;if(mx)e:{switch(n){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else ah?p8(n,t)&&(x="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(x="onCompositionStart");x&&(f8&&t.locale!=="ko"&&(ah||x!=="onCompositionStart"?x==="onCompositionEnd"&&ah&&(P=h8()):($l=h,hx="value"in $l?$l.value:$l.textContent,ah=!0)),R=_v(u,x),0<R.length&&(x=new O4(x,n,null,t,h),f.push({event:x,listeners:R}),P?x.data=P:(P=m8(t),P!==null&&(x.data=P)))),(P=wz?bz(n,t):Ez(n,t))&&(u=_v(u,"onBeforeInput"),0<u.length&&(h=new O4("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=P))}x8(f,e)})}function ig(n,e,t){return{instance:n,listener:e,currentTarget:t}}function _v(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Xm(n,t),i!=null&&r.unshift(ig(n,i,s)),i=Xm(n,e),i!=null&&r.push(ig(n,i,s))),n=n.return}return r}function jd(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function W4(n,e,t,r,s){for(var i=e._reactName,a=[];t!==null&&t!==r;){var o=t,l=o.alternate,u=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&u!==null&&(o=u,s?(l=Xm(t,i),l!=null&&a.unshift(ig(t,l,o))):s||(l=Xm(t,i),l!=null&&a.push(ig(t,l,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var Dz=/\r\n?/g,Fz=/\u0000|\uFFFD/g;function H4(n){return(typeof n=="string"?n:""+n).replace(Dz,`
`).replace(Fz,"")}function By(n,e,t){if(e=H4(e),H4(n)!==e&&t)throw Error(he(425))}function yv(){}var PT=null,AT=null;function RT(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var NT=typeof setTimeout=="function"?setTimeout:void 0,$z=typeof clearTimeout=="function"?clearTimeout:void 0,q4=typeof Promise=="function"?Promise:void 0,jz=typeof queueMicrotask=="function"?queueMicrotask:typeof q4<"u"?function(n){return q4.resolve(null).then(n).catch(Uz)}:NT;function Uz(n){setTimeout(function(){throw n})}function OS(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),tg(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);tg(e)}function Jl(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function K4(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var vf=Math.random().toString(36).slice(2),$a="__reactFiber$"+vf,ag="__reactProps$"+vf,Vo="__reactContainer$"+vf,OT="__reactEvents$"+vf,Vz="__reactListeners$"+vf,Bz="__reactHandles$"+vf;function gc(n){var e=n[$a];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Vo]||t[$a]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=K4(n);n!==null;){if(t=n[$a])return t;n=K4(n)}return e}n=t,t=n.parentNode}return null}function Qg(n){return n=n[$a]||n[Vo],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function uh(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(he(33))}function Zw(n){return n[ag]||null}var LT=[],ch=-1;function ku(n){return{current:n}}function un(n){0>ch||(n.current=LT[ch],LT[ch]=null,ch--)}function an(n,e){ch++,LT[ch]=n.current,n.current=e}var cu={},as=ku(cu),Gs=ku(!1),Ac=cu;function Fh(n,e){var t=n.type.contextTypes;if(!t)return cu;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function Ws(n){return n=n.childContextTypes,n!=null}function vv(){un(Gs),un(as)}function Q4(n,e,t){if(as.current!==cu)throw Error(he(168));an(as,e),an(Gs,t)}function P8(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(he(108,IB(n)||"Unknown",s));return bn({},t,r)}function wv(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||cu,Ac=as.current,an(as,n),an(Gs,Gs.current),!0}function Y4(n,e,t){var r=n.stateNode;if(!r)throw Error(he(169));t?(n=P8(n,e,Ac),r.__reactInternalMemoizedMergedChildContext=n,un(Gs),un(as),an(as,n)):un(Gs),an(Gs,t)}var Co=null,e1=!1,LS=!1;function A8(n){Co===null?Co=[n]:Co.push(n)}function zz(n){e1=!0,A8(n)}function Pu(){if(!LS&&Co!==null){LS=!0;var n=0,e=qt;try{var t=Co;for(qt=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Co=null,e1=!1}catch(s){throw Co!==null&&(Co=Co.slice(n+1)),t8(lx,Pu),s}finally{qt=e,LS=!1}}return null}var dh=[],hh=0,bv=null,Ev=0,Si=[],Ti=0,Rc=null,xo=1,ko="";function uc(n,e){dh[hh++]=Ev,dh[hh++]=bv,bv=n,Ev=e}function R8(n,e,t){Si[Ti++]=xo,Si[Ti++]=ko,Si[Ti++]=Rc,Rc=n;var r=xo;n=ko;var s=32-sa(r)-1;r&=~(1<<s),t+=1;var i=32-sa(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,xo=1<<32-sa(e)+s|t<<s|r,ko=i+n}else xo=1<<i|t<<s|r,ko=n}function _x(n){n.return!==null&&(uc(n,1),R8(n,1,0))}function yx(n){for(;n===bv;)bv=dh[--hh],dh[hh]=null,Ev=dh[--hh],dh[hh]=null;for(;n===Rc;)Rc=Si[--Ti],Si[Ti]=null,ko=Si[--Ti],Si[Ti]=null,xo=Si[--Ti],Si[Ti]=null}var ri=null,ei=null,hn=!1,ea=null;function N8(n,e){var t=Ci(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function J4(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,ri=n,ei=Jl(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,ri=n,ei=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Rc!==null?{id:xo,overflow:ko}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Ci(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,ri=n,ei=null,!0):!1;default:return!1}}function MT(n){return(n.mode&1)!==0&&(n.flags&128)===0}function DT(n){if(hn){var e=ei;if(e){var t=e;if(!J4(n,e)){if(MT(n))throw Error(he(418));e=Jl(t.nextSibling);var r=ri;e&&J4(n,e)?N8(r,t):(n.flags=n.flags&-4097|2,hn=!1,ri=n)}}else{if(MT(n))throw Error(he(418));n.flags=n.flags&-4097|2,hn=!1,ri=n}}}function X4(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;ri=n}function zy(n){if(n!==ri)return!1;if(!hn)return X4(n),hn=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!RT(n.type,n.memoizedProps)),e&&(e=ei)){if(MT(n))throw O8(),Error(he(418));for(;e;)N8(n,e),e=Jl(e.nextSibling)}if(X4(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(he(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){ei=Jl(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}ei=null}}else ei=ri?Jl(n.stateNode.nextSibling):null;return!0}function O8(){for(var n=ei;n;)n=Jl(n.nextSibling)}function $h(){ei=ri=null,hn=!1}function vx(n){ea===null?ea=[n]:ea.push(n)}var Gz=Jo.ReactCurrentBatchConfig;function Mp(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(he(309));var r=t.stateNode}if(!r)throw Error(he(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=s.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof n!="string")throw Error(he(284));if(!t._owner)throw Error(he(290,n))}return n}function Gy(n,e){throw n=Object.prototype.toString.call(e),Error(he(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Z4(n){var e=n._init;return e(n._payload)}function L8(n){function e(E,C){if(n){var v=E.deletions;v===null?(E.deletions=[C],E.flags|=16):v.push(C)}}function t(E,C){if(!n)return null;for(;C!==null;)e(E,C),C=C.sibling;return null}function r(E,C){for(E=new Map;C!==null;)C.key!==null?E.set(C.key,C):E.set(C.index,C),C=C.sibling;return E}function s(E,C){return E=tu(E,C),E.index=0,E.sibling=null,E}function i(E,C,v){return E.index=v,n?(v=E.alternate,v!==null?(v=v.index,v<C?(E.flags|=2,C):v):(E.flags|=2,C)):(E.flags|=1048576,C)}function a(E){return n&&E.alternate===null&&(E.flags|=2),E}function o(E,C,v,I){return C===null||C.tag!==6?(C=VS(v,E.mode,I),C.return=E,C):(C=s(C,v),C.return=E,C)}function l(E,C,v,I){var L=v.type;return L===ih?h(E,C,v.props.children,I,v.key):C!==null&&(C.elementType===L||typeof L=="object"&&L!==null&&L.$$typeof===xl&&Z4(L)===C.type)?(I=s(C,v.props),I.ref=Mp(E,C,v),I.return=E,I):(I=j0(v.type,v.key,v.props,null,E.mode,I),I.ref=Mp(E,C,v),I.return=E,I)}function u(E,C,v,I){return C===null||C.tag!==4||C.stateNode.containerInfo!==v.containerInfo||C.stateNode.implementation!==v.implementation?(C=BS(v,E.mode,I),C.return=E,C):(C=s(C,v.children||[]),C.return=E,C)}function h(E,C,v,I,L){return C===null||C.tag!==7?(C=xc(v,E.mode,I,L),C.return=E,C):(C=s(C,v),C.return=E,C)}function f(E,C,v){if(typeof C=="string"&&C!==""||typeof C=="number")return C=VS(""+C,E.mode,v),C.return=E,C;if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Oy:return v=j0(C.type,C.key,C.props,null,E.mode,v),v.ref=Mp(E,null,C),v.return=E,v;case sh:return C=BS(C,E.mode,v),C.return=E,C;case xl:var I=C._init;return f(E,I(C._payload),v)}if(Qp(C)||Ap(C))return C=xc(C,E.mode,v,null),C.return=E,C;Gy(E,C)}return null}function p(E,C,v,I){var L=C!==null?C.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return L!==null?null:o(E,C,""+v,I);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Oy:return v.key===L?l(E,C,v,I):null;case sh:return v.key===L?u(E,C,v,I):null;case xl:return L=v._init,p(E,C,L(v._payload),I)}if(Qp(v)||Ap(v))return L!==null?null:h(E,C,v,I,null);Gy(E,v)}return null}function y(E,C,v,I,L){if(typeof I=="string"&&I!==""||typeof I=="number")return E=E.get(v)||null,o(C,E,""+I,L);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Oy:return E=E.get(I.key===null?v:I.key)||null,l(C,E,I,L);case sh:return E=E.get(I.key===null?v:I.key)||null,u(C,E,I,L);case xl:var R=I._init;return y(E,C,v,R(I._payload),L)}if(Qp(I)||Ap(I))return E=E.get(v)||null,h(C,E,I,L,null);Gy(C,I)}return null}function _(E,C,v,I){for(var L=null,R=null,P=C,x=C=0,N=null;P!==null&&x<v.length;x++){P.index>x?(N=P,P=null):N=P.sibling;var M=p(E,P,v[x],I);if(M===null){P===null&&(P=N);break}n&&P&&M.alternate===null&&e(E,P),C=i(M,C,x),R===null?L=M:R.sibling=M,R=M,P=N}if(x===v.length)return t(E,P),hn&&uc(E,x),L;if(P===null){for(;x<v.length;x++)P=f(E,v[x],I),P!==null&&(C=i(P,C,x),R===null?L=P:R.sibling=P,R=P);return hn&&uc(E,x),L}for(P=r(E,P);x<v.length;x++)N=y(P,E,x,v[x],I),N!==null&&(n&&N.alternate!==null&&P.delete(N.key===null?x:N.key),C=i(N,C,x),R===null?L=N:R.sibling=N,R=N);return n&&P.forEach(function(D){return e(E,D)}),hn&&uc(E,x),L}function b(E,C,v,I){var L=Ap(v);if(typeof L!="function")throw Error(he(150));if(v=L.call(v),v==null)throw Error(he(151));for(var R=L=null,P=C,x=C=0,N=null,M=v.next();P!==null&&!M.done;x++,M=v.next()){P.index>x?(N=P,P=null):N=P.sibling;var D=p(E,P,M.value,I);if(D===null){P===null&&(P=N);break}n&&P&&D.alternate===null&&e(E,P),C=i(D,C,x),R===null?L=D:R.sibling=D,R=D,P=N}if(M.done)return t(E,P),hn&&uc(E,x),L;if(P===null){for(;!M.done;x++,M=v.next())M=f(E,M.value,I),M!==null&&(C=i(M,C,x),R===null?L=M:R.sibling=M,R=M);return hn&&uc(E,x),L}for(P=r(E,P);!M.done;x++,M=v.next())M=y(P,E,x,M.value,I),M!==null&&(n&&M.alternate!==null&&P.delete(M.key===null?x:M.key),C=i(M,C,x),R===null?L=M:R.sibling=M,R=M);return n&&P.forEach(function(F){return e(E,F)}),hn&&uc(E,x),L}function S(E,C,v,I){if(typeof v=="object"&&v!==null&&v.type===ih&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Oy:e:{for(var L=v.key,R=C;R!==null;){if(R.key===L){if(L=v.type,L===ih){if(R.tag===7){t(E,R.sibling),C=s(R,v.props.children),C.return=E,E=C;break e}}else if(R.elementType===L||typeof L=="object"&&L!==null&&L.$$typeof===xl&&Z4(L)===R.type){t(E,R.sibling),C=s(R,v.props),C.ref=Mp(E,R,v),C.return=E,E=C;break e}t(E,R);break}else e(E,R);R=R.sibling}v.type===ih?(C=xc(v.props.children,E.mode,I,v.key),C.return=E,E=C):(I=j0(v.type,v.key,v.props,null,E.mode,I),I.ref=Mp(E,C,v),I.return=E,E=I)}return a(E);case sh:e:{for(R=v.key;C!==null;){if(C.key===R)if(C.tag===4&&C.stateNode.containerInfo===v.containerInfo&&C.stateNode.implementation===v.implementation){t(E,C.sibling),C=s(C,v.children||[]),C.return=E,E=C;break e}else{t(E,C);break}else e(E,C);C=C.sibling}C=BS(v,E.mode,I),C.return=E,E=C}return a(E);case xl:return R=v._init,S(E,C,R(v._payload),I)}if(Qp(v))return _(E,C,v,I);if(Ap(v))return b(E,C,v,I);Gy(E,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,C!==null&&C.tag===6?(t(E,C.sibling),C=s(C,v),C.return=E,E=C):(t(E,C),C=VS(v,E.mode,I),C.return=E,E=C),a(E)):t(E,C)}return S}var jh=L8(!0),M8=L8(!1),Sv=ku(null),Tv=null,fh=null,wx=null;function bx(){wx=fh=Tv=null}function Ex(n){var e=Sv.current;un(Sv),n._currentValue=e}function FT(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Ch(n,e){Tv=n,wx=fh=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Vs=!0),n.firstContext=null)}function Pi(n){var e=n._currentValue;if(wx!==n)if(n={context:n,memoizedValue:e,next:null},fh===null){if(Tv===null)throw Error(he(308));fh=n,Tv.dependencies={lanes:0,firstContext:n}}else fh=fh.next=n;return e}var _c=null;function Sx(n){_c===null?_c=[n]:_c.push(n)}function D8(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,Sx(e)):(t.next=s.next,s.next=t),e.interleaved=t,Bo(n,r)}function Bo(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var kl=!1;function Tx(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function F8(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Lo(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Xl(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Rt&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Bo(n,t)}return s=r.interleaved,s===null?(e.next=e,Sx(r)):(e.next=s.next,s.next=e),r.interleaved=e,Bo(n,t)}function O0(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,ux(n,t)}}function eN(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Cv(n,e,t,r){var s=n.updateQueue;kl=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?i=u:a.next=u,a=l;var h=n.alternate;h!==null&&(h=h.updateQueue,o=h.lastBaseUpdate,o!==a&&(o===null?h.firstBaseUpdate=u:o.next=u,h.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;a=0,h=u=l=null,o=i;do{var p=o.lane,y=o.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:y,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var _=n,b=o;switch(p=e,y=t,b.tag){case 1:if(_=b.payload,typeof _=="function"){f=_.call(y,f,p);break e}f=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=b.payload,p=typeof _=="function"?_.call(y,f,p):_,p==null)break e;f=bn({},f,p);break e;case 2:kl=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,p=s.effects,p===null?s.effects=[o]:p.push(o))}else y={eventTime:y,lane:p,tag:o.tag,payload:o.payload,callback:o.callback,next:null},h===null?(u=h=y,l=f):h=h.next=y,a|=p;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;p=o,o=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(!0);if(h===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Oc|=a,n.lanes=a,n.memoizedState=f}}function tN(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(he(191,s));s.call(r)}}}var Yg={},Wa=ku(Yg),og=ku(Yg),lg=ku(Yg);function yc(n){if(n===Yg)throw Error(he(174));return n}function Cx(n,e){switch(an(lg,e),an(og,n),an(Wa,Yg),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:_T(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=_T(e,n)}un(Wa),an(Wa,e)}function Uh(){un(Wa),un(og),un(lg)}function $8(n){yc(lg.current);var e=yc(Wa.current),t=_T(e,n.type);e!==t&&(an(og,n),an(Wa,t))}function Ix(n){og.current===n&&(un(Wa),un(og))}var _n=ku(0);function Iv(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var MS=[];function xx(){for(var n=0;n<MS.length;n++)MS[n]._workInProgressVersionPrimary=null;MS.length=0}var L0=Jo.ReactCurrentDispatcher,DS=Jo.ReactCurrentBatchConfig,Nc=0,wn=null,tr=null,yr=null,xv=!1,Em=!1,ug=0,Wz=0;function Xr(){throw Error(he(321))}function kx(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!ca(n[t],e[t]))return!1;return!0}function Px(n,e,t,r,s,i){if(Nc=i,wn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,L0.current=n===null||n.memoizedState===null?Qz:Yz,n=t(r,s),Em){i=0;do{if(Em=!1,ug=0,25<=i)throw Error(he(301));i+=1,yr=tr=null,e.updateQueue=null,L0.current=Jz,n=t(r,s)}while(Em)}if(L0.current=kv,e=tr!==null&&tr.next!==null,Nc=0,yr=tr=wn=null,xv=!1,e)throw Error(he(300));return n}function Ax(){var n=ug!==0;return ug=0,n}function Da(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yr===null?wn.memoizedState=yr=n:yr=yr.next=n,yr}function Ai(){if(tr===null){var n=wn.alternate;n=n!==null?n.memoizedState:null}else n=tr.next;var e=yr===null?wn.memoizedState:yr.next;if(e!==null)yr=e,tr=n;else{if(n===null)throw Error(he(310));tr=n,n={memoizedState:tr.memoizedState,baseState:tr.baseState,baseQueue:tr.baseQueue,queue:tr.queue,next:null},yr===null?wn.memoizedState=yr=n:yr=yr.next=n}return yr}function cg(n,e){return typeof e=="function"?e(n):e}function FS(n){var e=Ai(),t=e.queue;if(t===null)throw Error(he(311));t.lastRenderedReducer=n;var r=tr,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var o=a=null,l=null,u=i;do{var h=u.lane;if((Nc&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=f,a=r):l=l.next=f,wn.lanes|=h,Oc|=h}u=u.next}while(u!==null&&u!==i);l===null?a=r:l.next=o,ca(r,e.memoizedState)||(Vs=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,wn.lanes|=i,Oc|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function $S(n){var e=Ai(),t=e.queue;if(t===null)throw Error(he(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var a=s=s.next;do i=n(i,a.action),a=a.next;while(a!==s);ca(i,e.memoizedState)||(Vs=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function j8(){}function U8(n,e){var t=wn,r=Ai(),s=e(),i=!ca(r.memoizedState,s);if(i&&(r.memoizedState=s,Vs=!0),r=r.queue,Rx(z8.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||yr!==null&&yr.memoizedState.tag&1){if(t.flags|=2048,dg(9,B8.bind(null,t,r,s,e),void 0,null),Tr===null)throw Error(he(349));Nc&30||V8(t,e,s)}return s}function V8(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=wn.updateQueue,e===null?(e={lastEffect:null,stores:null},wn.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function B8(n,e,t,r){e.value=t,e.getSnapshot=r,G8(e)&&W8(n)}function z8(n,e,t){return t(function(){G8(e)&&W8(n)})}function G8(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!ca(n,t)}catch{return!0}}function W8(n){var e=Bo(n,1);e!==null&&ia(e,n,1,-1)}function nN(n){var e=Da();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cg,lastRenderedState:n},e.queue=n,n=n.dispatch=Kz.bind(null,wn,n),[e.memoizedState,n]}function dg(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=wn.updateQueue,e===null?(e={lastEffect:null,stores:null},wn.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function H8(){return Ai().memoizedState}function M0(n,e,t,r){var s=Da();wn.flags|=n,s.memoizedState=dg(1|e,t,void 0,r===void 0?null:r)}function t1(n,e,t,r){var s=Ai();r=r===void 0?null:r;var i=void 0;if(tr!==null){var a=tr.memoizedState;if(i=a.destroy,r!==null&&kx(r,a.deps)){s.memoizedState=dg(e,t,i,r);return}}wn.flags|=n,s.memoizedState=dg(1|e,t,i,r)}function rN(n,e){return M0(8390656,8,n,e)}function Rx(n,e){return t1(2048,8,n,e)}function q8(n,e){return t1(4,2,n,e)}function K8(n,e){return t1(4,4,n,e)}function Q8(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Y8(n,e,t){return t=t!=null?t.concat([n]):null,t1(4,4,Q8.bind(null,e,n),t)}function Nx(){}function J8(n,e){var t=Ai();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&kx(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function X8(n,e){var t=Ai();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&kx(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Z8(n,e,t){return Nc&21?(ca(t,e)||(t=s8(),wn.lanes|=t,Oc|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Vs=!0),n.memoizedState=t)}function Hz(n,e){var t=qt;qt=t!==0&&4>t?t:4,n(!0);var r=DS.transition;DS.transition={};try{n(!1),e()}finally{qt=t,DS.transition=r}}function eL(){return Ai().memoizedState}function qz(n,e,t){var r=eu(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},tL(n))nL(e,t);else if(t=D8(n,e,t,r),t!==null){var s=ws();ia(t,n,r,s),rL(t,e,r)}}function Kz(n,e,t){var r=eu(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(tL(n))nL(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,t);if(s.hasEagerState=!0,s.eagerState=o,ca(o,a)){var l=e.interleaved;l===null?(s.next=s,Sx(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=D8(n,e,s,r),t!==null&&(s=ws(),ia(t,n,r,s),rL(t,e,r))}}function tL(n){var e=n.alternate;return n===wn||e!==null&&e===wn}function nL(n,e){Em=xv=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function rL(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,ux(n,t)}}var kv={readContext:Pi,useCallback:Xr,useContext:Xr,useEffect:Xr,useImperativeHandle:Xr,useInsertionEffect:Xr,useLayoutEffect:Xr,useMemo:Xr,useReducer:Xr,useRef:Xr,useState:Xr,useDebugValue:Xr,useDeferredValue:Xr,useTransition:Xr,useMutableSource:Xr,useSyncExternalStore:Xr,useId:Xr,unstable_isNewReconciler:!1},Qz={readContext:Pi,useCallback:function(n,e){return Da().memoizedState=[n,e===void 0?null:e],n},useContext:Pi,useEffect:rN,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,M0(4194308,4,Q8.bind(null,e,n),t)},useLayoutEffect:function(n,e){return M0(4194308,4,n,e)},useInsertionEffect:function(n,e){return M0(4,2,n,e)},useMemo:function(n,e){var t=Da();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Da();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=qz.bind(null,wn,n),[r.memoizedState,n]},useRef:function(n){var e=Da();return n={current:n},e.memoizedState=n},useState:nN,useDebugValue:Nx,useDeferredValue:function(n){return Da().memoizedState=n},useTransition:function(){var n=nN(!1),e=n[0];return n=Hz.bind(null,n[1]),Da().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=wn,s=Da();if(hn){if(t===void 0)throw Error(he(407));t=t()}else{if(t=e(),Tr===null)throw Error(he(349));Nc&30||V8(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,rN(z8.bind(null,r,i,n),[n]),r.flags|=2048,dg(9,B8.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Da(),e=Tr.identifierPrefix;if(hn){var t=ko,r=xo;t=(r&~(1<<32-sa(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=ug++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=Wz++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},Yz={readContext:Pi,useCallback:J8,useContext:Pi,useEffect:Rx,useImperativeHandle:Y8,useInsertionEffect:q8,useLayoutEffect:K8,useMemo:X8,useReducer:FS,useRef:H8,useState:function(){return FS(cg)},useDebugValue:Nx,useDeferredValue:function(n){var e=Ai();return Z8(e,tr.memoizedState,n)},useTransition:function(){var n=FS(cg)[0],e=Ai().memoizedState;return[n,e]},useMutableSource:j8,useSyncExternalStore:U8,useId:eL,unstable_isNewReconciler:!1},Jz={readContext:Pi,useCallback:J8,useContext:Pi,useEffect:Rx,useImperativeHandle:Y8,useInsertionEffect:q8,useLayoutEffect:K8,useMemo:X8,useReducer:$S,useRef:H8,useState:function(){return $S(cg)},useDebugValue:Nx,useDeferredValue:function(n){var e=Ai();return tr===null?e.memoizedState=n:Z8(e,tr.memoizedState,n)},useTransition:function(){var n=$S(cg)[0],e=Ai().memoizedState;return[n,e]},useMutableSource:j8,useSyncExternalStore:U8,useId:eL,unstable_isNewReconciler:!1};function Ji(n,e){if(n&&n.defaultProps){e=bn({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function $T(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:bn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var n1={isMounted:function(n){return(n=n._reactInternals)?Zc(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=ws(),s=eu(n),i=Lo(r,s);i.payload=e,t!=null&&(i.callback=t),e=Xl(n,i,s),e!==null&&(ia(e,n,s,r),O0(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=ws(),s=eu(n),i=Lo(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Xl(n,i,s),e!==null&&(ia(e,n,s,r),O0(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=ws(),r=eu(n),s=Lo(t,r);s.tag=2,e!=null&&(s.callback=e),e=Xl(n,s,r),e!==null&&(ia(e,n,r,t),O0(e,n,r))}};function sN(n,e,t,r,s,i,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!rg(t,r)||!rg(s,i):!0}function sL(n,e,t){var r=!1,s=cu,i=e.contextType;return typeof i=="object"&&i!==null?i=Pi(i):(s=Ws(e)?Ac:as.current,r=e.contextTypes,i=(r=r!=null)?Fh(n,s):cu),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=n1,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function iN(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&n1.enqueueReplaceState(e,e.state,null)}function jT(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Tx(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Pi(i):(i=Ws(e)?Ac:as.current,s.context=Fh(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&($T(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&n1.enqueueReplaceState(s,s.state,null),Cv(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Vh(n,e){try{var t="",r=e;do t+=CB(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function jS(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function UT(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Xz=typeof WeakMap=="function"?WeakMap:Map;function iL(n,e,t){t=Lo(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Av||(Av=!0,YT=r),UT(n,e)},t}function aL(n,e,t){t=Lo(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){UT(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){UT(n,e),typeof r!="function"&&(Zl===null?Zl=new Set([this]):Zl.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function aN(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new Xz;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=hG.bind(null,n,e,t),e.then(n,n))}function oN(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function lN(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Lo(-1,1),e.tag=2,Xl(t,e,1))),t.lanes|=1),n)}var Zz=Jo.ReactCurrentOwner,Vs=!1;function _s(n,e,t,r){e.child=n===null?M8(e,null,t,r):jh(e,n.child,t,r)}function uN(n,e,t,r,s){t=t.render;var i=e.ref;return Ch(e,s),r=Px(n,e,t,r,i,s),t=Ax(),n!==null&&!Vs?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,zo(n,e,s)):(hn&&t&&_x(e),e.flags|=1,_s(n,e,r,s),e.child)}function cN(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!Ux(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,oL(n,e,i,r,s)):(n=j0(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:rg,t(a,r)&&n.ref===e.ref)return zo(n,e,s)}return e.flags|=1,n=tu(i,r),n.ref=e.ref,n.return=e,e.child=n}function oL(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(rg(i,r)&&n.ref===e.ref)if(Vs=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(Vs=!0);else return e.lanes=n.lanes,zo(n,e,s)}return VT(n,e,t,r,s)}function lL(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},an(mh,Zs),Zs|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,an(mh,Zs),Zs|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,an(mh,Zs),Zs|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,an(mh,Zs),Zs|=r;return _s(n,e,s,t),e.child}function uL(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function VT(n,e,t,r,s){var i=Ws(t)?Ac:as.current;return i=Fh(e,i),Ch(e,s),t=Px(n,e,t,r,i,s),r=Ax(),n!==null&&!Vs?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,zo(n,e,s)):(hn&&r&&_x(e),e.flags|=1,_s(n,e,t,s),e.child)}function dN(n,e,t,r,s){if(Ws(t)){var i=!0;wv(e)}else i=!1;if(Ch(e,s),e.stateNode===null)D0(n,e),sL(e,t,r),jT(e,t,r,s),r=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=Pi(u):(u=Ws(t)?Ac:as.current,u=Fh(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";f||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==u)&&iN(e,a,r,u),kl=!1;var p=e.memoizedState;a.state=p,Cv(e,r,a,s),l=e.memoizedState,o!==r||p!==l||Gs.current||kl?(typeof h=="function"&&($T(e,t,h,r),l=e.memoizedState),(o=kl||sN(e,t,o,r,p,l,u))?(f||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=u,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,F8(n,e),o=e.memoizedProps,u=e.type===e.elementType?o:Ji(e.type,o),a.props=u,f=e.pendingProps,p=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=Pi(l):(l=Ws(t)?Ac:as.current,l=Fh(e,l));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==f||p!==l)&&iN(e,a,r,l),kl=!1,p=e.memoizedState,a.state=p,Cv(e,r,a,s);var _=e.memoizedState;o!==f||p!==_||Gs.current||kl?(typeof y=="function"&&($T(e,t,y,r),_=e.memoizedState),(u=kl||sN(e,t,u,r,p,_,l)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,_,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,_,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=_),a.props=r,a.state=_,a.context=l,r=u):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),r=!1)}return BT(n,e,t,r,i,s)}function BT(n,e,t,r,s,i){uL(n,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&Y4(e,t,!1),zo(n,e,i);r=e.stateNode,Zz.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=jh(e,n.child,null,i),e.child=jh(e,null,o,i)):_s(n,e,o,i),e.memoizedState=r.state,s&&Y4(e,t,!0),e.child}function cL(n){var e=n.stateNode;e.pendingContext?Q4(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Q4(n,e.context,!1),Cx(n,e.containerInfo)}function hN(n,e,t,r,s){return $h(),vx(s),e.flags|=256,_s(n,e,t,r),e.child}var zT={dehydrated:null,treeContext:null,retryLane:0};function GT(n){return{baseLanes:n,cachePool:null,transitions:null}}function dL(n,e,t){var r=e.pendingProps,s=_n.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(s&2)!==0),o?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),an(_n,s&1),n===null)return DT(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,n=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=i1(a,r,0,null),n=xc(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=GT(t),e.memoizedState=zT,n):Ox(e,a));if(s=n.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return eG(n,e,a,r,o,s,t);if(i){i=r.fallback,a=e.mode,s=n.child,o=s.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=tu(s,l),r.subtreeFlags=s.subtreeFlags&14680064),o!==null?i=tu(o,i):(i=xc(i,a,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=n.child.memoizedState,a=a===null?GT(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=n.childLanes&~t,e.memoizedState=zT,r}return i=n.child,n=i.sibling,r=tu(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Ox(n,e){return e=i1({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Wy(n,e,t,r){return r!==null&&vx(r),jh(e,n.child,null,t),n=Ox(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function eG(n,e,t,r,s,i,a){if(t)return e.flags&256?(e.flags&=-257,r=jS(Error(he(422))),Wy(n,e,a,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=i1({mode:"visible",children:r.children},s,0,null),i=xc(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&jh(e,n.child,null,a),e.child.memoizedState=GT(a),e.memoizedState=zT,i);if(!(e.mode&1))return Wy(n,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var o=r.dgst;return r=o,i=Error(he(419)),r=jS(i,r,void 0),Wy(n,e,a,r)}if(o=(a&n.childLanes)!==0,Vs||o){if(r=Tr,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Bo(n,s),ia(r,n,s,-1))}return jx(),r=jS(Error(he(421))),Wy(n,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=fG.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,ei=Jl(s.nextSibling),ri=e,hn=!0,ea=null,n!==null&&(Si[Ti++]=xo,Si[Ti++]=ko,Si[Ti++]=Rc,xo=n.id,ko=n.overflow,Rc=e),e=Ox(e,r.children),e.flags|=4096,e)}function fN(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),FT(n.return,e,t)}function US(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function hL(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(_s(n,e,r.children,t),r=_n.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&fN(n,t,e);else if(n.tag===19)fN(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(an(_n,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Iv(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),US(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Iv(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}US(e,!0,t,null,i);break;case"together":US(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function D0(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function zo(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Oc|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(he(153));if(e.child!==null){for(n=e.child,t=tu(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=tu(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function tG(n,e,t){switch(e.tag){case 3:cL(e),$h();break;case 5:$8(e);break;case 1:Ws(e.type)&&wv(e);break;case 4:Cx(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;an(Sv,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(an(_n,_n.current&1),e.flags|=128,null):t&e.child.childLanes?dL(n,e,t):(an(_n,_n.current&1),n=zo(n,e,t),n!==null?n.sibling:null);an(_n,_n.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return hL(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),an(_n,_n.current),r)break;return null;case 22:case 23:return e.lanes=0,lL(n,e,t)}return zo(n,e,t)}var fL,WT,pL,mL;fL=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};WT=function(){};pL=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,yc(Wa.current);var i=null;switch(t){case"input":s=fT(n,s),r=fT(n,r),i=[];break;case"select":s=bn({},s,{value:void 0}),r=bn({},r,{value:void 0}),i=[];break;case"textarea":s=gT(n,s),r=gT(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=yv)}yT(t,r);var a;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var o=s[u];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ym.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(o=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ym.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&ln("scroll",n),i||o===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};mL=function(n,e,t,r){t!==r&&(e.flags|=4)};function Dp(n,e){if(!hn)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Zr(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function nG(n,e,t){var r=e.pendingProps;switch(yx(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zr(e),null;case 1:return Ws(e.type)&&vv(),Zr(e),null;case 3:return r=e.stateNode,Uh(),un(Gs),un(as),xx(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(zy(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ea!==null&&(ZT(ea),ea=null))),WT(n,e),Zr(e),null;case 5:Ix(e);var s=yc(lg.current);if(t=e.type,n!==null&&e.stateNode!=null)pL(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(he(166));return Zr(e),null}if(n=yc(Wa.current),zy(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[$a]=e,r[ag]=i,n=(e.mode&1)!==0,t){case"dialog":ln("cancel",r),ln("close",r);break;case"iframe":case"object":case"embed":ln("load",r);break;case"video":case"audio":for(s=0;s<Jp.length;s++)ln(Jp[s],r);break;case"source":ln("error",r);break;case"img":case"image":case"link":ln("error",r),ln("load",r);break;case"details":ln("toggle",r);break;case"input":E4(r,i),ln("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},ln("invalid",r);break;case"textarea":T4(r,i),ln("invalid",r)}yT(t,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?r.textContent!==o&&(i.suppressHydrationWarning!==!0&&By(r.textContent,o,n),s=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&By(r.textContent,o,n),s=["children",""+o]):Ym.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&ln("scroll",r)}switch(t){case"input":Ly(r),S4(r,i,!0);break;case"textarea":Ly(r),C4(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=yv)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=z6(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[$a]=e,n[ag]=r,fL(n,e,!1,!1),e.stateNode=n;e:{switch(a=vT(t,r),t){case"dialog":ln("cancel",n),ln("close",n),s=r;break;case"iframe":case"object":case"embed":ln("load",n),s=r;break;case"video":case"audio":for(s=0;s<Jp.length;s++)ln(Jp[s],n);s=r;break;case"source":ln("error",n),s=r;break;case"img":case"image":case"link":ln("error",n),ln("load",n),s=r;break;case"details":ln("toggle",n),s=r;break;case"input":E4(n,r),s=fT(n,r),ln("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=bn({},r,{value:void 0}),ln("invalid",n);break;case"textarea":T4(n,r),s=gT(n,r),ln("invalid",n);break;default:s=r}yT(t,s),o=s;for(i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="style"?H6(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&G6(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Jm(n,l):typeof l=="number"&&Jm(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ym.hasOwnProperty(i)?l!=null&&i==="onScroll"&&ln("scroll",n):l!=null&&rx(n,i,l,a))}switch(t){case"input":Ly(n),S4(n,r,!1);break;case"textarea":Ly(n),C4(n);break;case"option":r.value!=null&&n.setAttribute("value",""+uu(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?bh(n,!!r.multiple,i,!1):r.defaultValue!=null&&bh(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=yv)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Zr(e),null;case 6:if(n&&e.stateNode!=null)mL(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(he(166));if(t=yc(lg.current),yc(Wa.current),zy(e)){if(r=e.stateNode,t=e.memoizedProps,r[$a]=e,(i=r.nodeValue!==t)&&(n=ri,n!==null))switch(n.tag){case 3:By(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&By(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[$a]=e,e.stateNode=r}return Zr(e),null;case 13:if(un(_n),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(hn&&ei!==null&&e.mode&1&&!(e.flags&128))O8(),$h(),e.flags|=98560,i=!1;else if(i=zy(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(he(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(he(317));i[$a]=e}else $h(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Zr(e),i=!1}else ea!==null&&(ZT(ea),ea=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||_n.current&1?sr===0&&(sr=3):jx())),e.updateQueue!==null&&(e.flags|=4),Zr(e),null);case 4:return Uh(),WT(n,e),n===null&&sg(e.stateNode.containerInfo),Zr(e),null;case 10:return Ex(e.type._context),Zr(e),null;case 17:return Ws(e.type)&&vv(),Zr(e),null;case 19:if(un(_n),i=e.memoizedState,i===null)return Zr(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)Dp(i,!1);else{if(sr!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=Iv(n),a!==null){for(e.flags|=128,Dp(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,n=a.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return an(_n,_n.current&1|2),e.child}n=n.sibling}i.tail!==null&&An()>Bh&&(e.flags|=128,r=!0,Dp(i,!1),e.lanes=4194304)}else{if(!r)if(n=Iv(a),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Dp(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!hn)return Zr(e),null}else 2*An()-i.renderingStartTime>Bh&&t!==1073741824&&(e.flags|=128,r=!0,Dp(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=An(),e.sibling=null,t=_n.current,an(_n,r?t&1|2:t&1),e):(Zr(e),null);case 22:case 23:return $x(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Zs&1073741824&&(Zr(e),e.subtreeFlags&6&&(e.flags|=8192)):Zr(e),null;case 24:return null;case 25:return null}throw Error(he(156,e.tag))}function rG(n,e){switch(yx(e),e.tag){case 1:return Ws(e.type)&&vv(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Uh(),un(Gs),un(as),xx(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Ix(e),null;case 13:if(un(_n),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(he(340));$h()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return un(_n),null;case 4:return Uh(),null;case 10:return Ex(e.type._context),null;case 22:case 23:return $x(),null;case 24:return null;default:return null}}var Hy=!1,ns=!1,sG=typeof WeakSet=="function"?WeakSet:Set,Re=null;function ph(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Sn(n,e,r)}else t.current=null}function HT(n,e,t){try{t()}catch(r){Sn(n,e,r)}}var pN=!1;function iG(n,e){if(PT=mv,n=w8(),gx(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,u=0,h=0,f=n,p=null;t:for(;;){for(var y;f!==t||s!==0&&f.nodeType!==3||(o=a+s),f!==i||r!==0&&f.nodeType!==3||(l=a+r),f.nodeType===3&&(a+=f.nodeValue.length),(y=f.firstChild)!==null;)p=f,f=y;for(;;){if(f===n)break t;if(p===t&&++u===s&&(o=a),p===i&&++h===r&&(l=a),(y=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=y}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(AT={focusedElem:n,selectionRange:t},mv=!1,Re=e;Re!==null;)if(e=Re,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Re=n;else for(;Re!==null;){e=Re;try{var _=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var b=_.memoizedProps,S=_.memoizedState,E=e.stateNode,C=E.getSnapshotBeforeUpdate(e.elementType===e.type?b:Ji(e.type,b),S);E.__reactInternalSnapshotBeforeUpdate=C}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(he(163))}}catch(I){Sn(e,e.return,I)}if(n=e.sibling,n!==null){n.return=e.return,Re=n;break}Re=e.return}return _=pN,pN=!1,_}function Sm(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&HT(e,t,i)}s=s.next}while(s!==r)}}function r1(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function qT(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function gL(n){var e=n.alternate;e!==null&&(n.alternate=null,gL(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[$a],delete e[ag],delete e[OT],delete e[Vz],delete e[Bz])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function _L(n){return n.tag===5||n.tag===3||n.tag===4}function mN(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||_L(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function KT(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=yv));else if(r!==4&&(n=n.child,n!==null))for(KT(n,e,t),n=n.sibling;n!==null;)KT(n,e,t),n=n.sibling}function QT(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(QT(n,e,t),n=n.sibling;n!==null;)QT(n,e,t),n=n.sibling}var Lr=null,Zi=!1;function vl(n,e,t){for(t=t.child;t!==null;)yL(n,e,t),t=t.sibling}function yL(n,e,t){if(Ga&&typeof Ga.onCommitFiberUnmount=="function")try{Ga.onCommitFiberUnmount(Qw,t)}catch{}switch(t.tag){case 5:ns||ph(t,e);case 6:var r=Lr,s=Zi;Lr=null,vl(n,e,t),Lr=r,Zi=s,Lr!==null&&(Zi?(n=Lr,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Lr.removeChild(t.stateNode));break;case 18:Lr!==null&&(Zi?(n=Lr,t=t.stateNode,n.nodeType===8?OS(n.parentNode,t):n.nodeType===1&&OS(n,t),tg(n)):OS(Lr,t.stateNode));break;case 4:r=Lr,s=Zi,Lr=t.stateNode.containerInfo,Zi=!0,vl(n,e,t),Lr=r,Zi=s;break;case 0:case 11:case 14:case 15:if(!ns&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&HT(t,e,a),s=s.next}while(s!==r)}vl(n,e,t);break;case 1:if(!ns&&(ph(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(o){Sn(t,e,o)}vl(n,e,t);break;case 21:vl(n,e,t);break;case 22:t.mode&1?(ns=(r=ns)||t.memoizedState!==null,vl(n,e,t),ns=r):vl(n,e,t);break;default:vl(n,e,t)}}function gN(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new sG),e.forEach(function(r){var s=pG.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function zi(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:Lr=o.stateNode,Zi=!1;break e;case 3:Lr=o.stateNode.containerInfo,Zi=!0;break e;case 4:Lr=o.stateNode.containerInfo,Zi=!0;break e}o=o.return}if(Lr===null)throw Error(he(160));yL(i,a,s),Lr=null,Zi=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){Sn(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)vL(e,n),e=e.sibling}function vL(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(zi(e,n),Ra(n),r&4){try{Sm(3,n,n.return),r1(3,n)}catch(b){Sn(n,n.return,b)}try{Sm(5,n,n.return)}catch(b){Sn(n,n.return,b)}}break;case 1:zi(e,n),Ra(n),r&512&&t!==null&&ph(t,t.return);break;case 5:if(zi(e,n),Ra(n),r&512&&t!==null&&ph(t,t.return),n.flags&32){var s=n.stateNode;try{Jm(s,"")}catch(b){Sn(n,n.return,b)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,a=t!==null?t.memoizedProps:i,o=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&V6(s,i),vT(o,a);var u=vT(o,i);for(a=0;a<l.length;a+=2){var h=l[a],f=l[a+1];h==="style"?H6(s,f):h==="dangerouslySetInnerHTML"?G6(s,f):h==="children"?Jm(s,f):rx(s,h,f,u)}switch(o){case"input":pT(s,i);break;case"textarea":B6(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?bh(s,!!i.multiple,y,!1):p!==!!i.multiple&&(i.defaultValue!=null?bh(s,!!i.multiple,i.defaultValue,!0):bh(s,!!i.multiple,i.multiple?[]:"",!1))}s[ag]=i}catch(b){Sn(n,n.return,b)}}break;case 6:if(zi(e,n),Ra(n),r&4){if(n.stateNode===null)throw Error(he(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(b){Sn(n,n.return,b)}}break;case 3:if(zi(e,n),Ra(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{tg(e.containerInfo)}catch(b){Sn(n,n.return,b)}break;case 4:zi(e,n),Ra(n);break;case 13:zi(e,n),Ra(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Dx=An())),r&4&&gN(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(ns=(u=ns)||h,zi(e,n),ns=u):zi(e,n),Ra(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(Re=n,h=n.child;h!==null;){for(f=Re=h;Re!==null;){switch(p=Re,y=p.child,p.tag){case 0:case 11:case 14:case 15:Sm(4,p,p.return);break;case 1:ph(p,p.return);var _=p.stateNode;if(typeof _.componentWillUnmount=="function"){r=p,t=p.return;try{e=r,_.props=e.memoizedProps,_.state=e.memoizedState,_.componentWillUnmount()}catch(b){Sn(r,t,b)}}break;case 5:ph(p,p.return);break;case 22:if(p.memoizedState!==null){yN(f);continue}}y!==null?(y.return=p,Re=y):yN(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=f.stateNode,l=f.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=W6("display",a))}catch(b){Sn(n,n.return,b)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(b){Sn(n,n.return,b)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:zi(e,n),Ra(n),r&4&&gN(n);break;case 21:break;default:zi(e,n),Ra(n)}}function Ra(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(_L(t)){var r=t;break e}t=t.return}throw Error(he(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Jm(s,""),r.flags&=-33);var i=mN(n);QT(n,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,o=mN(n);KT(n,o,a);break;default:throw Error(he(161))}}catch(l){Sn(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function aG(n,e,t){Re=n,wL(n)}function wL(n,e,t){for(var r=(n.mode&1)!==0;Re!==null;){var s=Re,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||Hy;if(!a){var o=s.alternate,l=o!==null&&o.memoizedState!==null||ns;o=Hy;var u=ns;if(Hy=a,(ns=l)&&!u)for(Re=s;Re!==null;)a=Re,l=a.child,a.tag===22&&a.memoizedState!==null?vN(s):l!==null?(l.return=a,Re=l):vN(s);for(;i!==null;)Re=i,wL(i),i=i.sibling;Re=s,Hy=o,ns=u}_N(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Re=i):_N(n)}}function _N(n){for(;Re!==null;){var e=Re;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ns||r1(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ns)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Ji(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&tN(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}tN(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&tg(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(he(163))}ns||e.flags&512&&qT(e)}catch(p){Sn(e,e.return,p)}}if(e===n){Re=null;break}if(t=e.sibling,t!==null){t.return=e.return,Re=t;break}Re=e.return}}function yN(n){for(;Re!==null;){var e=Re;if(e===n){Re=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Re=t;break}Re=e.return}}function vN(n){for(;Re!==null;){var e=Re;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{r1(4,e)}catch(l){Sn(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Sn(e,s,l)}}var i=e.return;try{qT(e)}catch(l){Sn(e,i,l)}break;case 5:var a=e.return;try{qT(e)}catch(l){Sn(e,a,l)}}}catch(l){Sn(e,e.return,l)}if(e===n){Re=null;break}var o=e.sibling;if(o!==null){o.return=e.return,Re=o;break}Re=e.return}}var oG=Math.ceil,Pv=Jo.ReactCurrentDispatcher,Lx=Jo.ReactCurrentOwner,ki=Jo.ReactCurrentBatchConfig,Rt=0,Tr=null,Un=null,jr=0,Zs=0,mh=ku(0),sr=0,hg=null,Oc=0,s1=0,Mx=0,Tm=null,js=null,Dx=0,Bh=1/0,To=null,Av=!1,YT=null,Zl=null,qy=!1,jl=null,Rv=0,Cm=0,JT=null,F0=-1,$0=0;function ws(){return Rt&6?An():F0!==-1?F0:F0=An()}function eu(n){return n.mode&1?Rt&2&&jr!==0?jr&-jr:Gz.transition!==null?($0===0&&($0=s8()),$0):(n=qt,n!==0||(n=window.event,n=n===void 0?16:d8(n.type)),n):1}function ia(n,e,t,r){if(50<Cm)throw Cm=0,JT=null,Error(he(185));qg(n,t,r),(!(Rt&2)||n!==Tr)&&(n===Tr&&(!(Rt&2)&&(s1|=t),sr===4&&Ol(n,jr)),Hs(n,r),t===1&&Rt===0&&!(e.mode&1)&&(Bh=An()+500,e1&&Pu()))}function Hs(n,e){var t=n.callbackNode;GB(n,e);var r=pv(n,n===Tr?jr:0);if(r===0)t!==null&&k4(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&k4(t),e===1)n.tag===0?zz(wN.bind(null,n)):A8(wN.bind(null,n)),jz(function(){!(Rt&6)&&Pu()}),t=null;else{switch(i8(r)){case 1:t=lx;break;case 4:t=n8;break;case 16:t=fv;break;case 536870912:t=r8;break;default:t=fv}t=kL(t,bL.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function bL(n,e){if(F0=-1,$0=0,Rt&6)throw Error(he(327));var t=n.callbackNode;if(Ih()&&n.callbackNode!==t)return null;var r=pv(n,n===Tr?jr:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Nv(n,r);else{e=r;var s=Rt;Rt|=2;var i=SL();(Tr!==n||jr!==e)&&(To=null,Bh=An()+500,Ic(n,e));do try{cG();break}catch(o){EL(n,o)}while(!0);bx(),Pv.current=i,Rt=s,Un!==null?e=0:(Tr=null,jr=0,e=sr)}if(e!==0){if(e===2&&(s=TT(n),s!==0&&(r=s,e=XT(n,s))),e===1)throw t=hg,Ic(n,0),Ol(n,r),Hs(n,An()),t;if(e===6)Ol(n,r);else{if(s=n.current.alternate,!(r&30)&&!lG(s)&&(e=Nv(n,r),e===2&&(i=TT(n),i!==0&&(r=i,e=XT(n,i))),e===1))throw t=hg,Ic(n,0),Ol(n,r),Hs(n,An()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(he(345));case 2:cc(n,js,To);break;case 3:if(Ol(n,r),(r&130023424)===r&&(e=Dx+500-An(),10<e)){if(pv(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){ws(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=NT(cc.bind(null,n,js,To),e);break}cc(n,js,To);break;case 4:if(Ol(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var a=31-sa(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=An()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*oG(r/1960))-r,10<r){n.timeoutHandle=NT(cc.bind(null,n,js,To),r);break}cc(n,js,To);break;case 5:cc(n,js,To);break;default:throw Error(he(329))}}}return Hs(n,An()),n.callbackNode===t?bL.bind(null,n):null}function XT(n,e){var t=Tm;return n.current.memoizedState.isDehydrated&&(Ic(n,e).flags|=256),n=Nv(n,e),n!==2&&(e=js,js=t,e!==null&&ZT(e)),n}function ZT(n){js===null?js=n:js.push.apply(js,n)}function lG(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!ca(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ol(n,e){for(e&=~Mx,e&=~s1,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-sa(e),r=1<<t;n[t]=-1,e&=~r}}function wN(n){if(Rt&6)throw Error(he(327));Ih();var e=pv(n,0);if(!(e&1))return Hs(n,An()),null;var t=Nv(n,e);if(n.tag!==0&&t===2){var r=TT(n);r!==0&&(e=r,t=XT(n,r))}if(t===1)throw t=hg,Ic(n,0),Ol(n,e),Hs(n,An()),t;if(t===6)throw Error(he(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,cc(n,js,To),Hs(n,An()),null}function Fx(n,e){var t=Rt;Rt|=1;try{return n(e)}finally{Rt=t,Rt===0&&(Bh=An()+500,e1&&Pu())}}function Lc(n){jl!==null&&jl.tag===0&&!(Rt&6)&&Ih();var e=Rt;Rt|=1;var t=ki.transition,r=qt;try{if(ki.transition=null,qt=1,n)return n()}finally{qt=r,ki.transition=t,Rt=e,!(Rt&6)&&Pu()}}function $x(){Zs=mh.current,un(mh)}function Ic(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,$z(t)),Un!==null)for(t=Un.return;t!==null;){var r=t;switch(yx(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&vv();break;case 3:Uh(),un(Gs),un(as),xx();break;case 5:Ix(r);break;case 4:Uh();break;case 13:un(_n);break;case 19:un(_n);break;case 10:Ex(r.type._context);break;case 22:case 23:$x()}t=t.return}if(Tr=n,Un=n=tu(n.current,null),jr=Zs=e,sr=0,hg=null,Mx=s1=Oc=0,js=Tm=null,_c!==null){for(e=0;e<_c.length;e++)if(t=_c[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}t.pending=r}_c=null}return n}function EL(n,e){do{var t=Un;try{if(bx(),L0.current=kv,xv){for(var r=wn.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}xv=!1}if(Nc=0,yr=tr=wn=null,Em=!1,ug=0,Lx.current=null,t===null||t.return===null){sr=1,hg=e,Un=null;break}e:{var i=n,a=t.return,o=t,l=e;if(e=jr,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=o,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=oN(a);if(y!==null){y.flags&=-257,lN(y,a,o,i,e),y.mode&1&&aN(i,u,e),e=y,l=u;var _=e.updateQueue;if(_===null){var b=new Set;b.add(l),e.updateQueue=b}else _.add(l);break e}else{if(!(e&1)){aN(i,u,e),jx();break e}l=Error(he(426))}}else if(hn&&o.mode&1){var S=oN(a);if(S!==null){!(S.flags&65536)&&(S.flags|=256),lN(S,a,o,i,e),vx(Vh(l,o));break e}}i=l=Vh(l,o),sr!==4&&(sr=2),Tm===null?Tm=[i]:Tm.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var E=iL(i,l,e);eN(i,E);break e;case 1:o=l;var C=i.type,v=i.stateNode;if(!(i.flags&128)&&(typeof C.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Zl===null||!Zl.has(v)))){i.flags|=65536,e&=-e,i.lanes|=e;var I=aL(i,o,e);eN(i,I);break e}}i=i.return}while(i!==null)}CL(t)}catch(L){e=L,Un===t&&t!==null&&(Un=t=t.return);continue}break}while(!0)}function SL(){var n=Pv.current;return Pv.current=kv,n===null?kv:n}function jx(){(sr===0||sr===3||sr===2)&&(sr=4),Tr===null||!(Oc&268435455)&&!(s1&268435455)||Ol(Tr,jr)}function Nv(n,e){var t=Rt;Rt|=2;var r=SL();(Tr!==n||jr!==e)&&(To=null,Ic(n,e));do try{uG();break}catch(s){EL(n,s)}while(!0);if(bx(),Rt=t,Pv.current=r,Un!==null)throw Error(he(261));return Tr=null,jr=0,sr}function uG(){for(;Un!==null;)TL(Un)}function cG(){for(;Un!==null&&!MB();)TL(Un)}function TL(n){var e=xL(n.alternate,n,Zs);n.memoizedProps=n.pendingProps,e===null?CL(n):Un=e,Lx.current=null}function CL(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=rG(t,e),t!==null){t.flags&=32767,Un=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{sr=6,Un=null;return}}else if(t=nG(t,e,Zs),t!==null){Un=t;return}if(e=e.sibling,e!==null){Un=e;return}Un=e=n}while(e!==null);sr===0&&(sr=5)}function cc(n,e,t){var r=qt,s=ki.transition;try{ki.transition=null,qt=1,dG(n,e,t,r)}finally{ki.transition=s,qt=r}return null}function dG(n,e,t,r){do Ih();while(jl!==null);if(Rt&6)throw Error(he(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(he(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(WB(n,i),n===Tr&&(Un=Tr=null,jr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||qy||(qy=!0,kL(fv,function(){return Ih(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=ki.transition,ki.transition=null;var a=qt;qt=1;var o=Rt;Rt|=4,Lx.current=null,iG(n,t),vL(t,n),Rz(AT),mv=!!PT,AT=PT=null,n.current=t,aG(t),DB(),Rt=o,qt=a,ki.transition=i}else n.current=t;if(qy&&(qy=!1,jl=n,Rv=s),i=n.pendingLanes,i===0&&(Zl=null),jB(t.stateNode),Hs(n,An()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Av)throw Av=!1,n=YT,YT=null,n;return Rv&1&&n.tag!==0&&Ih(),i=n.pendingLanes,i&1?n===JT?Cm++:(Cm=0,JT=n):Cm=0,Pu(),null}function Ih(){if(jl!==null){var n=i8(Rv),e=ki.transition,t=qt;try{if(ki.transition=null,qt=16>n?16:n,jl===null)var r=!1;else{if(n=jl,jl=null,Rv=0,Rt&6)throw Error(he(331));var s=Rt;for(Rt|=4,Re=n.current;Re!==null;){var i=Re,a=i.child;if(Re.flags&16){var o=i.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(Re=u;Re!==null;){var h=Re;switch(h.tag){case 0:case 11:case 15:Sm(8,h,i)}var f=h.child;if(f!==null)f.return=h,Re=f;else for(;Re!==null;){h=Re;var p=h.sibling,y=h.return;if(gL(h),h===u){Re=null;break}if(p!==null){p.return=y,Re=p;break}Re=y}}}var _=i.alternate;if(_!==null){var b=_.child;if(b!==null){_.child=null;do{var S=b.sibling;b.sibling=null,b=S}while(b!==null)}}Re=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,Re=a;else e:for(;Re!==null;){if(i=Re,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Sm(9,i,i.return)}var E=i.sibling;if(E!==null){E.return=i.return,Re=E;break e}Re=i.return}}var C=n.current;for(Re=C;Re!==null;){a=Re;var v=a.child;if(a.subtreeFlags&2064&&v!==null)v.return=a,Re=v;else e:for(a=C;Re!==null;){if(o=Re,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:r1(9,o)}}catch(L){Sn(o,o.return,L)}if(o===a){Re=null;break e}var I=o.sibling;if(I!==null){I.return=o.return,Re=I;break e}Re=o.return}}if(Rt=s,Pu(),Ga&&typeof Ga.onPostCommitFiberRoot=="function")try{Ga.onPostCommitFiberRoot(Qw,n)}catch{}r=!0}return r}finally{qt=t,ki.transition=e}}return!1}function bN(n,e,t){e=Vh(t,e),e=iL(n,e,1),n=Xl(n,e,1),e=ws(),n!==null&&(qg(n,1,e),Hs(n,e))}function Sn(n,e,t){if(n.tag===3)bN(n,n,t);else for(;e!==null;){if(e.tag===3){bN(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Zl===null||!Zl.has(r))){n=Vh(t,n),n=aL(e,n,1),e=Xl(e,n,1),n=ws(),e!==null&&(qg(e,1,n),Hs(e,n));break}}e=e.return}}function hG(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=ws(),n.pingedLanes|=n.suspendedLanes&t,Tr===n&&(jr&t)===t&&(sr===4||sr===3&&(jr&130023424)===jr&&500>An()-Dx?Ic(n,0):Mx|=t),Hs(n,e)}function IL(n,e){e===0&&(n.mode&1?(e=Fy,Fy<<=1,!(Fy&130023424)&&(Fy=4194304)):e=1);var t=ws();n=Bo(n,e),n!==null&&(qg(n,e,t),Hs(n,t))}function fG(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),IL(n,t)}function pG(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(he(314))}r!==null&&r.delete(e),IL(n,t)}var xL;xL=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Gs.current)Vs=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Vs=!1,tG(n,e,t);Vs=!!(n.flags&131072)}else Vs=!1,hn&&e.flags&1048576&&R8(e,Ev,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;D0(n,e),n=e.pendingProps;var s=Fh(e,as.current);Ch(e,t),s=Px(null,e,r,n,s,t);var i=Ax();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ws(r)?(i=!0,wv(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Tx(e),s.updater=n1,e.stateNode=s,s._reactInternals=e,jT(e,r,n,t),e=BT(null,e,r,!0,i,t)):(e.tag=0,hn&&i&&_x(e),_s(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(D0(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=gG(r),n=Ji(r,n),s){case 0:e=VT(null,e,r,n,t);break e;case 1:e=dN(null,e,r,n,t);break e;case 11:e=uN(null,e,r,n,t);break e;case 14:e=cN(null,e,r,Ji(r.type,n),t);break e}throw Error(he(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ji(r,s),VT(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ji(r,s),dN(n,e,r,s,t);case 3:e:{if(cL(e),n===null)throw Error(he(387));r=e.pendingProps,i=e.memoizedState,s=i.element,F8(n,e),Cv(e,r,null,t);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Vh(Error(he(423)),e),e=hN(n,e,r,t,s);break e}else if(r!==s){s=Vh(Error(he(424)),e),e=hN(n,e,r,t,s);break e}else for(ei=Jl(e.stateNode.containerInfo.firstChild),ri=e,hn=!0,ea=null,t=M8(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if($h(),r===s){e=zo(n,e,t);break e}_s(n,e,r,t)}e=e.child}return e;case 5:return $8(e),n===null&&DT(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,a=s.children,RT(r,s)?a=null:i!==null&&RT(r,i)&&(e.flags|=32),uL(n,e),_s(n,e,a,t),e.child;case 6:return n===null&&DT(e),null;case 13:return dL(n,e,t);case 4:return Cx(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=jh(e,null,r,t):_s(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ji(r,s),uN(n,e,r,s,t);case 7:return _s(n,e,e.pendingProps,t),e.child;case 8:return _s(n,e,e.pendingProps.children,t),e.child;case 12:return _s(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,an(Sv,r._currentValue),r._currentValue=a,i!==null)if(ca(i.value,a)){if(i.children===s.children&&!Gs.current){e=zo(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=Lo(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),FT(i.return,t,e),o.lanes|=t;break}l=l.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(he(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),FT(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}_s(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Ch(e,t),s=Pi(s),r=r(s),e.flags|=1,_s(n,e,r,t),e.child;case 14:return r=e.type,s=Ji(r,e.pendingProps),s=Ji(r.type,s),cN(n,e,r,s,t);case 15:return oL(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ji(r,s),D0(n,e),e.tag=1,Ws(r)?(n=!0,wv(e)):n=!1,Ch(e,t),sL(e,r,s),jT(e,r,s,t),BT(null,e,r,!0,n,t);case 19:return hL(n,e,t);case 22:return lL(n,e,t)}throw Error(he(156,e.tag))};function kL(n,e){return t8(n,e)}function mG(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ci(n,e,t,r){return new mG(n,e,t,r)}function Ux(n){return n=n.prototype,!(!n||!n.isReactComponent)}function gG(n){if(typeof n=="function")return Ux(n)?1:0;if(n!=null){if(n=n.$$typeof,n===ix)return 11;if(n===ax)return 14}return 2}function tu(n,e){var t=n.alternate;return t===null?(t=Ci(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function j0(n,e,t,r,s,i){var a=2;if(r=n,typeof n=="function")Ux(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case ih:return xc(t.children,s,i,e);case sx:a=8,s|=8;break;case uT:return n=Ci(12,t,e,s|2),n.elementType=uT,n.lanes=i,n;case cT:return n=Ci(13,t,e,s),n.elementType=cT,n.lanes=i,n;case dT:return n=Ci(19,t,e,s),n.elementType=dT,n.lanes=i,n;case $6:return i1(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case D6:a=10;break e;case F6:a=9;break e;case ix:a=11;break e;case ax:a=14;break e;case xl:a=16,r=null;break e}throw Error(he(130,n==null?n:typeof n,""))}return e=Ci(a,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function xc(n,e,t,r){return n=Ci(7,n,r,e),n.lanes=t,n}function i1(n,e,t,r){return n=Ci(22,n,r,e),n.elementType=$6,n.lanes=t,n.stateNode={isHidden:!1},n}function VS(n,e,t){return n=Ci(6,n,null,e),n.lanes=t,n}function BS(n,e,t){return e=Ci(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function _G(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ES(0),this.expirationTimes=ES(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ES(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Vx(n,e,t,r,s,i,a,o,l){return n=new _G(n,e,t,o,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Ci(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Tx(i),n}function yG(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:sh,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function PL(n){if(!n)return cu;n=n._reactInternals;e:{if(Zc(n)!==n||n.tag!==1)throw Error(he(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ws(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(he(171))}if(n.tag===1){var t=n.type;if(Ws(t))return P8(n,t,e)}return e}function AL(n,e,t,r,s,i,a,o,l){return n=Vx(t,r,!0,n,s,i,a,o,l),n.context=PL(null),t=n.current,r=ws(),s=eu(t),i=Lo(r,s),i.callback=e??null,Xl(t,i,s),n.current.lanes=s,qg(n,s,r),Hs(n,r),n}function a1(n,e,t,r){var s=e.current,i=ws(),a=eu(s);return t=PL(t),e.context===null?e.context=t:e.pendingContext=t,e=Lo(i,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Xl(s,e,a),n!==null&&(ia(n,s,a,i),O0(n,s,a)),a}function Ov(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function EN(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Bx(n,e){EN(n,e),(n=n.alternate)&&EN(n,e)}function vG(){return null}var RL=typeof reportError=="function"?reportError:function(n){console.error(n)};function zx(n){this._internalRoot=n}o1.prototype.render=zx.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(he(409));a1(n,e,null,null)};o1.prototype.unmount=zx.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Lc(function(){a1(null,n,null,null)}),e[Vo]=null}};function o1(n){this._internalRoot=n}o1.prototype.unstable_scheduleHydration=function(n){if(n){var e=l8();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Nl.length&&e!==0&&e<Nl[t].priority;t++);Nl.splice(t,0,n),t===0&&c8(n)}};function Gx(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function l1(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function SN(){}function wG(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Ov(a);i.call(u)}}var a=AL(e,r,n,0,null,!1,!1,"",SN);return n._reactRootContainer=a,n[Vo]=a.current,sg(n.nodeType===8?n.parentNode:n),Lc(),a}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var o=r;r=function(){var u=Ov(l);o.call(u)}}var l=Vx(n,0,!1,null,null,!1,!1,"",SN);return n._reactRootContainer=l,n[Vo]=l.current,sg(n.nodeType===8?n.parentNode:n),Lc(function(){a1(e,l,t,r)}),l}function u1(n,e,t,r,s){var i=t._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var o=s;s=function(){var l=Ov(a);o.call(l)}}a1(e,a,n,s)}else a=wG(t,e,n,s,r);return Ov(a)}a8=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Yp(e.pendingLanes);t!==0&&(ux(e,t|1),Hs(e,An()),!(Rt&6)&&(Bh=An()+500,Pu()))}break;case 13:Lc(function(){var r=Bo(n,1);if(r!==null){var s=ws();ia(r,n,1,s)}}),Bx(n,1)}};cx=function(n){if(n.tag===13){var e=Bo(n,134217728);if(e!==null){var t=ws();ia(e,n,134217728,t)}Bx(n,134217728)}};o8=function(n){if(n.tag===13){var e=eu(n),t=Bo(n,e);if(t!==null){var r=ws();ia(t,n,e,r)}Bx(n,e)}};l8=function(){return qt};u8=function(n,e){var t=qt;try{return qt=n,e()}finally{qt=t}};bT=function(n,e,t){switch(e){case"input":if(pT(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=Zw(r);if(!s)throw Error(he(90));U6(r),pT(r,s)}}}break;case"textarea":B6(n,t);break;case"select":e=t.value,e!=null&&bh(n,!!t.multiple,e,!1)}};Q6=Fx;Y6=Lc;var bG={usingClientEntryPoint:!1,Events:[Qg,uh,Zw,q6,K6,Fx]},Fp={findFiberByHostInstance:gc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},EG={bundleType:Fp.bundleType,version:Fp.version,rendererPackageName:Fp.rendererPackageName,rendererConfig:Fp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Jo.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Z6(n),n===null?null:n.stateNode},findFiberByHostInstance:Fp.findFiberByHostInstance||vG,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ky=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ky.isDisabled&&Ky.supportsFiber)try{Qw=Ky.inject(EG),Ga=Ky}catch{}}ci.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bG;ci.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Gx(e))throw Error(he(200));return yG(n,e,null,t)};ci.createRoot=function(n,e){if(!Gx(n))throw Error(he(299));var t=!1,r="",s=RL;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Vx(n,1,!1,null,null,t,!1,r,s),n[Vo]=e.current,sg(n.nodeType===8?n.parentNode:n),new zx(e)};ci.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(he(188)):(n=Object.keys(n).join(","),Error(he(268,n)));return n=Z6(e),n=n===null?null:n.stateNode,n};ci.flushSync=function(n){return Lc(n)};ci.hydrate=function(n,e,t){if(!l1(e))throw Error(he(200));return u1(null,n,e,!0,t)};ci.hydrateRoot=function(n,e,t){if(!Gx(n))throw Error(he(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",a=RL;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=AL(e,null,n,1,t??null,s,!1,i,a),n[Vo]=e.current,sg(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new o1(e)};ci.render=function(n,e,t){if(!l1(e))throw Error(he(200));return u1(null,n,e,!1,t)};ci.unmountComponentAtNode=function(n){if(!l1(n))throw Error(he(40));return n._reactRootContainer?(Lc(function(){u1(null,null,n,!1,function(){n._reactRootContainer=null,n[Vo]=null})}),!0):!1};ci.unstable_batchedUpdates=Fx;ci.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!l1(t))throw Error(he(200));if(n==null||n._reactInternals===void 0)throw Error(he(38));return u1(n,e,t,!1,r)};ci.version="18.3.1-next-f1338f8080-20240426";function NL(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(NL)}catch(n){console.error(n)}}NL(),N6.exports=ci;var SG=N6.exports,TN=SG;oT.createRoot=TN.createRoot,oT.hydrateRoot=TN.hydrateRoot;var CN={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OL={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _e=function(n,e){if(!n)throw wf(e)},wf=function(n){return new Error("Firebase Database ("+OL.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LL=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},TG=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],o=n[t++],l=((s&7)<<18|(i&63)<<12|(a&63)<<6|o&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},Wx={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,o=a?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|o>>4;let p=(o&15)<<2|u>>6,y=u&63;l||(y=64,a||(p=64)),r.push(t[h],t[f],t[p],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(LL(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):TG(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],o=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||o==null||u==null||f==null)throw new CG;const p=i<<2|o>>4;if(r.push(p),u!==64){const y=o<<4&240|u>>2;if(r.push(y),f!==64){const _=u<<6&192|f;r.push(_)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class CG extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ML=function(n){const e=LL(n);return Wx.encodeByteArray(e,!0)},Lv=function(n){return ML(n).replace(/\./g,"")},Mv=function(n){try{return Wx.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IG(n){return DL(void 0,n)}function DL(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!xG(t)||(n[t]=DL(n[t],e[t]));return n}function xG(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kG(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PG=()=>kG().__FIREBASE_DEFAULTS__,AG=()=>{if(typeof process>"u"||typeof CN>"u")return;const n=CN.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},RG=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Mv(n[1]);return e&&JSON.parse(e)},c1=()=>{try{return PG()||AG()||RG()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},FL=n=>{var e,t;return(t=(e=c1())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},$L=n=>{const e=FL(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},jL=()=>{var n;return(n=c1())===null||n===void 0?void 0:n.config},UL=n=>{var e;return(e=c1())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VL(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Lv(JSON.stringify(t)),Lv(JSON.stringify(a)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function os(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Hx(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(os())}function NG(){var n;const e=(n=c1())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function OG(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function LG(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function BL(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function MG(){const n=os();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function DG(){return OL.NODE_ADMIN===!0}function FG(){return!NG()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function $G(){try{return typeof indexedDB=="object"}catch{return!1}}function jG(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UG="FirebaseError";class Xo extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=UG,Object.setPrototypeOf(this,Xo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Jg.prototype.create)}}class Jg{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?VG(i,r):"Error",o=`${this.serviceName}: ${a} (${s}).`;return new Xo(s,o,r)}}function VG(n,e){return n.replace(BG,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const BG=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fg(n){return JSON.parse(n)}function Sr(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zL=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=fg(Mv(i[0])||""),t=fg(Mv(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},zG=function(n){const e=zL(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},GG=function(n){const e=zL(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Za(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function zh(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Dv(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Fv(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function $v(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(IN(i)&&IN(a)){if(!$v(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function IN(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bf(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Xp(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Zp(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let WG=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const p=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(p<<1|p>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],a=this.chain_[2],o=this.chain_[3],l=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=o^i&(a^o),h=1518500249):(u=i^a^o,h=1859775393):f<60?(u=i&a|o&(i|a),h=2400959708):(u=i^a^o,h=3395469782);const p=(s<<5|s>>>27)+u+l+h+r[f]&4294967295;l=o,o=a,a=(i<<30|i>>>2)&4294967295,i=s,s=p}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+o&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let a=this.inbuf_;for(;s<t;){if(a===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[a]=e.charCodeAt(s),++a,++s,a===this.blockSize){this.compress_(i),a=0;break}}else for(;s<t;)if(i[a]=e[s],++a,++s,a===this.blockSize){this.compress_(i),a=0;break}}this.inbuf_=a,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}};function HG(n,e){const t=new qG(n,e);return t.subscribe.bind(t)}class qG{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");KG(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=zS),s.error===void 0&&(s.error=zS),s.complete===void 0&&(s.complete=zS);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function KG(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function zS(){}function Gh(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QG=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,_e(r<n.length,"Surrogate pair missing trail surrogate.");const a=n.charCodeAt(r)-56320;s=65536+(i<<10)+a}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},d1=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xt(n){return n&&n._delegate?n._delegate:n}class du{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dc="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YG{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new ja;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(XG(e))try{this.getOrInitializeService({instanceIdentifier:dc})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=dc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=dc){return this.instances.has(e)}getOptions(e=dc){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(i);r===o&&a.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:JG(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=dc){return this.component?this.component.multipleInstances?e:dc:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function JG(n){return n===dc?void 0:n}function XG(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZG{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new YG(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Et;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Et||(Et={}));const eW={debug:Et.DEBUG,verbose:Et.VERBOSE,info:Et.INFO,warn:Et.WARN,error:Et.ERROR,silent:Et.SILENT},tW=Et.INFO,nW={[Et.DEBUG]:"log",[Et.VERBOSE]:"log",[Et.INFO]:"info",[Et.WARN]:"warn",[Et.ERROR]:"error"},rW=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=nW[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class h1{constructor(e){this.name=e,this._logLevel=tW,this._logHandler=rW,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Et))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?eW[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Et.DEBUG,...e),this._logHandler(this,Et.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Et.VERBOSE,...e),this._logHandler(this,Et.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Et.INFO,...e),this._logHandler(this,Et.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Et.WARN,...e),this._logHandler(this,Et.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Et.ERROR,...e),this._logHandler(this,Et.ERROR,...e)}}const sW=(n,e)=>e.some(t=>n instanceof t);let xN,kN;function iW(){return xN||(xN=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function aW(){return kN||(kN=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const GL=new WeakMap,eC=new WeakMap,WL=new WeakMap,GS=new WeakMap,qx=new WeakMap;function oW(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(nu(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&GL.set(t,n)}).catch(()=>{}),qx.set(e,n),e}function lW(n){if(eC.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});eC.set(n,e)}let tC={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return eC.get(n);if(e==="objectStoreNames")return n.objectStoreNames||WL.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return nu(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function uW(n){tC=n(tC)}function cW(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(WS(this),e,...t);return WL.set(r,e.sort?e.sort():[e]),nu(r)}:aW().includes(n)?function(...e){return n.apply(WS(this),e),nu(GL.get(this))}:function(...e){return nu(n.apply(WS(this),e))}}function dW(n){return typeof n=="function"?cW(n):(n instanceof IDBTransaction&&lW(n),sW(n,iW())?new Proxy(n,tC):n)}function nu(n){if(n instanceof IDBRequest)return oW(n);if(GS.has(n))return GS.get(n);const e=dW(n);return e!==n&&(GS.set(n,e),qx.set(e,n)),e}const WS=n=>qx.get(n);function hW(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),o=nu(a);return r&&a.addEventListener("upgradeneeded",l=>{r(nu(a.result),l.oldVersion,l.newVersion,nu(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),o.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),o}const fW=["get","getKey","getAll","getAllKeys","count"],pW=["put","add","delete","clear"],HS=new Map;function PN(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(HS.get(e))return HS.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=pW.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||fW.includes(t)))return;const i=async function(a,...o){const l=this.transaction(a,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(o.shift())),(await Promise.all([u[t](...o),s&&l.done]))[0]};return HS.set(e,i),i}uW(n=>({...n,get:(e,t,r)=>PN(e,t)||n.get(e,t,r),has:(e,t)=>!!PN(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mW{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(gW(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function gW(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const nC="@firebase/app",AN="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Go=new h1("@firebase/app"),_W="@firebase/app-compat",yW="@firebase/analytics-compat",vW="@firebase/analytics",wW="@firebase/app-check-compat",bW="@firebase/app-check",EW="@firebase/auth",SW="@firebase/auth-compat",TW="@firebase/database",CW="@firebase/data-connect",IW="@firebase/database-compat",xW="@firebase/functions",kW="@firebase/functions-compat",PW="@firebase/installations",AW="@firebase/installations-compat",RW="@firebase/messaging",NW="@firebase/messaging-compat",OW="@firebase/performance",LW="@firebase/performance-compat",MW="@firebase/remote-config",DW="@firebase/remote-config-compat",FW="@firebase/storage",$W="@firebase/storage-compat",jW="@firebase/firestore",UW="@firebase/vertexai-preview",VW="@firebase/firestore-compat",BW="firebase",zW="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rC="[DEFAULT]",GW={[nC]:"fire-core",[_W]:"fire-core-compat",[vW]:"fire-analytics",[yW]:"fire-analytics-compat",[bW]:"fire-app-check",[wW]:"fire-app-check-compat",[EW]:"fire-auth",[SW]:"fire-auth-compat",[TW]:"fire-rtdb",[CW]:"fire-data-connect",[IW]:"fire-rtdb-compat",[xW]:"fire-fn",[kW]:"fire-fn-compat",[PW]:"fire-iid",[AW]:"fire-iid-compat",[RW]:"fire-fcm",[NW]:"fire-fcm-compat",[OW]:"fire-perf",[LW]:"fire-perf-compat",[MW]:"fire-rc",[DW]:"fire-rc-compat",[FW]:"fire-gcs",[$W]:"fire-gcs-compat",[jW]:"fire-fst",[VW]:"fire-fst-compat",[UW]:"fire-vertex","fire-js":"fire-js",[BW]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jv=new Map,WW=new Map,sC=new Map;function RN(n,e){try{n.container.addComponent(e)}catch(t){Go.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Mc(n){const e=n.name;if(sC.has(e))return Go.debug(`There were multiple attempts to register component ${e}.`),!1;sC.set(e,n);for(const t of jv.values())RN(t,n);for(const t of WW.values())RN(t,n);return!0}function f1(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function na(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HW={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ru=new Jg("app","Firebase",HW);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qW{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new du("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ru.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ed=zW;function HL(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:rC,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw ru.create("bad-app-name",{appName:String(s)});if(t||(t=jL()),!t)throw ru.create("no-options");const i=jv.get(s);if(i){if($v(t,i.options)&&$v(r,i.config))return i;throw ru.create("duplicate-app",{appName:s})}const a=new ZG(s);for(const l of sC.values())a.addComponent(l);const o=new qW(t,r,a);return jv.set(s,o),o}function Kx(n=rC){const e=jv.get(n);if(!e&&n===rC&&jL())return HL();if(!e)throw ru.create("no-app",{appName:n});return e}function Ha(n,e,t){var r;let s=(r=GW[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const o=[`Unable to register library "${s}" with version "${e}":`];i&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&o.push("and"),a&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Go.warn(o.join(" "));return}Mc(new du(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KW="firebase-heartbeat-database",QW=1,pg="firebase-heartbeat-store";let qS=null;function qL(){return qS||(qS=hW(KW,QW,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(pg)}catch(t){console.warn(t)}}}}).catch(n=>{throw ru.create("idb-open",{originalErrorMessage:n.message})})),qS}async function YW(n){try{const t=(await qL()).transaction(pg),r=await t.objectStore(pg).get(KL(n));return await t.done,r}catch(e){if(e instanceof Xo)Go.warn(e.message);else{const t=ru.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Go.warn(t.message)}}}async function NN(n,e){try{const r=(await qL()).transaction(pg,"readwrite");await r.objectStore(pg).put(e,KL(n)),await r.done}catch(t){if(t instanceof Xo)Go.warn(t.message);else{const r=ru.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Go.warn(r.message)}}}function KL(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JW=1024,XW=30*24*60*60*1e3;class ZW{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tH(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=ON();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const o=new Date(a.date).valueOf();return Date.now()-o<=XW}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Go.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=ON(),{heartbeatsToSend:r,unsentEntries:s}=eH(this._heartbeatsCache.heartbeats),i=Lv(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Go.warn(t),""}}}function ON(){return new Date().toISOString().substring(0,10)}function eH(n,e=JW){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),LN(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),LN(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class tH{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return $G()?jG().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await YW(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return NN(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return NN(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function LN(n){return Lv(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nH(n){Mc(new du("platform-logger",e=>new mW(e),"PRIVATE")),Mc(new du("heartbeat",e=>new ZW(e),"PRIVATE")),Ha(nC,AN,n),Ha(nC,AN,"esm2017"),Ha("fire-js","")}nH("");function Qx(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function QL(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const rH=QL,YL=new Jg("auth","Firebase",QL());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uv=new h1("@firebase/auth");function sH(n,...e){Uv.logLevel<=Et.WARN&&Uv.warn(`Auth (${ed}): ${n}`,...e)}function U0(n,...e){Uv.logLevel<=Et.ERROR&&Uv.error(`Auth (${ed}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ri(n,...e){throw Jx(n,...e)}function aa(n,...e){return Jx(n,...e)}function Yx(n,e,t){const r=Object.assign(Object.assign({},rH()),{[e]:t});return new Jg("auth","Firebase",r).create(e,{appName:n.name})}function Mo(n){return Yx(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function iH(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Ri(n,"argument-error"),Yx(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Jx(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return YL.create(n,...e)}function Ye(n,e,...t){if(!n)throw Jx(e,...t)}function Po(n){const e="INTERNAL ASSERTION FAILED: "+n;throw U0(e),new Error(e)}function Wo(n,e){n||Po(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iC(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function aH(){return MN()==="http:"||MN()==="https:"}function MN(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oH(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(aH()||LG()||"connection"in navigator)?navigator.onLine:!0}function lH(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xg{constructor(e,t){this.shortDelay=e,this.longDelay=t,Wo(t>e,"Short delay should be less than long delay!"),this.isMobile=Hx()||BL()}get(){return oH()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xx(n,e){Wo(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JL{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Po("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Po("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Po("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uH={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cH=new Xg(3e4,6e4);function Au(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Ru(n,e,t,r,s={}){return XL(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const o=bf(Object.assign({key:n.config.apiKey},a)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u=Object.assign({method:e,headers:l},i);return OG()||(u.referrerPolicy="no-referrer"),JL.fetch()(ZL(n,n.config.apiHost,t,o),u)})}async function XL(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},uH),e);try{const s=new hH(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Qy(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const o=i.ok?a.errorMessage:a.error.message,[l,u]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Qy(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw Qy(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw Qy(n,"user-disabled",a);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Yx(n,h,u);Ri(n,h)}}catch(s){if(s instanceof Xo)throw s;Ri(n,"network-request-failed",{message:String(s)})}}async function Zg(n,e,t,r,s={}){const i=await Ru(n,e,t,r,s);return"mfaPendingCredential"in i&&Ri(n,"multi-factor-auth-required",{_serverResponse:i}),i}function ZL(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Xx(n.config,s):`${n.config.apiScheme}://${s}`}function dH(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class hH{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(aa(this.auth,"network-request-failed")),cH.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Qy(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=aa(n,e,r);return s.customData._tokenResponse=t,s}function DN(n){return n!==void 0&&n.enterprise!==void 0}class fH{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return dH(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function pH(n,e){return Ru(n,"GET","/v2/recaptchaConfig",Au(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mH(n,e){return Ru(n,"POST","/v1/accounts:delete",e)}async function eM(n,e){return Ru(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Im(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function gH(n,e=!1){const t=Xt(n),r=await t.getIdToken(e),s=Zx(r);Ye(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Im(KS(s.auth_time)),issuedAtTime:Im(KS(s.iat)),expirationTime:Im(KS(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function KS(n){return Number(n)*1e3}function Zx(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return U0("JWT malformed, contained fewer than 3 sections"),null;try{const s=Mv(t);return s?JSON.parse(s):(U0("Failed to decode base64 JWT payload"),null)}catch(s){return U0("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function FN(n){const e=Zx(n);return Ye(e,"internal-error"),Ye(typeof e.exp<"u","internal-error"),Ye(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mg(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Xo&&_H(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function _H({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yH{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Im(this.lastLoginAt),this.creationTime=Im(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vv(n){var e;const t=n.auth,r=await n.getIdToken(),s=await mg(n,eM(t,{idToken:r}));Ye(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?tM(i.providerUserInfo):[],o=wH(n.providerData,a),l=n.isAnonymous,u=!(n.email&&i.passwordHash)&&!(o!=null&&o.length),h=l?u:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new aC(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function vH(n){const e=Xt(n);await Vv(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function wH(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function tM(n){return n.map(e=>{var{providerId:t}=e,r=Qx(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bH(n,e){const t=await XL(n,{},async()=>{const r=bf({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=ZL(n,s,"/v1/token",`key=${i}`),o=await n._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",JL.fetch()(a,{method:"POST",headers:o,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function EH(n,e){return Ru(n,"POST","/v2/accounts:revokeToken",Au(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ye(e.idToken,"internal-error"),Ye(typeof e.idToken<"u","internal-error"),Ye(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):FN(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ye(e.length!==0,"internal-error");const t=FN(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ye(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await bH(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new xh;return r&&(Ye(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(Ye(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(Ye(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xh,this.toJSON())}_performRefresh(){return Po("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wl(n,e){Ye(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ao{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Qx(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new yH(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new aC(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await mg(this,this.stsTokenManager.getToken(this.auth,e));return Ye(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return gH(this,e)}reload(){return vH(this)}_assign(e){this!==e&&(Ye(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ao(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ye(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Vv(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(na(this.auth.app))return Promise.reject(Mo(this.auth));const e=await this.getIdToken();return await mg(this,mH(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,a,o,l,u,h;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,p=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,_=(a=t.photoURL)!==null&&a!==void 0?a:void 0,b=(o=t.tenantId)!==null&&o!==void 0?o:void 0,S=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,E=(u=t.createdAt)!==null&&u!==void 0?u:void 0,C=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:v,emailVerified:I,isAnonymous:L,providerData:R,stsTokenManager:P}=t;Ye(v&&P,e,"internal-error");const x=xh.fromJSON(this.name,P);Ye(typeof v=="string",e,"internal-error"),wl(f,e.name),wl(p,e.name),Ye(typeof I=="boolean",e,"internal-error"),Ye(typeof L=="boolean",e,"internal-error"),wl(y,e.name),wl(_,e.name),wl(b,e.name),wl(S,e.name),wl(E,e.name),wl(C,e.name);const N=new Ao({uid:v,auth:e,email:p,emailVerified:I,displayName:f,isAnonymous:L,photoURL:_,phoneNumber:y,tenantId:b,stsTokenManager:x,createdAt:E,lastLoginAt:C});return R&&Array.isArray(R)&&(N.providerData=R.map(M=>Object.assign({},M))),S&&(N._redirectEventId=S),N}static async _fromIdTokenResponse(e,t,r=!1){const s=new xh;s.updateFromServerResponse(t);const i=new Ao({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Vv(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];Ye(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?tM(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),o=new xh;o.updateFromIdToken(r);const l=new Ao({uid:s.localId,auth:e,stsTokenManager:o,isAnonymous:a}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new aC(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $N=new Map;function Ro(n){Wo(n instanceof Function,"Expected a class definition");let e=$N.get(n);return e?(Wo(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,$N.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nM{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}nM.type="NONE";const jN=nM;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V0(n,e,t){return`firebase:${n}:${e}:${t}`}class kh{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=V0(this.userKey,s.apiKey,i),this.fullPersistenceKey=V0("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ao._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new kh(Ro(jN),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||Ro(jN);const a=V0(r,e.config.apiKey,e.name);let o=null;for(const u of t)try{const h=await u._get(a);if(h){const f=Ao._fromJSON(e,h);u!==i&&(o=f),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new kh(i,e,r):(i=l[0],o&&await i._set(a,o.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(a)}catch{}})),new kh(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UN(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(aM(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(rM(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(lM(e))return"Blackberry";if(uM(e))return"Webos";if(sM(e))return"Safari";if((e.includes("chrome/")||iM(e))&&!e.includes("edge/"))return"Chrome";if(oM(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function rM(n=os()){return/firefox\//i.test(n)}function sM(n=os()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function iM(n=os()){return/crios\//i.test(n)}function aM(n=os()){return/iemobile/i.test(n)}function oM(n=os()){return/android/i.test(n)}function lM(n=os()){return/blackberry/i.test(n)}function uM(n=os()){return/webos/i.test(n)}function ek(n=os()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function SH(n=os()){var e;return ek(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function TH(){return MG()&&document.documentMode===10}function cM(n=os()){return ek(n)||oM(n)||uM(n)||lM(n)||/windows phone/i.test(n)||aM(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dM(n,e=[]){let t;switch(n){case"Browser":t=UN(os());break;case"Worker":t=`${UN(os())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ed}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CH{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,o)=>{try{const l=e(i);a(l)}catch(l){o(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IH(n,e={}){return Ru(n,"GET","/v2/passwordPolicy",Au(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xH=6;class kH{constructor(e){var t,r,s,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:xH,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,a,o;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(a=l.containsNumericCharacter)!==null&&a!==void 0?a:!0),l.isValid&&(l.isValid=(o=l.containsNonAlphanumericCharacter)!==null&&o!==void 0?o:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PH{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new VN(this),this.idTokenSubscription=new VN(this),this.beforeStateQueue=new CH(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=YL,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ro(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await kh.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await eM(this,{idToken:e}),r=await Ao._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(na(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,o=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!a||a===o)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ye(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Vv(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=lH()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(na(this.app))return Promise.reject(Mo(this));const t=e?Xt(e):null;return t&&Ye(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ye(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return na(this.app)?Promise.reject(Mo(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return na(this.app)?Promise.reject(Mo(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ro(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await IH(this),t=new kH(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Jg("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await EH(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ro(e)||this._popupRedirectResolver;Ye(t,this,"argument-error"),this.redirectPersistenceManager=await kh.create(this,[Ro(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ye(o,this,"internal-error"),o.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ye(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=dM(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&sH(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Nu(n){return Xt(n)}class VN{constructor(e){this.auth=e,this.observer=null,this.addObserver=HG(t=>this.observer=t)}get next(){return Ye(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let p1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function AH(n){p1=n}function hM(n){return p1.loadJS(n)}function RH(){return p1.recaptchaEnterpriseScript}function NH(){return p1.gapiScript}function OH(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const LH="recaptcha-enterprise",MH="NO_RECAPTCHA";class DH{constructor(e){this.type=LH,this.auth=Nu(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,o)=>{pH(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const u=new fH(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,a(u.siteKey)}}).catch(l=>{o(l)})})}function s(i,a,o){const l=window.grecaptcha;DN(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{a(u)}).catch(()=>{a(MH)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,a)=>{r(this.auth).then(o=>{if(!t&&DN(window.grecaptcha))s(o,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=RH();l.length!==0&&(l+=o),hM(l).then(()=>{s(o,i,a)}).catch(u=>{a(u)})}}).catch(o=>{a(o)})})}}async function BN(n,e,t,r=!1){const s=new DH(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const a=Object.assign({},e);return r?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function oC(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await BN(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await BN(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FH(n,e){const t=f1(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if($v(i,e??{}))return s;Ri(s,"already-initialized")}return t.initialize({options:e})}function $H(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Ro);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function fM(n,e,t){const r=Nu(n);Ye(r._canInitEmulator,r,"emulator-config-failed"),Ye(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=pM(e),{host:a,port:o}=jH(e),l=o===null?"":`:${o}`;r.config.emulator={url:`${i}//${a}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||UH()}function pM(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function jH(n){const e=pM(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:zN(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:zN(a)}}}function zN(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function UH(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tk{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Po("not implemented")}_getIdTokenResponse(e){return Po("not implemented")}_linkToIdToken(e,t){return Po("not implemented")}_getReauthenticationResolver(e){return Po("not implemented")}}async function VH(n,e){return Ru(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BH(n,e){return Zg(n,"POST","/v1/accounts:signInWithPassword",Au(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zH(n,e){return Zg(n,"POST","/v1/accounts:signInWithEmailLink",Au(n,e))}async function GH(n,e){return Zg(n,"POST","/v1/accounts:signInWithEmailLink",Au(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg extends tk{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new gg(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new gg(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return oC(e,t,"signInWithPassword",BH);case"emailLink":return zH(e,{email:this._email,oobCode:this._password});default:Ri(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return oC(e,r,"signUpPassword",VH);case"emailLink":return GH(e,{idToken:t,email:this._email,oobCode:this._password});default:Ri(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ph(n,e){return Zg(n,"POST","/v1/accounts:signInWithIdp",Au(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WH="http://localhost";class Dc extends tk{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Dc(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ri("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Qx(t,["providerId","signInMethod"]);if(!r||!s)return null;const a=new Dc(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Ph(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ph(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ph(e,t)}buildRequest(){const e={requestUri:WH,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=bf(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HH(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function qH(n){const e=Xp(Zp(n)).link,t=e?Xp(Zp(e)).deep_link_id:null,r=Xp(Zp(n)).deep_link_id;return(r?Xp(Zp(r)).link:null)||r||t||e||n}class nk{constructor(e){var t,r,s,i,a,o;const l=Xp(Zp(e)),u=(t=l.apiKey)!==null&&t!==void 0?t:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,f=HH((s=l.mode)!==null&&s!==void 0?s:null);Ye(u&&h&&f,"argument-error"),this.apiKey=u,this.operation=f,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=l.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(o=l.tenantId)!==null&&o!==void 0?o:null}static parseLink(e){const t=qH(e);try{return new nk(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ef{constructor(){this.providerId=Ef.PROVIDER_ID}static credential(e,t){return gg._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=nk.parseLink(t);return Ye(r,"argument-error"),gg._fromEmailAndCode(e,r.code,r.tenantId)}}Ef.PROVIDER_ID="password";Ef.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ef.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e_ extends rk{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ll extends e_{constructor(){super("facebook.com")}static credential(e){return Dc._fromParams({providerId:Ll.PROVIDER_ID,signInMethod:Ll.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ll.credentialFromTaggedObject(e)}static credentialFromError(e){return Ll.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ll.credential(e.oauthAccessToken)}catch{return null}}}Ll.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ll.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io extends e_{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Dc._fromParams({providerId:Io.PROVIDER_ID,signInMethod:Io.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Io.credentialFromTaggedObject(e)}static credentialFromError(e){return Io.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Io.credential(t,r)}catch{return null}}}Io.GOOGLE_SIGN_IN_METHOD="google.com";Io.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ml extends e_{constructor(){super("github.com")}static credential(e){return Dc._fromParams({providerId:Ml.PROVIDER_ID,signInMethod:Ml.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ml.credentialFromTaggedObject(e)}static credentialFromError(e){return Ml.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ml.credential(e.oauthAccessToken)}catch{return null}}}Ml.GITHUB_SIGN_IN_METHOD="github.com";Ml.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl extends e_{constructor(){super("twitter.com")}static credential(e,t){return Dc._fromParams({providerId:Dl.PROVIDER_ID,signInMethod:Dl.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Dl.credentialFromTaggedObject(e)}static credentialFromError(e){return Dl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Dl.credential(t,r)}catch{return null}}}Dl.TWITTER_SIGN_IN_METHOD="twitter.com";Dl.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KH(n,e){return Zg(n,"POST","/v1/accounts:signUp",Au(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Ao._fromIdTokenResponse(e,r,s),a=GN(r);return new Fc({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=GN(r);return new Fc({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function GN(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bv extends Xo{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Bv.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Bv(e,t,r,s)}}function mM(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Bv._fromErrorAndOperation(n,i,e,r):i})}async function QH(n,e,t=!1){const r=await mg(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Fc._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YH(n,e,t=!1){const{auth:r}=n;if(na(r.app))return Promise.reject(Mo(r));const s="reauthenticate";try{const i=await mg(n,mM(r,s,e,n),t);Ye(i.idToken,r,"internal-error");const a=Zx(i.idToken);Ye(a,r,"internal-error");const{sub:o}=a;return Ye(n.uid===o,r,"user-mismatch"),Fc._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Ri(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gM(n,e,t=!1){if(na(n.app))return Promise.reject(Mo(n));const r="signIn",s=await mM(n,r,e),i=await Fc._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function JH(n,e){return gM(Nu(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _M(n){const e=Nu(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function XH(n,e,t){if(na(n.app))return Promise.reject(Mo(n));const r=Nu(n),a=await oC(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",KH).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&_M(n),l}),o=await Fc._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(o.user),o}function ZH(n,e,t){return na(n.app)?Promise.reject(Mo(n)):JH(Xt(n),Ef.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&_M(n),r})}function eq(n,e,t,r){return Xt(n).onIdTokenChanged(e,t,r)}function tq(n,e,t){return Xt(n).beforeAuthStateChanged(e,t)}function nq(n,e,t,r){return Xt(n).onAuthStateChanged(e,t,r)}function rq(n){return Xt(n).signOut()}const zv="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yM{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(zv,"1"),this.storage.removeItem(zv),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sq=1e3,iq=10;class vM extends yM{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=cM(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,o,l)=>{this.notifyListeners(a,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);TH()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,iq):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},sq)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}vM.type="LOCAL";const aq=vM;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wM extends yM{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}wM.type="SESSION";const bM=wM;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oq(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m1{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new m1(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const o=Array.from(a).map(async u=>u(t.origin,i)),l=await oq(o);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}m1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sk(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lq{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((o,l)=>{const u=sk("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(f){const p=f;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(p.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qa(){return window}function uq(n){qa().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EM(){return typeof qa().WorkerGlobalScope<"u"&&typeof qa().importScripts=="function"}async function cq(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function dq(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function hq(){return EM()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SM="firebaseLocalStorageDb",fq=1,Gv="firebaseLocalStorage",TM="fbase_key";class t_{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function g1(n,e){return n.transaction([Gv],e?"readwrite":"readonly").objectStore(Gv)}function pq(){const n=indexedDB.deleteDatabase(SM);return new t_(n).toPromise()}function lC(){const n=indexedDB.open(SM,fq);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Gv,{keyPath:TM})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Gv)?e(r):(r.close(),await pq(),e(await lC()))})})}async function WN(n,e,t){const r=g1(n,!0).put({[TM]:e,value:t});return new t_(r).toPromise()}async function mq(n,e){const t=g1(n,!1).get(e),r=await new t_(t).toPromise();return r===void 0?null:r.value}function HN(n,e){const t=g1(n,!0).delete(e);return new t_(t).toPromise()}const gq=800,_q=3;class CM{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await lC(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>_q)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return EM()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=m1._getInstance(hq()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await cq(),!this.activeServiceWorker)return;this.sender=new lq(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||dq()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await lC();return await WN(e,zv,"1"),await HN(e,zv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>WN(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>mq(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>HN(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=g1(s,!1).getAll();return new t_(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),gq)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}CM.type="LOCAL";const yq=CM;new Xg(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IM(n,e){return e?Ro(e):(Ye(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik extends tk{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ph(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ph(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ph(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function vq(n){return gM(n.auth,new ik(n),n.bypassAuthState)}function wq(n){const{auth:e,user:t}=n;return Ye(t,e,"internal-error"),YH(t,new ik(n),n.bypassAuthState)}async function bq(n){const{auth:e,user:t}=n;return Ye(t,e,"internal-error"),QH(t,new ik(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xM{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:o}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return vq;case"linkViaPopup":case"linkViaRedirect":return bq;case"reauthViaPopup":case"reauthViaRedirect":return wq;default:Ri(this.auth,"internal-error")}}resolve(e){Wo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Wo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eq=new Xg(2e3,1e4);async function Sq(n,e,t){if(na(n.app))return Promise.reject(aa(n,"operation-not-supported-in-this-environment"));const r=Nu(n);iH(n,e,rk);const s=IM(r,t);return new vc(r,"signInViaPopup",e,s).executeNotNull()}class vc extends xM{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,vc.currentPopupAction&&vc.currentPopupAction.cancel(),vc.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ye(e,this.auth,"internal-error"),e}async onExecution(){Wo(this.filter.length===1,"Popup operations only handle one event");const e=sk();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(aa(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(aa(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,vc.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(aa(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Eq.get())};e()}}vc.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tq="pendingRedirect",B0=new Map;class Cq extends xM{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=B0.get(this.auth._key());if(!e){try{const r=await Iq(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}B0.set(this.auth._key(),e)}return this.bypassAuthState||B0.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Iq(n,e){const t=Pq(e),r=kq(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function xq(n,e){B0.set(n._key(),e)}function kq(n){return Ro(n._redirectPersistence)}function Pq(n){return V0(Tq,n.config.apiKey,n.name)}async function Aq(n,e,t=!1){if(na(n.app))return Promise.reject(Mo(n));const r=Nu(n),s=IM(r,e),a=await new Cq(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rq=10*60*1e3;class Nq{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Oq(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!kM(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(aa(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Rq&&this.cachedEventUids.clear(),this.cachedEventUids.has(qN(e))}saveEventToCache(e){this.cachedEventUids.add(qN(e)),this.lastProcessedEventTime=Date.now()}}function qN(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function kM({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Oq(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return kM(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lq(n,e={}){return Ru(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mq=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Dq=/^https?/;async function Fq(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Lq(n);for(const t of e)try{if($q(t))return}catch{}Ri(n,"unauthorized-domain")}function $q(n){const e=iC(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!Dq.test(t))return!1;if(Mq.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jq=new Xg(3e4,6e4);function KN(){const n=qa().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Uq(n){return new Promise((e,t)=>{var r,s,i;function a(){KN(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{KN(),t(aa(n,"network-request-failed"))},timeout:jq.get()})}if(!((s=(r=qa().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=qa().gapi)===null||i===void 0)&&i.load)a();else{const o=OH("iframefcb");return qa()[o]=()=>{gapi.load?a():t(aa(n,"network-request-failed"))},hM(`${NH()}?onload=${o}`).catch(l=>t(l))}}).catch(e=>{throw z0=null,e})}let z0=null;function Vq(n){return z0=z0||Uq(n),z0}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bq=new Xg(5e3,15e3),zq="__/auth/iframe",Gq="emulator/auth/iframe",Wq={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Hq=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function qq(n){const e=n.config;Ye(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Xx(e,Gq):`https://${n.config.authDomain}/${zq}`,r={apiKey:e.apiKey,appName:n.name,v:ed},s=Hq.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${bf(r).slice(1)}`}async function Kq(n){const e=await Vq(n),t=qa().gapi;return Ye(t,n,"internal-error"),e.open({where:document.body,url:qq(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Wq,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=aa(n,"network-request-failed"),o=qa().setTimeout(()=>{i(a)},Bq.get());function l(){qa().clearTimeout(o),s(r)}r.ping(l).then(l,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qq={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Yq=500,Jq=600,Xq="_blank",Zq="http://localhost";class QN{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function eK(n,e,t,r=Yq,s=Jq){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l=Object.assign(Object.assign({},Qq),{width:r.toString(),height:s.toString(),top:i,left:a}),u=os().toLowerCase();t&&(o=iM(u)?Xq:t),rM(u)&&(e=e||Zq,l.scrollbars="yes");const h=Object.entries(l).reduce((p,[y,_])=>`${p}${y}=${_},`,"");if(SH(u)&&o!=="_self")return tK(e||"",o),new QN(null);const f=window.open(e||"",o,h);Ye(f,n,"popup-blocked");try{f.focus()}catch{}return new QN(f)}function tK(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nK="__/auth/handler",rK="emulator/auth/handler",sK=encodeURIComponent("fac");async function YN(n,e,t,r,s,i){Ye(n.config.authDomain,n,"auth-domain-config-required"),Ye(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:ed,eventId:s};if(e instanceof rk){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",Dv(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries({}))a[h]=f}if(e instanceof e_){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(a.scopes=h.join(","))}n.tenantId&&(a.tid=n.tenantId);const o=a;for(const h of Object.keys(o))o[h]===void 0&&delete o[h];const l=await n._getAppCheckToken(),u=l?`#${sK}=${encodeURIComponent(l)}`:"";return`${iK(n)}?${bf(o).slice(1)}${u}`}function iK({config:n}){return n.emulator?Xx(n,rK):`https://${n.authDomain}/${nK}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QS="webStorageSupport";class aK{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=bM,this._completeRedirectFn=Aq,this._overrideRedirectResult=xq}async _openPopup(e,t,r,s){var i;Wo((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await YN(e,t,r,iC(),s);return eK(e,a,sk())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await YN(e,t,r,iC(),s);return uq(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Wo(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Kq(e),r=new Nq(e);return t.register("authEvent",s=>(Ye(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(QS,{type:QS},s=>{var i;const a=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[QS];a!==void 0&&t(!!a),Ri(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Fq(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return cM()||sM()||ek()}}const oK=aK;var JN="@firebase/auth",XN="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lK{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ye(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uK(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function cK(n){Mc(new du("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;Ye(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:a,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:dM(n)},u=new PH(r,s,i,l);return $H(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Mc(new du("auth-internal",e=>{const t=Nu(e.getProvider("auth").getImmediate());return(r=>new lK(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ha(JN,XN,uK(n)),Ha(JN,XN,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dK=5*60,hK=UL("authIdTokenMaxAge")||dK;let ZN=null;const fK=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>hK)return;const s=t==null?void 0:t.token;ZN!==s&&(ZN=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function pK(n=Kx()){const e=f1(n,"auth");if(e.isInitialized())return e.getImmediate();const t=FH(n,{popupRedirectResolver:oK,persistence:[yq,aq,bM]}),r=UL("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=fK(i.toString());tq(t,a,()=>a(t.currentUser)),eq(t,o=>a(o))}}const s=FL("auth");return s&&fM(t,`http://${s}`),t}function mK(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}AH({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=aa("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",mK().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});cK("Browser");var gK="firebase",_K="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ha(gK,_K,"app");var eO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var kc,PM;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(P,x){function N(){}N.prototype=x.prototype,P.D=x.prototype,P.prototype=new N,P.prototype.constructor=P,P.C=function(M,D,F){for(var $=Array(arguments.length-2),H=2;H<arguments.length;H++)$[H-2]=arguments[H];return x.prototype[D].apply(M,$)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(P,x,N){N||(N=0);var M=Array(16);if(typeof x=="string")for(var D=0;16>D;++D)M[D]=x.charCodeAt(N++)|x.charCodeAt(N++)<<8|x.charCodeAt(N++)<<16|x.charCodeAt(N++)<<24;else for(D=0;16>D;++D)M[D]=x[N++]|x[N++]<<8|x[N++]<<16|x[N++]<<24;x=P.g[0],N=P.g[1],D=P.g[2];var F=P.g[3],$=x+(F^N&(D^F))+M[0]+3614090360&4294967295;x=N+($<<7&4294967295|$>>>25),$=F+(D^x&(N^D))+M[1]+3905402710&4294967295,F=x+($<<12&4294967295|$>>>20),$=D+(N^F&(x^N))+M[2]+606105819&4294967295,D=F+($<<17&4294967295|$>>>15),$=N+(x^D&(F^x))+M[3]+3250441966&4294967295,N=D+($<<22&4294967295|$>>>10),$=x+(F^N&(D^F))+M[4]+4118548399&4294967295,x=N+($<<7&4294967295|$>>>25),$=F+(D^x&(N^D))+M[5]+1200080426&4294967295,F=x+($<<12&4294967295|$>>>20),$=D+(N^F&(x^N))+M[6]+2821735955&4294967295,D=F+($<<17&4294967295|$>>>15),$=N+(x^D&(F^x))+M[7]+4249261313&4294967295,N=D+($<<22&4294967295|$>>>10),$=x+(F^N&(D^F))+M[8]+1770035416&4294967295,x=N+($<<7&4294967295|$>>>25),$=F+(D^x&(N^D))+M[9]+2336552879&4294967295,F=x+($<<12&4294967295|$>>>20),$=D+(N^F&(x^N))+M[10]+4294925233&4294967295,D=F+($<<17&4294967295|$>>>15),$=N+(x^D&(F^x))+M[11]+2304563134&4294967295,N=D+($<<22&4294967295|$>>>10),$=x+(F^N&(D^F))+M[12]+1804603682&4294967295,x=N+($<<7&4294967295|$>>>25),$=F+(D^x&(N^D))+M[13]+4254626195&4294967295,F=x+($<<12&4294967295|$>>>20),$=D+(N^F&(x^N))+M[14]+2792965006&4294967295,D=F+($<<17&4294967295|$>>>15),$=N+(x^D&(F^x))+M[15]+1236535329&4294967295,N=D+($<<22&4294967295|$>>>10),$=x+(D^F&(N^D))+M[1]+4129170786&4294967295,x=N+($<<5&4294967295|$>>>27),$=F+(N^D&(x^N))+M[6]+3225465664&4294967295,F=x+($<<9&4294967295|$>>>23),$=D+(x^N&(F^x))+M[11]+643717713&4294967295,D=F+($<<14&4294967295|$>>>18),$=N+(F^x&(D^F))+M[0]+3921069994&4294967295,N=D+($<<20&4294967295|$>>>12),$=x+(D^F&(N^D))+M[5]+3593408605&4294967295,x=N+($<<5&4294967295|$>>>27),$=F+(N^D&(x^N))+M[10]+38016083&4294967295,F=x+($<<9&4294967295|$>>>23),$=D+(x^N&(F^x))+M[15]+3634488961&4294967295,D=F+($<<14&4294967295|$>>>18),$=N+(F^x&(D^F))+M[4]+3889429448&4294967295,N=D+($<<20&4294967295|$>>>12),$=x+(D^F&(N^D))+M[9]+568446438&4294967295,x=N+($<<5&4294967295|$>>>27),$=F+(N^D&(x^N))+M[14]+3275163606&4294967295,F=x+($<<9&4294967295|$>>>23),$=D+(x^N&(F^x))+M[3]+4107603335&4294967295,D=F+($<<14&4294967295|$>>>18),$=N+(F^x&(D^F))+M[8]+1163531501&4294967295,N=D+($<<20&4294967295|$>>>12),$=x+(D^F&(N^D))+M[13]+2850285829&4294967295,x=N+($<<5&4294967295|$>>>27),$=F+(N^D&(x^N))+M[2]+4243563512&4294967295,F=x+($<<9&4294967295|$>>>23),$=D+(x^N&(F^x))+M[7]+1735328473&4294967295,D=F+($<<14&4294967295|$>>>18),$=N+(F^x&(D^F))+M[12]+2368359562&4294967295,N=D+($<<20&4294967295|$>>>12),$=x+(N^D^F)+M[5]+4294588738&4294967295,x=N+($<<4&4294967295|$>>>28),$=F+(x^N^D)+M[8]+2272392833&4294967295,F=x+($<<11&4294967295|$>>>21),$=D+(F^x^N)+M[11]+1839030562&4294967295,D=F+($<<16&4294967295|$>>>16),$=N+(D^F^x)+M[14]+4259657740&4294967295,N=D+($<<23&4294967295|$>>>9),$=x+(N^D^F)+M[1]+2763975236&4294967295,x=N+($<<4&4294967295|$>>>28),$=F+(x^N^D)+M[4]+1272893353&4294967295,F=x+($<<11&4294967295|$>>>21),$=D+(F^x^N)+M[7]+4139469664&4294967295,D=F+($<<16&4294967295|$>>>16),$=N+(D^F^x)+M[10]+3200236656&4294967295,N=D+($<<23&4294967295|$>>>9),$=x+(N^D^F)+M[13]+681279174&4294967295,x=N+($<<4&4294967295|$>>>28),$=F+(x^N^D)+M[0]+3936430074&4294967295,F=x+($<<11&4294967295|$>>>21),$=D+(F^x^N)+M[3]+3572445317&4294967295,D=F+($<<16&4294967295|$>>>16),$=N+(D^F^x)+M[6]+76029189&4294967295,N=D+($<<23&4294967295|$>>>9),$=x+(N^D^F)+M[9]+3654602809&4294967295,x=N+($<<4&4294967295|$>>>28),$=F+(x^N^D)+M[12]+3873151461&4294967295,F=x+($<<11&4294967295|$>>>21),$=D+(F^x^N)+M[15]+530742520&4294967295,D=F+($<<16&4294967295|$>>>16),$=N+(D^F^x)+M[2]+3299628645&4294967295,N=D+($<<23&4294967295|$>>>9),$=x+(D^(N|~F))+M[0]+4096336452&4294967295,x=N+($<<6&4294967295|$>>>26),$=F+(N^(x|~D))+M[7]+1126891415&4294967295,F=x+($<<10&4294967295|$>>>22),$=D+(x^(F|~N))+M[14]+2878612391&4294967295,D=F+($<<15&4294967295|$>>>17),$=N+(F^(D|~x))+M[5]+4237533241&4294967295,N=D+($<<21&4294967295|$>>>11),$=x+(D^(N|~F))+M[12]+1700485571&4294967295,x=N+($<<6&4294967295|$>>>26),$=F+(N^(x|~D))+M[3]+2399980690&4294967295,F=x+($<<10&4294967295|$>>>22),$=D+(x^(F|~N))+M[10]+4293915773&4294967295,D=F+($<<15&4294967295|$>>>17),$=N+(F^(D|~x))+M[1]+2240044497&4294967295,N=D+($<<21&4294967295|$>>>11),$=x+(D^(N|~F))+M[8]+1873313359&4294967295,x=N+($<<6&4294967295|$>>>26),$=F+(N^(x|~D))+M[15]+4264355552&4294967295,F=x+($<<10&4294967295|$>>>22),$=D+(x^(F|~N))+M[6]+2734768916&4294967295,D=F+($<<15&4294967295|$>>>17),$=N+(F^(D|~x))+M[13]+1309151649&4294967295,N=D+($<<21&4294967295|$>>>11),$=x+(D^(N|~F))+M[4]+4149444226&4294967295,x=N+($<<6&4294967295|$>>>26),$=F+(N^(x|~D))+M[11]+3174756917&4294967295,F=x+($<<10&4294967295|$>>>22),$=D+(x^(F|~N))+M[2]+718787259&4294967295,D=F+($<<15&4294967295|$>>>17),$=N+(F^(D|~x))+M[9]+3951481745&4294967295,P.g[0]=P.g[0]+x&4294967295,P.g[1]=P.g[1]+(D+($<<21&4294967295|$>>>11))&4294967295,P.g[2]=P.g[2]+D&4294967295,P.g[3]=P.g[3]+F&4294967295}r.prototype.u=function(P,x){x===void 0&&(x=P.length);for(var N=x-this.blockSize,M=this.B,D=this.h,F=0;F<x;){if(D==0)for(;F<=N;)s(this,P,F),F+=this.blockSize;if(typeof P=="string"){for(;F<x;)if(M[D++]=P.charCodeAt(F++),D==this.blockSize){s(this,M),D=0;break}}else for(;F<x;)if(M[D++]=P[F++],D==this.blockSize){s(this,M),D=0;break}}this.h=D,this.o+=x},r.prototype.v=function(){var P=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);P[0]=128;for(var x=1;x<P.length-8;++x)P[x]=0;var N=8*this.o;for(x=P.length-8;x<P.length;++x)P[x]=N&255,N/=256;for(this.u(P),P=Array(16),x=N=0;4>x;++x)for(var M=0;32>M;M+=8)P[N++]=this.g[x]>>>M&255;return P};function i(P,x){var N=o;return Object.prototype.hasOwnProperty.call(N,P)?N[P]:N[P]=x(P)}function a(P,x){this.h=x;for(var N=[],M=!0,D=P.length-1;0<=D;D--){var F=P[D]|0;M&&F==x||(N[D]=F,M=!1)}this.g=N}var o={};function l(P){return-128<=P&&128>P?i(P,function(x){return new a([x|0],0>x?-1:0)}):new a([P|0],0>P?-1:0)}function u(P){if(isNaN(P)||!isFinite(P))return f;if(0>P)return S(u(-P));for(var x=[],N=1,M=0;P>=N;M++)x[M]=P/N|0,N*=4294967296;return new a(x,0)}function h(P,x){if(P.length==0)throw Error("number format error: empty string");if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(P.charAt(0)=="-")return S(h(P.substring(1),x));if(0<=P.indexOf("-"))throw Error('number format error: interior "-" character');for(var N=u(Math.pow(x,8)),M=f,D=0;D<P.length;D+=8){var F=Math.min(8,P.length-D),$=parseInt(P.substring(D,D+F),x);8>F?(F=u(Math.pow(x,F)),M=M.j(F).add(u($))):(M=M.j(N),M=M.add(u($)))}return M}var f=l(0),p=l(1),y=l(16777216);n=a.prototype,n.m=function(){if(b(this))return-S(this).m();for(var P=0,x=1,N=0;N<this.g.length;N++){var M=this.i(N);P+=(0<=M?M:4294967296+M)*x,x*=4294967296}return P},n.toString=function(P){if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(_(this))return"0";if(b(this))return"-"+S(this).toString(P);for(var x=u(Math.pow(P,6)),N=this,M="";;){var D=I(N,x).g;N=E(N,D.j(x));var F=((0<N.g.length?N.g[0]:N.h)>>>0).toString(P);if(N=D,_(N))return F+M;for(;6>F.length;)F="0"+F;M=F+M}},n.i=function(P){return 0>P?0:P<this.g.length?this.g[P]:this.h};function _(P){if(P.h!=0)return!1;for(var x=0;x<P.g.length;x++)if(P.g[x]!=0)return!1;return!0}function b(P){return P.h==-1}n.l=function(P){return P=E(this,P),b(P)?-1:_(P)?0:1};function S(P){for(var x=P.g.length,N=[],M=0;M<x;M++)N[M]=~P.g[M];return new a(N,~P.h).add(p)}n.abs=function(){return b(this)?S(this):this},n.add=function(P){for(var x=Math.max(this.g.length,P.g.length),N=[],M=0,D=0;D<=x;D++){var F=M+(this.i(D)&65535)+(P.i(D)&65535),$=(F>>>16)+(this.i(D)>>>16)+(P.i(D)>>>16);M=$>>>16,F&=65535,$&=65535,N[D]=$<<16|F}return new a(N,N[N.length-1]&-2147483648?-1:0)};function E(P,x){return P.add(S(x))}n.j=function(P){if(_(this)||_(P))return f;if(b(this))return b(P)?S(this).j(S(P)):S(S(this).j(P));if(b(P))return S(this.j(S(P)));if(0>this.l(y)&&0>P.l(y))return u(this.m()*P.m());for(var x=this.g.length+P.g.length,N=[],M=0;M<2*x;M++)N[M]=0;for(M=0;M<this.g.length;M++)for(var D=0;D<P.g.length;D++){var F=this.i(M)>>>16,$=this.i(M)&65535,H=P.i(D)>>>16,G=P.i(D)&65535;N[2*M+2*D]+=$*G,C(N,2*M+2*D),N[2*M+2*D+1]+=F*G,C(N,2*M+2*D+1),N[2*M+2*D+1]+=$*H,C(N,2*M+2*D+1),N[2*M+2*D+2]+=F*H,C(N,2*M+2*D+2)}for(M=0;M<x;M++)N[M]=N[2*M+1]<<16|N[2*M];for(M=x;M<2*x;M++)N[M]=0;return new a(N,0)};function C(P,x){for(;(P[x]&65535)!=P[x];)P[x+1]+=P[x]>>>16,P[x]&=65535,x++}function v(P,x){this.g=P,this.h=x}function I(P,x){if(_(x))throw Error("division by zero");if(_(P))return new v(f,f);if(b(P))return x=I(S(P),x),new v(S(x.g),S(x.h));if(b(x))return x=I(P,S(x)),new v(S(x.g),x.h);if(30<P.g.length){if(b(P)||b(x))throw Error("slowDivide_ only works with positive integers.");for(var N=p,M=x;0>=M.l(P);)N=L(N),M=L(M);var D=R(N,1),F=R(M,1);for(M=R(M,2),N=R(N,2);!_(M);){var $=F.add(M);0>=$.l(P)&&(D=D.add(N),F=$),M=R(M,1),N=R(N,1)}return x=E(P,D.j(x)),new v(D,x)}for(D=f;0<=P.l(x);){for(N=Math.max(1,Math.floor(P.m()/x.m())),M=Math.ceil(Math.log(N)/Math.LN2),M=48>=M?1:Math.pow(2,M-48),F=u(N),$=F.j(x);b($)||0<$.l(P);)N-=M,F=u(N),$=F.j(x);_(F)&&(F=p),D=D.add(F),P=E(P,$)}return new v(D,P)}n.A=function(P){return I(this,P).h},n.and=function(P){for(var x=Math.max(this.g.length,P.g.length),N=[],M=0;M<x;M++)N[M]=this.i(M)&P.i(M);return new a(N,this.h&P.h)},n.or=function(P){for(var x=Math.max(this.g.length,P.g.length),N=[],M=0;M<x;M++)N[M]=this.i(M)|P.i(M);return new a(N,this.h|P.h)},n.xor=function(P){for(var x=Math.max(this.g.length,P.g.length),N=[],M=0;M<x;M++)N[M]=this.i(M)^P.i(M);return new a(N,this.h^P.h)};function L(P){for(var x=P.g.length+1,N=[],M=0;M<x;M++)N[M]=P.i(M)<<1|P.i(M-1)>>>31;return new a(N,P.h)}function R(P,x){var N=x>>5;x%=32;for(var M=P.g.length-N,D=[],F=0;F<M;F++)D[F]=0<x?P.i(F+N)>>>x|P.i(F+N+1)<<32-x:P.i(F+N);return new a(D,P.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,PM=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=u,a.fromString=h,kc=a}).apply(typeof eO<"u"?eO:typeof self<"u"?self:typeof window<"u"?window:{});var Yy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var AM,em,RM,G0,uC,NM,OM,LM;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(m,k,O){return m==Array.prototype||m==Object.prototype||(m[k]=O.value),m};function t(m){m=[typeof globalThis=="object"&&globalThis,m,typeof window=="object"&&window,typeof self=="object"&&self,typeof Yy=="object"&&Yy];for(var k=0;k<m.length;++k){var O=m[k];if(O&&O.Math==Math)return O}throw Error("Cannot find global object")}var r=t(this);function s(m,k){if(k)e:{var O=r;m=m.split(".");for(var j=0;j<m.length-1;j++){var K=m[j];if(!(K in O))break e;O=O[K]}m=m[m.length-1],j=O[m],k=k(j),k!=j&&k!=null&&e(O,m,{configurable:!0,writable:!0,value:k})}}function i(m,k){m instanceof String&&(m+="");var O=0,j=!1,K={next:function(){if(!j&&O<m.length){var ne=O++;return{value:k(ne,m[ne]),done:!1}}return j=!0,{done:!0,value:void 0}}};return K[Symbol.iterator]=function(){return K},K}s("Array.prototype.values",function(m){return m||function(){return i(this,function(k,O){return O})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},o=this||self;function l(m){var k=typeof m;return k=k!="object"?k:m?Array.isArray(m)?"array":k:"null",k=="array"||k=="object"&&typeof m.length=="number"}function u(m){var k=typeof m;return k=="object"&&m!=null||k=="function"}function h(m,k,O){return m.call.apply(m.bind,arguments)}function f(m,k,O){if(!m)throw Error();if(2<arguments.length){var j=Array.prototype.slice.call(arguments,2);return function(){var K=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(K,j),m.apply(k,K)}}return function(){return m.apply(k,arguments)}}function p(m,k,O){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,p.apply(null,arguments)}function y(m,k){var O=Array.prototype.slice.call(arguments,1);return function(){var j=O.slice();return j.push.apply(j,arguments),m.apply(this,j)}}function _(m,k){function O(){}O.prototype=k.prototype,m.aa=k.prototype,m.prototype=new O,m.prototype.constructor=m,m.Qb=function(j,K,ne){for(var ge=Array(arguments.length-2),Pt=2;Pt<arguments.length;Pt++)ge[Pt-2]=arguments[Pt];return k.prototype[K].apply(j,ge)}}function b(m){const k=m.length;if(0<k){const O=Array(k);for(let j=0;j<k;j++)O[j]=m[j];return O}return[]}function S(m,k){for(let O=1;O<arguments.length;O++){const j=arguments[O];if(l(j)){const K=m.length||0,ne=j.length||0;m.length=K+ne;for(let ge=0;ge<ne;ge++)m[K+ge]=j[ge]}else m.push(j)}}class E{constructor(k,O){this.i=k,this.j=O,this.h=0,this.g=null}get(){let k;return 0<this.h?(this.h--,k=this.g,this.g=k.next,k.next=null):k=this.i(),k}}function C(m){return/^[\s\xa0]*$/.test(m)}function v(){var m=o.navigator;return m&&(m=m.userAgent)?m:""}function I(m){return I[" "](m),m}I[" "]=function(){};var L=v().indexOf("Gecko")!=-1&&!(v().toLowerCase().indexOf("webkit")!=-1&&v().indexOf("Edge")==-1)&&!(v().indexOf("Trident")!=-1||v().indexOf("MSIE")!=-1)&&v().indexOf("Edge")==-1;function R(m,k,O){for(const j in m)k.call(O,m[j],j,m)}function P(m,k){for(const O in m)k.call(void 0,m[O],O,m)}function x(m){const k={};for(const O in m)k[O]=m[O];return k}const N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function M(m,k){let O,j;for(let K=1;K<arguments.length;K++){j=arguments[K];for(O in j)m[O]=j[O];for(let ne=0;ne<N.length;ne++)O=N[ne],Object.prototype.hasOwnProperty.call(j,O)&&(m[O]=j[O])}}function D(m){var k=1;m=m.split(":");const O=[];for(;0<k&&m.length;)O.push(m.shift()),k--;return m.length&&O.push(m.join(":")),O}function F(m){o.setTimeout(()=>{throw m},0)}function $(){var m=Q;let k=null;return m.g&&(k=m.g,m.g=m.g.next,m.g||(m.h=null),k.next=null),k}class H{constructor(){this.h=this.g=null}add(k,O){const j=G.get();j.set(k,O),this.h?this.h.next=j:this.g=j,this.h=j}}var G=new E(()=>new ue,m=>m.reset());class ue{constructor(){this.next=this.g=this.h=null}set(k,O){this.h=k,this.g=O,this.next=null}reset(){this.next=this.g=this.h=null}}let ae,z=!1,Q=new H,ee=()=>{const m=o.Promise.resolve(void 0);ae=()=>{m.then(se)}};var se=()=>{for(var m;m=$();){try{m.h.call(m.g)}catch(O){F(O)}var k=G;k.j(m),100>k.h&&(k.h++,m.next=k.g,k.g=m)}z=!1};function le(){this.s=this.s,this.C=this.C}le.prototype.s=!1,le.prototype.ma=function(){this.s||(this.s=!0,this.N())},le.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ye(m,k){this.type=m,this.g=this.target=k,this.defaultPrevented=!1}ye.prototype.h=function(){this.defaultPrevented=!0};var ve=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var m=!1,k=Object.defineProperty({},"passive",{get:function(){m=!0}});try{const O=()=>{};o.addEventListener("test",O,k),o.removeEventListener("test",O,k)}catch{}return m}();function de(m,k){if(ye.call(this,m?m.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,m){var O=this.type=m.type,j=m.changedTouches&&m.changedTouches.length?m.changedTouches[0]:null;if(this.target=m.target||m.srcElement,this.g=k,k=m.relatedTarget){if(L){e:{try{I(k.nodeName);var K=!0;break e}catch{}K=!1}K||(k=null)}}else O=="mouseover"?k=m.fromElement:O=="mouseout"&&(k=m.toElement);this.relatedTarget=k,j?(this.clientX=j.clientX!==void 0?j.clientX:j.pageX,this.clientY=j.clientY!==void 0?j.clientY:j.pageY,this.screenX=j.screenX||0,this.screenY=j.screenY||0):(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0),this.button=m.button,this.key=m.key||"",this.ctrlKey=m.ctrlKey,this.altKey=m.altKey,this.shiftKey=m.shiftKey,this.metaKey=m.metaKey,this.pointerId=m.pointerId||0,this.pointerType=typeof m.pointerType=="string"?m.pointerType:Me[m.pointerType]||"",this.state=m.state,this.i=m,m.defaultPrevented&&de.aa.h.call(this)}}_(de,ye);var Me={2:"touch",3:"pen",4:"mouse"};de.prototype.h=function(){de.aa.h.call(this);var m=this.i;m.preventDefault?m.preventDefault():m.returnValue=!1};var B="closure_listenable_"+(1e6*Math.random()|0),Z=0;function be(m,k,O,j,K){this.listener=m,this.proxy=null,this.src=k,this.type=O,this.capture=!!j,this.ha=K,this.key=++Z,this.da=this.fa=!1}function Ce(m){m.da=!0,m.listener=null,m.proxy=null,m.src=null,m.ha=null}function Le(m){this.src=m,this.g={},this.h=0}Le.prototype.add=function(m,k,O,j,K){var ne=m.toString();m=this.g[ne],m||(m=this.g[ne]=[],this.h++);var ge=ht(m,k,j,K);return-1<ge?(k=m[ge],O||(k.fa=!1)):(k=new be(k,this.src,ne,!!j,K),k.fa=O,m.push(k)),k};function et(m,k){var O=k.type;if(O in m.g){var j=m.g[O],K=Array.prototype.indexOf.call(j,k,void 0),ne;(ne=0<=K)&&Array.prototype.splice.call(j,K,1),ne&&(Ce(k),m.g[O].length==0&&(delete m.g[O],m.h--))}}function ht(m,k,O,j){for(var K=0;K<m.length;++K){var ne=m[K];if(!ne.da&&ne.listener==k&&ne.capture==!!O&&ne.ha==j)return K}return-1}var cn="closure_lm_"+(1e6*Math.random()|0),ot={};function Gn(m,k,O,j,K){if(Array.isArray(k)){for(var ne=0;ne<k.length;ne++)Gn(m,k[ne],O,j,K);return null}return O=Se(O),m&&m[B]?m.K(k,O,u(j)?!!j.capture:!1,K):Wn(m,k,O,!1,j,K)}function Wn(m,k,O,j,K,ne){if(!k)throw Error("Invalid event type");var ge=u(K)?!!K.capture:!!K,Pt=Pe(m);if(Pt||(m[cn]=Pt=new Le(m)),O=Pt.add(k,O,j,ge,ne),O.proxy)return O;if(j=Ir(),O.proxy=j,j.src=m,j.listener=O,m.addEventListener)ve||(K=ge),K===void 0&&(K=!1),m.addEventListener(k.toString(),j,K);else if(m.attachEvent)m.attachEvent(xs(k.toString()),j);else if(m.addListener&&m.removeListener)m.addListener(j);else throw Error("addEventListener and attachEvent are unavailable.");return O}function Ir(){function m(O){return k.call(m.src,m.listener,O)}const k=Ge;return m}function Is(m,k,O,j,K){if(Array.isArray(k))for(var ne=0;ne<k.length;ne++)Is(m,k[ne],O,j,K);else j=u(j)?!!j.capture:!!j,O=Se(O),m&&m[B]?(m=m.i,k=String(k).toString(),k in m.g&&(ne=m.g[k],O=ht(ne,O,j,K),-1<O&&(Ce(ne[O]),Array.prototype.splice.call(ne,O,1),ne.length==0&&(delete m.g[k],m.h--)))):m&&(m=Pe(m))&&(k=m.g[k.toString()],m=-1,k&&(m=ht(k,O,j,K)),(O=-1<m?k[m]:null)&&we(O))}function we(m){if(typeof m!="number"&&m&&!m.da){var k=m.src;if(k&&k[B])et(k.i,m);else{var O=m.type,j=m.proxy;k.removeEventListener?k.removeEventListener(O,j,m.capture):k.detachEvent?k.detachEvent(xs(O),j):k.addListener&&k.removeListener&&k.removeListener(j),(O=Pe(k))?(et(O,m),O.h==0&&(O.src=null,k[cn]=null)):Ce(m)}}}function xs(m){return m in ot?ot[m]:ot[m]="on"+m}function Ge(m,k){if(m.da)m=!0;else{k=new de(k,this);var O=m.listener,j=m.ha||m.src;m.fa&&we(m),m=O.call(j,k)}return m}function Pe(m){return m=m[cn],m instanceof Le?m:null}var $e="__closure_events_fn_"+(1e9*Math.random()>>>0);function Se(m){return typeof m=="function"?m:(m[$e]||(m[$e]=function(k){return m.handleEvent(k)}),m[$e])}function fe(){le.call(this),this.i=new Le(this),this.M=this,this.F=null}_(fe,le),fe.prototype[B]=!0,fe.prototype.removeEventListener=function(m,k,O,j){Is(this,m,k,O,j)};function Ne(m,k){var O,j=m.F;if(j)for(O=[];j;j=j.F)O.push(j);if(m=m.M,j=k.type||k,typeof k=="string")k=new ye(k,m);else if(k instanceof ye)k.target=k.target||m;else{var K=k;k=new ye(j,m),M(k,K)}if(K=!0,O)for(var ne=O.length-1;0<=ne;ne--){var ge=k.g=O[ne];K=Be(ge,j,!0,k)&&K}if(ge=k.g=m,K=Be(ge,j,!0,k)&&K,K=Be(ge,j,!1,k)&&K,O)for(ne=0;ne<O.length;ne++)ge=k.g=O[ne],K=Be(ge,j,!1,k)&&K}fe.prototype.N=function(){if(fe.aa.N.call(this),this.i){var m=this.i,k;for(k in m.g){for(var O=m.g[k],j=0;j<O.length;j++)Ce(O[j]);delete m.g[k],m.h--}}this.F=null},fe.prototype.K=function(m,k,O,j){return this.i.add(String(m),k,!1,O,j)},fe.prototype.L=function(m,k,O,j){return this.i.add(String(m),k,!0,O,j)};function Be(m,k,O,j){if(k=m.i.g[String(k)],!k)return!0;k=k.concat();for(var K=!0,ne=0;ne<k.length;++ne){var ge=k[ne];if(ge&&!ge.da&&ge.capture==O){var Pt=ge.listener,xn=ge.ha||ge.src;ge.fa&&et(m.i,ge),K=Pt.call(xn,j)!==!1&&K}}return K&&!j.defaultPrevented}function Hn(m,k,O){if(typeof m=="function")O&&(m=p(m,O));else if(m&&typeof m.handleEvent=="function")m=p(m.handleEvent,m);else throw Error("Invalid listener argument");return 2147483647<Number(k)?-1:o.setTimeout(m,k||0)}function zu(m){m.g=Hn(()=>{m.g=null,m.i&&(m.i=!1,zu(m))},m.l);const k=m.h;m.h=null,m.m.apply(null,k)}class _d extends le{constructor(k,O){super(),this.m=k,this.l=O,this.h=null,this.i=!1,this.g=null}j(k){this.h=arguments,this.g?this.i=!0:zu(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Gu(m){le.call(this),this.h=m,this.g={}}_(Gu,le);var L_=[];function M_(m){R(m.g,function(k,O){this.g.hasOwnProperty(O)&&we(k)},m),m.g={}}Gu.prototype.N=function(){Gu.aa.N.call(this),M_(this)},Gu.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Yf=o.JSON.stringify,yE=o.JSON.parse,D_=class{stringify(m){return o.JSON.stringify(m,void 0)}parse(m){return o.JSON.parse(m,void 0)}};function Jf(){}Jf.prototype.h=null;function F_(m){return m.h||(m.h=m.i())}function $_(){}var Wu={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Xf(){ye.call(this,"d")}_(Xf,ye);function Zf(){ye.call(this,"c")}_(Zf,ye);var _a={},ep=null;function yd(){return ep=ep||new fe}_a.La="serverreachability";function vd(m){ye.call(this,_a.La,m)}_(vd,ye);function il(m){const k=yd();Ne(k,new vd(k))}_a.STAT_EVENT="statevent";function tp(m,k){ye.call(this,_a.STAT_EVENT,m),this.stat=k}_(tp,ye);function xr(m){const k=yd();Ne(k,new tp(k,m))}_a.Ma="timingevent";function j_(m,k){ye.call(this,_a.Ma,m),this.size=k}_(j_,ye);function Hu(m,k){if(typeof m!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){m()},k)}function al(){this.g=!0}al.prototype.xa=function(){this.g=!1};function np(m,k,O,j,K,ne){m.info(function(){if(m.g)if(ne)for(var ge="",Pt=ne.split("&"),xn=0;xn<Pt.length;xn++){var wt=Pt[xn].split("=");if(1<wt.length){var Kn=wt[0];wt=wt[1];var Mn=Kn.split("_");ge=2<=Mn.length&&Mn[1]=="type"?ge+(Kn+"="+wt+"&"):ge+(Kn+"=redacted&")}}else ge=null;else ge=ne;return"XMLHTTP REQ ("+j+") [attempt "+K+"]: "+k+`
`+O+`
`+ge})}function vE(m,k,O,j,K,ne,ge){m.info(function(){return"XMLHTTP RESP ("+j+") [ attempt "+K+"]: "+k+`
`+O+`
`+ne+" "+ge})}function ol(m,k,O,j){m.info(function(){return"XMLHTTP TEXT ("+k+"): "+wE(m,O)+(j?" "+j:"")})}function wd(m,k){m.info(function(){return"TIMEOUT: "+k})}al.prototype.info=function(){};function wE(m,k){if(!m.g)return k;if(!k)return null;try{var O=JSON.parse(k);if(O){for(m=0;m<O.length;m++)if(Array.isArray(O[m])){var j=O[m];if(!(2>j.length)){var K=j[1];if(Array.isArray(K)&&!(1>K.length)){var ne=K[0];if(ne!="noop"&&ne!="stop"&&ne!="close")for(var ge=1;ge<K.length;ge++)K[ge]=""}}}}return Yf(O)}catch{return k}}var bd={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},U_={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},rp;function Ed(){}_(Ed,Jf),Ed.prototype.g=function(){return new XMLHttpRequest},Ed.prototype.i=function(){return{}},rp=new Ed;function ya(m,k,O,j){this.j=m,this.i=k,this.l=O,this.R=j||1,this.U=new Gu(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new V_}function V_(){this.i=null,this.g="",this.h=!1}var B_={},sp={};function ip(m,k,O){m.L=1,m.v=Cd(ks(k)),m.m=O,m.P=!0,z_(m,null)}function z_(m,k){m.F=Date.now(),Sd(m),m.A=ks(m.v);var O=m.A,j=m.R;Array.isArray(j)||(j=[String(j)]),Tt(O.i,"t",j),m.C=0,O=m.j.J,m.h=new V_,m.g=mp(m.j,O?k:null,!m.m),0<m.O&&(m.M=new _d(p(m.Y,m,m.g),m.O)),k=m.U,O=m.g,j=m.ca;var K="readystatechange";Array.isArray(K)||(K&&(L_[0]=K.toString()),K=L_);for(var ne=0;ne<K.length;ne++){var ge=Gn(O,K[ne],j||k.handleEvent,!1,k.h||k);if(!ge)break;k.g[ge.key]=ge}k=m.H?x(m.H):{},m.m?(m.u||(m.u="POST"),k["Content-Type"]="application/x-www-form-urlencoded",m.g.ea(m.A,m.u,m.m,k)):(m.u="GET",m.g.ea(m.A,m.u,null,k)),il(),np(m.i,m.u,m.A,m.l,m.R,m.m)}ya.prototype.ca=function(m){m=m.target;const k=this.M;k&&Hr(m)==3?k.j():this.Y(m)},ya.prototype.Y=function(m){try{if(m==this.g)e:{const Mn=Hr(this.g);var k=this.g.Ba();const Ta=this.g.Z();if(!(3>Mn)&&(Mn!=3||this.g&&(this.h.h||this.g.oa()||Ju(this.g)))){this.J||Mn!=4||k==7||(k==8||0>=Ta?il(3):il(2)),so(this);var O=this.g.Z();this.X=O;t:if(G_(this)){var j=Ju(this.g);m="";var K=j.length,ne=Hr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Li(this),io(this);var ge="";break t}this.h.i=new o.TextDecoder}for(k=0;k<K;k++)this.h.h=!0,m+=this.h.i.decode(j[k],{stream:!(ne&&k==K-1)});j.length=0,this.h.g+=m,this.C=0,ge=this.h.g}else ge=this.g.oa();if(this.o=O==200,vE(this.i,this.u,this.A,this.l,this.R,Mn,O),this.o){if(this.T&&!this.K){t:{if(this.g){var Pt,xn=this.g;if((Pt=xn.g?xn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(Pt)){var wt=Pt;break t}}wt=null}if(O=wt)ol(this.i,this.l,O,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ap(this,O);else{this.o=!1,this.s=3,xr(12),Li(this),io(this);break e}}if(this.P){O=!0;let cr;for(;!this.J&&this.C<ge.length;)if(cr=bE(this,ge),cr==sp){Mn==4&&(this.s=4,xr(14),O=!1),ol(this.i,this.l,null,"[Incomplete Response]");break}else if(cr==B_){this.s=4,xr(15),ol(this.i,this.l,ge,"[Invalid Chunk]"),O=!1;break}else ol(this.i,this.l,cr,null),ap(this,cr);if(G_(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Mn!=4||ge.length!=0||this.h.h||(this.s=1,xr(16),O=!1),this.o=this.o&&O,!O)ol(this.i,this.l,ge,"[Invalid Chunked Response]"),Li(this),io(this);else if(0<ge.length&&!this.W){this.W=!0;var Kn=this.j;Kn.g==this&&Kn.ba&&!Kn.M&&(Kn.j.info("Great, no buffering proxy detected. Bytes received: "+ge.length),fo(Kn),Kn.M=!0,xr(11))}}else ol(this.i,this.l,ge,null),ap(this,ge);Mn==4&&Li(this),this.o&&!this.J&&(Mn==4?fp(this.j,this):(this.o=!1,Sd(this)))}else Ad(this.g),O==400&&0<ge.indexOf("Unknown SID")?(this.s=3,xr(12)):(this.s=0,xr(13)),Li(this),io(this)}}}catch{}finally{}};function G_(m){return m.g?m.u=="GET"&&m.L!=2&&m.j.Ca:!1}function bE(m,k){var O=m.C,j=k.indexOf(`
`,O);return j==-1?sp:(O=Number(k.substring(O,j)),isNaN(O)?B_:(j+=1,j+O>k.length?sp:(k=k.slice(j,j+O),m.C=j+O,k)))}ya.prototype.cancel=function(){this.J=!0,Li(this)};function Sd(m){m.S=Date.now()+m.I,Td(m,m.I)}function Td(m,k){if(m.B!=null)throw Error("WatchDog timer not null");m.B=Hu(p(m.ba,m),k)}function so(m){m.B&&(o.clearTimeout(m.B),m.B=null)}ya.prototype.ba=function(){this.B=null;const m=Date.now();0<=m-this.S?(wd(this.i,this.A),this.L!=2&&(il(),xr(17)),Li(this),this.s=2,io(this)):Td(this,this.S-m)};function io(m){m.j.G==0||m.J||fp(m.j,m)}function Li(m){so(m);var k=m.M;k&&typeof k.ma=="function"&&k.ma(),m.M=null,M_(m.U),m.g&&(k=m.g,m.g=null,k.abort(),k.ma())}function ap(m,k){try{var O=m.j;if(O.G!=0&&(O.g==m||Bt(O.h,m))){if(!m.K&&Bt(O.h,m)&&O.G==3){try{var j=O.Da.g.parse(k)}catch{j=null}if(Array.isArray(j)&&j.length==3){var K=j;if(K[0]==0){e:if(!O.u){if(O.g)if(O.g.F+3e3<m.F)Xu(O),As(O);else break e;Yt(O),xr(18)}}else O.za=K[1],0<O.za-O.T&&37500>K[2]&&O.F&&O.v==0&&!O.C&&(O.C=Hu(p(O.Za,O),6e3));if(1>=Qt(O.h)&&O.ca){try{O.ca()}catch{}O.ca=void 0}}else $i(O,11)}else if((m.K||O.g==m)&&Xu(O),!C(k))for(K=O.Da.g.parse(k),k=0;k<K.length;k++){let wt=K[k];if(O.T=wt[0],wt=wt[1],O.G==2)if(wt[0]=="c"){O.K=wt[1],O.ia=wt[2];const Kn=wt[3];Kn!=null&&(O.la=Kn,O.j.info("VER="+O.la));const Mn=wt[4];Mn!=null&&(O.Aa=Mn,O.j.info("SVER="+O.Aa));const Ta=wt[5];Ta!=null&&typeof Ta=="number"&&0<Ta&&(j=1.5*Ta,O.L=j,O.j.info("backChannelRequestTimeoutMs_="+j)),j=O;const cr=m.g;if(cr){const Ar=cr.g?cr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ar){var ne=j.h;ne.g||Ar.indexOf("spdy")==-1&&Ar.indexOf("quic")==-1&&Ar.indexOf("h2")==-1||(ne.j=ne.l,ne.g=new Set,ne.h&&(hi(ne,ne.h),ne.h=null))}if(j.D){const ji=cr.g?cr.g.getResponseHeader("X-HTTP-Session-Id"):null;ji&&(j.ya=ji,Zt(j.I,j.D,ji))}}O.G=3,O.l&&O.l.ua(),O.ba&&(O.R=Date.now()-m.F,O.j.info("Handshake RTT: "+O.R+"ms")),j=O;var ge=m;if(j.qa=Zu(j,j.J?j.ia:null,j.W),ge.K){qn(j.h,ge);var Pt=ge,xn=j.L;xn&&(Pt.I=xn),Pt.B&&(so(Pt),Sd(Pt)),j.g=ge}else ds(j);0<O.i.length&&pi(O)}else wt[0]!="stop"&&wt[0]!="close"||$i(O,7);else O.G==3&&(wt[0]=="stop"||wt[0]=="close"?wt[0]=="stop"?$i(O,7):Fi(O):wt[0]!="noop"&&O.l&&O.l.ta(wt),O.v=0)}}il(4)}catch{}}var op=class{constructor(m,k){this.g=m,this.map=k}};function ao(m){this.l=m||10,o.PerformanceNavigationTiming?(m=o.performance.getEntriesByType("navigation"),m=0<m.length&&(m[0].nextHopProtocol=="hq"||m[0].nextHopProtocol=="h2")):m=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=m?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Mi(m){return m.h?!0:m.g?m.g.size>=m.j:!1}function Qt(m){return m.h?1:m.g?m.g.size:0}function Bt(m,k){return m.h?m.h==k:m.g?m.g.has(k):!1}function hi(m,k){m.g?m.g.add(k):m.h=k}function qn(m,k){m.h&&m.h==k?m.h=null:m.g&&m.g.has(k)&&m.g.delete(k)}ao.prototype.cancel=function(){if(this.i=kr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const m of this.g.values())m.cancel();this.g.clear()}};function kr(m){if(m.h!=null)return m.i.concat(m.h.D);if(m.g!=null&&m.g.size!==0){let k=m.i;for(const O of m.g.values())k=k.concat(O.D);return k}return b(m.i)}function oo(m){if(m.V&&typeof m.V=="function")return m.V();if(typeof Map<"u"&&m instanceof Map||typeof Set<"u"&&m instanceof Set)return Array.from(m.values());if(typeof m=="string")return m.split("");if(l(m)){for(var k=[],O=m.length,j=0;j<O;j++)k.push(m[j]);return k}k=[],O=0;for(j in m)k[O++]=m[j];return k}function ll(m){if(m.na&&typeof m.na=="function")return m.na();if(!m.V||typeof m.V!="function"){if(typeof Map<"u"&&m instanceof Map)return Array.from(m.keys());if(!(typeof Set<"u"&&m instanceof Set)){if(l(m)||typeof m=="string"){var k=[];m=m.length;for(var O=0;O<m;O++)k.push(O);return k}k=[],O=0;for(const j in m)k[O++]=j;return k}}}function Pr(m,k){if(m.forEach&&typeof m.forEach=="function")m.forEach(k,void 0);else if(l(m)||typeof m=="string")Array.prototype.forEach.call(m,k,void 0);else for(var O=ll(m),j=oo(m),K=j.length,ne=0;ne<K;ne++)k.call(void 0,j[ne],O&&O[ne],m)}var qu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function W_(m,k){if(m){m=m.split("&");for(var O=0;O<m.length;O++){var j=m[O].indexOf("="),K=null;if(0<=j){var ne=m[O].substring(0,j);K=m[O].substring(j+1)}else ne=m[O];k(ne,K?decodeURIComponent(K.replace(/\+/g," ")):"")}}}function va(m){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,m instanceof va){this.h=m.h,Ku(this,m.j),this.o=m.o,this.g=m.g,Gr(this,m.s),this.l=m.l;var k=m.i,O=new lo;O.i=k.i,k.g&&(O.g=new Map(k.g),O.h=k.h),H_(this,O),this.m=m.m}else m&&(k=String(m).match(qu))?(this.h=!1,Ku(this,k[1]||"",!0),this.o=wa(k[2]||""),this.g=wa(k[3]||"",!0),Gr(this,k[4]),this.l=wa(k[5]||"",!0),H_(this,k[6]||"",!0),this.m=wa(k[7]||"")):(this.h=!1,this.i=new lo(null,this.h))}va.prototype.toString=function(){var m=[],k=this.j;k&&m.push(ba(k,Yu,!0),":");var O=this.g;return(O||k=="file")&&(m.push("//"),(k=this.o)&&m.push(ba(k,Yu,!0),"@"),m.push(encodeURIComponent(String(O)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),O=this.s,O!=null&&m.push(":",String(O))),(O=this.l)&&(this.g&&O.charAt(0)!="/"&&m.push("/"),m.push(ba(O,O.charAt(0)=="/"?SE:EE,!0))),(O=this.i.toString())&&m.push("?",O),(O=this.m)&&m.push("#",ba(O,q_)),m.join("")};function ks(m){return new va(m)}function Ku(m,k,O){m.j=O?wa(k,!0):k,m.j&&(m.j=m.j.replace(/:$/,""))}function Gr(m,k){if(k){if(k=Number(k),isNaN(k)||0>k)throw Error("Bad port number "+k);m.s=k}else m.s=null}function H_(m,k,O){k instanceof lo?(m.i=k,up(m.i,m.h)):(O||(k=ba(k,lp)),m.i=new lo(k,m.h))}function Zt(m,k,O){m.i.set(k,O)}function Cd(m){return Zt(m,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),m}function wa(m,k){return m?k?decodeURI(m.replace(/%25/g,"%2525")):decodeURIComponent(m):""}function ba(m,k,O){return typeof m=="string"?(m=encodeURI(m).replace(k,Qu),O&&(m=m.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m):null}function Qu(m){return m=m.charCodeAt(0),"%"+(m>>4&15).toString(16)+(m&15).toString(16)}var Yu=/[#\/\?@]/g,EE=/[#\?:]/g,SE=/[#\?]/g,lp=/[#\?@]/g,q_=/#/g;function lo(m,k){this.h=this.g=null,this.i=m||null,this.j=!!k}function Ps(m){m.g||(m.g=new Map,m.h=0,m.i&&W_(m.i,function(k,O){m.add(decodeURIComponent(k.replace(/\+/g," ")),O)}))}n=lo.prototype,n.add=function(m,k){Ps(this),this.i=null,m=uo(this,m);var O=this.g.get(m);return O||this.g.set(m,O=[]),O.push(k),this.h+=1,this};function K_(m,k){Ps(m),k=uo(m,k),m.g.has(k)&&(m.i=null,m.h-=m.g.get(k).length,m.g.delete(k))}function Id(m,k){return Ps(m),k=uo(m,k),m.g.has(k)}n.forEach=function(m,k){Ps(this),this.g.forEach(function(O,j){O.forEach(function(K){m.call(k,K,j,this)},this)},this)},n.na=function(){Ps(this);const m=Array.from(this.g.values()),k=Array.from(this.g.keys()),O=[];for(let j=0;j<k.length;j++){const K=m[j];for(let ne=0;ne<K.length;ne++)O.push(k[j])}return O},n.V=function(m){Ps(this);let k=[];if(typeof m=="string")Id(this,m)&&(k=k.concat(this.g.get(uo(this,m))));else{m=Array.from(this.g.values());for(let O=0;O<m.length;O++)k=k.concat(m[O])}return k},n.set=function(m,k){return Ps(this),this.i=null,m=uo(this,m),Id(this,m)&&(this.h-=this.g.get(m).length),this.g.set(m,[k]),this.h+=1,this},n.get=function(m,k){return m?(m=this.V(m),0<m.length?String(m[0]):k):k};function Tt(m,k,O){K_(m,k),0<O.length&&(m.i=null,m.g.set(uo(m,k),b(O)),m.h+=O.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const m=[],k=Array.from(this.g.keys());for(var O=0;O<k.length;O++){var j=k[O];const ne=encodeURIComponent(String(j)),ge=this.V(j);for(j=0;j<ge.length;j++){var K=ne;ge[j]!==""&&(K+="="+encodeURIComponent(String(ge[j]))),m.push(K)}}return this.i=m.join("&")};function uo(m,k){return k=String(k),m.j&&(k=k.toLowerCase()),k}function up(m,k){k&&!m.j&&(Ps(m),m.i=null,m.g.forEach(function(O,j){var K=j.toLowerCase();j!=K&&(K_(this,j),Tt(this,K,O))},m)),m.j=k}function Q_(m,k){const O=new al;if(o.Image){const j=new Image;j.onload=y(Ea,O,"TestLoadImage: loaded",!0,k,j),j.onerror=y(Ea,O,"TestLoadImage: error",!1,k,j),j.onabort=y(Ea,O,"TestLoadImage: abort",!1,k,j),j.ontimeout=y(Ea,O,"TestLoadImage: timeout",!1,k,j),o.setTimeout(function(){j.ontimeout&&j.ontimeout()},1e4),j.src=m}else k(!1)}function TE(m,k){const O=new al,j=new AbortController,K=setTimeout(()=>{j.abort(),Ea(O,"TestPingServer: timeout",!1,k)},1e4);fetch(m,{signal:j.signal}).then(ne=>{clearTimeout(K),ne.ok?Ea(O,"TestPingServer: ok",!0,k):Ea(O,"TestPingServer: server error",!1,k)}).catch(()=>{clearTimeout(K),Ea(O,"TestPingServer: error",!1,k)})}function Ea(m,k,O,j,K){try{K&&(K.onload=null,K.onerror=null,K.onabort=null,K.ontimeout=null),j(O)}catch{}}function Ln(){this.g=new D_}function cp(m,k,O){const j=O||"";try{Pr(m,function(K,ne){let ge=K;u(K)&&(ge=Yf(K)),k.push(j+ne+"="+encodeURIComponent(ge))})}catch(K){throw k.push(j+"type="+encodeURIComponent("_badmap")),K}}function xd(m){this.l=m.Ub||null,this.j=m.eb||!1}_(xd,Jf),xd.prototype.g=function(){return new ul(this.l,this.j)},xd.prototype.i=function(m){return function(){return m}}({});function ul(m,k){fe.call(this),this.D=m,this.o=k,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}_(ul,fe),n=ul.prototype,n.open=function(m,k){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=m,this.A=k,this.readyState=1,Wr(this)},n.send=function(m){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const k={headers:this.u,method:this.B,credentials:this.m,cache:void 0};m&&(k.body=m),(this.D||o).fetch(new Request(this.A,k)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Sa(this)),this.readyState=0},n.Sa=function(m){if(this.g&&(this.l=m,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=m.headers,this.readyState=2,Wr(this)),this.g&&(this.readyState=3,Wr(this),this.g)))if(this.responseType==="arraybuffer")m.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in m){if(this.j=m.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Y_(this)}else m.text().then(this.Ra.bind(this),this.ga.bind(this))};function Y_(m){m.j.read().then(m.Pa.bind(m)).catch(m.ga.bind(m))}n.Pa=function(m){if(this.g){if(this.o&&m.value)this.response.push(m.value);else if(!this.o){var k=m.value?m.value:new Uint8Array(0);(k=this.v.decode(k,{stream:!m.done}))&&(this.response=this.responseText+=k)}m.done?Sa(this):Wr(this),this.readyState==3&&Y_(this)}},n.Ra=function(m){this.g&&(this.response=this.responseText=m,Sa(this))},n.Qa=function(m){this.g&&(this.response=m,Sa(this))},n.ga=function(){this.g&&Sa(this)};function Sa(m){m.readyState=4,m.l=null,m.j=null,m.v=null,Wr(m)}n.setRequestHeader=function(m,k){this.u.append(m,k)},n.getResponseHeader=function(m){return this.h&&this.h.get(m.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const m=[],k=this.h.entries();for(var O=k.next();!O.done;)O=O.value,m.push(O[0]+": "+O[1]),O=k.next();return m.join(`\r
`)};function Wr(m){m.onreadystatechange&&m.onreadystatechange.call(m)}Object.defineProperty(ul.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(m){this.m=m?"include":"same-origin"}});function J_(m){let k="";return R(m,function(O,j){k+=j,k+=":",k+=O,k+=`\r
`}),k}function dp(m,k,O){e:{for(j in O){var j=!1;break e}j=!0}j||(O=J_(O),typeof m=="string"?O!=null&&encodeURIComponent(String(O)):Zt(m,k,O))}function kt(m){fe.call(this),this.headers=new Map,this.o=m||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}_(kt,fe);var Di=/^https?$/i,kd=["POST","PUT"];n=kt.prototype,n.Ha=function(m){this.J=m},n.ea=function(m,k,O,j){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+m);k=k?k.toUpperCase():"GET",this.D=m,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():rp.g(),this.v=this.o?F_(this.o):F_(rp),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(k,String(m),!0),this.B=!1}catch(ne){Pd(this,ne);return}if(m=O||"",O=new Map(this.headers),j)if(Object.getPrototypeOf(j)===Object.prototype)for(var K in j)O.set(K,j[K]);else if(typeof j.keys=="function"&&typeof j.get=="function")for(const ne of j.keys())O.set(ne,j.get(ne));else throw Error("Unknown input type for opt_headers: "+String(j));j=Array.from(O.keys()).find(ne=>ne.toLowerCase()=="content-type"),K=o.FormData&&m instanceof o.FormData,!(0<=Array.prototype.indexOf.call(kd,k,void 0))||j||K||O.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ne,ge]of O)this.g.setRequestHeader(ne,ge);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{co(this),this.u=!0,this.g.send(m),this.u=!1}catch(ne){Pd(this,ne)}};function Pd(m,k){m.h=!1,m.g&&(m.j=!0,m.g.abort(),m.j=!1),m.l=k,m.m=5,hp(m),us(m)}function hp(m){m.A||(m.A=!0,Ne(m,"complete"),Ne(m,"error"))}n.abort=function(m){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=m||7,Ne(this,"complete"),Ne(this,"abort"),us(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),us(this,!0)),kt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?X_(this):this.bb())},n.bb=function(){X_(this)};function X_(m){if(m.h&&typeof a<"u"&&(!m.v[1]||Hr(m)!=4||m.Z()!=2)){if(m.u&&Hr(m)==4)Hn(m.Ea,0,m);else if(Ne(m,"readystatechange"),Hr(m)==4){m.h=!1;try{const ge=m.Z();e:switch(ge){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var k=!0;break e;default:k=!1}var O;if(!(O=k)){var j;if(j=ge===0){var K=String(m.D).match(qu)[1]||null;!K&&o.self&&o.self.location&&(K=o.self.location.protocol.slice(0,-1)),j=!Di.test(K?K.toLowerCase():"")}O=j}if(O)Ne(m,"complete"),Ne(m,"success");else{m.m=6;try{var ne=2<Hr(m)?m.g.statusText:""}catch{ne=""}m.l=ne+" ["+m.Z()+"]",hp(m)}}finally{us(m)}}}}function us(m,k){if(m.g){co(m);const O=m.g,j=m.v[0]?()=>{}:null;m.g=null,m.v=null,k||Ne(m,"ready");try{O.onreadystatechange=j}catch{}}}function co(m){m.I&&(o.clearTimeout(m.I),m.I=null)}n.isActive=function(){return!!this.g};function Hr(m){return m.g?m.g.readyState:0}n.Z=function(){try{return 2<Hr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(m){if(this.g){var k=this.g.responseText;return m&&k.indexOf(m)==0&&(k=k.substring(m.length)),yE(k)}};function Ju(m){try{if(!m.g)return null;if("response"in m.g)return m.g.response;switch(m.H){case"":case"text":return m.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in m.g)return m.g.mozResponseArrayBuffer}return null}catch{return null}}function Ad(m){const k={};m=(m.g&&2<=Hr(m)&&m.g.getAllResponseHeaders()||"").split(`\r
`);for(let j=0;j<m.length;j++){if(C(m[j]))continue;var O=D(m[j]);const K=O[0];if(O=O[1],typeof O!="string")continue;O=O.trim();const ne=k[K]||[];k[K]=ne,ne.push(O)}P(k,function(j){return j.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ur(m,k,O){return O&&O.internalChannelParams&&O.internalChannelParams[m]||k}function cs(m){this.Aa=0,this.i=[],this.j=new al,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ur("failFast",!1,m),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ur("baseRetryDelayMs",5e3,m),this.cb=ur("retryDelaySeedMs",1e4,m),this.Wa=ur("forwardChannelMaxRetries",2,m),this.wa=ur("forwardChannelRequestTimeoutMs",2e4,m),this.pa=m&&m.xmlHttpFactory||void 0,this.Xa=m&&m.Tb||void 0,this.Ca=m&&m.useFetchStreams||!1,this.L=void 0,this.J=m&&m.supportsCrossDomainXhr||!1,this.K="",this.h=new ao(m&&m.concurrentRequestLimit),this.Da=new Ln,this.P=m&&m.fastHandshake||!1,this.O=m&&m.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=m&&m.Rb||!1,m&&m.xa&&this.j.xa(),m&&m.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&m&&m.detectBufferingProxy||!1,this.ja=void 0,m&&m.longPollingTimeout&&0<m.longPollingTimeout&&(this.ja=m.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=cs.prototype,n.la=8,n.G=1,n.connect=function(m,k,O,j){xr(0),this.W=m,this.H=k||{},O&&j!==void 0&&(this.H.OSID=O,this.H.OAID=j),this.F=this.X,this.I=Zu(this,null,this.W),pi(this)};function Fi(m){if(fi(m),m.G==3){var k=m.U++,O=ks(m.I);if(Zt(O,"SID",m.K),Zt(O,"RID",k),Zt(O,"TYPE","terminate"),ho(m,O),k=new ya(m,m.j,k),k.L=2,k.v=Cd(ks(O)),O=!1,o.navigator&&o.navigator.sendBeacon)try{O=o.navigator.sendBeacon(k.v.toString(),"")}catch{}!O&&o.Image&&(new Image().src=k.v,O=!0),O||(k.g=mp(k.j,null),k.g.ea(k.v)),k.F=Date.now(),Sd(k)}pp(m)}function As(m){m.g&&(fo(m),m.g.cancel(),m.g=null)}function fi(m){As(m),m.u&&(o.clearTimeout(m.u),m.u=null),Xu(m),m.h.cancel(),m.s&&(typeof m.s=="number"&&o.clearTimeout(m.s),m.s=null)}function pi(m){if(!Mi(m.h)&&!m.s){m.s=!0;var k=m.Ga;ae||ee(),z||(ae(),z=!0),Q.add(k,m),m.B=0}}function Z_(m,k){return Qt(m.h)>=m.h.j-(m.s?1:0)?!1:m.s?(m.i=k.D.concat(m.i),!0):m.G==1||m.G==2||m.B>=(m.Va?0:m.Wa)?!1:(m.s=Hu(p(m.Ga,m,k),Nd(m,m.B)),m.B++,!0)}n.Ga=function(m){if(this.s)if(this.s=null,this.G==1){if(!m){this.U=Math.floor(1e5*Math.random()),m=this.U++;const K=new ya(this,this.j,m);let ne=this.o;if(this.S&&(ne?(ne=x(ne),M(ne,this.S)):ne=this.S),this.m!==null||this.O||(K.H=ne,ne=null),this.P)e:{for(var k=0,O=0;O<this.i.length;O++){t:{var j=this.i[O];if("__data__"in j.map&&(j=j.map.__data__,typeof j=="string")){j=j.length;break t}j=void 0}if(j===void 0)break;if(k+=j,4096<k){k=O;break e}if(k===4096||O===this.i.length-1){k=O+1;break e}}k=1e3}else k=1e3;k=qr(this,K,k),O=ks(this.I),Zt(O,"RID",m),Zt(O,"CVER",22),this.D&&Zt(O,"X-HTTP-Session-Id",this.D),ho(this,O),ne&&(this.O?k="headers="+encodeURIComponent(String(J_(ne)))+"&"+k:this.m&&dp(O,this.m,ne)),hi(this.h,K),this.Ua&&Zt(O,"TYPE","init"),this.P?(Zt(O,"$req",k),Zt(O,"SID","null"),K.T=!0,ip(K,O,null)):ip(K,O,k),this.G=2}}else this.G==3&&(m?Rd(this,m):this.i.length==0||Mi(this.h)||Rd(this))};function Rd(m,k){var O;k?O=k.l:O=m.U++;const j=ks(m.I);Zt(j,"SID",m.K),Zt(j,"RID",O),Zt(j,"AID",m.T),ho(m,j),m.m&&m.o&&dp(j,m.m,m.o),O=new ya(m,m.j,O,m.B+1),m.m===null&&(O.H=m.o),k&&(m.i=k.D.concat(m.i)),k=qr(m,O,1e3),O.I=Math.round(.5*m.wa)+Math.round(.5*m.wa*Math.random()),hi(m.h,O),ip(O,j,k)}function ho(m,k){m.H&&R(m.H,function(O,j){Zt(k,j,O)}),m.l&&Pr({},function(O,j){Zt(k,j,O)})}function qr(m,k,O){O=Math.min(m.i.length,O);var j=m.l?p(m.l.Na,m.l,m):null;e:{var K=m.i;let ne=-1;for(;;){const ge=["count="+O];ne==-1?0<O?(ne=K[0].g,ge.push("ofs="+ne)):ne=0:ge.push("ofs="+ne);let Pt=!0;for(let xn=0;xn<O;xn++){let wt=K[xn].g;const Kn=K[xn].map;if(wt-=ne,0>wt)ne=Math.max(0,K[xn].g-100),Pt=!1;else try{cp(Kn,ge,"req"+wt+"_")}catch{j&&j(Kn)}}if(Pt){j=ge.join("&");break e}}}return m=m.i.splice(0,O),k.D=m,j}function ds(m){if(!m.g&&!m.u){m.Y=1;var k=m.Fa;ae||ee(),z||(ae(),z=!0),Q.add(k,m),m.v=0}}function Yt(m){return m.g||m.u||3<=m.v?!1:(m.Y++,m.u=Hu(p(m.Fa,m),Nd(m,m.v)),m.v++,!0)}n.Fa=function(){if(this.u=null,Rs(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var m=2*this.R;this.j.info("BP detection timer enabled: "+m),this.A=Hu(p(this.ab,this),m)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,xr(10),As(this),Rs(this))};function fo(m){m.A!=null&&(o.clearTimeout(m.A),m.A=null)}function Rs(m){m.g=new ya(m,m.j,"rpc",m.Y),m.m===null&&(m.g.H=m.o),m.g.O=0;var k=ks(m.qa);Zt(k,"RID","rpc"),Zt(k,"SID",m.K),Zt(k,"AID",m.T),Zt(k,"CI",m.F?"0":"1"),!m.F&&m.ja&&Zt(k,"TO",m.ja),Zt(k,"TYPE","xmlhttp"),ho(m,k),m.m&&m.o&&dp(k,m.m,m.o),m.L&&(m.g.I=m.L);var O=m.g;m=m.ia,O.L=1,O.v=Cd(ks(k)),O.m=null,O.P=!0,z_(O,m)}n.Za=function(){this.C!=null&&(this.C=null,As(this),Yt(this),xr(19))};function Xu(m){m.C!=null&&(o.clearTimeout(m.C),m.C=null)}function fp(m,k){var O=null;if(m.g==k){Xu(m),fo(m),m.g=null;var j=2}else if(Bt(m.h,k))O=k.D,qn(m.h,k),j=1;else return;if(m.G!=0){if(k.o)if(j==1){O=k.m?k.m.length:0,k=Date.now()-k.F;var K=m.B;j=yd(),Ne(j,new j_(j,O)),pi(m)}else ds(m);else if(K=k.s,K==3||K==0&&0<k.X||!(j==1&&Z_(m,k)||j==2&&Yt(m)))switch(O&&0<O.length&&(k=m.h,k.i=k.i.concat(O)),K){case 1:$i(m,5);break;case 4:$i(m,10);break;case 3:$i(m,6);break;default:$i(m,2)}}}function Nd(m,k){let O=m.Ta+Math.floor(Math.random()*m.cb);return m.isActive()||(O*=2),O*k}function $i(m,k){if(m.j.info("Error code "+k),k==2){var O=p(m.fb,m),j=m.Xa;const K=!j;j=new va(j||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Ku(j,"https"),Cd(j),K?Q_(j.toString(),O):TE(j.toString(),O)}else xr(2);m.G=0,m.l&&m.l.sa(k),pp(m),fi(m)}n.fb=function(m){m?(this.j.info("Successfully pinged google.com"),xr(2)):(this.j.info("Failed to ping google.com"),xr(1))};function pp(m){if(m.G=0,m.ka=[],m.l){const k=kr(m.h);(k.length!=0||m.i.length!=0)&&(S(m.ka,k),S(m.ka,m.i),m.h.i.length=0,b(m.i),m.i.length=0),m.l.ra()}}function Zu(m,k,O){var j=O instanceof va?ks(O):new va(O);if(j.g!="")k&&(j.g=k+"."+j.g),Gr(j,j.s);else{var K=o.location;j=K.protocol,k=k?k+"."+K.hostname:K.hostname,K=+K.port;var ne=new va(null);j&&Ku(ne,j),k&&(ne.g=k),K&&Gr(ne,K),O&&(ne.l=O),j=ne}return O=m.D,k=m.ya,O&&k&&Zt(j,O,k),Zt(j,"VER",m.la),ho(m,j),j}function mp(m,k,O){if(k&&!m.J)throw Error("Can't create secondary domain capable XhrIo object.");return k=m.Ca&&!m.pa?new kt(new xd({eb:O})):new kt(m.pa),k.Ha(m.J),k}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function po(){}n=po.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function cl(){}cl.prototype.g=function(m,k){return new hs(m,k)};function hs(m,k){fe.call(this),this.g=new cs(k),this.l=m,this.h=k&&k.messageUrlParams||null,m=k&&k.messageHeaders||null,k&&k.clientProtocolHeaderRequired&&(m?m["X-Client-Protocol"]="webchannel":m={"X-Client-Protocol":"webchannel"}),this.g.o=m,m=k&&k.initMessageHeaders||null,k&&k.messageContentType&&(m?m["X-WebChannel-Content-Type"]=k.messageContentType:m={"X-WebChannel-Content-Type":k.messageContentType}),k&&k.va&&(m?m["X-WebChannel-Client-Profile"]=k.va:m={"X-WebChannel-Client-Profile":k.va}),this.g.S=m,(m=k&&k.Sb)&&!C(m)&&(this.g.m=m),this.v=k&&k.supportsCrossDomainXhr||!1,this.u=k&&k.sendRawJson||!1,(k=k&&k.httpSessionIdParam)&&!C(k)&&(this.g.D=k,m=this.h,m!==null&&k in m&&(m=this.h,k in m&&delete m[k])),this.j=new mi(this)}_(hs,fe),hs.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},hs.prototype.close=function(){Fi(this.g)},hs.prototype.o=function(m){var k=this.g;if(typeof m=="string"){var O={};O.__data__=m,m=O}else this.u&&(O={},O.__data__=Yf(m),m=O);k.i.push(new op(k.Ya++,m)),k.G==3&&pi(k)},hs.prototype.N=function(){this.g.l=null,delete this.j,Fi(this.g),delete this.g,hs.aa.N.call(this)};function ec(m){Xf.call(this),m.__headers__&&(this.headers=m.__headers__,this.statusCode=m.__status__,delete m.__headers__,delete m.__status__);var k=m.__sm__;if(k){e:{for(const O in k){m=O;break e}m=void 0}(this.i=m)&&(m=this.i,k=k!==null&&m in k?k[m]:void 0),this.data=k}else this.data=m}_(ec,Xf);function ey(){Zf.call(this),this.status=1}_(ey,Zf);function mi(m){this.g=m}_(mi,po),mi.prototype.ua=function(){Ne(this.g,"a")},mi.prototype.ta=function(m){Ne(this.g,new ec(m))},mi.prototype.sa=function(m){Ne(this.g,new ey)},mi.prototype.ra=function(){Ne(this.g,"b")},cl.prototype.createWebChannel=cl.prototype.g,hs.prototype.send=hs.prototype.o,hs.prototype.open=hs.prototype.m,hs.prototype.close=hs.prototype.close,LM=function(){return new cl},OM=function(){return yd()},NM=_a,uC={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},bd.NO_ERROR=0,bd.TIMEOUT=8,bd.HTTP_ERROR=6,G0=bd,U_.COMPLETE="complete",RM=U_,$_.EventType=Wu,Wu.OPEN="a",Wu.CLOSE="b",Wu.ERROR="c",Wu.MESSAGE="d",fe.prototype.listen=fe.prototype.K,em=$_,kt.prototype.listenOnce=kt.prototype.L,kt.prototype.getLastError=kt.prototype.Ka,kt.prototype.getLastErrorCode=kt.prototype.Ba,kt.prototype.getStatus=kt.prototype.Z,kt.prototype.getResponseJson=kt.prototype.Oa,kt.prototype.getResponseText=kt.prototype.oa,kt.prototype.send=kt.prototype.ea,kt.prototype.setWithCredentials=kt.prototype.Ha,AM=kt}).apply(typeof Yy<"u"?Yy:typeof self<"u"?self:typeof window<"u"?window:{});const tO="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ts.UNAUTHENTICATED=new ts(null),ts.GOOGLE_CREDENTIALS=new ts("google-credentials-uid"),ts.FIRST_PARTY=new ts("first-party-uid"),ts.MOCK_USER=new ts("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sf="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $c=new h1("@firebase/firestore");function $p(){return $c.logLevel}function De(n,...e){if($c.logLevel<=Et.DEBUG){const t=e.map(ak);$c.debug(`Firestore (${Sf}): ${n}`,...t)}}function Ho(n,...e){if($c.logLevel<=Et.ERROR){const t=e.map(ak);$c.error(`Firestore (${Sf}): ${n}`,...t)}}function Wh(n,...e){if($c.logLevel<=Et.WARN){const t=e.map(ak);$c.warn(`Firestore (${Sf}): ${n}`,...t)}}function ak(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function He(n="Unexpected state"){const e=`FIRESTORE (${Sf}) INTERNAL ASSERTION FAILED: `+n;throw Ho(e),new Error(e)}function Nt(n,e){n||He()}function tt(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oe={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Te extends Xo{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MM{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class yK{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ts.UNAUTHENTICATED))}shutdown(){}}class vK{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class wK{constructor(e){this.t=e,this.currentUser=ts.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Nt(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Do;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Do,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},o=l=>{De("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>o(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?o(l):(De("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Do)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(De("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Nt(typeof r.accessToken=="string"),new MM(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Nt(e===null||typeof e=="string"),new ts(e)}}class bK{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=ts.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class EK{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new bK(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ts.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class SK{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class TK{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Nt(this.o===void 0);const r=i=>{i.error!=null&&De("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.R;return this.R=i.token,De("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{De("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):De("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Nt(typeof t.token=="string"),this.R=t.token,new SK(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CK(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DM{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=CK(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Dt(n,e){return n<e?-1:n>e?1:0}function Hh(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Te(oe.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Te(oe.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Te(oe.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Te(oe.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ir.fromMillis(Date.now())}static fromDate(e){return ir.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new ir(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Dt(this.nanoseconds,e.nanoseconds):Dt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Qe(e)}static min(){return new Qe(new ir(0,0))}static max(){return new Qe(new ir(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g{constructor(e,t,r){t===void 0?t=0:t>e.length&&He(),r===void 0?r=e.length-t:r>e.length-t&&He(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return _g.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof _g?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),a=t.get(s);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class nn extends _g{construct(e,t,r){return new nn(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Te(oe.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new nn(t)}static emptyPath(){return new nn([])}}const IK=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fr extends _g{construct(e,t,r){return new Fr(e,t,r)}static isValidIdentifier(e){return IK.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Fr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Fr(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Te(oe.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const o=e[s];if(o==="\\"){if(s+1===e.length)throw new Te(oe.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Te(oe.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else o==="`"?(a=!a,s++):o!=="."||a?(r+=o,s++):(i(),s++)}if(i(),a)throw new Te(oe.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Fr(t)}static emptyPath(){return new Fr([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ve{constructor(e){this.path=e}static fromPath(e){return new Ve(nn.fromString(e))}static fromName(e){return new Ve(nn.fromString(e).popFirst(5))}static empty(){return new Ve(nn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&nn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return nn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ve(new nn(e.slice()))}}function xK(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Qe.fromTimestamp(r===1e9?new ir(t+1,0):new ir(t,r));return new hu(s,Ve.empty(),e)}function kK(n){return new hu(n.readTime,n.key,-1)}class hu{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new hu(Qe.min(),Ve.empty(),-1)}static max(){return new hu(Qe.max(),Ve.empty(),-1)}}function PK(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ve.comparator(n.documentKey,e.documentKey),t!==0?t:Dt(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AK="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class RK{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n_(n){if(n.code!==oe.FAILED_PRECONDITION||n.message!==AK)throw n;De("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ce{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&He(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ce((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof ce?t:ce.resolve(t)}catch(t){return ce.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ce.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ce.reject(t)}static resolve(e){return new ce((t,r)=>{t(e)})}static reject(e){return new ce((t,r)=>{r(e)})}static waitFor(e){return new ce((t,r)=>{let s=0,i=0,a=!1;e.forEach(o=>{++s,o.next(()=>{++i,a&&i===s&&t()},l=>r(l))}),a=!0,i===s&&t()})}static or(e){let t=ce.resolve(!1);for(const r of e)t=t.next(s=>s?ce.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new ce((r,s)=>{const i=e.length,a=new Array(i);let o=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(h=>{a[u]=h,++o,o===i&&r(a)},h=>s(h))}})}static doWhile(e,t){return new ce((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}function NK(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function r_(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ok{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}ok.oe=-1;function s_(n){return n==null}function Wv(n){return n===0&&1/n==-1/0}function OK(n){return typeof n=="number"&&Number.isInteger(n)&&!Wv(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nO(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function td(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function FM(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bn=class cC{constructor(e,t){this.comparator=e,this.root=t||su.EMPTY}insert(e,t){return new cC(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,su.BLACK,null,null))}remove(e){return new cC(this.comparator,this.root.remove(e,this.comparator).copy(null,null,su.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Jy(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Jy(this.root,e,this.comparator,!1)}getReverseIterator(){return new Jy(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Jy(this.root,e,this.comparator,!0)}},Jy=class{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},su=class bo{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??bo.RED,this.left=s??bo.EMPTY,this.right=i??bo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new bo(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return bo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return bo.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,bo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,bo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw He();const e=this.left.check();if(e!==this.right.check())throw He();return e+(this.isRed()?0:1)}};su.EMPTY=null,su.RED=!0,su.BLACK=!1;su.EMPTY=new class{constructor(){this.size=0}get key(){throw He()}get value(){throw He()}get color(){throw He()}get left(){throw He()}get right(){throw He()}copy(e,t,r,s,i){return this}insert(e,t,r){return new su(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(e){this.comparator=e,this.data=new Bn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new rO(this.data.getIterator())}getIteratorFrom(e){return new rO(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Ur)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ur(this.comparator);return t.data=e,t}}class rO{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{constructor(e){this.fields=e,e.sort(Fr.comparator)}static empty(){return new ti([])}unionWith(e){let t=new Ur(Fr.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ti(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Hh(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $M extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new $M("Invalid base64 string: "+i):i}}(e);return new Br(t)}static fromUint8Array(e){const t=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new Br(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Dt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Br.EMPTY_BYTE_STRING=new Br("");const LK=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fu(n){if(Nt(!!n),typeof n=="string"){let e=0;const t=LK.exec(n);if(Nt(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Pn(n.seconds),nanos:Pn(n.nanos)}}function Pn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function jc(n){return typeof n=="string"?Br.fromBase64String(n):Br.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lk(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function uk(n){const e=n.mapValue.fields.__previous_value__;return lk(e)?uk(e):e}function yg(n){const e=fu(n.mapValue.fields.__local_write_time__.timestampValue);return new ir(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MK{constructor(e,t,r,s,i,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=u}}class vg{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new vg("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof vg&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xy={mapValue:{}};function Uc(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?lk(n)?4:FK(n)?9007199254740991:DK(n)?10:11:He()}function Ja(n,e){if(n===e)return!0;const t=Uc(n);if(t!==Uc(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return yg(n).isEqual(yg(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=fu(s.timestampValue),o=fu(i.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return jc(s.bytesValue).isEqual(jc(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Pn(s.geoPointValue.latitude)===Pn(i.geoPointValue.latitude)&&Pn(s.geoPointValue.longitude)===Pn(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Pn(s.integerValue)===Pn(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=Pn(s.doubleValue),o=Pn(i.doubleValue);return a===o?Wv(a)===Wv(o):isNaN(a)&&isNaN(o)}return!1}(n,e);case 9:return Hh(n.arrayValue.values||[],e.arrayValue.values||[],Ja);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},o=i.mapValue.fields||{};if(nO(a)!==nO(o))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(o[l]===void 0||!Ja(a[l],o[l])))return!1;return!0}(n,e);default:return He()}}function wg(n,e){return(n.values||[]).find(t=>Ja(t,e))!==void 0}function qh(n,e){if(n===e)return 0;const t=Uc(n),r=Uc(e);if(t!==r)return Dt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Dt(n.booleanValue,e.booleanValue);case 2:return function(i,a){const o=Pn(i.integerValue||i.doubleValue),l=Pn(a.integerValue||a.doubleValue);return o<l?-1:o>l?1:o===l?0:isNaN(o)?isNaN(l)?0:-1:1}(n,e);case 3:return sO(n.timestampValue,e.timestampValue);case 4:return sO(yg(n),yg(e));case 5:return Dt(n.stringValue,e.stringValue);case 6:return function(i,a){const o=jc(i),l=jc(a);return o.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,a){const o=i.split("/"),l=a.split("/");for(let u=0;u<o.length&&u<l.length;u++){const h=Dt(o[u],l[u]);if(h!==0)return h}return Dt(o.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,a){const o=Dt(Pn(i.latitude),Pn(a.latitude));return o!==0?o:Dt(Pn(i.longitude),Pn(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return iO(n.arrayValue,e.arrayValue);case 10:return function(i,a){var o,l,u,h;const f=i.fields||{},p=a.fields||{},y=(o=f.value)===null||o===void 0?void 0:o.arrayValue,_=(l=p.value)===null||l===void 0?void 0:l.arrayValue,b=Dt(((u=y==null?void 0:y.values)===null||u===void 0?void 0:u.length)||0,((h=_==null?void 0:_.values)===null||h===void 0?void 0:h.length)||0);return b!==0?b:iO(y,_)}(n.mapValue,e.mapValue);case 11:return function(i,a){if(i===Xy.mapValue&&a===Xy.mapValue)return 0;if(i===Xy.mapValue)return 1;if(a===Xy.mapValue)return-1;const o=i.fields||{},l=Object.keys(o),u=a.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const p=Dt(l[f],h[f]);if(p!==0)return p;const y=qh(o[l[f]],u[h[f]]);if(y!==0)return y}return Dt(l.length,h.length)}(n.mapValue,e.mapValue);default:throw He()}}function sO(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Dt(n,e);const t=fu(n),r=fu(e),s=Dt(t.seconds,r.seconds);return s!==0?s:Dt(t.nanos,r.nanos)}function iO(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=qh(t[s],r[s]);if(i)return i}return Dt(t.length,r.length)}function Kh(n){return dC(n)}function dC(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=fu(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return jc(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ve.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=dC(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${dC(t.fields[a])}`;return s+"}"}(n.mapValue):He()}function aO(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function hC(n){return!!n&&"integerValue"in n}function ck(n){return!!n&&"arrayValue"in n}function oO(n){return!!n&&"nullValue"in n}function lO(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function W0(n){return!!n&&"mapValue"in n}function DK(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function xm(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return td(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=xm(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=xm(n.arrayValue.values[t]);return e}return Object.assign({},n)}function FK(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e){this.value=e}static empty(){return new ys({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!W0(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=xm(t)}setAll(e){let t=Fr.emptyPath(),r={},s=[];e.forEach((a,o)=>{if(!t.isImmediateParentOf(o)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=o.popLast()}a?r[o.lastSegment()]=xm(a):s.push(o.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());W0(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ja(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];W0(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){td(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new ys(xm(this.value))}}function jM(n){const e=[];return td(n.fields,(t,r)=>{const s=new Fr([t]);if(W0(r)){const i=jM(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new ti(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(e,t,r,s,i,a,o){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=o}static newInvalidDocument(e){return new wr(e,0,Qe.min(),Qe.min(),Qe.min(),ys.empty(),0)}static newFoundDocument(e,t,r,s){return new wr(e,1,t,Qe.min(),r,s,0)}static newNoDocument(e,t){return new wr(e,2,t,Qe.min(),Qe.min(),ys.empty(),0)}static newUnknownDocument(e,t){return new wr(e,3,t,Qe.min(),Qe.min(),ys.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Qe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ys.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ys.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Qe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof wr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new wr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{constructor(e,t){this.position=e,this.inclusive=t}}function uO(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=Ve.comparator(Ve.fromName(a.referenceValue),t.key):r=qh(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function cO(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ja(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg{constructor(e,t="asc"){this.field=e,this.dir=t}}function $K(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UM{}class Vn extends UM{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new UK(e,t,r):t==="array-contains"?new zK(e,r):t==="in"?new GK(e,r):t==="not-in"?new WK(e,r):t==="array-contains-any"?new HK(e,r):new Vn(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new VK(e,r):new BK(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(qh(t,this.value)):t!==null&&Uc(this.value)===Uc(t)&&this.matchesComparison(qh(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return He()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class da extends UM{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new da(e,t)}matches(e){return VM(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function VM(n){return n.op==="and"}function BM(n){return jK(n)&&VM(n)}function jK(n){for(const e of n.filters)if(e instanceof da)return!1;return!0}function fC(n){if(n instanceof Vn)return n.field.canonicalString()+n.op.toString()+Kh(n.value);if(BM(n))return n.filters.map(e=>fC(e)).join(",");{const e=n.filters.map(t=>fC(t)).join(",");return`${n.op}(${e})`}}function zM(n,e){return n instanceof Vn?function(r,s){return s instanceof Vn&&r.op===s.op&&r.field.isEqual(s.field)&&Ja(r.value,s.value)}(n,e):n instanceof da?function(r,s){return s instanceof da&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,o)=>i&&zM(a,s.filters[o]),!0):!1}(n,e):void He()}function GM(n){return n instanceof Vn?function(t){return`${t.field.canonicalString()} ${t.op} ${Kh(t.value)}`}(n):n instanceof da?function(t){return t.op.toString()+" {"+t.getFilters().map(GM).join(" ,")+"}"}(n):"Filter"}class UK extends Vn{constructor(e,t,r){super(e,t,r),this.key=Ve.fromName(r.referenceValue)}matches(e){const t=Ve.comparator(e.key,this.key);return this.matchesComparison(t)}}class VK extends Vn{constructor(e,t){super(e,"in",t),this.keys=WM("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class BK extends Vn{constructor(e,t){super(e,"not-in",t),this.keys=WM("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function WM(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Ve.fromName(r.referenceValue))}class zK extends Vn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ck(t)&&wg(t.arrayValue,this.value)}}class GK extends Vn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&wg(this.value.arrayValue,t)}}class WK extends Vn{constructor(e,t){super(e,"not-in",t)}matches(e){if(wg(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!wg(this.value.arrayValue,t)}}class HK extends Vn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ck(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>wg(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qK{constructor(e,t=null,r=[],s=[],i=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=o,this.ue=null}}function dO(n,e=null,t=[],r=[],s=null,i=null,a=null){return new qK(n,e,t,r,s,i,a)}function dk(n){const e=tt(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>fC(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),s_(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Kh(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Kh(r)).join(",")),e.ue=t}return e.ue}function hk(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!$K(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!zM(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!cO(n.startAt,e.startAt)&&cO(n.endAt,e.endAt)}function pC(n){return Ve.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e,t=null,r=[],s=[],i=null,a="F",o=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=o,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function KK(n,e,t,r,s,i,a,o){return new Tf(n,e,t,r,s,i,a,o)}function fk(n){return new Tf(n)}function hO(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function HM(n){return n.collectionGroup!==null}function km(n){const e=tt(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let o=new Ur(Fr.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(o=o.add(u.field))})}),o})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new bg(i,r))}),t.has(Fr.keyField().canonicalString())||e.ce.push(new bg(Fr.keyField(),r))}return e.ce}function Ka(n){const e=tt(n);return e.le||(e.le=QK(e,km(n))),e.le}function QK(n,e){if(n.limitType==="F")return dO(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new bg(s.field,i)});const t=n.endAt?new Hv(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Hv(n.startAt.position,n.startAt.inclusive):null;return dO(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function mC(n,e){const t=n.filters.concat([e]);return new Tf(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function gC(n,e,t){return new Tf(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function _1(n,e){return hk(Ka(n),Ka(e))&&n.limitType===e.limitType}function qM(n){return`${dk(Ka(n))}|lt:${n.limitType}`}function Jd(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>GM(s)).join(", ")}]`),s_(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Kh(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Kh(s)).join(",")),`Target(${r})`}(Ka(n))}; limitType=${n.limitType})`}function y1(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Ve.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of km(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(a,o,l){const u=uO(a,o,l);return a.inclusive?u<=0:u<0}(r.startAt,km(r),s)||r.endAt&&!function(a,o,l){const u=uO(a,o,l);return a.inclusive?u>=0:u>0}(r.endAt,km(r),s))}(n,e)}function YK(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function KM(n){return(e,t)=>{let r=!1;for(const s of km(n)){const i=JK(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function JK(n,e,t){const r=n.field.isKeyField()?Ve.comparator(e.key,t.key):function(i,a,o){const l=a.data.field(i),u=o.data.field(i);return l!==null&&u!==null?qh(l,u):He()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return He()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){td(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return FM(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XK=new Bn(Ve.comparator);function qo(){return XK}const QM=new Bn(Ve.comparator);function tm(...n){let e=QM;for(const t of n)e=e.insert(t.key,t);return e}function YM(n){let e=QM;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function wc(){return Pm()}function JM(){return Pm()}function Pm(){return new Cf(n=>n.toString(),(n,e)=>n.isEqual(e))}const ZK=new Bn(Ve.comparator),eQ=new Ur(Ve.comparator);function St(...n){let e=eQ;for(const t of n)e=e.add(t);return e}const tQ=new Ur(Dt);function nQ(){return tQ}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pk(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Wv(e)?"-0":e}}function XM(n){return{integerValue:""+n}}function rQ(n,e){return OK(e)?XM(e):pk(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{constructor(){this._=void 0}}function sQ(n,e,t){return n instanceof Eg?function(s,i){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&lk(i)&&(i=uk(i)),i&&(a.fields.__previous_value__=i),{mapValue:a}}(t,e):n instanceof Sg?eD(n,e):n instanceof Tg?tD(n,e):function(s,i){const a=ZM(s,i),o=fO(a)+fO(s.Pe);return hC(a)&&hC(s.Pe)?XM(o):pk(s.serializer,o)}(n,e)}function iQ(n,e,t){return n instanceof Sg?eD(n,e):n instanceof Tg?tD(n,e):t}function ZM(n,e){return n instanceof qv?function(r){return hC(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Eg extends v1{}class Sg extends v1{constructor(e){super(),this.elements=e}}function eD(n,e){const t=nD(e);for(const r of n.elements)t.some(s=>Ja(s,r))||t.push(r);return{arrayValue:{values:t}}}class Tg extends v1{constructor(e){super(),this.elements=e}}function tD(n,e){let t=nD(e);for(const r of n.elements)t=t.filter(s=>!Ja(s,r));return{arrayValue:{values:t}}}class qv extends v1{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function fO(n){return Pn(n.integerValue||n.doubleValue)}function nD(n){return ck(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aQ{constructor(e,t){this.field=e,this.transform=t}}function oQ(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Sg&&s instanceof Sg||r instanceof Tg&&s instanceof Tg?Hh(r.elements,s.elements,Ja):r instanceof qv&&s instanceof qv?Ja(r.Pe,s.Pe):r instanceof Eg&&s instanceof Eg}(n.transform,e.transform)}class lQ{constructor(e,t){this.version=e,this.transformResults=t}}class rr{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new rr}static exists(e){return new rr(void 0,e)}static updateTime(e){return new rr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function H0(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class w1{}function rD(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new a_(n.key,rr.none()):new i_(n.key,n.data,rr.none());{const t=n.data,r=ys.empty();let s=new Ur(Fr.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Ou(n.key,r,new ti(s.toArray()),rr.none())}}function uQ(n,e,t){n instanceof i_?function(s,i,a){const o=s.value.clone(),l=mO(s.fieldTransforms,i,a.transformResults);o.setAll(l),i.convertToFoundDocument(a.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Ou?function(s,i,a){if(!H0(s.precondition,i))return void i.convertToUnknownDocument(a.version);const o=mO(s.fieldTransforms,i,a.transformResults),l=i.data;l.setAll(sD(s)),l.setAll(o),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Am(n,e,t,r){return n instanceof i_?function(i,a,o,l){if(!H0(i.precondition,a))return o;const u=i.value.clone(),h=gO(i.fieldTransforms,l,a);return u.setAll(h),a.convertToFoundDocument(a.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ou?function(i,a,o,l){if(!H0(i.precondition,a))return o;const u=gO(i.fieldTransforms,l,a),h=a.data;return h.setAll(sD(i)),h.setAll(u),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),o===null?null:o.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,a,o){return H0(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o}(n,e,t)}function cQ(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=ZM(r.transform,s||null);i!=null&&(t===null&&(t=ys.empty()),t.set(r.field,i))}return t||null}function pO(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Hh(r,s,(i,a)=>oQ(i,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class i_ extends w1{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ou extends w1{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function sD(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function mO(n,e,t){const r=new Map;Nt(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,o=e.data.field(i.field);r.set(i.field,iQ(a,o,t[s]))}return r}function gO(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,sQ(i,a,e))}return r}class a_ extends w1{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class iD extends w1{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dQ{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&uQ(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Am(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Am(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=JM();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let o=this.applyToLocalView(a,i.mutatedFields);o=t.has(s.key)?null:o;const l=rD(a,o);l!==null&&r.set(s.key,l),a.isValidDocument()||a.convertToNoDocument(Qe.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),St())}isEqual(e){return this.batchId===e.batchId&&Hh(this.mutations,e.mutations,(t,r)=>pO(t,r))&&Hh(this.baseMutations,e.baseMutations,(t,r)=>pO(t,r))}}class mk{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Nt(e.mutations.length===r.length);let s=function(){return ZK}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new mk(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hQ{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fQ{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fn,At;function aD(n){switch(n){default:return He();case oe.CANCELLED:case oe.UNKNOWN:case oe.DEADLINE_EXCEEDED:case oe.RESOURCE_EXHAUSTED:case oe.INTERNAL:case oe.UNAVAILABLE:case oe.UNAUTHENTICATED:return!1;case oe.INVALID_ARGUMENT:case oe.NOT_FOUND:case oe.ALREADY_EXISTS:case oe.PERMISSION_DENIED:case oe.FAILED_PRECONDITION:case oe.ABORTED:case oe.OUT_OF_RANGE:case oe.UNIMPLEMENTED:case oe.DATA_LOSS:return!0}}function oD(n){if(n===void 0)return Ho("GRPC error has no .code"),oe.UNKNOWN;switch(n){case Fn.OK:return oe.OK;case Fn.CANCELLED:return oe.CANCELLED;case Fn.UNKNOWN:return oe.UNKNOWN;case Fn.DEADLINE_EXCEEDED:return oe.DEADLINE_EXCEEDED;case Fn.RESOURCE_EXHAUSTED:return oe.RESOURCE_EXHAUSTED;case Fn.INTERNAL:return oe.INTERNAL;case Fn.UNAVAILABLE:return oe.UNAVAILABLE;case Fn.UNAUTHENTICATED:return oe.UNAUTHENTICATED;case Fn.INVALID_ARGUMENT:return oe.INVALID_ARGUMENT;case Fn.NOT_FOUND:return oe.NOT_FOUND;case Fn.ALREADY_EXISTS:return oe.ALREADY_EXISTS;case Fn.PERMISSION_DENIED:return oe.PERMISSION_DENIED;case Fn.FAILED_PRECONDITION:return oe.FAILED_PRECONDITION;case Fn.ABORTED:return oe.ABORTED;case Fn.OUT_OF_RANGE:return oe.OUT_OF_RANGE;case Fn.UNIMPLEMENTED:return oe.UNIMPLEMENTED;case Fn.DATA_LOSS:return oe.DATA_LOSS;default:return He()}}(At=Fn||(Fn={}))[At.OK=0]="OK",At[At.CANCELLED=1]="CANCELLED",At[At.UNKNOWN=2]="UNKNOWN",At[At.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",At[At.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",At[At.NOT_FOUND=5]="NOT_FOUND",At[At.ALREADY_EXISTS=6]="ALREADY_EXISTS",At[At.PERMISSION_DENIED=7]="PERMISSION_DENIED",At[At.UNAUTHENTICATED=16]="UNAUTHENTICATED",At[At.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",At[At.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",At[At.ABORTED=10]="ABORTED",At[At.OUT_OF_RANGE=11]="OUT_OF_RANGE",At[At.UNIMPLEMENTED=12]="UNIMPLEMENTED",At[At.INTERNAL=13]="INTERNAL",At[At.UNAVAILABLE=14]="UNAVAILABLE",At[At.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pQ(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mQ=new kc([4294967295,4294967295],0);function _O(n){const e=pQ().encode(n),t=new PM;return t.update(e),new Uint8Array(t.digest())}function yO(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new kc([t,r],0),new kc([s,i],0)]}class gk{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new nm(`Invalid padding: ${t}`);if(r<0)throw new nm(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new nm(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new nm(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=kc.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(kc.fromNumber(r)));return s.compare(mQ)===1&&(s=new kc([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=_O(e),[r,s]=yO(t);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);if(!this.de(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new gk(i,s,t);return r.forEach(o=>a.insert(o)),a}insert(e){if(this.Ie===0)return;const t=_O(e),[r,s]=yO(t);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);this.Ae(a)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class nm extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b1{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,o_.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new b1(Qe.min(),s,new Bn(Dt),qo(),St())}}class o_{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new o_(r,t,St(),St(),St())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q0{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class lD{constructor(e,t){this.targetId=e,this.me=t}}class uD{constructor(e,t,r=Br.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class vO{constructor(){this.fe=0,this.ge=bO(),this.pe=Br.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=St(),t=St(),r=St();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:He()}}),new o_(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=bO()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Nt(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class gQ{constructor(e){this.Le=e,this.Be=new Map,this.ke=qo(),this.qe=wO(),this.Qe=new Bn(Dt)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:He()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(pC(i))if(r===0){const a=new Ve(i.path);this.Ue(t,a,wr.newNoDocument(a,Qe.min()))}else Nt(r===1);else{const a=this.Ye(t);if(a!==r){const o=this.Ze(e),l=o?this.Xe(o,e,a):1;if(l!==0){this.je(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,o;try{a=jc(r).toUint8Array()}catch(l){if(l instanceof $M)return Wh("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{o=new gk(a,s,i)}catch(l){return Wh(l instanceof nm?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return o.Ie===0?null:o}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const a=this.Le.tt(),o=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(o)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,a)=>{const o=this.Je(a);if(o){if(i.current&&pC(o.target)){const l=new Ve(o.target.path);this.ke.get(l)!==null||this.it(a,l)||this.Ue(a,l,wr.newNoDocument(l,e))}i.be&&(t.set(a,i.ve()),i.Ce())}});let r=St();this.qe.forEach((i,a)=>{let o=!0;a.forEachWhile(l=>{const u=this.Je(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)}),o&&(r=r.add(i))}),this.ke.forEach((i,a)=>a.setReadTime(e));const s=new b1(e,t,this.Qe,this.ke,r);return this.ke=qo(),this.qe=wO(),this.Qe=new Bn(Dt),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new vO,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ur(Dt),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||De("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new vO),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function wO(){return new Bn(Ve.comparator)}function bO(){return new Bn(Ve.comparator)}const _Q={asc:"ASCENDING",desc:"DESCENDING"},yQ={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vQ={and:"AND",or:"OR"};class wQ{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function _C(n,e){return n.useProto3Json||s_(e)?e:{value:e}}function Kv(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cD(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function bQ(n,e){return Kv(n,e.toTimestamp())}function si(n){return Nt(!!n),Qe.fromTimestamp(function(t){const r=fu(t);return new ir(r.seconds,r.nanos)}(n))}function _k(n,e){return yC(n,e).canonicalString()}function yC(n,e){const t=function(s){return new nn(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function dD(n){const e=nn.fromString(n);return Nt(_D(e)),e}function Qv(n,e){return _k(n.databaseId,e.path)}function Rm(n,e){const t=dD(e);if(t.get(1)!==n.databaseId.projectId)throw new Te(oe.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Te(oe.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ve(fD(t))}function hD(n,e){return _k(n.databaseId,e)}function EQ(n){const e=dD(n);return e.length===4?nn.emptyPath():fD(e)}function vC(n){return new nn(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function fD(n){return Nt(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function EO(n,e,t){return{name:Qv(n,e),fields:t.value.mapValue.fields}}function SQ(n,e){return"found"in e?function(r,s){Nt(!!s.found),s.found.name,s.found.updateTime;const i=Rm(r,s.found.name),a=si(s.found.updateTime),o=s.found.createTime?si(s.found.createTime):Qe.min(),l=new ys({mapValue:{fields:s.found.fields}});return wr.newFoundDocument(i,a,o,l)}(n,e):"missing"in e?function(r,s){Nt(!!s.missing),Nt(!!s.readTime);const i=Rm(r,s.missing),a=si(s.readTime);return wr.newNoDocument(i,a)}(n,e):He()}function TQ(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:He()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(Nt(h===void 0||typeof h=="string"),Br.fromBase64String(h||"")):(Nt(h===void 0||h instanceof Buffer||h instanceof Uint8Array),Br.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&function(u){const h=u.code===void 0?oe.UNKNOWN:oD(u.code);return new Te(h,u.message||"")}(a);t=new uD(r,s,i,o||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Rm(n,r.document.name),i=si(r.document.updateTime),a=r.document.createTime?si(r.document.createTime):Qe.min(),o=new ys({mapValue:{fields:r.document.fields}}),l=wr.newFoundDocument(s,i,a,o),u=r.targetIds||[],h=r.removedTargetIds||[];t=new q0(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Rm(n,r.document),i=r.readTime?si(r.readTime):Qe.min(),a=wr.newNoDocument(s,i),o=r.removedTargetIds||[];t=new q0([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Rm(n,r.document),i=r.removedTargetIds||[];t=new q0([],i,s,null)}else{if(!("filter"in e))return He();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new fQ(s,i),o=r.targetId;t=new lD(o,a)}}return t}function pD(n,e){let t;if(e instanceof i_)t={update:EO(n,e.key,e.value)};else if(e instanceof a_)t={delete:Qv(n,e.key)};else if(e instanceof Ou)t={update:EO(n,e.key,e.data),updateMask:OQ(e.fieldMask)};else{if(!(e instanceof iD))return He();t={verify:Qv(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const o=a.transform;if(o instanceof Eg)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Sg)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Tg)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof qv)return{fieldPath:a.field.canonicalString(),increment:o.Pe};throw He()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:bQ(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:He()}(n,e.precondition)),t}function CQ(n,e){return n&&n.length>0?(Nt(e!==void 0),n.map(t=>function(s,i){let a=s.updateTime?si(s.updateTime):si(i);return a.isEqual(Qe.min())&&(a=si(i)),new lQ(a,s.transformResults||[])}(t,e))):[]}function IQ(n,e){return{documents:[hD(n,e.path)]}}function xQ(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=hD(n,s);const i=function(u){if(u.length!==0)return gD(da.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const a=function(u){if(u.length!==0)return u.map(h=>function(p){return{field:Xd(p.field),direction:AQ(p.dir)}}(h))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const o=_C(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:s}}function kQ(n){let e=EQ(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Nt(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const p=mD(f);return p instanceof da&&BM(p)?p.getFilters():[p]}(t.where));let a=[];t.orderBy&&(a=function(f){return f.map(p=>function(_){return new bg(Zd(_.field),function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction))}(p))}(t.orderBy));let o=null;t.limit&&(o=function(f){let p;return p=typeof f=="object"?f.value:f,s_(p)?null:p}(t.limit));let l=null;t.startAt&&(l=function(f){const p=!!f.before,y=f.values||[];return new Hv(y,p)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const p=!f.before,y=f.values||[];return new Hv(y,p)}(t.endAt)),KK(e,s,a,i,o,"F",l,u)}function PQ(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return He()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function mD(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Zd(t.unaryFilter.field);return Vn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Zd(t.unaryFilter.field);return Vn.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Zd(t.unaryFilter.field);return Vn.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Zd(t.unaryFilter.field);return Vn.create(a,"!=",{nullValue:"NULL_VALUE"});default:return He()}}(n):n.fieldFilter!==void 0?function(t){return Vn.create(Zd(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return He()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return da.create(t.compositeFilter.filters.map(r=>mD(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return He()}}(t.compositeFilter.op))}(n):He()}function AQ(n){return _Q[n]}function RQ(n){return yQ[n]}function NQ(n){return vQ[n]}function Xd(n){return{fieldPath:n.canonicalString()}}function Zd(n){return Fr.fromServerFormat(n.fieldPath)}function gD(n){return n instanceof Vn?function(t){if(t.op==="=="){if(lO(t.value))return{unaryFilter:{field:Xd(t.field),op:"IS_NAN"}};if(oO(t.value))return{unaryFilter:{field:Xd(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(lO(t.value))return{unaryFilter:{field:Xd(t.field),op:"IS_NOT_NAN"}};if(oO(t.value))return{unaryFilter:{field:Xd(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xd(t.field),op:RQ(t.op),value:t.value}}}(n):n instanceof da?function(t){const r=t.getFilters().map(s=>gD(s));return r.length===1?r[0]:{compositeFilter:{op:NQ(t.op),filters:r}}}(n):He()}function OQ(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function _D(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(e,t,r,s,i=Qe.min(),a=Qe.min(),o=Br.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(e){return new Ul(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ul(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ul(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ul(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LQ{constructor(e){this.ct=e}}function MQ(n){const e=kQ({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?gC(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DQ{constructor(){this.un=new FQ}addToCollectionParentIndex(e,t){return this.un.add(t),ce.resolve()}getCollectionParents(e,t){return ce.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return ce.resolve()}deleteFieldIndex(e,t){return ce.resolve()}deleteAllFieldIndexes(e){return ce.resolve()}createTargetIndexes(e,t){return ce.resolve()}getDocumentsMatchingTarget(e,t){return ce.resolve(null)}getIndexType(e,t){return ce.resolve(0)}getFieldIndexes(e,t){return ce.resolve([])}getNextCollectionGroupToUpdate(e){return ce.resolve(null)}getMinOffset(e,t){return ce.resolve(hu.min())}getMinOffsetFromCollectionGroup(e,t){return ce.resolve(hu.min())}updateCollectionGroup(e,t,r){return ce.resolve()}updateIndexEntries(e,t){return ce.resolve()}}class FQ{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Ur(nn.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Ur(nn.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qh{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Qh(0)}static kn(){return new Qh(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $Q{constructor(){this.changes=new Cf(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,wr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?ce.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jQ{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UQ{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Am(r.mutation,s,ti.empty(),ir.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,St()).next(()=>r))}getLocalViewOfDocuments(e,t,r=St()){const s=wc();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let a=tm();return i.forEach((o,l)=>{a=a.insert(o,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=wc();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,St()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,o)=>{t.set(a,o)})})}computeViews(e,t,r,s){let i=qo();const a=Pm(),o=function(){return Pm()}();return t.forEach((l,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof Ou)?i=i.insert(u.key,u):h!==void 0?(a.set(u.key,h.mutation.getFieldMask()),Am(h.mutation,u,h.mutation.getFieldMask(),ir.now())):a.set(u.key,ti.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,h)=>a.set(u,h)),t.forEach((u,h)=>{var f;return o.set(u,new jQ(h,(f=a.get(u))!==null&&f!==void 0?f:null))}),o))}recalculateAndSaveOverlays(e,t){const r=Pm();let s=new Bn((a,o)=>a-o),i=St();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const o of a)o.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let h=r.get(l)||ti.empty();h=o.applyToLocalView(u,h),r.set(l,h);const f=(s.get(o.batchId)||St()).add(l);s=s.insert(o.batchId,f)})}).next(()=>{const a=[],o=s.getReverseIterator();for(;o.hasNext();){const l=o.getNext(),u=l.key,h=l.value,f=JM();h.forEach(p=>{if(!i.has(p)){const y=rD(t.get(p),r.get(p));y!==null&&f.set(p,y),i=i.add(p)}}),a.push(this.documentOverlayCache.saveOverlays(e,u,f))}return ce.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(a){return Ve.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):HM(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):ce.resolve(wc());let o=-1,l=i;return a.next(u=>ce.forEach(u,(h,f)=>(o<f.largestBatchId&&(o=f.largestBatchId),i.get(h)?ce.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{l=l.insert(h,p)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,St())).next(h=>({batchId:o,changes:YM(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ve(t)).next(r=>{let s=tm();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=tm();return this.indexManager.getCollectionParents(e,i).next(o=>ce.forEach(o,l=>{const u=function(f,p){return new Tf(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((f,p)=>{a=a.insert(f,p)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(a=>{i.forEach((l,u)=>{const h=u.getKey();a.get(h)===null&&(a=a.insert(h,wr.newInvalidDocument(h)))});let o=tm();return a.forEach((l,u)=>{const h=i.get(l);h!==void 0&&Am(h.mutation,u,ti.empty(),ir.now()),y1(t,u)&&(o=o.insert(l,u))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VQ{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return ce.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:si(s.createTime)}}(t)),ce.resolve()}getNamedQuery(e,t){return ce.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:MQ(s.bundledQuery),readTime:si(s.readTime)}}(t)),ce.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BQ{constructor(){this.overlays=new Bn(Ve.comparator),this.Ir=new Map}getOverlay(e,t){return ce.resolve(this.overlays.get(t))}getOverlays(e,t){const r=wc();return ce.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),ce.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),ce.resolve()}getOverlaysForCollection(e,t,r){const s=wc(),i=t.length+1,a=new Ve(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const l=o.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return ce.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Bn((u,h)=>u-h);const a=this.overlays.getIterator();for(;a.hasNext();){const u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=wc(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const o=wc(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>o.set(u,h)),!(o.size()>=s)););return ce.resolve(o)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new hQ(t,r));let i=this.Ir.get(t);i===void 0&&(i=St(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zQ{constructor(){this.sessionToken=Br.EMPTY_BYTE_STRING}getSessionToken(e){return ce.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ce.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(){this.Tr=new Ur(_r.Er),this.dr=new Ur(_r.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new _r(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new _r(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Ve(new nn([])),r=new _r(t,e),s=new _r(t,e+1),i=[];return this.dr.forEachInRange([r,s],a=>{this.Vr(a),i.push(a.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Ve(new nn([])),r=new _r(t,e),s=new _r(t,e+1);let i=St();return this.dr.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const t=new _r(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class _r{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Ve.comparator(e.key,t.key)||Dt(e.wr,t.wr)}static Ar(e,t){return Dt(e.wr,t.wr)||Ve.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GQ{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Ur(_r.Er)}checkEmpty(e){return ce.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new dQ(i,t,r,s);this.mutationQueue.push(a);for(const o of s)this.br=this.br.add(new _r(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return ce.resolve(a)}lookupMutationBatch(e,t){return ce.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return ce.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ce.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return ce.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new _r(t,0),s=new _r(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],a=>{const o=this.Dr(a.wr);i.push(o)}),ce.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ur(Dt);return t.forEach(s=>{const i=new _r(s,0),a=new _r(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,a],o=>{r=r.add(o.wr)})}),ce.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Ve.isDocumentKey(i)||(i=i.child(""));const a=new _r(new Ve(i),0);let o=new Ur(Dt);return this.br.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(o=o.add(l.wr)),!0)},a),ce.resolve(this.Cr(o))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Nt(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return ce.forEach(t.mutations,s=>{const i=new _r(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new _r(t,0),s=this.br.firstAfterOrEqual(r);return ce.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,ce.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WQ{constructor(e){this.Mr=e,this.docs=function(){return new Bn(Ve.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return ce.resolve(r?r.document.mutableCopy():wr.newInvalidDocument(t))}getEntries(e,t){let r=qo();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():wr.newInvalidDocument(s))}),ce.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=qo();const a=t.path,o=new Ve(a.child("")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!a.isPrefixOf(u.path))break;u.path.length>a.length+1||PK(kK(h),r)<=0||(s.has(h.key)||y1(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return ce.resolve(i)}getAllFromCollectionGroup(e,t,r,s){He()}Or(e,t){return ce.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new HQ(this)}getSize(e){return ce.resolve(this.size)}}class HQ extends $Q{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),ce.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qQ{constructor(e){this.persistence=e,this.Nr=new Cf(t=>dk(t),hk),this.lastRemoteSnapshotVersion=Qe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new yk,this.targetCount=0,this.kr=Qh.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),ce.resolve()}getLastRemoteSnapshotVersion(e){return ce.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ce.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ce.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),ce.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Qh(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,ce.resolve()}updateTargetData(e,t){return this.Kn(t),ce.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,ce.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((a,o)=>{o.sequenceNumber<=t&&r.get(o.targetId)===null&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),s++)}),ce.waitFor(i).next(()=>s)}getTargetCount(e){return ce.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return ce.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),ce.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),ce.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),ce.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return ce.resolve(r)}containsKey(e,t){return ce.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KQ{constructor(e,t){this.qr={},this.overlays={},this.Qr=new ok(0),this.Kr=!1,this.Kr=!0,this.$r=new zQ,this.referenceDelegate=e(this),this.Ur=new qQ(this),this.indexManager=new DQ,this.remoteDocumentCache=function(s){return new WQ(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new LQ(t),this.Gr=new VQ(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new BQ,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new GQ(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){De("MemoryPersistence","Starting transaction:",e);const s=new QQ(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return ce.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class QQ extends RK{constructor(e){super(),this.currentSequenceNumber=e}}class vk{constructor(e){this.persistence=e,this.Jr=new yk,this.Yr=null}static Zr(e){return new vk(e)}get Xr(){if(this.Yr)return this.Yr;throw He()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),ce.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),ce.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),ce.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ce.forEach(this.Xr,r=>{const s=Ve.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Qe.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return ce.or([()=>ce.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=St(),s=St();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new wk(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YQ{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JQ{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return FG()?8:NK(os())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new YQ;return this.Xi(e,t,a).next(o=>{if(i.result=o,this.zi)return this.es(e,t,a,o.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?($p()<=Et.DEBUG&&De("QueryEngine","SDK will not create cache indexes for query:",Jd(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ce.resolve()):($p()<=Et.DEBUG&&De("QueryEngine","Query:",Jd(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?($p()<=Et.DEBUG&&De("QueryEngine","The SDK decides to create cache indexes for query:",Jd(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ka(t))):ce.resolve())}Yi(e,t){if(hO(t))return ce.resolve(null);let r=Ka(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=gC(t,null,"F"),r=Ka(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=St(...i);return this.Ji.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.ts(t,o);return this.ns(t,u,a,l.readTime)?this.Yi(e,gC(t,null,"F")):this.rs(e,u,t,l)}))})))}Zi(e,t,r,s){return hO(t)||s.isEqual(Qe.min())?ce.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const a=this.ts(t,i);return this.ns(t,a,r,s)?ce.resolve(null):($p()<=Et.DEBUG&&De("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Jd(t)),this.rs(e,a,t,xK(s,-1)).next(o=>o))})}ts(e,t){let r=new Ur(KM(e));return t.forEach((s,i)=>{y1(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return $p()<=Et.DEBUG&&De("QueryEngine","Using full collection scan to execute query:",Jd(t)),this.Ji.getDocumentsMatchingQuery(e,t,hu.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XQ{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Bn(Dt),this._s=new Cf(i=>dk(i),hk),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new UQ(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function ZQ(n,e,t,r){return new XQ(n,e,t,r)}async function yD(n,e){const t=tt(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],o=[];let l=St();for(const u of s){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(u=>({hs:u,removedBatchIds:a,addedBatchIds:o}))})})}function eY(n,e){const t=tt(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(o,l,u,h){const f=u.batch,p=f.keys();let y=ce.resolve();return p.forEach(_=>{y=y.next(()=>h.getEntry(l,_)).next(b=>{const S=u.docVersions.get(_);Nt(S!==null),b.version.compareTo(S)<0&&(f.applyToRemoteDocument(b,u),b.isValidDocument()&&(b.setReadTime(u.commitVersion),h.addEntry(b)))})}),y.next(()=>o.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let l=St();for(let u=0;u<o.mutationResults.length;++u)o.mutationResults[u].transformResults.length>0&&(l=l.add(o.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function vD(n){const e=tt(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function tY(n,e){const t=tt(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const o=[];e.targetChanges.forEach((h,f)=>{const p=s.get(f);if(!p)return;o.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,f)));let y=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(Br.EMPTY_BYTE_STRING,Qe.min()).withLastLimboFreeSnapshotVersion(Qe.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(b,S,E){return b.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=3e8?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0}(p,y,h)&&o.push(t.Ur.updateTargetData(i,y))});let l=qo(),u=St();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),o.push(nY(i,a,e.documentUpdates).next(h=>{l=h.Ps,u=h.Is})),!r.isEqual(Qe.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));o.push(h)}return ce.waitFor(o).next(()=>a.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.os=s,i))}function nY(n,e,t){let r=St(),s=St();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let a=qo();return t.forEach((o,l)=>{const u=i.get(o);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(o)),l.isNoDocument()&&l.version.isEqual(Qe.min())?(e.removeEntry(o,l.readTime),a=a.insert(o,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),a=a.insert(o,l)):De("LocalStore","Ignoring outdated watch update for ",o,". Current version:",u.version," Watch version:",l.version)}),{Ps:a,Is:s}})}function rY(n,e){const t=tt(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function sY(n,e){const t=tt(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,ce.resolve(s)):t.Ur.allocateTargetId(r).next(a=>(s=new Ul(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function wC(n,e,t){const r=tt(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!r_(a))throw a;De("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function SO(n,e,t){const r=tt(n);let s=Qe.min(),i=St();return r.persistence.runTransaction("Execute query","readwrite",a=>function(l,u,h){const f=tt(l),p=f._s.get(h);return p!==void 0?ce.resolve(f.os.get(p)):f.Ur.getTargetData(u,h)}(r,a,Ka(e)).next(o=>{if(o)return s=o.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,o.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,t?s:Qe.min(),t?i:St())).next(o=>(iY(r,YK(e),o),{documents:o,Ts:i})))}function iY(n,e,t){let r=n.us.get(e)||Qe.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}class TO{constructor(){this.activeTargetIds=nQ()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class aY{constructor(){this.so=new TO,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new TO,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oY{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CO{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){De("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){De("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zy=null;function YS(){return Zy===null?Zy=function(){return 268435456+Math.round(2147483648*Math.random())}():Zy++,"0x"+Zy.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lY={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uY{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const es="WebChannelConnection";class cY extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,a){const o=YS(),l=this.xo(t,r.toUriEncodedString());De("RestConnection",`Sending RPC '${t}' ${o}:`,l,s);const u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,i,a),this.No(t,l,u,s).then(h=>(De("RestConnection",`Received RPC '${t}' ${o}: `,h),h),h=>{throw Wh("RestConnection",`RPC '${t}' ${o} failed with error: `,h,"url: ",l,"request:",s),h})}Lo(t,r,s,i,a,o){return this.Mo(t,r,s,i,a)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Sf}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,a)=>t[a]=i),s&&s.headers.forEach((i,a)=>t[a]=i)}xo(t,r){const s=lY[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=YS();return new Promise((a,o)=>{const l=new AM;l.setWithCredentials(!0),l.listenOnce(RM.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case G0.NO_ERROR:const h=l.getResponseJson();De(es,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),a(h);break;case G0.TIMEOUT:De(es,`RPC '${e}' ${i} timed out`),o(new Te(oe.DEADLINE_EXCEEDED,"Request time out"));break;case G0.HTTP_ERROR:const f=l.getStatus();if(De(es,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let p=l.getResponseJson();Array.isArray(p)&&(p=p[0]);const y=p==null?void 0:p.error;if(y&&y.status&&y.message){const _=function(S){const E=S.toLowerCase().replace(/_/g,"-");return Object.values(oe).indexOf(E)>=0?E:oe.UNKNOWN}(y.status);o(new Te(_,y.message))}else o(new Te(oe.UNKNOWN,"Server responded with status "+l.getStatus()))}else o(new Te(oe.UNAVAILABLE,"Connection failed."));break;default:He()}}finally{De(es,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(s);De(es,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",u,r,15)})}Bo(e,t,r){const s=YS(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=LM(),o=OM(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");De(es,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=a.createWebChannel(h,l);let p=!1,y=!1;const _=new uY({Io:S=>{y?De(es,`Not sending because RPC '${e}' stream ${s} is closed:`,S):(p||(De(es,`Opening RPC '${e}' stream ${s} transport.`),f.open(),p=!0),De(es,`RPC '${e}' stream ${s} sending:`,S),f.send(S))},To:()=>f.close()}),b=(S,E,C)=>{S.listen(E,v=>{try{C(v)}catch(I){setTimeout(()=>{throw I},0)}})};return b(f,em.EventType.OPEN,()=>{y||(De(es,`RPC '${e}' stream ${s} transport opened.`),_.yo())}),b(f,em.EventType.CLOSE,()=>{y||(y=!0,De(es,`RPC '${e}' stream ${s} transport closed`),_.So())}),b(f,em.EventType.ERROR,S=>{y||(y=!0,Wh(es,`RPC '${e}' stream ${s} transport errored:`,S),_.So(new Te(oe.UNAVAILABLE,"The operation could not be completed")))}),b(f,em.EventType.MESSAGE,S=>{var E;if(!y){const C=S.data[0];Nt(!!C);const v=C,I=v.error||((E=v[0])===null||E===void 0?void 0:E.error);if(I){De(es,`RPC '${e}' stream ${s} received error:`,I);const L=I.status;let R=function(N){const M=Fn[N];if(M!==void 0)return oD(M)}(L),P=I.message;R===void 0&&(R=oe.INTERNAL,P="Unknown error status: "+L+" with message "+I.message),y=!0,_.So(new Te(R,P)),f.close()}else De(es,`RPC '${e}' stream ${s} received:`,C),_.bo(C)}}),b(o,NM.STAT_EVENT,S=>{S.stat===uC.PROXY?De(es,`RPC '${e}' stream ${s} detected buffering proxy`):S.stat===uC.NOPROXY&&De(es,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{_.wo()},0),_}}function JS(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E1(n){return new wQ(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&De("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wD{constructor(e,t,r,s,i,a,o,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new bk(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===oe.RESOURCE_EXHAUSTED?(Ho(t.toString()),Ho("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===oe.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new Te(oe.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return De("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(De("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class dY extends wD{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=TQ(this.serializer,e),r=function(i){if(!("targetChange"in i))return Qe.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?Qe.min():a.readTime?si(a.readTime):Qe.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=vC(this.serializer),t.addTarget=function(i,a){let o;const l=a.target;if(o=pC(l)?{documents:IQ(i,l)}:{query:xQ(i,l)._t},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=cD(i,a.resumeToken);const u=_C(i,a.expectedCount);u!==null&&(o.expectedCount=u)}else if(a.snapshotVersion.compareTo(Qe.min())>0){o.readTime=Kv(i,a.snapshotVersion.toTimestamp());const u=_C(i,a.expectedCount);u!==null&&(o.expectedCount=u)}return o}(this.serializer,e);const r=PQ(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=vC(this.serializer),t.removeTarget=e,this.a_(t)}}class hY extends wD{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Nt(!!e.streamToken),this.lastStreamToken=e.streamToken,Nt(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Nt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=CQ(e.writeResults,e.commitTime),r=si(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=vC(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>pD(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fY extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new Te(oe.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Mo(e,yC(t,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===oe.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Te(oe.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Lo(e,yC(t,r),s,a,o,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===oe.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Te(oe.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class pY{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Ho(t),this.D_=!1):De("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mY{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(a=>{r.enqueueAndForget(async()=>{nd(this)&&(De("RemoteStore","Restarting streams for network reachability change."),await async function(l){const u=tt(l);u.L_.add(4),await l_(u),u.q_.set("Unknown"),u.L_.delete(4),await S1(u)}(this))})}),this.q_=new pY(r,s)}}async function S1(n){if(nd(n))for(const e of n.B_)await e(!0)}async function l_(n){for(const e of n.B_)await e(!1)}function bD(n,e){const t=tt(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Ck(t)?Tk(t):If(t).r_()&&Sk(t,e))}function Ek(n,e){const t=tt(n),r=If(t);t.N_.delete(e),r.r_()&&ED(t,e),t.N_.size===0&&(r.r_()?r.o_():nd(t)&&t.q_.set("Unknown"))}function Sk(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Qe.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}If(n).A_(e)}function ED(n,e){n.Q_.xe(e),If(n).R_(e)}function Tk(n){n.Q_=new gQ({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),If(n).start(),n.q_.v_()}function Ck(n){return nd(n)&&!If(n).n_()&&n.N_.size>0}function nd(n){return tt(n).L_.size===0}function SD(n){n.Q_=void 0}async function gY(n){n.q_.set("Online")}async function _Y(n){n.N_.forEach((e,t)=>{Sk(n,e)})}async function yY(n,e){SD(n),Ck(n)?(n.q_.M_(e),Tk(n)):n.q_.set("Unknown")}async function vY(n,e,t){if(n.q_.set("Online"),e instanceof uD&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const o of i.targetIds)s.N_.has(o)&&(await s.remoteSyncer.rejectListen(o,a),s.N_.delete(o),s.Q_.removeTarget(o))}(n,e)}catch(r){De("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Yv(n,r)}else if(e instanceof q0?n.Q_.Ke(e):e instanceof lD?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Qe.min()))try{const r=await vD(n.localStore);t.compareTo(r)>=0&&await function(i,a){const o=i.Q_.rt(a);return o.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.N_.get(u);h&&i.N_.set(u,h.withResumeToken(l.resumeToken,a))}}),o.targetMismatches.forEach((l,u)=>{const h=i.N_.get(l);if(!h)return;i.N_.set(l,h.withResumeToken(Br.EMPTY_BYTE_STRING,h.snapshotVersion)),ED(i,l);const f=new Ul(h.target,l,u,h.sequenceNumber);Sk(i,f)}),i.remoteSyncer.applyRemoteEvent(o)}(n,t)}catch(r){De("RemoteStore","Failed to raise snapshot:",r),await Yv(n,r)}}async function Yv(n,e,t){if(!r_(e))throw e;n.L_.add(1),await l_(n),n.q_.set("Offline"),t||(t=()=>vD(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{De("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await S1(n)})}function TD(n,e){return e().catch(t=>Yv(n,t,e))}async function T1(n){const e=tt(n),t=pu(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;wY(e);)try{const s=await rY(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,bY(e,s)}catch(s){await Yv(e,s)}CD(e)&&ID(e)}function wY(n){return nd(n)&&n.O_.length<10}function bY(n,e){n.O_.push(e);const t=pu(n);t.r_()&&t.V_&&t.m_(e.mutations)}function CD(n){return nd(n)&&!pu(n).n_()&&n.O_.length>0}function ID(n){pu(n).start()}async function EY(n){pu(n).p_()}async function SY(n){const e=pu(n);for(const t of n.O_)e.m_(t.mutations)}async function TY(n,e,t){const r=n.O_.shift(),s=mk.from(r,e,t);await TD(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await T1(n)}async function CY(n,e){e&&pu(n).V_&&await async function(r,s){if(function(a){return aD(a)&&a!==oe.ABORTED}(s.code)){const i=r.O_.shift();pu(r).s_(),await TD(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await T1(r)}}(n,e),CD(n)&&ID(n)}async function IO(n,e){const t=tt(n);t.asyncQueue.verifyOperationInProgress(),De("RemoteStore","RemoteStore received new credentials");const r=nd(t);t.L_.add(3),await l_(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await S1(t)}async function IY(n,e){const t=tt(n);e?(t.L_.delete(2),await S1(t)):e||(t.L_.add(2),await l_(t),t.q_.set("Unknown"))}function If(n){return n.K_||(n.K_=function(t,r,s){const i=tt(t);return i.w_(),new dY(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:gY.bind(null,n),Ro:_Y.bind(null,n),mo:yY.bind(null,n),d_:vY.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Ck(n)?Tk(n):n.q_.set("Unknown")):(await n.K_.stop(),SD(n))})),n.K_}function pu(n){return n.U_||(n.U_=function(t,r,s){const i=tt(t);return i.w_(),new hY(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:EY.bind(null,n),mo:CY.bind(null,n),f_:SY.bind(null,n),g_:TY.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await T1(n)):(await n.U_.stop(),n.O_.length>0&&(De("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Do,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,o=new Ik(e,t,a,s,i);return o.start(r),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Te(oe.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function xk(n,e){if(Ho("AsyncQueue",`${e}: ${n}`),r_(n))return new Te(oe.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Ve.comparator(t.key,r.key):(t,r)=>Ve.comparator(t.key,r.key),this.keyedMap=tm(),this.sortedSet=new Bn(this.comparator)}static emptySet(e){return new Ah(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ah)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Ah;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xO{constructor(){this.W_=new Bn(Ve.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):He():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Yh{constructor(e,t,r,s,i,a,o,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach(o=>{a.push({type:0,doc:o})}),new Yh(e,t,Ah.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_1(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xY{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class kY{constructor(){this.queries=kO(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=tt(t),i=s.queries;s.queries=kO(),i.forEach((a,o)=>{for(const l of o.j_)l.onError(r)})})(this,new Te(oe.ABORTED,"Firestore shutting down"))}}function kO(){return new Cf(n=>qM(n),_1)}async function xD(n,e){const t=tt(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new xY,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const o=xk(a,`Initialization of query '${Jd(e.query)}' failed`);return void e.onError(o)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&kk(t)}async function kD(n,e){const t=tt(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.j_.indexOf(e);a>=0&&(i.j_.splice(a,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function PY(n,e){const t=tt(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const o of a.j_)o.X_(s)&&(r=!0);a.z_=s}}r&&kk(t)}function AY(n,e,t){const r=tt(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function kk(n){n.Y_.forEach(e=>{e.next()})}var bC,PO;(PO=bC||(bC={})).ea="default",PO.Cache="cache";class PD{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Yh(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Yh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==bC.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AD{constructor(e){this.key=e}}class RD{constructor(e){this.key=e}}class RY{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=St(),this.mutatedKeys=St(),this.Aa=KM(e),this.Ra=new Ah(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new xO,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,o=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const p=s.get(h),y=y1(this.query,f)?f:null,_=!!p&&this.mutatedKeys.has(p.key),b=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let S=!1;p&&y?p.data.isEqual(y.data)?_!==b&&(r.track({type:3,doc:y}),S=!0):this.ga(p,y)||(r.track({type:2,doc:y}),S=!0,(l&&this.Aa(y,l)>0||u&&this.Aa(y,u)<0)&&(o=!0)):!p&&y?(r.track({type:0,doc:y}),S=!0):p&&!y&&(r.track({type:1,doc:p}),S=!0,(l||u)&&(o=!0)),S&&(y?(a=a.add(y),i=b?i.add(h):i.delete(h)):(a=a.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:a,fa:r,ns:o,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((h,f)=>function(y,_){const b=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return He()}};return b(y)-b(_)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const o=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,u=l!==this.Ea;return this.Ea=l,a.length!==0||u?{snapshot:new Yh(this.query,e.Ra,i,a,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:o}:{wa:o}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new xO,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=St(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new RD(r))}),this.da.forEach(r=>{e.has(r)||t.push(new AD(r))}),t}ba(e){this.Ta=e.Ts,this.da=St();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Yh.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class NY{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class OY{constructor(e){this.key=e,this.va=!1}}class LY{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new Cf(o=>qM(o),_1),this.Ma=new Map,this.xa=new Set,this.Oa=new Bn(Ve.comparator),this.Na=new Map,this.La=new yk,this.Ba={},this.ka=new Map,this.qa=Qh.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function MY(n,e,t=!0){const r=FD(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await ND(r,e,t,!0),s}async function DY(n,e){const t=FD(n);await ND(t,e,!0,!1)}async function ND(n,e,t,r){const s=await sY(n.localStore,Ka(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let o;return r&&(o=await FY(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&bD(n.remoteStore,s),o}async function FY(n,e,t,r,s){n.Ka=(f,p,y)=>async function(b,S,E,C){let v=S.view.ma(E);v.ns&&(v=await SO(b.localStore,S.query,!1).then(({documents:P})=>S.view.ma(P,v)));const I=C&&C.targetChanges.get(S.targetId),L=C&&C.targetMismatches.get(S.targetId)!=null,R=S.view.applyChanges(v,b.isPrimaryClient,I,L);return RO(b,S.targetId,R.wa),R.snapshot}(n,f,p,y);const i=await SO(n.localStore,e,!0),a=new RY(e,i.Ts),o=a.ma(i.documents),l=o_.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=a.applyChanges(o,n.isPrimaryClient,l);RO(n,t,u.wa);const h=new NY(e,t,a);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),u.snapshot}async function $Y(n,e,t){const r=tt(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(a=>!_1(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await wC(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Ek(r.remoteStore,s.targetId),EC(r,s.targetId)}).catch(n_)):(EC(r,s.targetId),await wC(r.localStore,s.targetId,!0))}async function jY(n,e){const t=tt(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ek(t.remoteStore,r.targetId))}async function UY(n,e,t){const r=qY(n);try{const s=await function(a,o){const l=tt(a),u=ir.now(),h=o.reduce((y,_)=>y.add(_.key),St());let f,p;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let _=qo(),b=St();return l.cs.getEntries(y,h).next(S=>{_=S,_.forEach((E,C)=>{C.isValidDocument()||(b=b.add(E))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,_)).next(S=>{f=S;const E=[];for(const C of o){const v=cQ(C,f.get(C.key).overlayedDocument);v!=null&&E.push(new Ou(C.key,v,jM(v.value.mapValue),rr.exists(!0)))}return l.mutationQueue.addMutationBatch(y,u,E,o)}).next(S=>{p=S;const E=S.applyToLocalDocumentSet(f,b);return l.documentOverlayCache.saveOverlays(y,S.batchId,E)})}).then(()=>({batchId:p.batchId,changes:YM(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,o,l){let u=a.Ba[a.currentUser.toKey()];u||(u=new Bn(Dt)),u=u.insert(o,l),a.Ba[a.currentUser.toKey()]=u}(r,s.batchId,t),await u_(r,s.changes),await T1(r.remoteStore)}catch(s){const i=xk(s,"Failed to persist write");t.reject(i)}}async function OD(n,e){const t=tt(n);try{const r=await tY(t.localStore,e);e.targetChanges.forEach((s,i)=>{const a=t.Na.get(i);a&&(Nt(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.va=!0:s.modifiedDocuments.size>0?Nt(a.va):s.removedDocuments.size>0&&(Nt(a.va),a.va=!1))}),await u_(t,r,e)}catch(r){await n_(r)}}function AO(n,e,t){const r=tt(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,a)=>{const o=a.view.Z_(e);o.snapshot&&s.push(o.snapshot)}),function(a,o){const l=tt(a);l.onlineState=o;let u=!1;l.queries.forEach((h,f)=>{for(const p of f.j_)p.Z_(o)&&(u=!0)}),u&&kk(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function VY(n,e,t){const r=tt(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let a=new Bn(Ve.comparator);a=a.insert(i,wr.newNoDocument(i,Qe.min()));const o=St().add(i),l=new b1(Qe.min(),new Map,new Bn(Dt),a,o);await OD(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),Pk(r)}else await wC(r.localStore,e,!1).then(()=>EC(r,e,t)).catch(n_)}async function BY(n,e){const t=tt(n),r=e.batch.batchId;try{const s=await eY(t.localStore,e);MD(t,r,null),LD(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await u_(t,s)}catch(s){await n_(s)}}async function zY(n,e,t){const r=tt(n);try{const s=await function(a,o){const l=tt(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,o).next(f=>(Nt(f!==null),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,o)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);MD(r,e,t),LD(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await u_(r,s)}catch(s){await n_(s)}}function LD(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function MD(n,e,t){const r=tt(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function EC(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||DD(n,r)})}function DD(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Ek(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Pk(n))}function RO(n,e,t){for(const r of t)r instanceof AD?(n.La.addReference(r.key,e),GY(n,r)):r instanceof RD?(De("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||DD(n,r.key)):He()}function GY(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(De("SyncEngine","New document in limbo: "+t),n.xa.add(r),Pk(n))}function Pk(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Ve(nn.fromString(e)),r=n.qa.next();n.Na.set(r,new OY(t)),n.Oa=n.Oa.insert(t,r),bD(n.remoteStore,new Ul(Ka(fk(t.path)),r,"TargetPurposeLimboResolution",ok.oe))}}async function u_(n,e,t){const r=tt(n),s=[],i=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((o,l)=>{a.push(r.Ka(l,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){s.push(u);const f=wk.Wi(l.targetId,u);i.push(f)}}))}),await Promise.all(a),r.Ca.d_(s),await async function(l,u){const h=tt(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>ce.forEach(u,p=>ce.forEach(p.$i,y=>h.persistence.referenceDelegate.addReference(f,p.targetId,y)).next(()=>ce.forEach(p.Ui,y=>h.persistence.referenceDelegate.removeReference(f,p.targetId,y)))))}catch(f){if(!r_(f))throw f;De("LocalStore","Failed to update sequence numbers: "+f)}for(const f of u){const p=f.targetId;if(!f.fromCache){const y=h.os.get(p),_=y.snapshotVersion,b=y.withLastLimboFreeSnapshotVersion(_);h.os=h.os.insert(p,b)}}}(r.localStore,i))}async function WY(n,e){const t=tt(n);if(!t.currentUser.isEqual(e)){De("SyncEngine","User change. New user:",e.toKey());const r=await yD(t.localStore,e);t.currentUser=e,function(i,a){i.ka.forEach(o=>{o.forEach(l=>{l.reject(new Te(oe.CANCELLED,a))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await u_(t,r.hs)}}function HY(n,e){const t=tt(n),r=t.Na.get(e);if(r&&r.va)return St().add(r.key);{let s=St();const i=t.Ma.get(e);if(!i)return s;for(const a of i){const o=t.Fa.get(a);s=s.unionWith(o.view.Va)}return s}}function FD(n){const e=tt(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=OD.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=HY.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=VY.bind(null,e),e.Ca.d_=PY.bind(null,e.eventManager),e.Ca.$a=AY.bind(null,e.eventManager),e}function qY(n){const e=tt(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=BY.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=zY.bind(null,e),e}class Jv{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=E1(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return ZQ(this.persistence,new JQ,e.initialUser,this.serializer)}Ga(e){return new KQ(vk.Zr,this.serializer)}Wa(e){return new aY}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Jv.provider={build:()=>new Jv};class SC{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>AO(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=WY.bind(null,this.syncEngine),await IY(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new kY}()}createDatastore(e){const t=E1(e.databaseInfo.databaseId),r=function(i){return new cY(i)}(e.databaseInfo);return function(i,a,o,l){return new fY(i,a,o,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,a,o){return new mY(r,s,i,a,o)}(this.localStore,this.datastore,e.asyncQueue,t=>AO(this.syncEngine,t,0),function(){return CO.D()?new CO:new oY}())}createSyncEngine(e,t){return function(s,i,a,o,l,u,h){const f=new LY(s,i,a,o,l,u);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=tt(s);De("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await l_(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}SC.provider={build:()=>new SC};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $D{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Ho("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KY{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Te(oe.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const a=tt(s),o={documents:i.map(f=>Qv(a.serializer,f))},l=await a.Lo("BatchGetDocuments",a.serializer.databaseId,nn.emptyPath(),o,i.length),u=new Map;l.forEach(f=>{const p=SQ(a.serializer,f);u.set(p.key.toString(),p)});const h=[];return i.forEach(f=>{const p=u.get(f.toString());Nt(!!p),h.push(p)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new a_(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Ve.fromPath(r);this.mutations.push(new iD(s,this.precondition(s)))}),await async function(r,s){const i=tt(r),a={writes:s.map(o=>pD(i.serializer,o))};await i.Mo("Commit",i.serializer.databaseId,nn.emptyPath(),a)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw He();t=Qe.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new Te(oe.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Qe.min())?rr.exists(!1):rr.updateTime(t):rr.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Qe.min()))throw new Te(oe.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rr.updateTime(t)}return rr.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QY{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new bk(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new KY(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!s_(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!aD(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YY{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=ts.UNAUTHENTICATED,this.clientId=DM.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{De("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(De("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Do;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=xk(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function XS(n,e){n.asyncQueue.verifyOperationInProgress(),De("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await yD(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function NO(n,e){n.asyncQueue.verifyOperationInProgress();const t=await JY(n);De("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>IO(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>IO(e.remoteStore,s)),n._onlineComponents=e}async function JY(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){De("FirestoreClient","Using user provided OfflineComponentProvider");try{await XS(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===oe.FAILED_PRECONDITION||s.code===oe.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Wh("Error using user provided cache. Falling back to memory cache: "+t),await XS(n,new Jv)}}else De("FirestoreClient","Using default OfflineComponentProvider"),await XS(n,new Jv);return n._offlineComponents}async function Ak(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(De("FirestoreClient","Using user provided OnlineComponentProvider"),await NO(n,n._uninitializedComponentsProvider._online)):(De("FirestoreClient","Using default OnlineComponentProvider"),await NO(n,new SC))),n._onlineComponents}function XY(n){return Ak(n).then(e=>e.syncEngine)}function ZY(n){return Ak(n).then(e=>e.datastore)}async function TC(n){const e=await Ak(n),t=e.eventManager;return t.onListen=MY.bind(null,e.syncEngine),t.onUnlisten=$Y.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=DY.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=jY.bind(null,e.syncEngine),t}function eJ(n,e,t={}){const r=new Do;return n.asyncQueue.enqueueAndForget(async()=>function(i,a,o,l,u){const h=new $D({next:p=>{h.Za(),a.enqueueAndForget(()=>kD(i,f)),p.fromCache&&l.source==="server"?u.reject(new Te(oe.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new PD(o,h,{includeMetadataChanges:!0,_a:!0});return xD(i,f)}(await TC(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jD(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OO=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UD(n,e,t){if(!t)throw new Te(oe.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function tJ(n,e,t,r){if(e===!0&&r===!0)throw new Te(oe.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function LO(n){if(!Ve.isDocumentKey(n))throw new Te(oe.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function MO(n){if(Ve.isDocumentKey(n))throw new Te(oe.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function C1(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":He()}function ii(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Te(oe.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=C1(n);throw new Te(oe.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DO{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Te(oe.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Te(oe.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}tJ("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=jD((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Te(oe.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Te(oe.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Te(oe.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class I1{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new DO({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Te(oe.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Te(oe.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new DO(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new yK;switch(r.type){case"firstParty":return new EK(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Te(oe.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=OO.get(t);r&&(De("ComponentProvider","Removing Datastore"),OO.delete(t),r.terminate())}(this),Promise.resolve()}}function VD(n,e,t,r={}){var s;const i=(n=ii(n,I1))._getSettings(),a=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==a&&Wh("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),r.mockUserToken){let o,l;if(typeof r.mockUserToken=="string")o=r.mockUserToken,l=ts.MOCK_USER;else{o=VL(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new Te(oe.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new ts(u)}n._authCredentials=new vK(new MM(o,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lu{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Lu(this.firestore,e,this._query)}}class is{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new iu(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new is(this.firestore,e,this._key)}}class iu extends Lu{constructor(e,t,r){super(e,t,fk(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new is(this.firestore,null,new Ve(e))}withConverter(e){return new iu(this.firestore,e,this._path)}}function rd(n,e,...t){if(n=Xt(n),UD("collection","path",e),n instanceof I1){const r=nn.fromString(e,...t);return MO(r),new iu(n,null,r)}{if(!(n instanceof is||n instanceof iu))throw new Te(oe.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(nn.fromString(e,...t));return MO(r),new iu(n.firestore,null,r)}}function eo(n,e,...t){if(n=Xt(n),arguments.length===1&&(e=DM.newId()),UD("doc","path",e),n instanceof I1){const r=nn.fromString(e,...t);return LO(r),new is(n,null,new Ve(r))}{if(!(n instanceof is||n instanceof iu))throw new Te(oe.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(nn.fromString(e,...t));return LO(r),new is(n.firestore,n instanceof iu?n.converter:null,new Ve(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FO{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new bk(this,"async_queue_retry"),this.Vu=()=>{const r=JS();r&&De("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=JS();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=JS();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Do;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!r_(e))throw e;De("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(a){let o=a.message||"";return a.stack&&(o=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),o}(r);throw Ho("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Ik.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&He()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function $O(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class Ko extends I1{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new FO,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new FO(e),this._firestoreClient=void 0,await e}}}function nJ(n,e){const t=typeof n=="object"?n:Kx(),r=typeof n=="string"?n:"(default)",s=f1(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=$L("firestore");i&&VD(s,...i)}return s}function c_(n){if(n._terminated)throw new Te(oe.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||rJ(n),n._firestoreClient}function rJ(n){var e,t,r;const s=n._freezeSettings(),i=function(o,l,u,h){return new MK(o,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,jD(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new YY(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(o){const l=o==null?void 0:o._online.build();return{_offline:o==null?void 0:o._offline.build(l),_online:l}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Vc(Br.fromBase64String(e))}catch(t){throw new Te(oe.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Vc(Br.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Te(oe.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Fr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function BD(){return new sd("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x1{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Te(oe.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Te(oe.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Dt(this._lat,e._lat)||Dt(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nk{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sJ=/^__.*__$/;class iJ{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ou(e,this.data,this.fieldMask,t,this.fieldTransforms):new i_(e,this.data,t,this.fieldTransforms)}}class zD{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ou(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function GD(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw He()}}class Ok{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Ok(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Xv(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(GD(this.Cu)&&sJ.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class aJ{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||E1(e)}Qu(e,t,r,s=!1){return new Ok({Cu:e,methodName:t,qu:r,path:Fr.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function d_(n){const e=n._freezeSettings(),t=E1(n._databaseId);return new aJ(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Lk(n,e,t,r,s,i={}){const a=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);$k("Data must be an object, but it was:",a,r);const o=WD(r,a);let l,u;if(i.merge)l=new ti(a.fieldMask),u=a.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const p=CC(e,f,t);if(!a.contains(p))throw new Te(oe.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);qD(h,p)||h.push(p)}l=new ti(h),u=a.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=a.fieldTransforms;return new iJ(new ys(o),l,u)}class k1 extends x1{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof k1}}class Mk extends x1{_toFieldTransform(e){return new aQ(e.path,new Eg)}isEqual(e){return e instanceof Mk}}function Dk(n,e,t,r){const s=n.Qu(1,e,t);$k("Data must be an object, but it was:",s,r);const i=[],a=ys.empty();td(r,(l,u)=>{const h=jk(e,l,t);u=Xt(u);const f=s.Nu(h);if(u instanceof k1)i.push(h);else{const p=h_(u,f);p!=null&&(i.push(h),a.set(h,p))}});const o=new ti(i);return new zD(a,o,s.fieldTransforms)}function Fk(n,e,t,r,s,i){const a=n.Qu(1,e,t),o=[CC(e,r,t)],l=[s];if(i.length%2!=0)throw new Te(oe.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)o.push(CC(e,i[p])),l.push(i[p+1]);const u=[],h=ys.empty();for(let p=o.length-1;p>=0;--p)if(!qD(u,o[p])){const y=o[p];let _=l[p];_=Xt(_);const b=a.Nu(y);if(_ instanceof k1)u.push(y);else{const S=h_(_,b);S!=null&&(u.push(y),h.set(y,S))}}const f=new ti(u);return new zD(h,f,a.fieldTransforms)}function oJ(n,e,t,r=!1){return h_(t,n.Qu(r?4:3,e))}function h_(n,e){if(HD(n=Xt(n)))return $k("Unsupported field value:",e,n),WD(n,e);if(n instanceof x1)return function(r,s){if(!GD(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const o of r){let l=h_(o,s.Lu(a));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),a++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Xt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return rQ(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=ir.fromDate(r);return{timestampValue:Kv(s.serializer,i)}}if(r instanceof ir){const i=new ir(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Kv(s.serializer,i)}}if(r instanceof Rk)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Vc)return{bytesValue:cD(s.serializer,r._byteString)};if(r instanceof is){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:_k(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Nk)return function(a,o){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(l=>{if(typeof l!="number")throw o.Bu("VectorValues must only contain numeric values.");return pk(o.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${C1(r)}`)}(n,e)}function WD(n,e){const t={};return FM(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):td(n,(r,s)=>{const i=h_(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function HD(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ir||n instanceof Rk||n instanceof Vc||n instanceof is||n instanceof x1||n instanceof Nk)}function $k(n,e,t){if(!HD(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=C1(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function CC(n,e,t){if((e=Xt(e))instanceof sd)return e._internalPath;if(typeof e=="string")return jk(n,e);throw Xv("Field path arguments must be of type string or ",n,!1,void 0,t)}const lJ=new RegExp("[~\\*/\\[\\]]");function jk(n,e,t){if(e.search(lJ)>=0)throw Xv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new sd(...e.split("."))._internalPath}catch{throw Xv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Xv(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${r}`),a&&(l+=` in document ${s}`),l+=")"),new Te(oe.INVALID_ARGUMENT,o+n+l)}function qD(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zv{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new is(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new uJ(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(P1("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class uJ extends Zv{data(){return super.data()}}function P1(n,e){return typeof e=="string"?jk(n,e):e instanceof sd?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KD(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Te(oe.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Uk{}class QD extends Uk{}function A1(n,e,...t){let r=[];e instanceof Uk&&r.push(e),r=r.concat(t),function(i){const a=i.filter(l=>l instanceof Bk).length,o=i.filter(l=>l instanceof R1).length;if(a>1||a>0&&o>0)throw new Te(oe.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class R1 extends QD{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new R1(e,t,r)}_apply(e){const t=this._parse(e);return YD(e._query,t),new Lu(e.firestore,e.converter,mC(e._query,t))}_parse(e){const t=d_(e.firestore);return function(i,a,o,l,u,h,f){let p;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new Te(oe.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){UO(f,h);const y=[];for(const _ of f)y.push(jO(l,i,_));p={arrayValue:{values:y}}}else p=jO(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||UO(f,h),p=oJ(o,a,f,h==="in"||h==="not-in");return Vn.create(u,h,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Vk(n,e,t){const r=e,s=P1("where",n);return R1._create(s,r,t)}class Bk extends Uk{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Bk(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:da.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let a=s;const o=i.getFlattenedFilters();for(const l of o)YD(a,l),a=mC(a,l)}(e._query,t),new Lu(e.firestore,e.converter,mC(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class zk extends QD{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new zk(e,t)}_apply(e){const t=function(s,i,a){if(s.startAt!==null)throw new Te(oe.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Te(oe.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new bg(i,a)}(e._query,this._field,this._direction);return new Lu(e.firestore,e.converter,function(s,i){const a=s.explicitOrderBy.concat([i]);return new Tf(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function cJ(n,e="asc"){const t=e,r=P1("orderBy",n);return zk._create(r,t)}function jO(n,e,t){if(typeof(t=Xt(t))=="string"){if(t==="")throw new Te(oe.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!HM(e)&&t.indexOf("/")!==-1)throw new Te(oe.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(nn.fromString(t));if(!Ve.isDocumentKey(r))throw new Te(oe.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return aO(n,new Ve(r))}if(t instanceof is)return aO(n,t._key);throw new Te(oe.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${C1(t)}.`)}function UO(n,e){if(!Array.isArray(n)||n.length===0)throw new Te(oe.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function YD(n,e){const t=function(s,i){for(const a of s)for(const o of a.getFlattenedFilters())if(i.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Te(oe.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Te(oe.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class JD{convertValue(e,t="none"){switch(Uc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Pn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(jc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw He()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return td(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(a=>Pn(a.doubleValue));return new Nk(i)}convertGeoPoint(e){return new Rk(Pn(e.latitude),Pn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=uk(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(yg(e));default:return null}}convertTimestamp(e){const t=fu(e);return new ir(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=nn.fromString(e);Nt(_D(r));const s=new vg(r.get(1),r.get(3)),i=new Ve(r.popFirst(5));return s.isEqual(t)||Ho(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gk(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class dJ extends JD{constructor(e){super(),this.firestore=e}convertBytes(e){return new Vc(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new is(this.firestore,null,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Wk extends Zv{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new K0(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(P1("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class K0 extends Wk{data(e={}){return super.data(e)}}class XD{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new gh(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new K0(this._firestore,this._userDataWriter,r.key,r,new gh(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Te(oe.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(o=>{const l=new K0(s._firestore,s._userDataWriter,o.doc.key,o.doc,new gh(s._snapshot.mutatedKeys.has(o.doc.key),s._snapshot.fromCache),s.query.converter);return o.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(o=>i||o.type!==3).map(o=>{const l=new K0(s._firestore,s._userDataWriter,o.doc.key,o.doc,new gh(s._snapshot.mutatedKeys.has(o.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return o.type!==0&&(u=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),h=a.indexOf(o.doc.key)),{type:hJ(o.type),doc:l,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function hJ(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return He()}}class N1 extends JD{constructor(e){super(),this.firestore=e}convertBytes(e){return new Vc(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new is(this.firestore,null,t)}}function f_(n){n=ii(n,Lu);const e=ii(n.firestore,Ko),t=c_(e),r=new N1(e);return KD(n._query),eJ(t,n._query).then(s=>new XD(e,r,n,s))}function fJ(n,e,t){n=ii(n,is);const r=ii(n.firestore,Ko),s=Gk(n.converter,e,t);return O1(r,[Lk(d_(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,rr.none())])}function ZD(n,e,t,...r){n=ii(n,is);const s=ii(n.firestore,Ko),i=d_(s);let a;return a=typeof(e=Xt(e))=="string"||e instanceof sd?Fk(i,"updateDoc",n._key,e,t,r):Dk(i,"updateDoc",n._key,e),O1(s,[a.toMutation(n._key,rr.exists(!0))])}function e7(n){return O1(ii(n.firestore,Ko),[new a_(n._key,rr.none())])}function pJ(n,...e){var t,r,s;n=Xt(n);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||$O(e[a])||(i=e[a],a++);const o={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if($O(e[a])){const f=e[a];e[a]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[a+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[a+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,u,h;if(n instanceof is)u=ii(n.firestore,Ko),h=fk(n._key.path),l={next:f=>{e[a]&&e[a](mJ(u,n,f))},error:e[a+1],complete:e[a+2]};else{const f=ii(n,Lu);u=ii(f.firestore,Ko),h=f._query;const p=new N1(u);l={next:y=>{e[a]&&e[a](new XD(u,p,f,y))},error:e[a+1],complete:e[a+2]},KD(n._query)}return function(p,y,_,b){const S=new $D(b),E=new PD(y,S,_);return p.asyncQueue.enqueueAndForget(async()=>xD(await TC(p),E)),()=>{S.Za(),p.asyncQueue.enqueueAndForget(async()=>kD(await TC(p),E))}}(c_(u),h,o,l)}function O1(n,e){return function(r,s){const i=new Do;return r.asyncQueue.enqueueAndForget(async()=>UY(await XY(r),s,i)),i.promise}(c_(n),e)}function mJ(n,e,t){const r=t.docs.get(e._key),s=new N1(n);return new Wk(n,s,e._key,r,new gh(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gJ={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _J{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=d_(e)}set(e,t,r){this._verifyNotCommitted();const s=Fl(e,this._firestore),i=Gk(s.converter,t,r),a=Lk(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,rr.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Fl(e,this._firestore);let a;return a=typeof(t=Xt(t))=="string"||t instanceof sd?Fk(this._dataReader,"WriteBatch.update",i._key,t,r,s):Dk(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(a.toMutation(i._key,rr.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Fl(e,this._firestore);return this._mutations=this._mutations.concat(new a_(t._key,rr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Te(oe.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Fl(n,e){if((n=Xt(n)).firestore!==e)throw new Te(oe.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yJ extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=d_(t)}get(t){const r=Fl(t,this._firestore),s=new dJ(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return He();const a=i[0];if(a.isFoundDocument())return new Zv(this._firestore,s,a.key,a,r.converter);if(a.isNoDocument())return new Zv(this._firestore,s,r._key,null,r.converter);throw He()})}set(t,r,s){const i=Fl(t,this._firestore),a=Gk(i.converter,r,s),o=Lk(this._dataReader,"Transaction.set",i._key,a,i.converter!==null,s);return this._transaction.set(i._key,o),this}update(t,r,s,...i){const a=Fl(t,this._firestore);let o;return o=typeof(r=Xt(r))=="string"||r instanceof sd?Fk(this._dataReader,"Transaction.update",a._key,r,s,i):Dk(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,o),this}delete(t){const r=Fl(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Fl(e,this._firestore),r=new N1(this._firestore);return super.get(e).then(s=>new Wk(this._firestore,r,t._key,s._document,new gh(!1,!1),t.converter))}}function Hk(n,e,t){n=ii(n,Ko);const r=Object.assign(Object.assign({},gJ),t);return function(i){if(i.maxAttempts<1)throw new Te(oe.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,a,o){const l=new Do;return i.asyncQueue.enqueueAndForget(async()=>{const u=await ZY(i);new QY(i.asyncQueue,u,o,a,l).au()}),l.promise}(c_(n),s=>e(new yJ(n,s)),r)}function mu(){return new Mk("serverTimestamp")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t7(n){return c_(n=ii(n,Ko)),new _J(n,e=>O1(n,e))}(function(e,t=!0){(function(s){Sf=s})(ed),Mc(new du("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),o=new Ko(new wK(r.getProvider("auth-internal")),new TK(r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Te(oe.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vg(u.options.projectId,h)}(a,s),a);return i=Object.assign({useFetchStreams:t},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Ha(tO,"4.7.3",e),Ha(tO,"4.7.3","esm2017")})();var VO={};const BO="@firebase/database",zO="1.0.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let n7="";function r7(n){n7=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vJ{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Sr(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:fg(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wJ{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Za(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s7=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new vJ(e)}}catch{}return new wJ},bc=s7("localStorage"),bJ=s7("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rh=new h1("@firebase/database"),EJ=function(){let n=1;return function(){return n++}}(),i7=function(n){const e=QG(n),t=new WG;t.update(e);const r=t.digest();return Wx.encodeByteArray(r)},p_=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=p_.apply(null,r):typeof r=="object"?e+=Sr(r):e+=r,e+=" "}return e};let Nm=null,GO=!0;const SJ=function(n,e){_e(!0,"Can't turn on custom loggers persistently."),Rh.logLevel=Et.VERBOSE,Nm=Rh.log.bind(Rh)},br=function(...n){if(GO===!0&&(GO=!1,Nm===null&&bJ.get("logging_enabled")===!0&&SJ()),Nm){const e=p_.apply(null,n);Nm(e)}},m_=function(n){return function(...e){br(n,...e)}},IC=function(...n){const e="FIREBASE INTERNAL ERROR: "+p_(...n);Rh.error(e)},Qo=function(...n){const e=`FIREBASE FATAL ERROR: ${p_(...n)}`;throw Rh.error(e),new Error(e)},bs=function(...n){const e="FIREBASE WARNING: "+p_(...n);Rh.warn(e)},TJ=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&bs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},L1=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},CJ=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Jh="[MIN_NAME]",Bc="[MAX_NAME]",id=function(n,e){if(n===e)return 0;if(n===Jh||e===Bc)return-1;if(e===Jh||n===Bc)return 1;{const t=WO(n),r=WO(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},IJ=function(n,e){return n===e?0:n<e?-1:1},jp=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Sr(e))},qk=function(n){if(typeof n!="object"||n===null)return Sr(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=Sr(e[r]),t+=":",t+=qk(n[e[r]]);return t+="}",t},a7=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function Cr(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const o7=function(n){_e(!L1(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,a,o,l;n===0?(i=0,a=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(o=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=o+r,a=Math.round(n*Math.pow(2,t-o)-Math.pow(2,t))):(i=0,a=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(l=t;l;l-=1)u.push(a%2?1:0),a=Math.floor(a/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(l=0;l<64;l+=8){let p=parseInt(h.substr(l,8),2).toString(16);p.length===1&&(p="0"+p),f=f+p}return f.toLowerCase()},xJ=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},kJ=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function PJ(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const AJ=new RegExp("^-?(0*)\\d{1,10}$"),RJ=-2147483648,NJ=2147483647,WO=function(n){if(AJ.test(n)){const e=Number(n);if(e>=RJ&&e<=NJ)return e}return null},xf=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw bs("Exception was thrown by user callback.",t),e},Math.floor(0))}},OJ=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Om=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LJ{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){bs(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MJ{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(br("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',bs(e)}}class Q0{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Q0.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kk="5",l7="v",u7="s",c7="r",d7="f",h7=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,f7="ls",p7="p",xC="ac",m7="websocket",g7="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _7{constructor(e,t,r,s,i=!1,a="",o=!1,l=!1){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=a,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=bc.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&bc.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function DJ(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function y7(n,e,t){_e(typeof e=="string","typeof type must == string"),_e(typeof t=="object","typeof params must == object");let r;if(e===m7)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===g7)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);DJ(n)&&(t.ns=n.namespace);const s=[];return Cr(t,(i,a)=>{s.push(i+"="+a)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FJ{constructor(){this.counters_={}}incrementCounter(e,t=1){Za(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return IG(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZS={},e2={};function Qk(n){const e=n.toString();return ZS[e]||(ZS[e]=new FJ),ZS[e]}function $J(n,e){const t=n.toString();return e2[t]||(e2[t]=e()),e2[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jJ{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&xf(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HO="start",UJ="close",VJ="pLPCommand",BJ="pRTLPCB",v7="id",w7="pw",b7="ser",zJ="cb",GJ="seg",WJ="ts",HJ="d",qJ="dframe",E7=1870,S7=30,KJ=E7-S7,QJ=25e3,YJ=3e4;class _h{constructor(e,t,r,s,i,a,o){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=a,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=m_(e),this.stats_=Qk(t),this.urlFn=l=>(this.appCheckToken&&(l[xC]=this.appCheckToken),y7(t,g7,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new jJ(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(YJ)),CJ(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Yk((...i)=>{const[a,o,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,a===HO)this.id=o,this.password=l;else if(a===UJ)o?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(o,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+a)},(...i)=>{const[a,o]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(a,o)},()=>{this.onClosed_()},this.urlFn);const r={};r[HO]="t",r[b7]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[zJ]=this.scriptTagHolder.uniqueCallbackIdentifier),r[l7]=Kk,this.transportSessionId&&(r[u7]=this.transportSessionId),this.lastSessionId&&(r[f7]=this.lastSessionId),this.applicationId&&(r[p7]=this.applicationId),this.appCheckToken&&(r[xC]=this.appCheckToken),typeof location<"u"&&location.hostname&&h7.test(location.hostname)&&(r[c7]=d7);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){_h.forceAllow_=!0}static forceDisallow(){_h.forceDisallow_=!0}static isAvailable(){return _h.forceAllow_?!0:!_h.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!xJ()&&!kJ()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Sr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=ML(t),s=a7(r,KJ);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[qJ]="t",r[v7]=e,r[w7]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Sr(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Yk{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=EJ(),window[VJ+this.uniqueCallbackIdentifier]=e,window[BJ+this.uniqueCallbackIdentifier]=t,this.myIFrame=Yk.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const a="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(o){br("frame writing exception"),o.stack&&br(o.stack),br(o)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||br("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[v7]=this.myID,e[w7]=this.myPW,e[b7]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+S7+r.length<=E7;){const a=this.pendingSegs.shift();r=r+"&"+GJ+s+"="+a.seg+"&"+WJ+s+"="+a.ts+"&"+HJ+s+"="+a.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(QJ)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{br("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JJ=16384,XJ=45e3;let ew=null;typeof MozWebSocket<"u"?ew=MozWebSocket:typeof WebSocket<"u"&&(ew=WebSocket);class ta{constructor(e,t,r,s,i,a,o){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=m_(this.connId),this.stats_=Qk(t),this.connURL=ta.connectionURL_(t,a,o,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const a={};return a[l7]=Kk,typeof location<"u"&&location.hostname&&h7.test(location.hostname)&&(a[c7]=d7),t&&(a[u7]=t),r&&(a[f7]=r),s&&(a[xC]=s),i&&(a[p7]=i),y7(e,m7,a)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,bc.set("previous_websocket_failure",!0);try{let r;DG(),this.mySock=new ew(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){ta.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&ew!==null&&!ta.forceDisallow_}static previouslyFailed(){return bc.isInMemoryStorage||bc.get("previous_websocket_failure")===!0}markConnectionHealthy(){bc.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=fg(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(_e(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=Sr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=a7(t,JJ);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(XJ))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ta.responsesRequiredToBeHealthy=2;ta.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cg{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[_h,ta]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=ta&&ta.isAvailable();let r=t&&!ta.previouslyFailed();if(e.webSocketOnly&&(t||bs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[ta];else{const s=this.transports_=[];for(const i of Cg.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);Cg.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Cg.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZJ=6e4,eX=5e3,tX=10*1024,nX=100*1024,t2="t",qO="d",rX="s",KO="r",sX="e",QO="o",YO="a",JO="n",XO="p",iX="h";class aX{constructor(e,t,r,s,i,a,o,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=a,this.onReady_=o,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=m_("c:"+this.id+":"),this.transportManager_=new Cg(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Om(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>nX?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>tX?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(t2 in e){const t=e[t2];t===YO?this.upgradeIfSecondaryHealthy_():t===KO?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===QO&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=jp("t",e),r=jp("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:XO,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:YO,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:JO,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=jp("t",e),r=jp("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=jp(t2,e);if(qO in e){const r=e[qO];if(t===iX){const s=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===JO){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===rX?this.onConnectionShutdown_(r):t===KO?this.onReset_(r):t===sX?IC("Server Error: "+r):t===QO?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):IC("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Kk!==r&&bs("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Om(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(ZJ))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Om(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(eX))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:XO,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(bc.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T7{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let C7=class{constructor(e){this.allowedEvents_=e,this.listeners_={},_e(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){_e(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tw extends C7{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Hx()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new tw}getInitialEvent(e){return _e(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZO=32,e3=768;let Kt=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function Ut(){return new Kt("")}function dt(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function gu(n){return n.pieces_.length-n.pieceNum_}function tn(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Kt(n.pieces_,e)}function Jk(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function oX(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Ig(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function I7(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Kt(e,0)}function yn(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof Kt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new Kt(t,0)}function pt(n){return n.pieceNum_>=n.pieces_.length}function Bs(n,e){const t=dt(n),r=dt(e);if(t===null)return e;if(t===r)return Bs(tn(n),tn(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function lX(n,e){const t=Ig(n,0),r=Ig(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=id(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function Xk(n,e){if(gu(n)!==gu(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Ii(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(gu(n)>gu(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class uX{constructor(e,t){this.errorPrefix_=t,this.parts_=Ig(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=d1(this.parts_[r]);x7(this)}}function cX(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=d1(e),x7(n)}function dX(n){const e=n.parts_.pop();n.byteLength_-=d1(e),n.parts_.length>0&&(n.byteLength_-=1)}function x7(n){if(n.byteLength_>e3)throw new Error(n.errorPrefix_+"has a key path longer than "+e3+" bytes ("+n.byteLength_+").");if(n.parts_.length>ZO)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ZO+") or object contains a cycle "+hc(n))}function hc(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zk extends C7{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new Zk}getInitialEvent(e){return _e(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Up=1e3,hX=60*5*1e3,t3=30*1e3,fX=1.3,pX=3e4,mX="server_kill",n3=3;class Fo extends T7{constructor(e,t,r,s,i,a,o,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=a,this.appCheckTokenProvider_=o,this.authOverride_=l,this.id=Fo.nextPersistentConnectionId_++,this.log_=m_("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Up,this.maxReconnectDelay_=hX,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Zk.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&tw.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(Sr(i)),_e(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new ja,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:a=>{const o=a.d;a.s==="ok"?t.resolve(o):t.reject(o)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+i),this.listens.has(a)||this.listens.set(a,new Map),_e(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),_e(!this.listens.get(a).has(i),"listen() called twice for same path/queryId.");const o={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(a).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},a="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(a,i,o=>{const l=o.d,u=o.s;Fo.warnOnListenWarnings_(l,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",o),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Za(e,"w")){const r=zh(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();bs(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||GG(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=t3)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=zG(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,a=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),_e(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},a="n";s&&(i.q=r,i.t=s),this.sendRequest(a,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const a={p:t,d:r};i!==void 0&&(a.h=i),this.outstandingPuts_.push({action:e,request:a,onComplete:s}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Sr(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):IC("Unrecognized action received from server: "+Sr(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){_e(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Up,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Up,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>pX&&(this.reconnectDelay_=Up),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*fX)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Fo.nextConnectionId_++,i=this.lastSessionId;let a=!1,o=null;const l=function(){o?o.close():(a=!0,r())},u=function(f){_e(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(f)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,p]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);a?br("getToken() completed but was canceled"):(br("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=p&&p.token,o=new aX(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,y=>{bs(y+" ("+this.repoInfo_.toString()+")"),this.interrupt(mX)},i))}catch(f){this.log_("Failed to get token: "+f),a||(this.repoInfo_.nodeAdmin&&bs(f),l())}}}interrupt(e){br("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){br("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Dv(this.interruptReasons_)&&(this.reconnectDelay_=Up,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>qk(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new Kt(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){br("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=n3&&(this.reconnectDelay_=t3,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){br("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=n3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+n7.replace(/\./g,"-")]=1,Hx()?e["framework.cordova"]=1:BL()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=tw.getInstance().currentlyOnline();return Dv(this.interruptReasons_)&&e}}Fo.nextPersistentConnectionId_=0;Fo.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new mt(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M1{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new mt(Jh,e),s=new mt(Jh,t);return this.compare(r,s)!==0}minPost(){return mt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e0;class k7 extends M1{static get __EMPTY_NODE(){return e0}static set __EMPTY_NODE(e){e0=e}compare(e,t){return id(e.name,t.name)}isDefinedOn(e){throw wf("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return mt.MIN}maxPost(){return new mt(Bc,e0)}makePost(e,t){return _e(typeof e=="string","KeyIndex indexValue must always be a string."),new mt(e,e0)}toString(){return".key"}}const Nh=new k7;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t0{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let a=1;for(;!e.isEmpty();)if(e=e,a=t?r(e.key,t):1,s&&(a*=-1),a<0)this.isReverse_?e=e.left:e=e.right;else if(a===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class vr{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??vr.RED,this.left=s??zs.EMPTY_NODE,this.right=i??zs.EMPTY_NODE}copy(e,t,r,s,i){return new vr(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return zs.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return zs.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,vr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,vr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}vr.RED=!0;vr.BLACK=!1;class gX{copy(e,t,r,s,i){return this}insert(e,t,r){return new vr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class zs{constructor(e,t=zs.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new zs(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,vr.BLACK,null,null))}remove(e){return new zs(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,vr.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new t0(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new t0(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new t0(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new t0(this.root_,null,this.comparator_,!0,e)}}zs.EMPTY_NODE=new gX;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _X(n,e){return id(n.name,e.name)}function eP(n,e){return id(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kC;function yX(n){kC=n}const P7=function(n){return typeof n=="number"?"number:"+o7(n):"string:"+n},A7=function(n){if(n.isLeafNode()){const e=n.val();_e(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Za(e,".sv"),"Priority must be a string or number.")}else _e(n===kC||n.isEmpty(),"priority of unexpected type.");_e(n===kC||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r3;class gr{constructor(e,t=gr.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,_e(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),A7(this.priorityNode_)}static set __childrenNodeConstructor(e){r3=e}static get __childrenNodeConstructor(){return r3}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new gr(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:gr.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return pt(e)?this:dt(e)===".priority"?this.priorityNode_:gr.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:gr.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=dt(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(_e(r!==".priority"||gu(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,gr.__childrenNodeConstructor.EMPTY_NODE.updateChild(tn(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+P7(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=o7(this.value_):e+=this.value_,this.lazyHash_=i7(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===gr.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof gr.__childrenNodeConstructor?-1:(_e(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=gr.VALUE_TYPE_ORDER.indexOf(t),i=gr.VALUE_TYPE_ORDER.indexOf(r);return _e(s>=0,"Unknown leaf type: "+t),_e(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}gr.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let R7,N7;function vX(n){R7=n}function wX(n){N7=n}class bX extends M1{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?id(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return mt.MIN}maxPost(){return new mt(Bc,new gr("[PRIORITY-POST]",N7))}makePost(e,t){const r=R7(e);return new mt(t,new gr("[PRIORITY-POST]",r))}toString(){return".priority"}}const vn=new bX;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EX=Math.log(2);class SX{constructor(e){const t=i=>parseInt(Math.log(i)/EX,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const nw=function(n,e,t,r){n.sort(e);const s=function(l,u){const h=u-l;let f,p;if(h===0)return null;if(h===1)return f=n[l],p=t?t(f):f,new vr(p,f.node,vr.BLACK,null,null);{const y=parseInt(h/2,10)+l,_=s(l,y),b=s(y+1,u);return f=n[y],p=t?t(f):f,new vr(p,f.node,vr.BLACK,_,b)}},i=function(l){let u=null,h=null,f=n.length;const p=function(_,b){const S=f-_,E=f;f-=_;const C=s(S+1,E),v=n[S],I=t?t(v):v;y(new vr(I,v.node,b,null,C))},y=function(_){u?(u.left=_,u=_):(h=_,u=_)};for(let _=0;_<l.count;++_){const b=l.nextBitIsOne(),S=Math.pow(2,l.count-(_+1));b?p(S,vr.BLACK):(p(S,vr.BLACK),p(S,vr.RED))}return h},a=new SX(n.length),o=i(a);return new zs(r||e,o)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let n2;const Ud={};class No{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return _e(Ud&&vn,"ChildrenNode.ts has not been loaded"),n2=n2||new No({".priority":Ud},{".priority":vn}),n2}get(e){const t=zh(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof zs?t:null}hasIndex(e){return Za(this.indexSet_,e.toString())}addIndex(e,t){_e(e!==Nh,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(mt.Wrap);let a=i.getNext();for(;a;)s=s||e.isDefinedOn(a.node),r.push(a),a=i.getNext();let o;s?o=nw(r,e.getCompare()):o=Ud;const l=e.toString(),u=Object.assign({},this.indexSet_);u[l]=e;const h=Object.assign({},this.indexes_);return h[l]=o,new No(h,u)}addToIndexes(e,t){const r=Fv(this.indexes_,(s,i)=>{const a=zh(this.indexSet_,i);if(_e(a,"Missing index implementation for "+i),s===Ud)if(a.isDefinedOn(e.node)){const o=[],l=t.getIterator(mt.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&o.push(u),u=l.getNext();return o.push(e),nw(o,a.getCompare())}else return Ud;else{const o=t.get(e.name);let l=s;return o&&(l=l.remove(new mt(e.name,o))),l.insert(e,e.node)}});return new No(r,this.indexSet_)}removeFromIndexes(e,t){const r=Fv(this.indexes_,s=>{if(s===Ud)return s;{const i=t.get(e.name);return i?s.remove(new mt(e.name,i)):s}});return new No(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vp;class Je{constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&A7(this.priorityNode_),this.children_.isEmpty()&&_e(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Vp||(Vp=new Je(new zs(eP),null,No.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Vp}updatePriority(e){return this.children_.isEmpty()?this:new Je(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Vp:t}}getChild(e){const t=dt(e);return t===null?this:this.getImmediateChild(t).getChild(tn(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(_e(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new mt(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const a=s.isEmpty()?Vp:this.priorityNode_;return new Je(s,a,i)}}updateChild(e,t){const r=dt(e);if(r===null)return t;{_e(dt(e)!==".priority"||gu(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(tn(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild(vn,(a,o)=>{t[a]=o.val(e),r++,i&&Je.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):i=!1}),!e&&i&&s<2*r){const a=[];for(const o in t)a[o]=t[o];return a}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+P7(this.getPriority().val())+":"),this.forEachChild(vn,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":i7(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new mt(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new mt(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new mt(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,mt.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,mt.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===g_?-1:0}withIndex(e){if(e===Nh||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Je(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Nh||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(vn),s=t.getIterator(vn);let i=r.getNext(),a=s.getNext();for(;i&&a;){if(i.name!==a.name||!i.node.equals(a.node))return!1;i=r.getNext(),a=s.getNext()}return i===null&&a===null}else return!1;else return!1}}resolveIndex_(e){return e===Nh?null:this.indexMap_.get(e.toString())}}Je.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class TX extends Je{constructor(){super(new zs(eP),Je.EMPTY_NODE,No.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Je.EMPTY_NODE}isEmpty(){return!1}}const g_=new TX;Object.defineProperties(mt,{MIN:{value:new mt(Jh,Je.EMPTY_NODE)},MAX:{value:new mt(Bc,g_)}});k7.__EMPTY_NODE=Je.EMPTY_NODE;gr.__childrenNodeConstructor=Je;yX(g_);wX(g_);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CX=!0;function Rn(n,e=null){if(n===null)return Je.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),_e(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new gr(t,Rn(e))}if(!(n instanceof Array)&&CX){const t=[];let r=!1;if(Cr(n,(a,o)=>{if(a.substring(0,1)!=="."){const l=Rn(o);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new mt(a,l)))}}),t.length===0)return Je.EMPTY_NODE;const i=nw(t,_X,a=>a.name,eP);if(r){const a=nw(t,vn.getCompare());return new Je(i,Rn(e),new No({".priority":a},{".priority":vn}))}else return new Je(i,Rn(e),No.Default)}else{let t=Je.EMPTY_NODE;return Cr(n,(r,s)=>{if(Za(n,r)&&r.substring(0,1)!=="."){const i=Rn(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(Rn(e))}}vX(Rn);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IX extends M1{constructor(e){super(),this.indexPath_=e,_e(!pt(e)&&dt(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?id(e.name,t.name):i}makePost(e,t){const r=Rn(e),s=Je.EMPTY_NODE.updateChild(this.indexPath_,r);return new mt(t,s)}maxPost(){const e=Je.EMPTY_NODE.updateChild(this.indexPath_,g_);return new mt(Bc,e)}toString(){return Ig(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xX extends M1{compare(e,t){const r=e.node.compareTo(t.node);return r===0?id(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return mt.MIN}maxPost(){return mt.MAX}makePost(e,t){const r=Rn(e);return new mt(t,r)}toString(){return".value"}}const kX=new xX;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O7(n){return{type:"value",snapshotNode:n}}function Xh(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function xg(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function kg(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function PX(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tP{constructor(e){this.index_=e}updateChild(e,t,r,s,i,a){_e(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(s).equals(r.getChild(s))&&o.isEmpty()===r.isEmpty()||(a!=null&&(r.isEmpty()?e.hasChild(t)?a.trackChildChange(xg(t,o)):_e(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?a.trackChildChange(Xh(t,r)):a.trackChildChange(kg(t,r,o))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(vn,(s,i)=>{t.hasChild(s)||r.trackChildChange(xg(s,i))}),t.isLeafNode()||t.forEachChild(vn,(s,i)=>{if(e.hasChild(s)){const a=e.getImmediateChild(s);a.equals(i)||r.trackChildChange(kg(s,i,a))}else r.trackChildChange(Xh(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Je.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(e){this.indexedFilter_=new tP(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Pg.getStartPost_(e),this.endPost_=Pg.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,a){return this.matches(new mt(t,r))||(r=Je.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,a)}updateFullNode(e,t,r){t.isLeafNode()&&(t=Je.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(Je.EMPTY_NODE);const i=this;return t.forEachChild(vn,(a,o)=>{i.matches(new mt(a,o))||(s=s.updateImmediateChild(a,Je.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AX{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Pg(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,a){return this.rangedFilter_.matches(new mt(t,r))||(r=Je.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,a):this.fullLimitUpdateChild_(e,t,r,i,a)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=Je.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=Je.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;i.hasNext()&&a<this.limit_;){const o=i.getNext();if(this.withinDirectionalStart(o))if(this.withinDirectionalEnd(o))s=s.updateImmediateChild(o.name,o.node),a++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(Je.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let a=0;for(;i.hasNext();){const o=i.getNext();a<this.limit_&&this.withinDirectionalStart(o)&&this.withinDirectionalEnd(o)?a++:s=s.updateImmediateChild(o.name,Je.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let a;if(this.reverse_){const f=this.index_.getCompare();a=(p,y)=>f(y,p)}else a=this.index_.getCompare();const o=e;_e(o.numChildren()===this.limit_,"");const l=new mt(t,r),u=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(o.hasChild(t)){const f=o.getImmediateChild(t);let p=s.getChildAfterChild(this.index_,u,this.reverse_);for(;p!=null&&(p.name===t||o.hasChild(p.name));)p=s.getChildAfterChild(this.index_,p,this.reverse_);const y=p==null?1:a(p,l);if(h&&!r.isEmpty()&&y>=0)return i!=null&&i.trackChildChange(kg(t,r,f)),o.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(xg(t,f));const b=o.updateImmediateChild(t,Je.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(i!=null&&i.trackChildChange(Xh(p.name,p.node)),b.updateImmediateChild(p.name,p.node)):b}}else return r.isEmpty()?e:h&&a(u,l)>=0?(i!=null&&(i.trackChildChange(xg(u.name,u.node)),i.trackChildChange(Xh(t,r))),o.updateImmediateChild(t,r).updateImmediateChild(u.name,Je.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=vn}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return _e(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return _e(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Jh}hasEnd(){return this.endSet_}getIndexEndValue(){return _e(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return _e(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Bc}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return _e(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===vn}copy(){const e=new D1;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function RX(n){return n.loadsAllData()?new tP(n.getIndex()):n.hasLimit()?new AX(n):new Pg(n)}function s3(n){const e={};if(n.isDefault())return e;let t;if(n.index_===vn?t="$priority":n.index_===kX?t="$value":n.index_===Nh?t="$key":(_e(n.index_ instanceof IX,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Sr(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=Sr(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+Sr(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=Sr(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+Sr(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function i3(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==vn&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rw extends T7{constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=m_("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(_e(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const a=rw.getListenId_(e,r),o={};this.listens_[a]=o;const l=s3(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),zh(this.listens_,a)===o){let p;u?u===401?p="permission_denied":p="rest_error:"+u:p="ok",s(p,null)}})}unlisten(e,t){const r=rw.getListenId_(e,t);delete this.listens_[r]}get(e){const t=s3(e._queryParams),r=e._path.toString(),s=new ja;return this.restRequest_(r+".json",t,(i,a)=>{let o=a;i===404&&(o=null,i=null),i===null?(this.onDataUpdate_(r,o,!1,null),s.resolve(o)):s.reject(new Error(o))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const a=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+bf(t);this.log_("Sending REST request for "+a);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(r&&o.readyState===4){this.log_("REST Response for "+a+" received. status:",o.status,"response:",o.responseText);let l=null;if(o.status>=200&&o.status<300){try{l=fg(o.responseText)}catch{bs("Failed to parse JSON response for "+a+": "+o.responseText)}r(null,l)}else o.status!==401&&o.status!==404&&bs("Got unsuccessful REST response for "+a+" Status: "+o.status),r(o.status);r=null}},o.open("GET",a,!0),o.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NX{constructor(){this.rootNode_=Je.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sw(){return{value:null,children:new Map}}function kf(n,e,t){if(pt(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=dt(e);n.children.has(r)||n.children.set(r,sw());const s=n.children.get(r);e=tn(e),kf(s,e,t)}}function PC(n,e){if(pt(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(vn,(r,s)=>{kf(n,new Kt(r),s)}),PC(n,e)}}else if(n.children.size>0){const t=dt(e);return e=tn(e),n.children.has(t)&&PC(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function AC(n,e,t){n.value!==null?t(e,n.value):OX(n,(r,s)=>{const i=new Kt(e.toString()+"/"+r);AC(s,i,t)})}function OX(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LX{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Cr(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a3=10*1e3,MX=30*1e3,DX=5*60*1e3;class FX{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new LX(e);const r=a3+(MX-a3)*Math.random();Om(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Cr(e,(s,i)=>{i>0&&Za(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),Om(this.reportStats_.bind(this),Math.floor(Math.random()*2*DX))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ra;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(ra||(ra={}));function nP(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function rP(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function sP(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=ra.ACK_USER_WRITE,this.source=nP()}operationForChild(e){if(pt(this.path)){if(this.affectedTree.value!=null)return _e(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Kt(e));return new iw(Ut(),t,this.revert)}}else return _e(dt(this.path)===e,"operationForChild called for unrelated child."),new iw(tn(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag{constructor(e,t){this.source=e,this.path=t,this.type=ra.LISTEN_COMPLETE}operationForChild(e){return pt(this.path)?new Ag(this.source,Ut()):new Ag(this.source,tn(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zc{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=ra.OVERWRITE}operationForChild(e){return pt(this.path)?new zc(this.source,Ut(),this.snap.getImmediateChild(e)):new zc(this.source,tn(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zh{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=ra.MERGE}operationForChild(e){if(pt(this.path)){const t=this.children.subtree(new Kt(e));return t.isEmpty()?null:t.value?new zc(this.source,Ut(),t.value):new Zh(this.source,Ut(),t)}else return _e(dt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Zh(this.source,tn(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(pt(e))return this.isFullyInitialized()&&!this.filtered_;const t=dt(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $X{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function jX(n,e,t,r){const s=[],i=[];return e.forEach(a=>{a.type==="child_changed"&&n.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&i.push(PX(a.childName,a.snapshotNode))}),Bp(n,s,"child_removed",e,r,t),Bp(n,s,"child_added",e,r,t),Bp(n,s,"child_moved",i,r,t),Bp(n,s,"child_changed",e,r,t),Bp(n,s,"value",e,r,t),s}function Bp(n,e,t,r,s,i){const a=r.filter(o=>o.type===t);a.sort((o,l)=>VX(n,o,l)),a.forEach(o=>{const l=UX(n,o,i);s.forEach(u=>{u.respondsTo(o.type)&&e.push(u.createEvent(l,n.query_))})})}function UX(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function VX(n,e,t){if(e.childName==null||t.childName==null)throw wf("Should only compare child_ events.");const r=new mt(e.childName,e.snapshotNode),s=new mt(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F1(n,e){return{eventCache:n,serverCache:e}}function Lm(n,e,t,r){return F1(new Gc(e,t,r),n.serverCache)}function L7(n,e,t,r){return F1(n.eventCache,new Gc(e,t,r))}function RC(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Wc(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r2;const BX=()=>(r2||(r2=new zs(IJ)),r2);class sn{constructor(e,t=BX()){this.value=e,this.children=t}static fromObject(e){let t=new sn(null);return Cr(e,(r,s)=>{t=t.set(new Kt(r),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ut(),value:this.value};if(pt(e))return null;{const r=dt(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(tn(e),t);return i!=null?{path:yn(new Kt(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(pt(e))return this;{const t=dt(e),r=this.children.get(t);return r!==null?r.subtree(tn(e)):new sn(null)}}set(e,t){if(pt(e))return new sn(t,this.children);{const r=dt(e),i=(this.children.get(r)||new sn(null)).set(tn(e),t),a=this.children.insert(r,i);return new sn(this.value,a)}}remove(e){if(pt(e))return this.children.isEmpty()?new sn(null):new sn(null,this.children);{const t=dt(e),r=this.children.get(t);if(r){const s=r.remove(tn(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new sn(null):new sn(this.value,i)}else return this}}get(e){if(pt(e))return this.value;{const t=dt(e),r=this.children.get(t);return r?r.get(tn(e)):null}}setTree(e,t){if(pt(e))return t;{const r=dt(e),i=(this.children.get(r)||new sn(null)).setTree(tn(e),t);let a;return i.isEmpty()?a=this.children.remove(r):a=this.children.insert(r,i),new sn(this.value,a)}}fold(e){return this.fold_(Ut(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(yn(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Ut(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(pt(e))return null;{const i=dt(e),a=this.children.get(i);return a?a.findOnPath_(tn(e),yn(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ut(),t)}foreachOnPath_(e,t,r){if(pt(e))return this;{this.value&&r(t,this.value);const s=dt(e),i=this.children.get(s);return i?i.foreachOnPath_(tn(e),yn(t,s),r):new sn(null)}}foreach(e){this.foreach_(Ut(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(yn(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e){this.writeTree_=e}static empty(){return new oa(new sn(null))}}function Mm(n,e,t){if(pt(e))return new oa(new sn(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const a=Bs(s,e);return i=i.updateChild(a,t),new oa(n.writeTree_.set(s,i))}else{const s=new sn(t),i=n.writeTree_.setTree(e,s);return new oa(i)}}}function NC(n,e,t){let r=n;return Cr(t,(s,i)=>{r=Mm(r,yn(e,s),i)}),r}function o3(n,e){if(pt(e))return oa.empty();{const t=n.writeTree_.setTree(e,new sn(null));return new oa(t)}}function OC(n,e){return ad(n,e)!=null}function ad(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Bs(t.path,e)):null}function l3(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(vn,(r,s)=>{e.push(new mt(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new mt(r,s.value))}),e}function au(n,e){if(pt(e))return n;{const t=ad(n,e);return t!=null?new oa(new sn(t)):new oa(n.writeTree_.subtree(e))}}function LC(n){return n.writeTree_.isEmpty()}function ef(n,e){return M7(Ut(),n.writeTree_,e)}function M7(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(_e(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=M7(yn(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(yn(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iP(n,e){return j7(e,n)}function zX(n,e,t,r,s){_e(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=Mm(n.visibleWrites,e,t)),n.lastWriteId=r}function GX(n,e,t,r){_e(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=NC(n.visibleWrites,e,t),n.lastWriteId=r}function WX(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function HX(n,e){const t=n.allWrites.findIndex(o=>o.writeId===e);_e(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,a=n.allWrites.length-1;for(;s&&a>=0;){const o=n.allWrites[a];o.visible&&(a>=t&&qX(o,r.path)?s=!1:Ii(r.path,o.path)&&(i=!0)),a--}if(s){if(i)return KX(n),!0;if(r.snap)n.visibleWrites=o3(n.visibleWrites,r.path);else{const o=r.children;Cr(o,l=>{n.visibleWrites=o3(n.visibleWrites,yn(r.path,l))})}return!0}else return!1}function qX(n,e){if(n.snap)return Ii(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Ii(yn(n.path,t),e))return!0;return!1}function KX(n){n.visibleWrites=D7(n.allWrites,QX,Ut()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function QX(n){return n.visible}function D7(n,e,t){let r=oa.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const a=i.path;let o;if(i.snap)Ii(t,a)?(o=Bs(t,a),r=Mm(r,o,i.snap)):Ii(a,t)&&(o=Bs(a,t),r=Mm(r,Ut(),i.snap.getChild(o)));else if(i.children){if(Ii(t,a))o=Bs(t,a),r=NC(r,o,i.children);else if(Ii(a,t))if(o=Bs(a,t),pt(o))r=NC(r,Ut(),i.children);else{const l=zh(i.children,dt(o));if(l){const u=l.getChild(tn(o));r=Mm(r,Ut(),u)}}}else throw wf("WriteRecord should have .snap or .children")}}return r}function F7(n,e,t,r,s){if(!r&&!s){const i=ad(n.visibleWrites,e);if(i!=null)return i;{const a=au(n.visibleWrites,e);if(LC(a))return t;if(t==null&&!OC(a,Ut()))return null;{const o=t||Je.EMPTY_NODE;return ef(a,o)}}}else{const i=au(n.visibleWrites,e);if(!s&&LC(i))return t;if(!s&&t==null&&!OC(i,Ut()))return null;{const a=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(Ii(u.path,e)||Ii(e,u.path))},o=D7(n.allWrites,a,e),l=t||Je.EMPTY_NODE;return ef(o,l)}}}function YX(n,e,t){let r=Je.EMPTY_NODE;const s=ad(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(vn,(i,a)=>{r=r.updateImmediateChild(i,a)}),r;if(t){const i=au(n.visibleWrites,e);return t.forEachChild(vn,(a,o)=>{const l=ef(au(i,new Kt(a)),o);r=r.updateImmediateChild(a,l)}),l3(i).forEach(a=>{r=r.updateImmediateChild(a.name,a.node)}),r}else{const i=au(n.visibleWrites,e);return l3(i).forEach(a=>{r=r.updateImmediateChild(a.name,a.node)}),r}}function JX(n,e,t,r,s){_e(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=yn(e,t);if(OC(n.visibleWrites,i))return null;{const a=au(n.visibleWrites,i);return LC(a)?s.getChild(t):ef(a,s.getChild(t))}}function XX(n,e,t,r){const s=yn(e,t),i=ad(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const a=au(n.visibleWrites,s);return ef(a,r.getNode().getImmediateChild(t))}else return null}function ZX(n,e){return ad(n.visibleWrites,e)}function eZ(n,e,t,r,s,i,a){let o;const l=au(n.visibleWrites,e),u=ad(l,Ut());if(u!=null)o=u;else if(t!=null)o=ef(l,t);else return[];if(o=o.withIndex(a),!o.isEmpty()&&!o.isLeafNode()){const h=[],f=a.getCompare(),p=i?o.getReverseIteratorFrom(r,a):o.getIteratorFrom(r,a);let y=p.getNext();for(;y&&h.length<s;)f(y,r)!==0&&h.push(y),y=p.getNext();return h}else return[]}function tZ(){return{visibleWrites:oa.empty(),allWrites:[],lastWriteId:-1}}function aw(n,e,t,r){return F7(n.writeTree,n.treePath,e,t,r)}function aP(n,e){return YX(n.writeTree,n.treePath,e)}function u3(n,e,t,r){return JX(n.writeTree,n.treePath,e,t,r)}function ow(n,e){return ZX(n.writeTree,yn(n.treePath,e))}function nZ(n,e,t,r,s,i){return eZ(n.writeTree,n.treePath,e,t,r,s,i)}function oP(n,e,t){return XX(n.writeTree,n.treePath,e,t)}function $7(n,e){return j7(yn(n.treePath,e),n.writeTree)}function j7(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rZ{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;_e(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),_e(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,kg(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,xg(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,Xh(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,kg(r,e.snapshotNode,s.oldSnap));else throw wf("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sZ{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const U7=new sZ;class lP{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Gc(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return oP(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Wc(this.viewCache_),i=nZ(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iZ(n){return{filter:n}}function aZ(n,e){_e(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),_e(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function oZ(n,e,t,r,s){const i=new rZ;let a,o;if(t.type===ra.OVERWRITE){const u=t;u.source.fromUser?a=MC(n,e,u.path,u.snap,r,s,i):(_e(u.source.fromServer,"Unknown source."),o=u.source.tagged||e.serverCache.isFiltered()&&!pt(u.path),a=lw(n,e,u.path,u.snap,r,s,o,i))}else if(t.type===ra.MERGE){const u=t;u.source.fromUser?a=uZ(n,e,u.path,u.children,r,s,i):(_e(u.source.fromServer,"Unknown source."),o=u.source.tagged||e.serverCache.isFiltered(),a=DC(n,e,u.path,u.children,r,s,o,i))}else if(t.type===ra.ACK_USER_WRITE){const u=t;u.revert?a=hZ(n,e,u.path,r,s,i):a=cZ(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===ra.LISTEN_COMPLETE)a=dZ(n,e,t.path,r,i);else throw wf("Unknown operation type: "+t.type);const l=i.getChanges();return lZ(e,a,l),{viewCache:a,changes:l}}function lZ(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=RC(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(O7(RC(e)))}}function V7(n,e,t,r,s,i){const a=e.eventCache;if(ow(r,t)!=null)return e;{let o,l;if(pt(t))if(_e(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=Wc(e),h=u instanceof Je?u:Je.EMPTY_NODE,f=aP(r,h);o=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=aw(r,Wc(e));o=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=dt(t);if(u===".priority"){_e(gu(t)===1,"Can't have a priority with additional path components");const h=a.getNode();l=e.serverCache.getNode();const f=u3(r,t,h,l);f!=null?o=n.filter.updatePriority(h,f):o=a.getNode()}else{const h=tn(t);let f;if(a.isCompleteForChild(u)){l=e.serverCache.getNode();const p=u3(r,t,a.getNode(),l);p!=null?f=a.getNode().getImmediateChild(u).updateChild(h,p):f=a.getNode().getImmediateChild(u)}else f=oP(r,u,e.serverCache);f!=null?o=n.filter.updateChild(a.getNode(),u,f,h,s,i):o=a.getNode()}}return Lm(e,o,a.isFullyInitialized()||pt(t),n.filter.filtersNodes())}}function lw(n,e,t,r,s,i,a,o){const l=e.serverCache;let u;const h=a?n.filter:n.filter.getIndexedFilter();if(pt(t))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const y=l.getNode().updateChild(t,r);u=h.updateFullNode(l.getNode(),y,null)}else{const y=dt(t);if(!l.isCompleteForPath(t)&&gu(t)>1)return e;const _=tn(t),S=l.getNode().getImmediateChild(y).updateChild(_,r);y===".priority"?u=h.updatePriority(l.getNode(),S):u=h.updateChild(l.getNode(),y,S,_,U7,null)}const f=L7(e,u,l.isFullyInitialized()||pt(t),h.filtersNodes()),p=new lP(s,f,i);return V7(n,f,t,s,p,o)}function MC(n,e,t,r,s,i,a){const o=e.eventCache;let l,u;const h=new lP(s,e,i);if(pt(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,a),l=Lm(e,u,!0,n.filter.filtersNodes());else{const f=dt(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),l=Lm(e,u,o.isFullyInitialized(),o.isFiltered());else{const p=tn(t),y=o.getNode().getImmediateChild(f);let _;if(pt(p))_=r;else{const b=h.getCompleteChild(f);b!=null?Jk(p)===".priority"&&b.getChild(I7(p)).isEmpty()?_=b:_=b.updateChild(p,r):_=Je.EMPTY_NODE}if(y.equals(_))l=e;else{const b=n.filter.updateChild(o.getNode(),f,_,p,h,a);l=Lm(e,b,o.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function c3(n,e){return n.eventCache.isCompleteForChild(e)}function uZ(n,e,t,r,s,i,a){let o=e;return r.foreach((l,u)=>{const h=yn(t,l);c3(e,dt(h))&&(o=MC(n,o,h,u,s,i,a))}),r.foreach((l,u)=>{const h=yn(t,l);c3(e,dt(h))||(o=MC(n,o,h,u,s,i,a))}),o}function d3(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function DC(n,e,t,r,s,i,a,o){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;pt(t)?u=r:u=new sn(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,p)=>{if(h.hasChild(f)){const y=e.serverCache.getNode().getImmediateChild(f),_=d3(n,y,p);l=lw(n,l,new Kt(f),_,s,i,a,o)}}),u.children.inorderTraversal((f,p)=>{const y=!e.serverCache.isCompleteForChild(f)&&p.value===null;if(!h.hasChild(f)&&!y){const _=e.serverCache.getNode().getImmediateChild(f),b=d3(n,_,p);l=lw(n,l,new Kt(f),b,s,i,a,o)}}),l}function cZ(n,e,t,r,s,i,a){if(ow(s,t)!=null)return e;const o=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(pt(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return lw(n,e,t,l.getNode().getChild(t),s,i,o,a);if(pt(t)){let u=new sn(null);return l.getNode().forEachChild(Nh,(h,f)=>{u=u.set(new Kt(h),f)}),DC(n,e,t,u,s,i,o,a)}else return e}else{let u=new sn(null);return r.foreach((h,f)=>{const p=yn(t,h);l.isCompleteForPath(p)&&(u=u.set(h,l.getNode().getChild(p)))}),DC(n,e,t,u,s,i,o,a)}}function dZ(n,e,t,r,s){const i=e.serverCache,a=L7(e,i.getNode(),i.isFullyInitialized()||pt(t),i.isFiltered());return V7(n,a,t,r,U7,s)}function hZ(n,e,t,r,s,i){let a;if(ow(r,t)!=null)return e;{const o=new lP(r,e,s),l=e.eventCache.getNode();let u;if(pt(t)||dt(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=aw(r,Wc(e));else{const f=e.serverCache.getNode();_e(f instanceof Je,"serverChildren would be complete if leaf node"),h=aP(r,f)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=dt(t);let f=oP(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=l.getImmediateChild(h)),f!=null?u=n.filter.updateChild(l,h,f,tn(t),o,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,Je.EMPTY_NODE,tn(t),o,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(a=aw(r,Wc(e)),a.isLeafNode()&&(u=n.filter.updateFullNode(u,a,i)))}return a=e.serverCache.isFullyInitialized()||ow(r,Ut())!=null,Lm(e,u,a,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fZ{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new tP(r.getIndex()),i=RX(r);this.processor_=iZ(i);const a=t.serverCache,o=t.eventCache,l=s.updateFullNode(Je.EMPTY_NODE,a.getNode(),null),u=i.updateFullNode(Je.EMPTY_NODE,o.getNode(),null),h=new Gc(l,a.isFullyInitialized(),s.filtersNodes()),f=new Gc(u,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=F1(f,h),this.eventGenerator_=new $X(this.query_)}get query(){return this.query_}}function pZ(n){return n.viewCache_.serverCache.getNode()}function mZ(n,e){const t=Wc(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!pt(e)&&!t.getImmediateChild(dt(e)).isEmpty())?t.getChild(e):null}function h3(n){return n.eventRegistrations_.length===0}function gZ(n,e){n.eventRegistrations_.push(e)}function f3(n,e,t){const r=[];if(t){_e(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const a=i.createCancelEvent(t,s);a&&r.push(a)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const a=n.eventRegistrations_[i];if(!a.matches(e))s.push(a);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function p3(n,e,t,r){e.type===ra.MERGE&&e.source.queryId!==null&&(_e(Wc(n.viewCache_),"We should always have a full cache before handling merges"),_e(RC(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=oZ(n.processor_,s,e,t,r);return aZ(n.processor_,i.viewCache),_e(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,B7(n,i.changes,i.viewCache.eventCache.getNode(),null)}function _Z(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(vn,(i,a)=>{r.push(Xh(i,a))}),t.isFullyInitialized()&&r.push(O7(t.getNode())),B7(n,r,t.getNode(),e)}function B7(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return jX(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uw;class yZ{constructor(){this.views=new Map}}function vZ(n){_e(!uw,"__referenceConstructor has already been defined"),uw=n}function wZ(){return _e(uw,"Reference.ts has not been loaded"),uw}function bZ(n){return n.views.size===0}function uP(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return _e(i!=null,"SyncTree gave us an op for an invalid query."),p3(i,e,t,r)}else{let i=[];for(const a of n.views.values())i=i.concat(p3(a,e,t,r));return i}}function EZ(n,e,t,r,s){const i=e._queryIdentifier,a=n.views.get(i);if(!a){let o=aw(t,s?r:null),l=!1;o?l=!0:r instanceof Je?(o=aP(t,r),l=!1):(o=Je.EMPTY_NODE,l=!1);const u=F1(new Gc(o,l,!1),new Gc(r,s,!1));return new fZ(e,u)}return a}function SZ(n,e,t,r,s,i){const a=EZ(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,a),gZ(a,t),_Z(a,t)}function TZ(n,e,t,r){const s=e._queryIdentifier,i=[];let a=[];const o=_u(n);if(s==="default")for(const[l,u]of n.views.entries())a=a.concat(f3(u,t,r)),h3(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(s);l&&(a=a.concat(f3(l,t,r)),h3(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||i.push(l.query)))}return o&&!_u(n)&&i.push(new(wZ())(e._repo,e._path)),{removed:i,events:a}}function z7(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Oh(n,e){let t=null;for(const r of n.views.values())t=t||mZ(r,e);return t}function G7(n,e){if(e._queryParams.loadsAllData())return $1(n);{const r=e._queryIdentifier;return n.views.get(r)}}function W7(n,e){return G7(n,e)!=null}function _u(n){return $1(n)!=null}function $1(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cw;function CZ(n){_e(!cw,"__referenceConstructor has already been defined"),cw=n}function IZ(){return _e(cw,"Reference.ts has not been loaded"),cw}let xZ=1;class m3{constructor(e){this.listenProvider_=e,this.syncPointTree_=new sn(null),this.pendingWriteTree_=tZ(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function H7(n,e,t,r,s){return zX(n.pendingWriteTree_,e,t,r,s),s?Pf(n,new zc(nP(),e,t)):[]}function kZ(n,e,t,r){GX(n.pendingWriteTree_,e,t,r);const s=sn.fromObject(t);return Pf(n,new Zh(nP(),e,s))}function Vl(n,e,t=!1){const r=WX(n.pendingWriteTree_,e);if(HX(n.pendingWriteTree_,e)){let i=new sn(null);return r.snap!=null?i=i.set(Ut(),!0):Cr(r.children,a=>{i=i.set(new Kt(a),!0)}),Pf(n,new iw(r.path,i,t))}else return[]}function j1(n,e,t){return Pf(n,new zc(rP(),e,t))}function PZ(n,e,t){const r=sn.fromObject(t);return Pf(n,new Zh(rP(),e,r))}function AZ(n,e){return Pf(n,new Ag(rP(),e))}function RZ(n,e,t){const r=dP(n,t);if(r){const s=hP(r),i=s.path,a=s.queryId,o=Bs(i,e),l=new Ag(sP(a),o);return fP(n,i,l)}else return[]}function FC(n,e,t,r,s=!1){const i=e._path,a=n.syncPointTree_.get(i);let o=[];if(a&&(e._queryIdentifier==="default"||W7(a,e))){const l=TZ(a,e,t,r);bZ(a)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(o=l.events,!s){const h=u.findIndex(p=>p._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(p,y)=>_u(y));if(h&&!f){const p=n.syncPointTree_.subtree(i);if(!p.isEmpty()){const y=LZ(p);for(let _=0;_<y.length;++_){const b=y[_],S=b.query,E=Q7(n,b);n.listenProvider_.startListening(Dm(S),dw(n,S),E.hashFn,E.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(Dm(e),null):u.forEach(p=>{const y=n.queryToTagMap.get(U1(p));n.listenProvider_.stopListening(Dm(p),y)}))}MZ(n,u)}return o}function NZ(n,e,t,r){const s=dP(n,r);if(s!=null){const i=hP(s),a=i.path,o=i.queryId,l=Bs(a,e),u=new zc(sP(o),l,t);return fP(n,a,u)}else return[]}function OZ(n,e,t,r){const s=dP(n,r);if(s){const i=hP(s),a=i.path,o=i.queryId,l=Bs(a,e),u=sn.fromObject(t),h=new Zh(sP(o),l,u);return fP(n,a,h)}else return[]}function g3(n,e,t,r=!1){const s=e._path;let i=null,a=!1;n.syncPointTree_.foreachOnPath(s,(p,y)=>{const _=Bs(p,s);i=i||Oh(y,_),a=a||_u(y)});let o=n.syncPointTree_.get(s);o?(a=a||_u(o),i=i||Oh(o,Ut())):(o=new yZ,n.syncPointTree_=n.syncPointTree_.set(s,o));let l;i!=null?l=!0:(l=!1,i=Je.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((y,_)=>{const b=Oh(_,Ut());b&&(i=i.updateImmediateChild(y,b))}));const u=W7(o,e);if(!u&&!e._queryParams.loadsAllData()){const p=U1(e);_e(!n.queryToTagMap.has(p),"View does not exist, but we have a tag");const y=DZ();n.queryToTagMap.set(p,y),n.tagToQueryMap.set(y,p)}const h=iP(n.pendingWriteTree_,s);let f=SZ(o,e,t,h,i,l);if(!u&&!a&&!r){const p=G7(o,e);f=f.concat(FZ(n,e,p))}return f}function cP(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(a,o)=>{const l=Bs(a,e),u=Oh(o,l);if(u)return u});return F7(s,e,i,t,!0)}function Pf(n,e){return q7(e,n.syncPointTree_,null,iP(n.pendingWriteTree_,Ut()))}function q7(n,e,t,r){if(pt(n.path))return K7(n,e,t,r);{const s=e.get(Ut());t==null&&s!=null&&(t=Oh(s,Ut()));let i=[];const a=dt(n.path),o=n.operationForChild(a),l=e.children.get(a);if(l&&o){const u=t?t.getImmediateChild(a):null,h=$7(r,a);i=i.concat(q7(o,l,u,h))}return s&&(i=i.concat(uP(s,n,r,t))),i}}function K7(n,e,t,r){const s=e.get(Ut());t==null&&s!=null&&(t=Oh(s,Ut()));let i=[];return e.children.inorderTraversal((a,o)=>{const l=t?t.getImmediateChild(a):null,u=$7(r,a),h=n.operationForChild(a);h&&(i=i.concat(K7(h,o,l,u)))}),s&&(i=i.concat(uP(s,n,r,t))),i}function Q7(n,e){const t=e.query,r=dw(n,t);return{hashFn:()=>(pZ(e)||Je.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?RZ(n,t._path,r):AZ(n,t._path);{const i=PJ(s,t);return FC(n,t,null,i)}}}}function dw(n,e){const t=U1(e);return n.queryToTagMap.get(t)}function U1(n){return n._path.toString()+"$"+n._queryIdentifier}function dP(n,e){return n.tagToQueryMap.get(e)}function hP(n){const e=n.indexOf("$");return _e(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Kt(n.substr(0,e))}}function fP(n,e,t){const r=n.syncPointTree_.get(e);_e(r,"Missing sync point for query tag that we're tracking");const s=iP(n.pendingWriteTree_,e);return uP(r,t,s,null)}function LZ(n){return n.fold((e,t,r)=>{if(t&&_u(t))return[$1(t)];{let s=[];return t&&(s=z7(t)),Cr(r,(i,a)=>{s=s.concat(a)}),s}})}function Dm(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(IZ())(n._repo,n._path):n}function MZ(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=U1(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function DZ(){return xZ++}function FZ(n,e,t){const r=e._path,s=dw(n,e),i=Q7(n,t),a=n.listenProvider_.startListening(Dm(e),s,i.hashFn,i.onComplete),o=n.syncPointTree_.subtree(r);if(s)_e(!_u(o.value),"If we're adding a query, it shouldn't be shadowed");else{const l=o.fold((u,h,f)=>{if(!pt(u)&&h&&_u(h))return[$1(h).query];{let p=[];return h&&(p=p.concat(z7(h).map(y=>y.query))),Cr(f,(y,_)=>{p=p.concat(_)}),p}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(Dm(h),dw(n,h))}}return a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pP{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new pP(t)}node(){return this.node_}}class mP{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=yn(this.path_,e);return new mP(this.syncTree_,t)}node(){return cP(this.syncTree_,this.path_)}}const $Z=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},_3=function(n,e,t){if(!n||typeof n!="object")return n;if(_e(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return jZ(n[".sv"],e,t);if(typeof n[".sv"]=="object")return UZ(n[".sv"],e);_e(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},jZ=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:_e(!1,"Unexpected server value: "+n)}},UZ=function(n,e,t){n.hasOwnProperty("increment")||_e(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&_e(!1,"Unexpected increment value: "+r);const s=e.node();if(_e(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const a=s.getValue();return typeof a!="number"?r:a+r},Y7=function(n,e,t,r){return gP(e,new mP(t,n),r)},J7=function(n,e,t){return gP(n,new pP(e),t)};function gP(n,e,t){const r=n.getPriority().val(),s=_3(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const a=n,o=_3(a.getValue(),e,t);return o!==a.getValue()||s!==a.getPriority().val()?new gr(o,Rn(s)):n}else{const a=n;return i=a,s!==a.getPriority().val()&&(i=i.updatePriority(new gr(s))),a.forEachChild(vn,(o,l)=>{const u=gP(l,e.getImmediateChild(o),t);u!==l&&(i=i.updateImmediateChild(o,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _P{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function yP(n,e){let t=e instanceof Kt?e:new Kt(e),r=n,s=dt(t);for(;s!==null;){const i=zh(r.node.children,s)||{children:{},childCount:0};r=new _P(s,r,i),t=tn(t),s=dt(t)}return r}function Af(n){return n.node.value}function X7(n,e){n.node.value=e,$C(n)}function Z7(n){return n.node.childCount>0}function VZ(n){return Af(n)===void 0&&!Z7(n)}function V1(n,e){Cr(n.node.children,(t,r)=>{e(new _P(t,n,r))})}function eF(n,e,t,r){t&&e(n),V1(n,s=>{eF(s,e,!0)})}function BZ(n,e,t){let r=n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function __(n){return new Kt(n.parent===null?n.name:__(n.parent)+"/"+n.name)}function $C(n){n.parent!==null&&zZ(n.parent,n.name,n)}function zZ(n,e,t){const r=VZ(t),s=Za(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,$C(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,$C(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GZ=/[\[\].#$\/\u0000-\u001F\u007F]/,WZ=/[\[\].#$\u0000-\u001F\u007F]/,s2=10*1024*1024,vP=function(n){return typeof n=="string"&&n.length!==0&&!GZ.test(n)},tF=function(n){return typeof n=="string"&&n.length!==0&&!WZ.test(n)},HZ=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),tF(n)},nF=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!L1(n)||n&&typeof n=="object"&&Za(n,".sv")},jC=function(n,e,t,r){B1(Gh(n,"value"),e,t)},B1=function(n,e,t){const r=t instanceof Kt?new uX(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+hc(r));if(typeof e=="function")throw new Error(n+"contains a function "+hc(r)+" with contents = "+e.toString());if(L1(e))throw new Error(n+"contains "+e.toString()+" "+hc(r));if(typeof e=="string"&&e.length>s2/3&&d1(e)>s2)throw new Error(n+"contains a string greater than "+s2+" utf8 bytes "+hc(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(Cr(e,(a,o)=>{if(a===".value")s=!0;else if(a!==".priority"&&a!==".sv"&&(i=!0,!vP(a)))throw new Error(n+" contains an invalid key ("+a+") "+hc(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);cX(r,a),B1(n,o,r),dX(r)}),s&&i)throw new Error(n+' contains ".value" child '+hc(r)+" in addition to actual children.")}},qZ=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=Ig(r);for(let a=0;a<i.length;a++)if(!(i[a]===".priority"&&a===i.length-1)){if(!vP(i[a]))throw new Error(n+"contains an invalid key ("+i[a]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(lX);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&Ii(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},rF=function(n,e,t,r){const s=Gh(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];Cr(e,(a,o)=>{const l=new Kt(a);if(B1(s,o,yn(t,l)),Jk(l)===".priority"&&!nF(o))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),qZ(s,i)},KZ=function(n,e,t){if(L1(e))throw new Error(Gh(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!nF(e))throw new Error(Gh(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},wP=function(n,e,t,r){if(!tF(t))throw new Error(Gh(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},QZ=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),wP(n,e,t)},Ec=function(n,e){if(dt(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},YZ=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!vP(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!HZ(t))throw new Error(Gh(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JZ{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function z1(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!Xk(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function sF(n,e,t){z1(n,t),iF(n,r=>Xk(r,e))}function ha(n,e,t){z1(n,t),iF(n,r=>Ii(r,e)||Ii(e,r))}function iF(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(XZ(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function XZ(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();Nm&&br("event: "+t.toString()),xf(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZZ="repo_interrupt",eee=25;class tee{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new JZ,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=sw(),this.transactionQueueTree_=new _P,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function nee(n,e,t){if(n.stats_=Qk(n.repoInfo_),n.forceRestClient_||OJ())n.server_=new rw(n.repoInfo_,(r,s,i,a)=>{y3(n,r,s,i,a)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>v3(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Sr(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Fo(n.repoInfo_,e,(r,s,i,a)=>{y3(n,r,s,i,a)},r=>{v3(n,r)},r=>{see(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=$J(n.repoInfo_,()=>new FX(n.stats_,n.server_)),n.infoData_=new NX,n.infoSyncTree_=new m3({startListening:(r,s,i,a)=>{let o=[];const l=n.infoData_.getNode(r._path);return l.isEmpty()||(o=j1(n.infoSyncTree_,r._path,l),setTimeout(()=>{a("ok")},0)),o},stopListening:()=>{}}),bP(n,"connected",!1),n.serverSyncTree_=new m3({startListening:(r,s,i,a)=>(n.server_.listen(r,i,s,(o,l)=>{const u=a(o,l);ha(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function ree(n){const t=n.infoData_.getNode(new Kt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function G1(n){return $Z({timestamp:ree(n)})}function y3(n,e,t,r,s){n.dataUpdateCount++;const i=new Kt(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let a=[];if(s)if(r){const l=Fv(t,u=>Rn(u));a=OZ(n.serverSyncTree_,i,l,s)}else{const l=Rn(t);a=NZ(n.serverSyncTree_,i,l,s)}else if(r){const l=Fv(t,u=>Rn(u));a=PZ(n.serverSyncTree_,i,l)}else{const l=Rn(t);a=j1(n.serverSyncTree_,i,l)}let o=i;a.length>0&&(o=tf(n,i)),ha(n.eventQueue_,o,a)}function v3(n,e){bP(n,"connected",e),e===!1&&oee(n)}function see(n,e){Cr(e,(t,r)=>{bP(n,t,r)})}function bP(n,e,t){const r=new Kt("/.info/"+e),s=Rn(t);n.infoData_.updateSnapshot(r,s);const i=j1(n.infoSyncTree_,r,s);ha(n.eventQueue_,r,i)}function EP(n){return n.nextWriteId_++}function iee(n,e,t,r,s){W1(n,"set",{path:e.toString(),value:t,priority:r});const i=G1(n),a=Rn(t,r),o=cP(n.serverSyncTree_,e),l=J7(a,o,i),u=EP(n),h=H7(n.serverSyncTree_,e,l,u,!0);z1(n.eventQueue_,h),n.server_.put(e.toString(),a.val(!0),(p,y)=>{const _=p==="ok";_||bs("set at "+e+" failed: "+p);const b=Vl(n.serverSyncTree_,u,!_);ha(n.eventQueue_,e,b),yu(n,s,p,y)});const f=TP(n,e);tf(n,f),ha(n.eventQueue_,f,[])}function aee(n,e,t,r){W1(n,"update",{path:e.toString(),value:t});let s=!0;const i=G1(n),a={};if(Cr(t,(o,l)=>{s=!1,a[o]=Y7(yn(e,o),Rn(l),n.serverSyncTree_,i)}),s)br("update() called with empty data.  Don't do anything."),yu(n,r,"ok",void 0);else{const o=EP(n),l=kZ(n.serverSyncTree_,e,a,o);z1(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||bs("update at "+e+" failed: "+u);const p=Vl(n.serverSyncTree_,o,!f),y=p.length>0?tf(n,e):e;ha(n.eventQueue_,y,p),yu(n,r,u,h)}),Cr(t,u=>{const h=TP(n,yn(e,u));tf(n,h)}),ha(n.eventQueue_,e,[])}}function oee(n){W1(n,"onDisconnectEvents");const e=G1(n),t=sw();AC(n.onDisconnect_,Ut(),(s,i)=>{const a=Y7(s,i,n.serverSyncTree_,e);kf(t,s,a)});let r=[];AC(t,Ut(),(s,i)=>{r=r.concat(j1(n.serverSyncTree_,s,i));const a=TP(n,s);tf(n,a)}),n.onDisconnect_=sw(),ha(n.eventQueue_,Ut(),r)}function lee(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&PC(n.onDisconnect_,e),yu(n,t,r,s)})}function w3(n,e,t,r){const s=Rn(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,a)=>{i==="ok"&&kf(n.onDisconnect_,e,s),yu(n,r,i,a)})}function uee(n,e,t,r,s){const i=Rn(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(a,o)=>{a==="ok"&&kf(n.onDisconnect_,e,i),yu(n,s,a,o)})}function cee(n,e,t,r){if(Dv(t)){br("onDisconnect().update() called with empty data.  Don't do anything."),yu(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&Cr(t,(a,o)=>{const l=Rn(o);kf(n.onDisconnect_,yn(e,a),l)}),yu(n,r,s,i)})}function dee(n,e,t){let r;dt(e._path)===".info"?r=g3(n.infoSyncTree_,e,t):r=g3(n.serverSyncTree_,e,t),sF(n.eventQueue_,e._path,r)}function b3(n,e,t){let r;dt(e._path)===".info"?r=FC(n.infoSyncTree_,e,t):r=FC(n.serverSyncTree_,e,t),sF(n.eventQueue_,e._path,r)}function hee(n){n.persistentConnection_&&n.persistentConnection_.interrupt(ZZ)}function W1(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),br(t,...e)}function yu(n,e,t,r){e&&xf(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const a=new Error(i);a.code=s,e(a)}})}function aF(n,e,t){return cP(n.serverSyncTree_,e,t)||Je.EMPTY_NODE}function SP(n,e=n.transactionQueueTree_){if(e||H1(n,e),Af(e)){const t=lF(n,e);_e(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&fee(n,__(e),t)}else Z7(e)&&V1(e,t=>{SP(n,t)})}function fee(n,e,t){const r=t.map(u=>u.currentWriteId),s=aF(n,e,r);let i=s;const a=s.hash();for(let u=0;u<t.length;u++){const h=t[u];_e(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=Bs(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const o=i.val(!0),l=e;n.server_.put(l.toString(),o,u=>{W1(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let p=0;p<t.length;p++)t[p].status=2,h=h.concat(Vl(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&f.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();H1(n,yP(n.transactionQueueTree_,e)),SP(n,n.transactionQueueTree_),ha(n.eventQueue_,e,h);for(let p=0;p<f.length;p++)xf(f[p])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{bs("transaction at "+l.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}tf(n,e)}},a)}function tf(n,e){const t=oF(n,e),r=__(t),s=lF(n,t);return pee(n,s,r),r}function pee(n,e,t){if(e.length===0)return;const r=[];let s=[];const a=e.filter(o=>o.status===0).map(o=>o.currentWriteId);for(let o=0;o<e.length;o++){const l=e[o],u=Bs(t,l.path);let h=!1,f;if(_e(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,f=l.abortReason,s=s.concat(Vl(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=eee)h=!0,f="maxretry",s=s.concat(Vl(n.serverSyncTree_,l.currentWriteId,!0));else{const p=aF(n,l.path,a);l.currentInputSnapshot=p;const y=e[o].update(p.val());if(y!==void 0){B1("transaction failed: Data returned ",y,l.path);let _=Rn(y);typeof y=="object"&&y!=null&&Za(y,".priority")||(_=_.updatePriority(p.getPriority()));const S=l.currentWriteId,E=G1(n),C=J7(_,p,E);l.currentOutputSnapshotRaw=_,l.currentOutputSnapshotResolved=C,l.currentWriteId=EP(n),a.splice(a.indexOf(S),1),s=s.concat(H7(n.serverSyncTree_,l.path,C,l.currentWriteId,l.applyLocally)),s=s.concat(Vl(n.serverSyncTree_,S,!0))}else h=!0,f="nodata",s=s.concat(Vl(n.serverSyncTree_,l.currentWriteId,!0))}ha(n.eventQueue_,t,s),s=[],h&&(e[o].status=2,function(p){setTimeout(p,Math.floor(0))}(e[o].unwatcher),e[o].onComplete&&(f==="nodata"?r.push(()=>e[o].onComplete(null,!1,e[o].currentInputSnapshot)):r.push(()=>e[o].onComplete(new Error(f),!1,null))))}H1(n,n.transactionQueueTree_);for(let o=0;o<r.length;o++)xf(r[o]);SP(n,n.transactionQueueTree_)}function oF(n,e){let t,r=n.transactionQueueTree_;for(t=dt(e);t!==null&&Af(r)===void 0;)r=yP(r,t),e=tn(e),t=dt(e);return r}function lF(n,e){const t=[];return uF(n,e,t),t.sort((r,s)=>r.order-s.order),t}function uF(n,e,t){const r=Af(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);V1(e,s=>{uF(n,s,t)})}function H1(n,e){const t=Af(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,X7(e,t.length>0?t:void 0)}V1(e,r=>{H1(n,r)})}function TP(n,e){const t=__(oF(n,e)),r=yP(n.transactionQueueTree_,e);return BZ(r,s=>{i2(n,s)}),i2(n,r),eF(r,s=>{i2(n,s)}),t}function i2(n,e){const t=Af(e);if(t){const r=[];let s=[],i=-1;for(let a=0;a<t.length;a++)t[a].status===3||(t[a].status===1?(_e(i===a-1,"All SENT items should be at beginning of queue."),i=a,t[a].status=3,t[a].abortReason="set"):(_e(t[a].status===0,"Unexpected transaction status in abort"),t[a].unwatcher(),s=s.concat(Vl(n.serverSyncTree_,t[a].currentWriteId,!0)),t[a].onComplete&&r.push(t[a].onComplete.bind(null,new Error("set"),!1,null))));i===-1?X7(e,void 0):t.length=i+1,ha(n.eventQueue_,__(e),s);for(let a=0;a<r.length;a++)xf(r[a])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mee(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function gee(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):bs(`Invalid query segment '${t}' in query '${n}'`)}return e}const E3=function(n,e){const t=_ee(n),r=t.namespace;t.domain==="firebase.com"&&Qo(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Qo("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||TJ();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new _7(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new Kt(t.pathString)}},_ee=function(n){let e="",t="",r="",s="",i="",a=!0,o="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(o=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=mee(n.substring(h,f)));const p=gee(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(a=o==="https"||o==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{const _=e.indexOf(".");r=e.substring(0,_).toLowerCase(),t=e.substring(_+1),i=r}"ns"in p&&(i=p.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:a,scheme:o,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yee{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Sr(this.snapshot.exportVal())}}class vee{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wee{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return _e(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cF{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new ja;return lee(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Ec("OnDisconnect.remove",this._path);const e=new ja;return w3(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Ec("OnDisconnect.set",this._path),jC("OnDisconnect.set",e,this._path);const t=new ja;return w3(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Ec("OnDisconnect.setWithPriority",this._path),jC("OnDisconnect.setWithPriority",e,this._path),KZ("OnDisconnect.setWithPriority",t);const r=new ja;return uee(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Ec("OnDisconnect.update",this._path),rF("OnDisconnect.update",e,this._path);const t=new ja;return cee(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return pt(this._path)?null:Jk(this._path)}get ref(){return new Zo(this._repo,this._path)}get _queryIdentifier(){const e=i3(this._queryParams),t=qk(e);return t==="{}"?"default":t}get _queryObject(){return i3(this._queryParams)}isEqual(e){if(e=Xt(e),!(e instanceof q1))return!1;const t=this._repo===e._repo,r=Xk(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+oX(this._path)}}class Zo extends q1{constructor(e,t){super(e,t,new D1,!1)}get parent(){const e=I7(this._path);return e===null?null:new Zo(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Rg{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Kt(e),r=hw(this.ref,e);return new Rg(this._node.getChild(t),r,vn)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Rg(s,hw(this.ref,r),vn)))}hasChild(e){const t=new Kt(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function el(n,e){return n=Xt(n),n._checkNotDeleted("ref"),e!==void 0?hw(n._root,e):n._root}function hw(n,e){return n=Xt(n),dt(n._path)===null?QZ("child","path",e):wP("child","path",e),new Zo(n._repo,yn(n._path,e))}function dF(n){return n=Xt(n),new cF(n._repo,n._path)}function bee(n){return Ec("remove",n._path),K1(n,null)}function K1(n,e){n=Xt(n),Ec("set",n._path),jC("set",e,n._path);const t=new ja;return iee(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function hF(n,e){rF("update",e,n._path);const t=new ja;return aee(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}class CP{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new yee("value",this,new Rg(e.snapshotNode,new Zo(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new vee(this,e,t):null}matches(e){return e instanceof CP?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function Eee(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const l=t,u=(h,f)=>{b3(n._repo,n,o),l(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const a=new wee(t,i||void 0),o=new CP(a);return dee(n._repo,n,o),()=>b3(n._repo,n,o)}function y_(n,e,t,r){return Eee(n,"value",e,t,r)}vZ(Zo);CZ(Zo);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const See="FIREBASE_DATABASE_EMULATOR_HOST",UC={};let Tee=!1;function Cee(n,e,t,r){n.repoInfo_=new _7(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function fF(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||Qo("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),br("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let a=E3(i,s),o=a.repoInfo,l;typeof process<"u"&&VO&&(l=VO[See]),l?(i=`http://${l}?ns=${o.namespace}`,a=E3(i,s),o=a.repoInfo):a.repoInfo.secure;const u=new MJ(n.name,n.options,e);YZ("Invalid Firebase Database URL",a),pt(a.path)||Qo("Database URL must point to the root of a Firebase Database (not including a child path).");const h=xee(o,n,u,new LJ(n.name,t));return new pF(h,n)}function Iee(n,e){const t=UC[e];(!t||t[n.key]!==n)&&Qo(`Database ${e}(${n.repoInfo_}) has already been deleted.`),hee(n),delete t[n.key]}function xee(n,e,t,r){let s=UC[e.name];s||(s={},UC[e.name]=s);let i=s[n.toURLString()];return i&&Qo("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new tee(n,Tee,t,r),s[n.toURLString()]=i,i}class pF{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(nee(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Zo(this._repo,Ut())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Iee(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Qo("Cannot call "+e+" on a deleted database.")}}function IP(n=Kx(),e){const t=f1(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=$L("database");r&&xP(t,...r)}return t}function xP(n,e,t,r={}){n=Xt(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Qo("Cannot call useEmulator() after instance has already been initialized.");const s=n._repoInternal;let i;if(s.repoInfo_.nodeAdmin)r.mockUserToken&&Qo('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),i=new Q0(Q0.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:VL(r.mockUserToken,n.app.options.projectId);i=new Q0(a)}Cee(s,e,t,i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kee(n){r7(ed),Mc(new du("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return fF(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),Ha(BO,zO,n),Ha(BO,zO,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pee={".sv":"timestamp"};function kP(){return Pee}Fo.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Fo.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};kee();const Aee=Object.freeze(Object.defineProperty({__proto__:null,DataSnapshot:Rg,Database:pF,OnDisconnect:cF,_QueryImpl:q1,_QueryParams:D1,_ReferenceImpl:Zo,_repoManagerDatabaseFromApp:fF,_setSDKVersion:r7,_validatePathString:wP,_validateWritablePath:Ec,child:hw,connectDatabaseEmulator:xP,getDatabase:IP,onDisconnect:dF,onValue:y_,ref:el,remove:bee,serverTimestamp:kP,set:K1,update:hF},Symbol.toStringTag,{value:"Module"}));console.log("🔍 [BUILD DEBUG] Starting Firebase module import...");console.log("🔍 [BUILD DEBUG] Firebase imports completed, reading config...");const Y0={apiKey:"AIzaSyDQZvIf-wol_S9nLsAHlFNfyBSxViW8xWc",authDomain:"collabcanvas-d5bce.firebaseapp.com",projectId:"collabcanvas-d5bce",storageBucket:"collabcanvas-d5bce.firebasestorage.app",messagingSenderId:"484501248859",appId:"1:484501248859:web:026a6bbbaa8652239b587e",databaseURL:"https://collabcanvas-d5bce-default-rtdb.firebaseio.com"};console.log("🔍 [BUILD DEBUG] Firebase config created:",{hasApiKey:!!Y0.apiKey,hasProjectId:!!Y0.projectId,hasDatabaseURL:!!Y0.databaseURL,environment:"production"});console.log("🔍 [BUILD DEBUG] About to initialize Firebase app...");const PP=HL(Y0);console.log("🔍 [BUILD DEBUG] Firebase app initialized successfully");console.log("🔍 [BUILD DEBUG] About to initialize Auth...");const nf=pK(PP);console.log("🔍 [BUILD DEBUG] Auth initialized successfully");console.log("🔍 [BUILD DEBUG] About to initialize Firestore...");const Cn=nJ(PP);console.log("🔍 [BUILD DEBUG] Firestore initialized successfully");console.log("🔍 [BUILD DEBUG] About to initialize Realtime Database...");const Mu=IP(PP);console.log("🔍 [BUILD DEBUG] Realtime Database initialized successfully");console.log("🔍 [BUILD DEBUG] Checking emulator configuration...");const Ree=!0;console.log("🔍 [BUILD DEBUG] Emulator mode:",Ree);{console.log("🔥 Using Firebase Emulators (FREE - no quota usage)"),console.log("🔍 [BUILD DEBUG] About to connect to Auth emulator...");try{fM(nf,"http://127.0.0.1:9099",{disableWarnings:!0}),console.log("✅ Auth Emulator connected")}catch(n){console.log("Auth emulator already connected",n)}console.log("🔍 [BUILD DEBUG] About to connect to Firestore emulator...");try{VD(Cn,"127.0.0.1",8080),console.log("✅ Firestore Emulator connected (FREE)")}catch(n){console.log("Firestore emulator already connected",n)}console.log("🔍 [BUILD DEBUG] About to connect to Database emulator...");try{xP(Mu,"127.0.0.1",9e3),console.log("✅ Realtime Database Emulator connected (FREE)")}catch(n){console.log("Realtime Database emulator already connected",n)}}console.log("🔍 [BUILD DEBUG] Firebase module initialization complete!");const VC=n=>{const e=(n==null?void 0:n.code)||"unknown",t={"auth/user-not-found":"No account found with this email address. Please check your email or create a new account.","auth/wrong-password":"Incorrect password. Please try again or reset your password.","auth/invalid-email":"Please enter a valid email address.","auth/user-disabled":"This account has been disabled. Please contact support.","auth/too-many-requests":"Too many failed attempts. Please try again later.","auth/invalid-credential":"Invalid email or password. Please check your credentials and try again.","auth/email-already-in-use":"An account with this email already exists. Try logging in instead.","auth/weak-password":"Password should be at least 6 characters long.","auth/operation-not-allowed":"Email/password accounts are not enabled. Please contact support.","auth/popup-closed-by-user":"Sign-in was cancelled. Please try again.","auth/popup-blocked":"Pop-up was blocked by your browser. Please allow pop-ups and try again.","auth/cancelled-popup-request":"Sign-in was cancelled. Please try again.","auth/account-exists-with-different-credential":"An account already exists with this email using a different sign-in method.","auth/network-request-failed":"Network error. Please check your internet connection and try again.","auth/timeout":"Request timed out. Please check your connection and try again.","auth/internal-error":"Something went wrong. Please try again.",unknown:"An unexpected error occurred. Please try again."};return t[e]||t.unknown},BC=n=>["auth/network-request-failed","auth/timeout","auth/too-many-requests","auth/internal-error","auth/popup-blocked"].includes(n==null?void 0:n.code),zC=n=>{const e=n==null?void 0:n.code;return{"auth/user-not-found":"Create Account","auth/email-already-in-use":"Sign In Instead","auth/popup-blocked":"Enable Pop-ups","auth/weak-password":"Use Stronger Password"}[e]||void 0},Nee=({onSuccess:n,onSwitchToRegister:e})=>{const[t,r]=Y.useState(""),[s,i]=Y.useState(""),[a,o]=Y.useState(!1),[l,u]=Y.useState(null),h=async p=>{if(p.preventDefault(),o(!0),u(null),!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){u({message:"Please enter a valid email address"}),o(!1);return}try{await ZH(nf,t,s),n==null||n()}catch(_){u({message:VC(_),action:zC(_),retryable:BC(_)})}finally{o(!1)}},f=async()=>{o(!0),u(null);try{const p=new Io;await Sq(nf,p),n==null||n()}catch(p){u({message:VC(p),action:zC(p),retryable:BC(p)})}finally{o(!1)}};return V.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-md p-6",children:[V.jsx("h2",{className:"text-2xl font-bold mb-6 text-center text-gray-800",children:"Sign In"}),l&&V.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:V.jsxs("div",{className:"flex items-start gap-3",children:[V.jsx("div",{className:"text-red-500 text-lg",children:"⚠️"}),V.jsxs("div",{className:"flex-1",children:[V.jsx("div",{className:"text-red-800 font-medium text-sm mb-1",children:"Sign In Error"}),V.jsx("div",{className:"text-red-700 text-sm",children:l.message}),l.action&&V.jsx("button",{onClick:()=>{l.action==="Create Account"&&(e==null||e()),u(null)},className:"mt-2 text-sm text-red-600 hover:text-red-800 underline",children:l.action}),l.retryable&&V.jsx("button",{onClick:()=>u(null),className:"mt-2 ml-2 text-sm text-red-600 hover:text-red-800 underline",children:"Try Again"})]})]})}),V.jsxs("form",{onSubmit:h,className:"space-y-4",children:[V.jsxs("div",{children:[V.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),V.jsx("input",{id:"email",type:"email",value:t,onChange:p=>r(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:a})]}),V.jsxs("div",{children:[V.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),V.jsx("input",{id:"password",type:"password",value:s,onChange:p=>i(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:a})]}),V.jsx("button",{type:"submit",disabled:a,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50",children:a?"Signing In...":"Sign In"})]}),V.jsx("div",{className:"my-4 text-center text-gray-500",children:"or"}),V.jsx("button",{onClick:f,disabled:a,className:"w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 disabled:opacity-50",children:"Sign in with Google"}),V.jsx("div",{className:"mt-4 text-center",children:V.jsx("button",{onClick:e,className:"text-blue-600 hover:underline text-sm",children:"Need an account? Sign up"})})]})},Oee=({onSuccess:n,onSwitchToLogin:e})=>{const[t,r]=Y.useState(""),[s,i]=Y.useState(""),[a,o]=Y.useState(""),[l,u]=Y.useState(!1),[h,f]=Y.useState(null),p=async y=>{if(y.preventDefault(),u(!0),f(null),!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){f({message:"Please enter a valid email address"}),u(!1);return}if(s!==a){f({message:"Passwords do not match"}),u(!1);return}if(s.length<6){f({message:"Password must be at least 6 characters"}),u(!1);return}try{await XH(nf,t,s),n==null||n()}catch(b){f({message:VC(b),action:zC(b),retryable:BC(b)})}finally{u(!1)}};return V.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-md p-6",children:[V.jsx("h2",{className:"text-2xl font-bold mb-6 text-center text-gray-800",children:"Create Account"}),h&&V.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:V.jsxs("div",{className:"flex items-start gap-3",children:[V.jsx("div",{className:"text-red-500 text-lg",children:"⚠️"}),V.jsxs("div",{className:"flex-1",children:[V.jsx("div",{className:"text-red-800 font-medium text-sm mb-1",children:"Registration Error"}),V.jsx("div",{className:"text-red-700 text-sm",children:h.message}),h.action&&V.jsx("button",{onClick:()=>{h.action==="Sign In Instead"&&(e==null||e()),f(null)},className:"mt-2 text-sm text-red-600 hover:text-red-800 underline",children:h.action}),h.retryable&&V.jsx("button",{onClick:()=>f(null),className:"mt-2 ml-2 text-sm text-red-600 hover:text-red-800 underline",children:"Try Again"})]})]})}),V.jsxs("form",{onSubmit:p,className:"space-y-4",children:[V.jsxs("div",{children:[V.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),V.jsx("input",{id:"email",type:"email",value:t,onChange:y=>r(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:l})]}),V.jsxs("div",{children:[V.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),V.jsx("input",{id:"password",type:"password",value:s,onChange:y=>i(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:l,minLength:6})]}),V.jsxs("div",{children:[V.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),V.jsx("input",{id:"confirmPassword",type:"password",value:a,onChange:y=>o(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:l})]}),V.jsx("button",{type:"submit",disabled:l,className:"w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 disabled:opacity-50",children:l?"Creating Account...":"Create Account"})]}),V.jsx("div",{className:"mt-4 text-center",children:V.jsx("button",{onClick:e,className:"text-blue-600 hover:underline text-sm",children:"Already have an account? Sign in"})})]})},Lee=({onAuthSuccess:n})=>{const[e,t]=Y.useState(!0),r=()=>{n==null||n()},s=()=>t(!0),i=()=>t(!1);return V.jsx("div",{className:"w-full max-w-md mx-auto",children:e?V.jsx(Nee,{onSuccess:r,onSwitchToRegister:i}):V.jsx(Oee,{onSuccess:r,onSwitchToLogin:s})})};var mF={exports:{}},Q1={},fw={},ct={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n._registerNode=n.Konva=n.glob=void 0;const e=Math.PI/180;function t(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}n.glob=typeof m4<"u"?m4:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},n.Konva={_global:n.glob,version:"9.3.22",isBrowser:t(),isUnminified:/param/.test((function(s){}).toString()),dblClickWindow:400,getAngle(s){return n.Konva.angleDeg?s*e:s},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return n.Konva.DD.isDragging},isTransforming(){var s;return(s=n.Konva.Transformer)===null||s===void 0?void 0:s.isTransforming()},isDragReady(){return!!n.Konva.DD.node},releaseCanvasOnDestroy:!0,document:n.glob.document,_injectGlobal(s){n.glob.Konva=s}};const r=s=>{n.Konva[s.prototype.getClassName()]=s};n._registerNode=r,n.Konva._injectGlobal(n.Konva)})(ct);var En={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Util=n.Transform=void 0;const e=ct;class t{constructor(I=[1,0,0,1,0,0]){this.dirty=!1,this.m=I&&I.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new t(this.m)}copyInto(I){I.m[0]=this.m[0],I.m[1]=this.m[1],I.m[2]=this.m[2],I.m[3]=this.m[3],I.m[4]=this.m[4],I.m[5]=this.m[5]}point(I){const L=this.m;return{x:L[0]*I.x+L[2]*I.y+L[4],y:L[1]*I.x+L[3]*I.y+L[5]}}translate(I,L){return this.m[4]+=this.m[0]*I+this.m[2]*L,this.m[5]+=this.m[1]*I+this.m[3]*L,this}scale(I,L){return this.m[0]*=I,this.m[1]*=I,this.m[2]*=L,this.m[3]*=L,this}rotate(I){const L=Math.cos(I),R=Math.sin(I),P=this.m[0]*L+this.m[2]*R,x=this.m[1]*L+this.m[3]*R,N=this.m[0]*-R+this.m[2]*L,M=this.m[1]*-R+this.m[3]*L;return this.m[0]=P,this.m[1]=x,this.m[2]=N,this.m[3]=M,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(I,L){const R=this.m[0]+this.m[2]*L,P=this.m[1]+this.m[3]*L,x=this.m[2]+this.m[0]*I,N=this.m[3]+this.m[1]*I;return this.m[0]=R,this.m[1]=P,this.m[2]=x,this.m[3]=N,this}multiply(I){const L=this.m[0]*I.m[0]+this.m[2]*I.m[1],R=this.m[1]*I.m[0]+this.m[3]*I.m[1],P=this.m[0]*I.m[2]+this.m[2]*I.m[3],x=this.m[1]*I.m[2]+this.m[3]*I.m[3],N=this.m[0]*I.m[4]+this.m[2]*I.m[5]+this.m[4],M=this.m[1]*I.m[4]+this.m[3]*I.m[5]+this.m[5];return this.m[0]=L,this.m[1]=R,this.m[2]=P,this.m[3]=x,this.m[4]=N,this.m[5]=M,this}invert(){const I=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),L=this.m[3]*I,R=-this.m[1]*I,P=-this.m[2]*I,x=this.m[0]*I,N=I*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),M=I*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=L,this.m[1]=R,this.m[2]=P,this.m[3]=x,this.m[4]=N,this.m[5]=M,this}getMatrix(){return this.m}decompose(){const I=this.m[0],L=this.m[1],R=this.m[2],P=this.m[3],x=this.m[4],N=this.m[5],M=I*P-L*R,D={x,y:N,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(I!=0||L!=0){const F=Math.sqrt(I*I+L*L);D.rotation=L>0?Math.acos(I/F):-Math.acos(I/F),D.scaleX=F,D.scaleY=M/F,D.skewX=(I*R+L*P)/M,D.skewY=0}else if(R!=0||P!=0){const F=Math.sqrt(R*R+P*P);D.rotation=Math.PI/2-(P>0?Math.acos(-R/F):-Math.acos(R/F)),D.scaleX=M/F,D.scaleY=F,D.skewX=0,D.skewY=(I*R+L*P)/M}return D.rotation=n.Util._getRotation(D.rotation),D}}n.Transform=t;const r="[object Array]",s="[object Number]",i="[object String]",a="[object Boolean]",o=Math.PI/180,l=180/Math.PI,u="#",h="",f="0",p="Konva warning: ",y="Konva error: ",_="rgb(",b={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},S=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let E=[];const C=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(v){setTimeout(v,60)};n.Util={_isElement(v){return!!(v&&v.nodeType==1)},_isFunction(v){return!!(v&&v.constructor&&v.call&&v.apply)},_isPlainObject(v){return!!v&&v.constructor===Object},_isArray(v){return Object.prototype.toString.call(v)===r},_isNumber(v){return Object.prototype.toString.call(v)===s&&!isNaN(v)&&isFinite(v)},_isString(v){return Object.prototype.toString.call(v)===i},_isBoolean(v){return Object.prototype.toString.call(v)===a},isObject(v){return v instanceof Object},isValidSelector(v){if(typeof v!="string")return!1;const I=v[0];return I==="#"||I==="."||I===I.toUpperCase()},_sign(v){return v===0||v>0?1:-1},requestAnimFrame(v){E.push(v),E.length===1&&C(function(){const I=E;E=[],I.forEach(function(L){L()})})},createCanvasElement(){const v=document.createElement("canvas");try{v.style=v.style||{}}catch{}return v},createImageElement(){return document.createElement("img")},_isInDocument(v){for(;v=v.parentNode;)if(v==document)return!0;return!1},_urlToImage(v,I){const L=n.Util.createImageElement();L.onload=function(){I(L)},L.src=v},_rgbToHex(v,I,L){return((1<<24)+(v<<16)+(I<<8)+L).toString(16).slice(1)},_hexToRgb(v){v=v.replace(u,h);const I=parseInt(v,16);return{r:I>>16&255,g:I>>8&255,b:I&255}},getRandomColor(){let v=(Math.random()*16777215<<0).toString(16);for(;v.length<6;)v=f+v;return u+v},getRGB(v){let I;return v in b?(I=b[v],{r:I[0],g:I[1],b:I[2]}):v[0]===u?this._hexToRgb(v.substring(1)):v.substr(0,4)===_?(I=S.exec(v.replace(/ /g,"")),{r:parseInt(I[1],10),g:parseInt(I[2],10),b:parseInt(I[3],10)}):{r:0,g:0,b:0}},colorToRGBA(v){return v=v||"black",n.Util._namedColorToRBA(v)||n.Util._hex3ColorToRGBA(v)||n.Util._hex4ColorToRGBA(v)||n.Util._hex6ColorToRGBA(v)||n.Util._hex8ColorToRGBA(v)||n.Util._rgbColorToRGBA(v)||n.Util._rgbaColorToRGBA(v)||n.Util._hslColorToRGBA(v)},_namedColorToRBA(v){const I=b[v.toLowerCase()];return I?{r:I[0],g:I[1],b:I[2],a:1}:null},_rgbColorToRGBA(v){if(v.indexOf("rgb(")===0){v=v.match(/rgb\(([^)]+)\)/)[1];const I=v.split(/ *, */).map(Number);return{r:I[0],g:I[1],b:I[2],a:1}}},_rgbaColorToRGBA(v){if(v.indexOf("rgba(")===0){v=v.match(/rgba\(([^)]+)\)/)[1];const I=v.split(/ *, */).map((L,R)=>L.slice(-1)==="%"?R===3?parseInt(L)/100:parseInt(L)/100*255:Number(L));return{r:I[0],g:I[1],b:I[2],a:I[3]}}},_hex8ColorToRGBA(v){if(v[0]==="#"&&v.length===9)return{r:parseInt(v.slice(1,3),16),g:parseInt(v.slice(3,5),16),b:parseInt(v.slice(5,7),16),a:parseInt(v.slice(7,9),16)/255}},_hex6ColorToRGBA(v){if(v[0]==="#"&&v.length===7)return{r:parseInt(v.slice(1,3),16),g:parseInt(v.slice(3,5),16),b:parseInt(v.slice(5,7),16),a:1}},_hex4ColorToRGBA(v){if(v[0]==="#"&&v.length===5)return{r:parseInt(v[1]+v[1],16),g:parseInt(v[2]+v[2],16),b:parseInt(v[3]+v[3],16),a:parseInt(v[4]+v[4],16)/255}},_hex3ColorToRGBA(v){if(v[0]==="#"&&v.length===4)return{r:parseInt(v[1]+v[1],16),g:parseInt(v[2]+v[2],16),b:parseInt(v[3]+v[3],16),a:1}},_hslColorToRGBA(v){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(v)){const[I,...L]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(v),R=Number(L[0])/360,P=Number(L[1])/100,x=Number(L[2])/100;let N,M,D;if(P===0)return D=x*255,{r:Math.round(D),g:Math.round(D),b:Math.round(D),a:1};x<.5?N=x*(1+P):N=x+P-x*P;const F=2*x-N,$=[0,0,0];for(let H=0;H<3;H++)M=R+1/3*-(H-1),M<0&&M++,M>1&&M--,6*M<1?D=F+(N-F)*6*M:2*M<1?D=N:3*M<2?D=F+(N-F)*(2/3-M)*6:D=F,$[H]=D*255;return{r:Math.round($[0]),g:Math.round($[1]),b:Math.round($[2]),a:1}}},haveIntersection(v,I){return!(I.x>v.x+v.width||I.x+I.width<v.x||I.y>v.y+v.height||I.y+I.height<v.y)},cloneObject(v){const I={};for(const L in v)this._isPlainObject(v[L])?I[L]=this.cloneObject(v[L]):this._isArray(v[L])?I[L]=this.cloneArray(v[L]):I[L]=v[L];return I},cloneArray(v){return v.slice(0)},degToRad(v){return v*o},radToDeg(v){return v*l},_degToRad(v){return n.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),n.Util.degToRad(v)},_radToDeg(v){return n.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),n.Util.radToDeg(v)},_getRotation(v){return e.Konva.angleDeg?n.Util.radToDeg(v):v},_capitalize(v){return v.charAt(0).toUpperCase()+v.slice(1)},throw(v){throw new Error(y+v)},error(v){console.error(y+v)},warn(v){e.Konva.showWarnings&&console.warn(p+v)},each(v,I){for(const L in v)I(L,v[L])},_inRange(v,I,L){return I<=v&&v<L},_getProjectionToSegment(v,I,L,R,P,x){let N,M,D;const F=(v-L)*(v-L)+(I-R)*(I-R);if(F==0)N=v,M=I,D=(P-L)*(P-L)+(x-R)*(x-R);else{const $=((P-v)*(L-v)+(x-I)*(R-I))/F;$<0?(N=v,M=I,D=(v-P)*(v-P)+(I-x)*(I-x)):$>1?(N=L,M=R,D=(L-P)*(L-P)+(R-x)*(R-x)):(N=v+$*(L-v),M=I+$*(R-I),D=(N-P)*(N-P)+(M-x)*(M-x))}return[N,M,D]},_getProjectionToLine(v,I,L){const R=n.Util.cloneObject(v);let P=Number.MAX_VALUE;return I.forEach(function(x,N){if(!L&&N===I.length-1)return;const M=I[(N+1)%I.length],D=n.Util._getProjectionToSegment(x.x,x.y,M.x,M.y,v.x,v.y),F=D[0],$=D[1],H=D[2];H<P&&(R.x=F,R.y=$,P=H)}),R},_prepareArrayForTween(v,I,L){const R=[],P=[];if(v.length>I.length){const N=I;I=v,v=N}for(let N=0;N<v.length;N+=2)R.push({x:v[N],y:v[N+1]});for(let N=0;N<I.length;N+=2)P.push({x:I[N],y:I[N+1]});const x=[];return P.forEach(function(N){const M=n.Util._getProjectionToLine(N,R,L);x.push(M.x),x.push(M.y)}),x},_prepareToStringify(v){let I;v.visitedByCircularReferenceRemoval=!0;for(const L in v)if(v.hasOwnProperty(L)&&v[L]&&typeof v[L]=="object"){if(I=Object.getOwnPropertyDescriptor(v,L),v[L].visitedByCircularReferenceRemoval||n.Util._isElement(v[L]))if(I.configurable)delete v[L];else return null;else if(n.Util._prepareToStringify(v[L])===null)if(I.configurable)delete v[L];else return null}return delete v.visitedByCircularReferenceRemoval,v},_assign(v,I){for(const L in I)v[L]=I[L];return v},_getFirstPointerId(v){return v.touches?v.changedTouches[0].identifier:v.pointerId||999},releaseCanvas(...v){e.Konva.releaseCanvasOnDestroy&&v.forEach(I=>{I.width=0,I.height=0})},drawRoundedRectPath(v,I,L,R){let P=0,x=0,N=0,M=0;typeof R=="number"?P=x=N=M=Math.min(R,I/2,L/2):(P=Math.min(R[0]||0,I/2,L/2),x=Math.min(R[1]||0,I/2,L/2),M=Math.min(R[2]||0,I/2,L/2),N=Math.min(R[3]||0,I/2,L/2)),v.moveTo(P,0),v.lineTo(I-x,0),v.arc(I-x,x,x,Math.PI*3/2,0,!1),v.lineTo(I,L-M),v.arc(I-M,L-M,M,0,Math.PI/2,!1),v.lineTo(N,L),v.arc(N,L-N,N,Math.PI/2,Math.PI,!1),v.lineTo(0,P),v.arc(P,P,P,Math.PI,Math.PI*3/2,!1)}}})(En);var fn={},la={},$o={};Object.defineProperty($o,"__esModule",{value:!0});$o.HitContext=$o.SceneContext=$o.Context=void 0;const gF=En,Mee=ct;function Dee(n){const e=[],t=n.length,r=gF.Util;for(let s=0;s<t;s++){let i=n[s];r._isNumber(i)?i=Math.round(i*1e3)/1e3:r._isString(i)||(i=i+""),e.push(i)}return e}const S3=",",Fee="(",$ee=")",jee="([",Uee="])",Vee=";",Bee="()",zee="=",T3=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],Gee=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],Wee=100;let Y1=class{constructor(e){this.canvas=e,Mee.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,t){let r=this.traceArr,s=r.length,i="",a,o,l,u;for(a=0;a<s;a++)o=r[a],l=o.method,l?(u=o.args,i+=l,e?i+=Bee:gF.Util._isArray(u[0])?i+=jee+u.join(S3)+Uee:(t&&(u=u.map(h=>typeof h=="number"?Math.floor(h):h)),i+=Fee+u.join(S3)+$ee)):(i+=o.property,e||(i+=zee+o.val)),i+=Vee;return i}clearTrace(){this.traceArr=[]}_trace(e){let t=this.traceArr,r;t.push(e),r=t.length,r>=Wee&&t.shift()}reset(){const e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){const t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)}_applyLineCap(e){const t=e.attrs.lineCap;t&&this.setAttr("lineCap",t)}_applyOpacity(e){const t=e.getAbsoluteOpacity();t!==1&&this.setAttr("globalAlpha",t)}_applyLineJoin(e){const t=e.attrs.lineJoin;t&&this.setAttr("lineJoin",t)}setAttr(e,t){this._context[e]=t}arc(e,t,r,s,i,a){this._context.arc(e,t,r,s,i,a)}arcTo(e,t,r,s,i){this._context.arcTo(e,t,r,s,i)}beginPath(){this._context.beginPath()}bezierCurveTo(e,t,r,s,i,a){this._context.bezierCurveTo(e,t,r,s,i,a)}clearRect(e,t,r,s){this._context.clearRect(e,t,r,s)}clip(...e){this._context.clip.apply(this._context,e)}closePath(){this._context.closePath()}createImageData(e,t){const r=arguments;if(r.length===2)return this._context.createImageData(e,t);if(r.length===1)return this._context.createImageData(e)}createLinearGradient(e,t,r,s){return this._context.createLinearGradient(e,t,r,s)}createPattern(e,t){return this._context.createPattern(e,t)}createRadialGradient(e,t,r,s,i,a){return this._context.createRadialGradient(e,t,r,s,i,a)}drawImage(e,t,r,s,i,a,o,l,u){const h=arguments,f=this._context;h.length===3?f.drawImage(e,t,r):h.length===5?f.drawImage(e,t,r,s,i):h.length===9&&f.drawImage(e,t,r,s,i,a,o,l,u)}ellipse(e,t,r,s,i,a,o,l){this._context.ellipse(e,t,r,s,i,a,o,l)}isPointInPath(e,t,r,s){return r?this._context.isPointInPath(r,e,t,s):this._context.isPointInPath(e,t,s)}fill(...e){this._context.fill.apply(this._context,e)}fillRect(e,t,r,s){this._context.fillRect(e,t,r,s)}strokeRect(e,t,r,s){this._context.strokeRect(e,t,r,s)}fillText(e,t,r,s){s?this._context.fillText(e,t,r,s):this._context.fillText(e,t,r)}measureText(e){return this._context.measureText(e)}getImageData(e,t,r,s){return this._context.getImageData(e,t,r,s)}lineTo(e,t){this._context.lineTo(e,t)}moveTo(e,t){this._context.moveTo(e,t)}rect(e,t,r,s){this._context.rect(e,t,r,s)}roundRect(e,t,r,s,i){this._context.roundRect(e,t,r,s,i)}putImageData(e,t,r){this._context.putImageData(e,t,r)}quadraticCurveTo(e,t,r,s){this._context.quadraticCurveTo(e,t,r,s)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,t){this._context.scale(e,t)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,t,r,s,i,a){this._context.setTransform(e,t,r,s,i,a)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,t,r,s){this._context.strokeText(e,t,r,s)}transform(e,t,r,s,i,a){this._context.transform(e,t,r,s,i,a)}translate(e,t){this._context.translate(e,t)}_enableTrace(){let e=this,t=T3.length,r=this.setAttr,s,i;const a=function(o){let l=e[o],u;e[o]=function(){return i=Dee(Array.prototype.slice.call(arguments,0)),u=l.apply(e,arguments),e._trace({method:o,args:i}),u}};for(s=0;s<t;s++)a(T3[s]);e.setAttr=function(){r.apply(e,arguments);const o=arguments[0];let l=arguments[1];(o==="shadowOffsetX"||o==="shadowOffsetY"||o==="shadowBlur")&&(l=l/this.canvas.getPixelRatio()),e._trace({property:o,val:l})}}_applyGlobalCompositeOperation(e){const t=e.attrs.globalCompositeOperation;!t||t==="source-over"||this.setAttr("globalCompositeOperation",t)}};$o.Context=Y1;Gee.forEach(function(n){Object.defineProperty(Y1.prototype,n,{get(){return this._context[n]},set(e){this._context[n]=e}})});class Hee extends Y1{constructor(e,{willReadFrequently:t=!1}={}){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:t})}_fillColor(e){const t=e.fill();this.setAttr("fillStyle",t),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){const t=e._getLinearGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fillRadialGradient(e){const t=e._getRadialGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fill(e){const t=e.fill(),r=e.getFillPriority();if(t&&r==="color"){this._fillColor(e);return}const s=e.getFillPatternImage();if(s&&r==="pattern"){this._fillPattern(e);return}const i=e.getFillLinearGradientColorStops();if(i&&r==="linear-gradient"){this._fillLinearGradient(e);return}const a=e.getFillRadialGradientColorStops();if(a&&r==="radial-gradient"){this._fillRadialGradient(e);return}t?this._fillColor(e):s?this._fillPattern(e):i?this._fillLinearGradient(e):a&&this._fillRadialGradient(e)}_strokeLinearGradient(e){const t=e.getStrokeLinearGradientStartPoint(),r=e.getStrokeLinearGradientEndPoint(),s=e.getStrokeLinearGradientColorStops(),i=this.createLinearGradient(t.x,t.y,r.x,r.y);if(s){for(let a=0;a<s.length;a+=2)i.addColorStop(s[a],s[a+1]);this.setAttr("strokeStyle",i)}}_stroke(e){const t=e.dash(),r=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!r){this.save();const i=this.getCanvas().getPixelRatio();this.setTransform(i,0,0,i,0,0)}this._applyLineCap(e),t&&e.dashEnabled()&&(this.setLineDash(t),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),e.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),r||this.restore()}}_applyShadow(e){var t,r,s;const i=(t=e.getShadowRGBA())!==null&&t!==void 0?t:"black",a=(r=e.getShadowBlur())!==null&&r!==void 0?r:5,o=(s=e.getShadowOffset())!==null&&s!==void 0?s:{x:0,y:0},l=e.getAbsoluteScale(),u=this.canvas.getPixelRatio(),h=l.x*u,f=l.y*u;this.setAttr("shadowColor",i),this.setAttr("shadowBlur",a*Math.min(Math.abs(h),Math.abs(f))),this.setAttr("shadowOffsetX",o.x*h),this.setAttr("shadowOffsetY",o.y*f)}}$o.SceneContext=Hee;class qee extends Y1{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){const t=e.getStrokeScaleEnabled();if(!t){this.save();const i=this.getCanvas().getPixelRatio();this.setTransform(i,0,0,i,0,0)}this._applyLineCap(e);const r=e.hitStrokeWidth(),s=r==="auto"?e.strokeWidth():r;this.setAttr("lineWidth",s),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),t||this.restore()}}}$o.HitContext=qee;Object.defineProperty(la,"__esModule",{value:!0});la.HitCanvas=la.SceneCanvas=la.Canvas=void 0;const pw=En,_F=$o,yF=ct;let n0;function Kee(){if(n0)return n0;const n=pw.Util.createCanvasElement(),e=n.getContext("2d");return n0=function(){const t=yF.Konva._global.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/r}(),pw.Util.releaseCanvas(n),n0}let AP=class{constructor(e){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const r=(e||{}).pixelRatio||yF.Konva.pixelRatio||Kee();this.pixelRatio=r,this._canvas=pw.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(e){const t=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/t,this.getHeight()/t)}setWidth(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";const t=this.pixelRatio;this.getContext()._context.scale(t,t)}setHeight(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";const t=this.pixelRatio;this.getContext()._context.scale(t,t)}getWidth(){return this.width}getHeight(){return this.height}setSize(e,t){this.setWidth(e||0),this.setHeight(t||0)}toDataURL(e,t){try{return this._canvas.toDataURL(e,t)}catch{try{return this._canvas.toDataURL()}catch(s){return pw.Util.error("Unable to get data URL. "+s.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};la.Canvas=AP;class Qee extends AP{constructor(e={width:0,height:0,willReadFrequently:!1}){super(e),this.context=new _F.SceneContext(this,{willReadFrequently:e.willReadFrequently}),this.setSize(e.width,e.height)}}la.SceneCanvas=Qee;class Yee extends AP{constructor(e={width:0,height:0}){super(e),this.hitCanvas=!0,this.context=new _F.HitContext(this),this.setSize(e.width,e.height)}}la.HitCanvas=Yee;var J1={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.DD=void 0;const e=ct,t=En;n.DD={get isDragging(){let r=!1;return n.DD._dragElements.forEach(s=>{s.dragStatus==="dragging"&&(r=!0)}),r},justDragged:!1,get node(){let r;return n.DD._dragElements.forEach(s=>{r=s.node}),r},_dragElements:new Map,_drag(r){const s=[];n.DD._dragElements.forEach((i,a)=>{const{node:o}=i,l=o.getStage();l.setPointersPositions(r),i.pointerId===void 0&&(i.pointerId=t.Util._getFirstPointerId(r));const u=l._changedPointerPositions.find(h=>h.id===i.pointerId);if(u){if(i.dragStatus!=="dragging"){const h=o.dragDistance();if(Math.max(Math.abs(u.x-i.startPointerPos.x),Math.abs(u.y-i.startPointerPos.y))<h||(o.startDrag({evt:r}),!o.isDragging()))return}o._setDragPosition(r,i),s.push(o)}}),s.forEach(i=>{i.fire("dragmove",{type:"dragmove",target:i,evt:r},!0)})},_endDragBefore(r){const s=[];n.DD._dragElements.forEach(i=>{const{node:a}=i,o=a.getStage();if(r&&o.setPointersPositions(r),!o._changedPointerPositions.find(h=>h.id===i.pointerId))return;(i.dragStatus==="dragging"||i.dragStatus==="stopped")&&(n.DD.justDragged=!0,e.Konva._mouseListenClick=!1,e.Konva._touchListenClick=!1,e.Konva._pointerListenClick=!1,i.dragStatus="stopped");const u=i.node.getLayer()||i.node instanceof e.Konva.Stage&&i.node;u&&s.indexOf(u)===-1&&s.push(u)}),s.forEach(i=>{i.draw()})},_endDragAfter(r){n.DD._dragElements.forEach((s,i)=>{s.dragStatus==="stopped"&&s.node.fire("dragend",{type:"dragend",target:s.node,evt:r},!0),s.dragStatus!=="dragging"&&n.DD._dragElements.delete(i)})}},e.Konva.isBrowser&&(window.addEventListener("mouseup",n.DD._endDragBefore,!0),window.addEventListener("touchend",n.DD._endDragBefore,!0),window.addEventListener("touchcancel",n.DD._endDragBefore,!0),window.addEventListener("mousemove",n.DD._drag),window.addEventListener("touchmove",n.DD._drag),window.addEventListener("mouseup",n.DD._endDragAfter,!1),window.addEventListener("touchend",n.DD._endDragAfter,!1),window.addEventListener("touchcancel",n.DD._endDragAfter,!1))})(J1);var _t={},Xe={};Object.defineProperty(Xe,"__esModule",{value:!0});Xe.RGBComponent=Jee;Xe.alphaComponent=Xee;Xe.getNumberValidator=Zee;Xe.getNumberOrArrayOfNumbersValidator=ete;Xe.getNumberOrAutoValidator=tte;Xe.getStringValidator=nte;Xe.getStringOrGradientValidator=rte;Xe.getFunctionValidator=ste;Xe.getNumberArrayValidator=ite;Xe.getBooleanValidator=ate;Xe.getComponentValidator=ote;const tl=ct,Tn=En;function nl(n){return Tn.Util._isString(n)?'"'+n+'"':Object.prototype.toString.call(n)==="[object Number]"||Tn.Util._isBoolean(n)?n:Object.prototype.toString.call(n)}function Jee(n){return n>255?255:n<0?0:Math.round(n)}function Xee(n){return n>1?1:n<1e-4?1e-4:n}function Zee(){if(tl.Konva.isUnminified)return function(n,e){return Tn.Util._isNumber(n)||Tn.Util.warn(nl(n)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),n}}function ete(n){if(tl.Konva.isUnminified)return function(e,t){let r=Tn.Util._isNumber(e),s=Tn.Util._isArray(e)&&e.length==n;return!r&&!s&&Tn.Util.warn(nl(e)+' is a not valid value for "'+t+'" attribute. The value should be a number or Array<number>('+n+")"),e}}function tte(){if(tl.Konva.isUnminified)return function(n,e){return Tn.Util._isNumber(n)||n==="auto"||Tn.Util.warn(nl(n)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),n}}function nte(){if(tl.Konva.isUnminified)return function(n,e){return Tn.Util._isString(n)||Tn.Util.warn(nl(n)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),n}}function rte(){if(tl.Konva.isUnminified)return function(n,e){const t=Tn.Util._isString(n),r=Object.prototype.toString.call(n)==="[object CanvasGradient]"||n&&n.addColorStop;return t||r||Tn.Util.warn(nl(n)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),n}}function ste(){if(tl.Konva.isUnminified)return function(n,e){return Tn.Util._isFunction(n)||Tn.Util.warn(nl(n)+' is a not valid value for "'+e+'" attribute. The value should be a function.'),n}}function ite(){if(tl.Konva.isUnminified)return function(n,e){const t=Int8Array?Object.getPrototypeOf(Int8Array):null;return t&&n instanceof t||(Tn.Util._isArray(n)?n.forEach(function(r){Tn.Util._isNumber(r)||Tn.Util.warn('"'+e+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")}):Tn.Util.warn(nl(n)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),n}}function ate(){if(tl.Konva.isUnminified)return function(n,e){return n===!0||n===!1||Tn.Util.warn(nl(n)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),n}}function ote(n){if(tl.Konva.isUnminified)return function(e,t){return e==null||Tn.Util.isObject(e)||Tn.Util.warn(nl(e)+' is a not valid value for "'+t+'" attribute. The value should be an object with properties '+n),e}}(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Factory=void 0;const e=En,t=Xe,r="get",s="set";n.Factory={addGetterSetter(i,a,o,l,u){n.Factory.addGetter(i,a,o),n.Factory.addSetter(i,a,l,u),n.Factory.addOverloadedGetterSetter(i,a)},addGetter(i,a,o){const l=r+e.Util._capitalize(a);i.prototype[l]=i.prototype[l]||function(){const u=this.attrs[a];return u===void 0?o:u}},addSetter(i,a,o,l){const u=s+e.Util._capitalize(a);i.prototype[u]||n.Factory.overWriteSetter(i,a,o,l)},overWriteSetter(i,a,o,l){const u=s+e.Util._capitalize(a);i.prototype[u]=function(h){return o&&h!==void 0&&h!==null&&(h=o.call(this,h,a)),this._setAttr(a,h),l&&l.call(this),this}},addComponentsGetterSetter(i,a,o,l,u){const h=o.length,f=e.Util._capitalize,p=r+f(a),y=s+f(a);i.prototype[p]=function(){const b={};for(let S=0;S<h;S++){const E=o[S];b[E]=this.getAttr(a+f(E))}return b};const _=(0,t.getComponentValidator)(o);i.prototype[y]=function(b){const S=this.attrs[a];l&&(b=l.call(this,b,a)),_&&_.call(this,b,a);for(const E in b)b.hasOwnProperty(E)&&this._setAttr(a+f(E),b[E]);return b||o.forEach(E=>{this._setAttr(a+f(E),void 0)}),this._fireChangeEvent(a,S,b),u&&u.call(this),this},n.Factory.addOverloadedGetterSetter(i,a)},addOverloadedGetterSetter(i,a){const o=e.Util._capitalize(a),l=s+o,u=r+o;i.prototype[a]=function(){return arguments.length?(this[l](arguments[0]),this):this[u]()}},addDeprecatedGetterSetter(i,a,o,l){e.Util.error("Adding deprecated "+a);const u=r+e.Util._capitalize(a),h=a+" property is deprecated and will be removed soon. Look at Konva change log for more information.";i.prototype[u]=function(){e.Util.error(h);const f=this.attrs[a];return f===void 0?o:f},n.Factory.addSetter(i,a,l,function(){e.Util.error(h)}),n.Factory.addOverloadedGetterSetter(i,a)},backCompat(i,a){e.Util.each(a,function(o,l){const u=i.prototype[l],h=r+e.Util._capitalize(o),f=s+e.Util._capitalize(o);function p(){u.apply(this,arguments),e.Util.error('"'+o+'" method is deprecated and will be removed soon. Use ""'+l+'" instead.')}i.prototype[o]=p,i.prototype[h]=p,i.prototype[f]=p})},afterSetFilter(){this._filterUpToDate=!1}}})(_t);Object.defineProperty(fn,"__esModule",{value:!0});fn.Node=void 0;const Vd=la,wi=J1,v_=_t,bl=ct,bt=En,On=Xe,J0="absoluteOpacity",r0="allEventListeners",Eo="absoluteTransform",C3="absoluteScale",oc="canvas",lte="Change",ute="children",cte="konva",GC="listening",dte="mouseenter",hte="mouseleave",fte="pointerenter",pte="pointerleave",mte="touchenter",gte="touchleave",I3="set",x3="Shape",X0=" ",k3="stage",Il="transform",_te="Stage",WC="visible",yte=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(X0);let vte=1;class nt{constructor(e){this._id=vte++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(e),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(e){(e===Il||e===Eo)&&this._cache.get(e)?this._cache.get(e).dirty=!0:e?this._cache.delete(e):this._cache.clear()}_getCache(e,t){let r=this._cache.get(e);return(r===void 0||(e===Il||e===Eo)&&r.dirty===!0)&&(r=t.call(this),this._cache.set(e,r)),r}_calculate(e,t,r){if(!this._attachedDepsListeners.get(e)){const s=t.map(i=>i+"Change.konva").join(X0);this.on(s,()=>{this._clearCache(e)}),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,r)}_getCanvasCache(){return this._cache.get(oc)}_clearSelfAndDescendantCache(e){this._clearCache(e),e===Eo&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(oc)){const{scene:e,filter:t,hit:r,buffer:s}=this._cache.get(oc);bt.Util.releaseCanvas(e,t,r,s),this._cache.delete(oc)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){const t=e||{};let r={};(t.x===void 0||t.y===void 0||t.width===void 0||t.height===void 0)&&(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let s=Math.ceil(t.width||r.width),i=Math.ceil(t.height||r.height),a=t.pixelRatio,o=t.x===void 0?Math.floor(r.x):t.x,l=t.y===void 0?Math.floor(r.y):t.y,u=t.offset||0,h=t.drawBorder||!1,f=t.hitCanvasPixelRatio||1;if(!s||!i){bt.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const p=Math.abs(Math.round(r.x)-o)>.5?1:0,y=Math.abs(Math.round(r.y)-l)>.5?1:0;s+=u*2+p,i+=u*2+y,o-=u,l-=u;const _=new Vd.SceneCanvas({pixelRatio:a,width:s,height:i}),b=new Vd.SceneCanvas({pixelRatio:a,width:0,height:0,willReadFrequently:!0}),S=new Vd.HitCanvas({pixelRatio:f,width:s,height:i}),E=_.getContext(),C=S.getContext(),v=new Vd.SceneCanvas({width:_.width/_.pixelRatio+Math.abs(o),height:_.height/_.pixelRatio+Math.abs(l),pixelRatio:_.pixelRatio}),I=v.getContext();return S.isCache=!0,_.isCache=!0,this._cache.delete(oc),this._filterUpToDate=!1,t.imageSmoothingEnabled===!1&&(_.getContext()._context.imageSmoothingEnabled=!1,b.getContext()._context.imageSmoothingEnabled=!1),E.save(),C.save(),I.save(),E.translate(-o,-l),C.translate(-o,-l),I.translate(-o,-l),v.x=o,v.y=l,this._isUnderCache=!0,this._clearSelfAndDescendantCache(J0),this._clearSelfAndDescendantCache(C3),this.drawScene(_,this,v),this.drawHit(S,this),this._isUnderCache=!1,E.restore(),C.restore(),h&&(E.save(),E.beginPath(),E.rect(0,0,s,i),E.closePath(),E.setAttr("strokeStyle","red"),E.setAttr("lineWidth",5),E.stroke(),E.restore()),this._cache.set(oc,{scene:_,filter:b,hit:S,buffer:v,x:o,y:l}),this._requestDraw(),this}isCached(){return this._cache.has(oc)}getClientRect(e){throw new Error('abstract "getClientRect" method call')}_transformedRect(e,t){const r=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}];let s=1/0,i=1/0,a=-1/0,o=-1/0;const l=this.getAbsoluteTransform(t);return r.forEach(function(u){const h=l.point(u);s===void 0&&(s=a=h.x,i=o=h.y),s=Math.min(s,h.x),i=Math.min(i,h.y),a=Math.max(a,h.x),o=Math.max(o,h.y)}),{x:s,y:i,width:a-s,height:o-i}}_drawCachedSceneCanvas(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);const t=this._getCanvasCache();e.translate(t.x,t.y);const r=this._getCachedSceneCanvas(),s=r.pixelRatio;e.drawImage(r._canvas,0,0,r.width/s,r.height/s),e.restore()}_drawCachedHitCanvas(e){const t=this._getCanvasCache(),r=t.hit;e.save(),e.translate(t.x,t.y),e.drawImage(r._canvas,0,0,r.width/r.pixelRatio,r.height/r.pixelRatio),e.restore()}_getCachedSceneCanvas(){let e=this.filters(),t=this._getCanvasCache(),r=t.scene,s=t.filter,i=s.getContext(),a,o,l,u;if(e){if(!this._filterUpToDate){const h=r.pixelRatio;s.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio);try{for(a=e.length,i.clear(),i.drawImage(r._canvas,0,0,r.getWidth()/h,r.getHeight()/h),o=i.getImageData(0,0,s.getWidth(),s.getHeight()),l=0;l<a;l++){if(u=e[l],typeof u!="function"){bt.Util.error("Filter should be type of function, but got "+typeof u+" instead. Please check correct filters");continue}u.call(this,o),i.putImageData(o,0,0)}}catch(f){bt.Util.error("Unable to apply filter. "+f.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return s}return r}on(e,t){if(this._cache&&this._cache.delete(r0),arguments.length===3)return this._delegate.apply(this,arguments);const r=e.split(X0);for(let s=0;s<r.length;s++){const a=r[s].split("."),o=a[0],l=a[1]||"";this.eventListeners[o]||(this.eventListeners[o]=[]),this.eventListeners[o].push({name:l,handler:t})}return this}off(e,t){let r=(e||"").split(X0),s=r.length,i,a,o,l,u,h;if(this._cache&&this._cache.delete(r0),!e)for(a in this.eventListeners)this._off(a);for(i=0;i<s;i++)if(o=r[i],l=o.split("."),u=l[0],h=l[1],u)this.eventListeners[u]&&this._off(u,h,t);else for(a in this.eventListeners)this._off(a,h,t);return this}dispatchEvent(e){const t={target:this,type:e.type,evt:e};return this.fire(e.type,t),this}addEventListener(e,t){return this.on(e,function(r){t.call(this,r.evt)}),this}removeEventListener(e){return this.off(e),this}_delegate(e,t,r){const s=this;this.on(e,function(i){const a=i.target.findAncestors(t,!0,s);for(let o=0;o<a.length;o++)i=bt.Util.cloneObject(i),i.currentTarget=a[o],r.call(a[o],i)})}remove(){return this.isDragging()&&this.stopDrag(),wi.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(Eo),this._clearSelfAndDescendantCache(J0),this._clearSelfAndDescendantCache(C3),this._clearSelfAndDescendantCache(k3),this._clearSelfAndDescendantCache(WC),this._clearSelfAndDescendantCache(GC)}_remove(){this._clearCaches();const e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(e){const t="get"+bt.Util._capitalize(e);return bt.Util._isFunction(this[t])?this[t]():this.attrs[e]}getAncestors(){let e=this.getParent(),t=[];for(;e;)t.push(e),e=e.getParent();return t}getAttrs(){return this.attrs||{}}setAttrs(e){return this._batchTransformChanges(()=>{let t,r;if(!e)return this;for(t in e)t!==ute&&(r=I3+bt.Util._capitalize(t),bt.Util._isFunction(this[r])?this[r](e[t]):this._setAttr(t,e[t]))}),this}isListening(){return this._getCache(GC,this._isListening)}_isListening(e){if(!this.listening())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isListening(e):!0}isVisible(){return this._getCache(WC,this._isVisible)}_isVisible(e){if(!this.visible())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isVisible(e):!0}shouldDrawHit(e,t=!1){if(e)return this._isVisible(e)&&this._isListening(e);const r=this.getLayer();let s=!1;wi.DD._dragElements.forEach(a=>{a.dragStatus==="dragging"&&(a.node.nodeType==="Stage"||a.node.getLayer()===r)&&(s=!0)});const i=!t&&!bl.Konva.hitOnDragEnabled&&(s||bl.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!i}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let e=this.getDepth(),t=this,r=0,s,i,a,o;function l(h){for(s=[],i=h.length,a=0;a<i;a++)o=h[a],r++,o.nodeType!==x3&&(s=s.concat(o.getChildren().slice())),o._id===t._id&&(a=i);s.length>0&&s[0].getDepth()<=e&&l(s)}const u=this.getStage();return t.nodeType!==_te&&u&&l(u.getChildren()),r}getDepth(){let e=0,t=this.parent;for(;t;)e++,t=t.parent;return e}_batchTransformChanges(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(Il),this._clearSelfAndDescendantCache(Eo)),this._needClearTransformCache=!1}setPosition(e){return this._batchTransformChanges(()=>{this.x(e.x),this.y(e.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const e=this.getStage();if(!e)return null;const t=e.getPointerPosition();if(!t)return null;const r=this.getAbsoluteTransform().copy();return r.invert(),r.point(t)}getAbsolutePosition(e){let t=!1,r=this.parent;for(;r;){if(r.isCached()){t=!0;break}r=r.parent}t&&!e&&(e=!0);const s=this.getAbsoluteTransform(e).getMatrix(),i=new bt.Transform,a=this.offset();return i.m=s.slice(),i.translate(a.x,a.y),i.getTranslation()}setAbsolutePosition(e){const{x:t,y:r,...s}=this._clearTransform();this.attrs.x=t,this.attrs.y=r,this._clearCache(Il);const i=this._getAbsoluteTransform().copy();return i.invert(),i.translate(e.x,e.y),e={x:this.attrs.x+i.getTranslation().x,y:this.attrs.y+i.getTranslation().y},this._setTransform(s),this.setPosition({x:e.x,y:e.y}),this._clearCache(Il),this._clearSelfAndDescendantCache(Eo),this}_setTransform(e){let t;for(t in e)this.attrs[t]=e[t]}_clearTransform(){const e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}move(e){let t=e.x,r=e.y,s=this.x(),i=this.y();return t!==void 0&&(s+=t),r!==void 0&&(i+=r),this.setPosition({x:s,y:i}),this}_eachAncestorReverse(e,t){let r=[],s=this.getParent(),i,a;if(!(t&&t._id===this._id)){for(r.unshift(this);s&&(!t||s._id!==t._id);)r.unshift(s),s=s.parent;for(i=r.length,a=0;a<i;a++)e(r[a])}}rotate(e){return this.rotation(this.rotation()+e),this}moveToTop(){if(!this.parent)return bt.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return bt.Util.warn("Node has no parent. moveUp function is ignored."),!1;const e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return bt.Util.warn("Node has no parent. moveDown function is ignored."),!1;const e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return bt.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(e){if(!this.parent)return bt.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&bt.Util.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(J0,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let e=this.opacity();const t=this.getParent();return t&&!t._isUnderCache&&(e*=t.getAbsoluteOpacity()),e}moveTo(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}toObject(){let e=this.getAttrs(),t,r,s,i,a;const o={attrs:{},className:this.getClassName()};for(t in e)r=e[t],a=bt.Util.isObject(r)&&!bt.Util._isPlainObject(r)&&!bt.Util._isArray(r),!a&&(s=typeof this[t]=="function"&&this[t],delete e[t],i=s?s.call(this):null,e[t]=r,i!==r&&(o.attrs[t]=r));return bt.Util._prepareToStringify(o)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(e,t,r){const s=[];t&&this._isMatch(e)&&s.push(this);let i=this.parent;for(;i;){if(i===r)return s;i._isMatch(e)&&s.push(i),i=i.parent}return s}isAncestorOf(e){return!1}findAncestor(e,t,r){return this.findAncestors(e,t,r)[0]}_isMatch(e){if(!e)return!1;if(typeof e=="function")return e(this);let t=e.replace(/ /g,"").split(","),r=t.length,s,i;for(s=0;s<r;s++)if(i=t[s],bt.Util.isValidSelector(i)||(bt.Util.warn('Selector "'+i+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),bt.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),bt.Util.warn("Konva is awesome, right?")),i.charAt(0)==="#"){if(this.id()===i.slice(1))return!0}else if(i.charAt(0)==="."){if(this.hasName(i.slice(1)))return!0}else if(this.className===i||this.nodeType===i)return!0;return!1}getLayer(){const e=this.getParent();return e?e.getLayer():null}getStage(){return this._getCache(k3,this._getStage)}_getStage(){const e=this.getParent();return e?e.getStage():null}fire(e,t={},r){return t.target=t.target||this,r?this._fireAndBubble(e,t):this._fire(e,t),this}getAbsoluteTransform(e){return e?this._getAbsoluteTransform(e):this._getCache(Eo,this._getAbsoluteTransform)}_getAbsoluteTransform(e){let t;if(e)return t=new bt.Transform,this._eachAncestorReverse(function(r){const s=r.transformsEnabled();s==="all"?t.multiply(r.getTransform()):s==="position"&&t.translate(r.x()-r.offsetX(),r.y()-r.offsetY())},e),t;{t=this._cache.get(Eo)||new bt.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(t):t.reset();const r=this.transformsEnabled();if(r==="all")t.multiply(this.getTransform());else if(r==="position"){const s=this.attrs.x||0,i=this.attrs.y||0,a=this.attrs.offsetX||0,o=this.attrs.offsetY||0;t.translate(s-a,i-o)}return t.dirty=!1,t}}getAbsoluteScale(e){let t=this;for(;t;)t._isUnderCache&&(e=t),t=t.getParent();const s=this.getAbsoluteTransform(e).decompose();return{x:s.scaleX,y:s.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(Il,this._getTransform)}_getTransform(){var e,t;const r=this._cache.get(Il)||new bt.Transform;r.reset();const s=this.x(),i=this.y(),a=bl.Konva.getAngle(this.rotation()),o=(e=this.attrs.scaleX)!==null&&e!==void 0?e:1,l=(t=this.attrs.scaleY)!==null&&t!==void 0?t:1,u=this.attrs.skewX||0,h=this.attrs.skewY||0,f=this.attrs.offsetX||0,p=this.attrs.offsetY||0;return(s!==0||i!==0)&&r.translate(s,i),a!==0&&r.rotate(a),(u!==0||h!==0)&&r.skew(u,h),(o!==1||l!==1)&&r.scale(o,l),(f!==0||p!==0)&&r.translate(-1*f,-1*p),r.dirty=!1,r}clone(e){let t=bt.Util.cloneObject(this.attrs),r,s,i,a,o;for(r in e)t[r]=e[r];const l=new this.constructor(t);for(r in this.eventListeners)for(s=this.eventListeners[r],i=s.length,a=0;a<i;a++)o=s[a],o.name.indexOf(cte)<0&&(l.eventListeners[r]||(l.eventListeners[r]=[]),l.eventListeners[r].push(o));return l}_toKonvaCanvas(e){e=e||{};const t=this.getClientRect(),r=this.getStage(),s=e.x!==void 0?e.x:Math.floor(t.x),i=e.y!==void 0?e.y:Math.floor(t.y),a=e.pixelRatio||1,o=new Vd.SceneCanvas({width:e.width||Math.ceil(t.width)||(r?r.width():0),height:e.height||Math.ceil(t.height)||(r?r.height():0),pixelRatio:a}),l=o.getContext(),u=new Vd.SceneCanvas({width:o.width/o.pixelRatio+Math.abs(s),height:o.height/o.pixelRatio+Math.abs(i),pixelRatio:o.pixelRatio});return e.imageSmoothingEnabled===!1&&(l._context.imageSmoothingEnabled=!1),l.save(),(s||i)&&l.translate(-1*s,-1*i),this.drawScene(o,void 0,u),l.restore(),o}toCanvas(e){return this._toKonvaCanvas(e)._canvas}toDataURL(e){e=e||{};const t=e.mimeType||null,r=e.quality||null,s=this._toKonvaCanvas(e).toDataURL(t,r);return e.callback&&e.callback(s),s}toImage(e){return new Promise((t,r)=>{try{const s=e==null?void 0:e.callback;s&&delete e.callback,bt.Util._urlToImage(this.toDataURL(e),function(i){t(i),s==null||s(i)})}catch(s){r(s)}})}toBlob(e){return new Promise((t,r)=>{try{const s=e==null?void 0:e.callback;s&&delete e.callback,this.toCanvas(e).toBlob(i=>{t(i),s==null||s(i)},e==null?void 0:e.mimeType,e==null?void 0:e.quality)}catch(s){r(s)}})}setSize(e){return this.width(e.width),this.height(e.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():bl.Konva.dragDistance}_off(e,t,r){let s=this.eventListeners[e],i,a,o;for(i=0;i<s.length;i++)if(a=s[i].name,o=s[i].handler,(a!=="konva"||t==="konva")&&(!t||a===t)&&(!r||r===o)){if(s.splice(i,1),s.length===0){delete this.eventListeners[e];break}i--}}_fireChangeEvent(e,t,r){this._fire(e+lte,{oldVal:t,newVal:r})}addName(e){if(!this.hasName(e)){const t=this.name(),r=t?t+" "+e:e;this.name(r)}return this}hasName(e){if(!e)return!1;const t=this.name();return t?(t||"").split(/\s/g).indexOf(e)!==-1:!1}removeName(e){const t=(this.name()||"").split(/\s/g),r=t.indexOf(e);return r!==-1&&(t.splice(r,1),this.name(t.join(" "))),this}setAttr(e,t){const r=this[I3+bt.Util._capitalize(e)];return bt.Util._isFunction(r)?r.call(this,t):this._setAttr(e,t),this}_requestDraw(){if(bl.Konva.autoDrawEnabled){const e=this.getLayer()||this.getStage();e==null||e.batchDraw()}}_setAttr(e,t){const r=this.attrs[e];r===t&&!bt.Util.isObject(t)||(t==null?delete this.attrs[e]:this.attrs[e]=t,this._shouldFireChangeEvents&&this._fireChangeEvent(e,r,t),this._requestDraw())}_setComponentAttr(e,t,r){let s;r!==void 0&&(s=this.attrs[e],s||(this.attrs[e]=this.getAttr(e)),this.attrs[e][t]=r,this._fireChangeEvent(e,s,r))}_fireAndBubble(e,t,r){t&&this.nodeType===x3&&(t.target=this);const s=[dte,hte,fte,pte,mte,gte];if(!(s.indexOf(e)!==-1&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||this.nodeType==="Stage"&&!r))){this._fire(e,t);const a=s.indexOf(e)!==-1&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(t&&!t.cancelBubble||!t)&&this.parent&&this.parent.isListening()&&!a&&(r&&r.parent?this._fireAndBubble.call(this.parent,e,t,r):this._fireAndBubble.call(this.parent,e,t))}}_getProtoListeners(e){var t,r,s;const i=(t=this._cache.get(r0))!==null&&t!==void 0?t:{};let a=i==null?void 0:i[e];if(a===void 0){a=[];let o=Object.getPrototypeOf(this);for(;o;){const l=(s=(r=o.eventListeners)===null||r===void 0?void 0:r[e])!==null&&s!==void 0?s:[];a.push(...l),o=Object.getPrototypeOf(o)}i[e]=a,this._cache.set(r0,i)}return a}_fire(e,t){t=t||{},t.currentTarget=this,t.type=e;const r=this._getProtoListeners(e);if(r)for(let i=0;i<r.length;i++)r[i].handler.call(this,t);const s=this.eventListeners[e];if(s)for(let i=0;i<s.length;i++)s[i].handler.call(this,t)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(e){const t=e?e.pointerId:void 0,r=this.getStage(),s=this.getAbsolutePosition();if(!r)return;const i=r._getPointerById(t)||r._changedPointerPositions[0]||s;wi.DD._dragElements.set(this._id,{node:this,startPointerPos:i,offset:{x:i.x-s.x,y:i.y-s.y},dragStatus:"ready",pointerId:t})}startDrag(e,t=!0){wi.DD._dragElements.has(this._id)||this._createDragElement(e);const r=wi.DD._dragElements.get(this._id);r.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},t)}_setDragPosition(e,t){const r=this.getStage()._getPointerById(t.pointerId);if(!r)return;let s={x:r.x-t.offset.x,y:r.y-t.offset.y};const i=this.dragBoundFunc();if(i!==void 0){const a=i.call(this,s,e);a?s=a:bt.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==s.x||this._lastPos.y!==s.y)&&(this.setAbsolutePosition(s),this._requestDraw()),this._lastPos=s}stopDrag(e){const t=wi.DD._dragElements.get(this._id);t&&(t.dragStatus="stopped"),wi.DD._endDragBefore(e),wi.DD._endDragAfter(e)}setDraggable(e){this._setAttr("draggable",e),this._dragChange()}isDragging(){const e=wi.DD._dragElements.get(this._id);return e?e.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(e){if(!(!(e.evt.button!==void 0)||bl.Konva.dragButtons.indexOf(e.evt.button)>=0)||this.isDragging())return;let s=!1;wi.DD._dragElements.forEach(i=>{this.isAncestorOf(i.node)&&(s=!0)}),s||this._createDragElement(e)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const t=wi.DD._dragElements.get(this._id),r=t&&t.dragStatus==="dragging",s=t&&t.dragStatus==="ready";r?this.stopDrag():s&&wi.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(e={x:0,y:0}){const t=this.getStage();if(!t)return!1;const r={x:-e.x,y:-e.y,width:t.width()+2*e.x,height:t.height()+2*e.y};return bt.Util.haveIntersection(r,this.getClientRect())}static create(e,t){return bt.Util._isString(e)&&(e=JSON.parse(e)),this._createNode(e,t)}static _createNode(e,t){let r=nt.prototype.getClassName.call(e),s=e.children,i,a,o;t&&(e.attrs.container=t),bl.Konva[r]||(bt.Util.warn('Can not find a node with class name "'+r+'". Fallback to "Shape".'),r="Shape");const l=bl.Konva[r];if(i=new l(e.attrs),s)for(a=s.length,o=0;o<a;o++)i.add(nt._createNode(s[o]));return i}}fn.Node=nt;nt.prototype.nodeType="Node";nt.prototype._attrsAffectingSize=[];nt.prototype.eventListeners={};nt.prototype.on.call(nt.prototype,yte,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(Il),this._clearSelfAndDescendantCache(Eo)});nt.prototype.on.call(nt.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(WC)});nt.prototype.on.call(nt.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(GC)});nt.prototype.on.call(nt.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(J0)});const rn=v_.Factory.addGetterSetter;rn(nt,"zIndex");rn(nt,"absolutePosition");rn(nt,"position");rn(nt,"x",0,(0,On.getNumberValidator)());rn(nt,"y",0,(0,On.getNumberValidator)());rn(nt,"globalCompositeOperation","source-over",(0,On.getStringValidator)());rn(nt,"opacity",1,(0,On.getNumberValidator)());rn(nt,"name","",(0,On.getStringValidator)());rn(nt,"id","",(0,On.getStringValidator)());rn(nt,"rotation",0,(0,On.getNumberValidator)());v_.Factory.addComponentsGetterSetter(nt,"scale",["x","y"]);rn(nt,"scaleX",1,(0,On.getNumberValidator)());rn(nt,"scaleY",1,(0,On.getNumberValidator)());v_.Factory.addComponentsGetterSetter(nt,"skew",["x","y"]);rn(nt,"skewX",0,(0,On.getNumberValidator)());rn(nt,"skewY",0,(0,On.getNumberValidator)());v_.Factory.addComponentsGetterSetter(nt,"offset",["x","y"]);rn(nt,"offsetX",0,(0,On.getNumberValidator)());rn(nt,"offsetY",0,(0,On.getNumberValidator)());rn(nt,"dragDistance",void 0,(0,On.getNumberValidator)());rn(nt,"width",0,(0,On.getNumberValidator)());rn(nt,"height",0,(0,On.getNumberValidator)());rn(nt,"listening",!0,(0,On.getBooleanValidator)());rn(nt,"preventDefault",!0,(0,On.getBooleanValidator)());rn(nt,"filters",void 0,function(n){return this._filterUpToDate=!1,n});rn(nt,"visible",!0,(0,On.getBooleanValidator)());rn(nt,"transformsEnabled","all",(0,On.getStringValidator)());rn(nt,"size");rn(nt,"dragBoundFunc");rn(nt,"draggable",!1,(0,On.getBooleanValidator)());v_.Factory.backCompat(nt,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});var od={};Object.defineProperty(od,"__esModule",{value:!0});od.Container=void 0;const Rf=_t,a2=fn,X1=Xe;class ld extends a2.Node{constructor(){super(...arguments),this.children=[]}getChildren(e){const t=this.children||[];return e?t.filter(e):t}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.destroy()}),this.children=[],this._requestDraw(),this}add(...e){if(e.length===0)return this;if(e.length>1){for(let r=0;r<e.length;r++)this.add(e[r]);return this}const t=e[0];return t.getParent()?(t.moveTo(this),this):(this._validateAdd(t),t.index=this.getChildren().length,t.parent=this,t._clearCaches(),this.getChildren().push(t),this._fire("add",{child:t}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(e){return this._generalFind(e,!1)}findOne(e){const t=this._generalFind(e,!0);return t.length>0?t[0]:void 0}_generalFind(e,t){const r=[];return this._descendants(s=>{const i=s._isMatch(e);return i&&r.push(s),!!(i&&t)}),r}_descendants(e){let t=!1;const r=this.getChildren();for(const s of r){if(t=e(s),t)return!0;if(s.hasChildren()&&(t=s._descendants(e),t))return!0}return!1}toObject(){const e=a2.Node.prototype.toObject.call(this);return e.children=[],this.getChildren().forEach(t=>{e.children.push(t.toObject())}),e}isAncestorOf(e){let t=e.getParent();for(;t;){if(t._id===this._id)return!0;t=t.getParent()}return!1}clone(e){const t=a2.Node.prototype.clone.call(this,e);return this.getChildren().forEach(function(r){t.add(r.clone())}),t}getAllIntersections(e){const t=[];return this.find("Shape").forEach(r=>{r.isVisible()&&r.intersects(e)&&t.push(r)}),t}_clearSelfAndDescendantCache(e){var t;super._clearSelfAndDescendantCache(e),!this.isCached()&&((t=this.children)===null||t===void 0||t.forEach(function(r){r._clearSelfAndDescendantCache(e)}))}_setChildrenIndices(){var e;(e=this.children)===null||e===void 0||e.forEach(function(t,r){t.index=r}),this._requestDraw()}drawScene(e,t,r){const s=this.getLayer(),i=e||s&&s.getCanvas(),a=i&&i.getContext(),o=this._getCanvasCache(),l=o&&o.scene,u=i&&i.isCache;if(!this.isVisible()&&!u)return this;if(l){a.save();const h=this.getAbsoluteTransform(t).getMatrix();a.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this._drawCachedSceneCanvas(a),a.restore()}else this._drawChildren("drawScene",i,t,r);return this}drawHit(e,t){if(!this.shouldDrawHit(t))return this;const r=this.getLayer(),s=e||r&&r.hitCanvas,i=s&&s.getContext(),a=this._getCanvasCache();if(a&&a.hit){i.save();const l=this.getAbsoluteTransform(t).getMatrix();i.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(i),i.restore()}else this._drawChildren("drawHit",s,t);return this}_drawChildren(e,t,r,s){var i;const a=t&&t.getContext(),o=this.clipWidth(),l=this.clipHeight(),u=this.clipFunc(),h=typeof o=="number"&&typeof l=="number"||u,f=r===this;if(h){a.save();const y=this.getAbsoluteTransform(r);let _=y.getMatrix();a.transform(_[0],_[1],_[2],_[3],_[4],_[5]),a.beginPath();let b;if(u)b=u.call(this,a,this);else{const S=this.clipX(),E=this.clipY();a.rect(S||0,E||0,o,l)}a.clip.apply(a,b),_=y.copy().invert().getMatrix(),a.transform(_[0],_[1],_[2],_[3],_[4],_[5])}const p=!f&&this.globalCompositeOperation()!=="source-over"&&e==="drawScene";p&&(a.save(),a._applyGlobalCompositeOperation(this)),(i=this.children)===null||i===void 0||i.forEach(function(y){y[e](t,r,s)}),p&&a.restore(),h&&a.restore()}getClientRect(e={}){var t;const r=e.skipTransform,s=e.relativeTo;let i,a,o,l,u={x:1/0,y:1/0,width:0,height:0};const h=this;(t=this.children)===null||t===void 0||t.forEach(function(y){if(!y.visible())return;const _=y.getClientRect({relativeTo:h,skipShadow:e.skipShadow,skipStroke:e.skipStroke});_.width===0&&_.height===0||(i===void 0?(i=_.x,a=_.y,o=_.x+_.width,l=_.y+_.height):(i=Math.min(i,_.x),a=Math.min(a,_.y),o=Math.max(o,_.x+_.width),l=Math.max(l,_.y+_.height)))});const f=this.find("Shape");let p=!1;for(let y=0;y<f.length;y++)if(f[y]._isVisible(this)){p=!0;break}return p&&i!==void 0?u={x:i,y:a,width:o-i,height:l-a}:u={x:0,y:0,width:0,height:0},r?u:this._transformedRect(u,s)}}od.Container=ld;Rf.Factory.addComponentsGetterSetter(ld,"clip",["x","y","width","height"]);Rf.Factory.addGetterSetter(ld,"clipX",void 0,(0,X1.getNumberValidator)());Rf.Factory.addGetterSetter(ld,"clipY",void 0,(0,X1.getNumberValidator)());Rf.Factory.addGetterSetter(ld,"clipWidth",void 0,(0,X1.getNumberValidator)());Rf.Factory.addGetterSetter(ld,"clipHeight",void 0,(0,X1.getNumberValidator)());Rf.Factory.addGetterSetter(ld,"clipFunc");var vF={},Du={};Object.defineProperty(Du,"__esModule",{value:!0});Du.getCapturedShape=bte;Du.createEvent=RP;Du.hasPointerCapture=Ete;Du.setPointerCapture=Ste;Du.releaseCapture=bF;const wte=ct,Ng=new Map,wF=wte.Konva._global.PointerEvent!==void 0;function bte(n){return Ng.get(n)}function RP(n){return{evt:n,pointerId:n.pointerId}}function Ete(n,e){return Ng.get(n)===e}function Ste(n,e){bF(n),e.getStage()&&(Ng.set(n,e),wF&&e._fire("gotpointercapture",RP(new PointerEvent("gotpointercapture"))))}function bF(n,e){const t=Ng.get(n);if(!t)return;const r=t.getStage();r&&r.content,Ng.delete(n),wF&&t._fire("lostpointercapture",RP(new PointerEvent("lostpointercapture")))}(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Stage=n.stages=void 0;const e=En,t=_t,r=od,s=ct,i=la,a=J1,o=ct,l=Du,u="Stage",h="string",f="px",p="mouseout",y="mouseleave",_="mouseover",b="mouseenter",S="mousemove",E="mousedown",C="mouseup",v="pointermove",I="pointerdown",L="pointerup",R="pointercancel",P="lostpointercapture",x="pointerout",N="pointerleave",M="pointerover",D="pointerenter",F="contextmenu",$="touchstart",H="touchend",G="touchmove",ue="touchcancel",ae="wheel",z=5,Q=[[b,"_pointerenter"],[E,"_pointerdown"],[S,"_pointermove"],[C,"_pointerup"],[y,"_pointerleave"],[$,"_pointerdown"],[G,"_pointermove"],[H,"_pointerup"],[ue,"_pointercancel"],[_,"_pointerover"],[ae,"_wheel"],[F,"_contextmenu"],[I,"_pointerdown"],[v,"_pointermove"],[L,"_pointerup"],[R,"_pointercancel"],[N,"_pointerleave"],[P,"_lostpointercapture"]],ee={mouse:{[x]:p,[N]:y,[M]:_,[D]:b,[v]:S,[I]:E,[L]:C,[R]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[x]:"touchout",[N]:"touchleave",[M]:"touchover",[D]:"touchenter",[v]:G,[I]:$,[L]:H,[R]:ue,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[x]:x,[N]:N,[M]:M,[D]:D,[v]:v,[I]:I,[L]:L,[R]:R,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},se=Me=>Me.indexOf("pointer")>=0?"pointer":Me.indexOf("touch")>=0?"touch":"mouse",le=Me=>{const B=se(Me);if(B==="pointer")return s.Konva.pointerEventsEnabled&&ee.pointer;if(B==="touch")return ee.touch;if(B==="mouse")return ee.mouse};function ye(Me={}){return(Me.clipFunc||Me.clipWidth||Me.clipHeight)&&e.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),Me}const ve="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";n.stages=[];class de extends r.Container{constructor(B){super(ye(B)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),n.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{ye(this.attrs)}),this._checkVisibility()}_validateAdd(B){const Z=B.getType()==="Layer",be=B.getType()==="FastLayer";Z||be||e.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const B=this.visible()?"":"none";this.content.style.display=B}setContainer(B){if(typeof B===h){let Z;if(B.charAt(0)==="."){const be=B.slice(1);B=document.getElementsByClassName(be)[0]}else B.charAt(0)!=="#"?Z=B:Z=B.slice(1),B=document.getElementById(Z);if(!B)throw"Can not find container in document with id "+Z}return this._setAttr("container",B),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),B.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const B=this.children,Z=B.length;for(let be=0;be<Z;be++)B[be].clear();return this}clone(B){return B||(B={}),B.container=typeof document<"u"&&document.createElement("div"),r.Container.prototype.clone.call(this,B)}destroy(){super.destroy();const B=this.content;B&&e.Util._isInDocument(B)&&this.container().removeChild(B);const Z=n.stages.indexOf(this);return Z>-1&&n.stages.splice(Z,1),e.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const B=this._pointerPositions[0]||this._changedPointerPositions[0];return B?{x:B.x,y:B.y}:(e.Util.warn(ve),null)}_getPointerById(B){return this._pointerPositions.find(Z=>Z.id===B)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(B){B=B||{},B.x=B.x||0,B.y=B.y||0,B.width=B.width||this.width(),B.height=B.height||this.height();const Z=new i.SceneCanvas({width:B.width,height:B.height,pixelRatio:B.pixelRatio||1}),be=Z.getContext()._context,Ce=this.children;return(B.x||B.y)&&be.translate(-1*B.x,-1*B.y),Ce.forEach(function(Le){if(!Le.isVisible())return;const et=Le._toKonvaCanvas(B);be.drawImage(et._canvas,B.x,B.y,et.getWidth()/et.getPixelRatio(),et.getHeight()/et.getPixelRatio())}),Z}getIntersection(B){if(!B)return null;const Z=this.children,be=Z.length,Ce=be-1;for(let Le=Ce;Le>=0;Le--){const et=Z[Le].getIntersection(B);if(et)return et}return null}_resizeDOM(){const B=this.width(),Z=this.height();this.content&&(this.content.style.width=B+f,this.content.style.height=Z+f),this.bufferCanvas.setSize(B,Z),this.bufferHitCanvas.setSize(B,Z),this.children.forEach(be=>{be.setSize({width:B,height:Z}),be.draw()})}add(B,...Z){if(arguments.length>1){for(let Ce=0;Ce<arguments.length;Ce++)this.add(arguments[Ce]);return this}super.add(B);const be=this.children.length;return be>z&&e.Util.warn("The stage has "+be+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),B.setSize({width:this.width(),height:this.height()}),B.draw(),s.Konva.isBrowser&&this.content.appendChild(B.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(B){return l.hasPointerCapture(B,this)}setPointerCapture(B){l.setPointerCapture(B,this)}releaseCapture(B){l.releaseCapture(B,this)}getLayers(){return this.children}_bindContentEvents(){s.Konva.isBrowser&&Q.forEach(([B,Z])=>{this.content.addEventListener(B,be=>{this[Z](be)},{passive:!1})})}_pointerenter(B){this.setPointersPositions(B);const Z=le(B.type);Z&&this._fire(Z.pointerenter,{evt:B,target:this,currentTarget:this})}_pointerover(B){this.setPointersPositions(B);const Z=le(B.type);Z&&this._fire(Z.pointerover,{evt:B,target:this,currentTarget:this})}_getTargetShape(B){let Z=this[B+"targetShape"];return Z&&!Z.getStage()&&(Z=null),Z}_pointerleave(B){const Z=le(B.type),be=se(B.type);if(!Z)return;this.setPointersPositions(B);const Ce=this._getTargetShape(be),Le=!(s.Konva.isDragging()||s.Konva.isTransforming())||s.Konva.hitOnDragEnabled;Ce&&Le?(Ce._fireAndBubble(Z.pointerout,{evt:B}),Ce._fireAndBubble(Z.pointerleave,{evt:B}),this._fire(Z.pointerleave,{evt:B,target:this,currentTarget:this}),this[be+"targetShape"]=null):Le&&(this._fire(Z.pointerleave,{evt:B,target:this,currentTarget:this}),this._fire(Z.pointerout,{evt:B,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(B){const Z=le(B.type),be=se(B.type);if(!Z)return;this.setPointersPositions(B);let Ce=!1;this._changedPointerPositions.forEach(Le=>{const et=this.getIntersection(Le);if(a.DD.justDragged=!1,s.Konva["_"+be+"ListenClick"]=!0,!et||!et.isListening()){this[be+"ClickStartShape"]=void 0;return}s.Konva.capturePointerEventsEnabled&&et.setPointerCapture(Le.id),this[be+"ClickStartShape"]=et,et._fireAndBubble(Z.pointerdown,{evt:B,pointerId:Le.id}),Ce=!0;const ht=B.type.indexOf("touch")>=0;et.preventDefault()&&B.cancelable&&ht&&B.preventDefault()}),Ce||this._fire(Z.pointerdown,{evt:B,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(B){const Z=le(B.type),be=se(B.type);if(!Z||(s.Konva.isDragging()&&a.DD.node.preventDefault()&&B.cancelable&&B.preventDefault(),this.setPointersPositions(B),!(!(s.Konva.isDragging()||s.Konva.isTransforming())||s.Konva.hitOnDragEnabled)))return;const Le={};let et=!1;const ht=this._getTargetShape(be);this._changedPointerPositions.forEach(cn=>{const ot=l.getCapturedShape(cn.id)||this.getIntersection(cn),Gn=cn.id,Wn={evt:B,pointerId:Gn},Ir=ht!==ot;if(Ir&&ht&&(ht._fireAndBubble(Z.pointerout,{...Wn},ot),ht._fireAndBubble(Z.pointerleave,{...Wn},ot)),ot){if(Le[ot._id])return;Le[ot._id]=!0}ot&&ot.isListening()?(et=!0,Ir&&(ot._fireAndBubble(Z.pointerover,{...Wn},ht),ot._fireAndBubble(Z.pointerenter,{...Wn},ht),this[be+"targetShape"]=ot),ot._fireAndBubble(Z.pointermove,{...Wn})):ht&&(this._fire(Z.pointerover,{evt:B,target:this,currentTarget:this,pointerId:Gn}),this[be+"targetShape"]=null)}),et||this._fire(Z.pointermove,{evt:B,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(B){const Z=le(B.type),be=se(B.type);if(!Z)return;this.setPointersPositions(B);const Ce=this[be+"ClickStartShape"],Le=this[be+"ClickEndShape"],et={};let ht=!1;this._changedPointerPositions.forEach(cn=>{const ot=l.getCapturedShape(cn.id)||this.getIntersection(cn);if(ot){if(ot.releaseCapture(cn.id),et[ot._id])return;et[ot._id]=!0}const Gn=cn.id,Wn={evt:B,pointerId:Gn};let Ir=!1;s.Konva["_"+be+"InDblClickWindow"]?(Ir=!0,clearTimeout(this[be+"DblTimeout"])):a.DD.justDragged||(s.Konva["_"+be+"InDblClickWindow"]=!0,clearTimeout(this[be+"DblTimeout"])),this[be+"DblTimeout"]=setTimeout(function(){s.Konva["_"+be+"InDblClickWindow"]=!1},s.Konva.dblClickWindow),ot&&ot.isListening()?(ht=!0,this[be+"ClickEndShape"]=ot,ot._fireAndBubble(Z.pointerup,{...Wn}),s.Konva["_"+be+"ListenClick"]&&Ce&&Ce===ot&&(ot._fireAndBubble(Z.pointerclick,{...Wn}),Ir&&Le&&Le===ot&&ot._fireAndBubble(Z.pointerdblclick,{...Wn}))):(this[be+"ClickEndShape"]=null,s.Konva["_"+be+"ListenClick"]&&this._fire(Z.pointerclick,{evt:B,target:this,currentTarget:this,pointerId:Gn}),Ir&&this._fire(Z.pointerdblclick,{evt:B,target:this,currentTarget:this,pointerId:Gn}))}),ht||this._fire(Z.pointerup,{evt:B,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),s.Konva["_"+be+"ListenClick"]=!1,B.cancelable&&be!=="touch"&&be!=="pointer"&&B.preventDefault()}_contextmenu(B){this.setPointersPositions(B);const Z=this.getIntersection(this.getPointerPosition());Z&&Z.isListening()?Z._fireAndBubble(F,{evt:B}):this._fire(F,{evt:B,target:this,currentTarget:this})}_wheel(B){this.setPointersPositions(B);const Z=this.getIntersection(this.getPointerPosition());Z&&Z.isListening()?Z._fireAndBubble(ae,{evt:B}):this._fire(ae,{evt:B,target:this,currentTarget:this})}_pointercancel(B){this.setPointersPositions(B);const Z=l.getCapturedShape(B.pointerId)||this.getIntersection(this.getPointerPosition());Z&&Z._fireAndBubble(L,l.createEvent(B)),l.releaseCapture(B.pointerId)}_lostpointercapture(B){l.releaseCapture(B.pointerId)}setPointersPositions(B){const Z=this._getContentPosition();let be=null,Ce=null;B=B||window.event,B.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(B.touches,Le=>{this._pointerPositions.push({id:Le.identifier,x:(Le.clientX-Z.left)/Z.scaleX,y:(Le.clientY-Z.top)/Z.scaleY})}),Array.prototype.forEach.call(B.changedTouches||B.touches,Le=>{this._changedPointerPositions.push({id:Le.identifier,x:(Le.clientX-Z.left)/Z.scaleX,y:(Le.clientY-Z.top)/Z.scaleY})})):(be=(B.clientX-Z.left)/Z.scaleX,Ce=(B.clientY-Z.top)/Z.scaleY,this.pointerPos={x:be,y:Ce},this._pointerPositions=[{x:be,y:Ce,id:e.Util._getFirstPointerId(B)}],this._changedPointerPositions=[{x:be,y:Ce,id:e.Util._getFirstPointerId(B)}])}_setPointerPosition(B){e.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(B)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const B=this.content.getBoundingClientRect();return{top:B.top,left:B.left,scaleX:B.width/this.content.clientWidth||1,scaleY:B.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new i.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new i.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!s.Konva.isBrowser)return;const B=this.container();if(!B)throw"Stage has no container. A container is required.";B.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),B.appendChild(this.content),this._resizeDOM()}cache(){return e.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(B){B.batchDraw()}),this}}n.Stage=de,de.prototype.nodeType=u,(0,o._registerNode)(de),t.Factory.addGetterSetter(de,"container"),s.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{n.stages.forEach(Me=>{Me.batchDraw()})})})(vF);var w_={},or={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Shape=n.shapes=void 0;const e=ct,t=En,r=_t,s=fn,i=Xe,a=ct,o=Du,l="hasShadow",u="shadowRGBA",h="patternImage",f="linearGradient",p="radialGradient";let y;function _(){return y||(y=t.Util.createCanvasElement().getContext("2d"),y)}n.shapes={};function b(N){const M=this.attrs.fillRule;M?N.fill(M):N.fill()}function S(N){N.stroke()}function E(N){const M=this.attrs.fillRule;M?N.fill(M):N.fill()}function C(N){N.stroke()}function v(){this._clearCache(l)}function I(){this._clearCache(u)}function L(){this._clearCache(h)}function R(){this._clearCache(f)}function P(){this._clearCache(p)}class x extends s.Node{constructor(M){super(M);let D;for(;D=t.Util.getRandomColor(),!(D&&!(D in n.shapes)););this.colorKey=D,n.shapes[D]=this}getContext(){return t.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return t.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(l,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(h,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const D=_().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(D&&D.setTransform){const F=new t.Transform;F.translate(this.fillPatternX(),this.fillPatternY()),F.rotate(e.Konva.getAngle(this.fillPatternRotation())),F.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),F.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const $=F.getMatrix(),H=typeof DOMMatrix>"u"?{a:$[0],b:$[1],c:$[2],d:$[3],e:$[4],f:$[5]}:new DOMMatrix($);D.setTransform(H)}return D}}_getLinearGradient(){return this._getCache(f,this.__getLinearGradient)}__getLinearGradient(){const M=this.fillLinearGradientColorStops();if(M){const D=_(),F=this.fillLinearGradientStartPoint(),$=this.fillLinearGradientEndPoint(),H=D.createLinearGradient(F.x,F.y,$.x,$.y);for(let G=0;G<M.length;G+=2)H.addColorStop(M[G],M[G+1]);return H}}_getRadialGradient(){return this._getCache(p,this.__getRadialGradient)}__getRadialGradient(){const M=this.fillRadialGradientColorStops();if(M){const D=_(),F=this.fillRadialGradientStartPoint(),$=this.fillRadialGradientEndPoint(),H=D.createRadialGradient(F.x,F.y,this.fillRadialGradientStartRadius(),$.x,$.y,this.fillRadialGradientEndRadius());for(let G=0;G<M.length;G+=2)H.addColorStop(M[G],M[G+1]);return H}}getShadowRGBA(){return this._getCache(u,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const M=t.Util.colorToRGBA(this.shadowColor());if(M)return"rgba("+M.r+","+M.g+","+M.b+","+M.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const M=this.hitStrokeWidth();return M==="auto"?this.hasStroke():this.strokeEnabled()&&!!M}intersects(M){const D=this.getStage();if(!D)return!1;const F=D.bufferHitCanvas;return F.getContext().clear(),this.drawHit(F,void 0,!0),F.context.getImageData(Math.round(M.x),Math.round(M.y),1,1).data[3]>0}destroy(){return s.Node.prototype.destroy.call(this),delete n.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(M){var D;if(!((D=this.attrs.perfectDrawEnabled)!==null&&D!==void 0?D:!0))return!1;const $=M||this.hasFill(),H=this.hasStroke(),G=this.getAbsoluteOpacity()!==1;if($&&H&&G)return!0;const ue=this.hasShadow(),ae=this.shadowForStrokeEnabled();return!!($&&H&&ue&&ae)}setStrokeHitEnabled(M){t.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),M?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const M=this.size();return{x:this._centroid?-M.width/2:0,y:this._centroid?-M.height/2:0,width:M.width,height:M.height}}getClientRect(M={}){let D=!1,F=this.getParent();for(;F;){if(F.isCached()){D=!0;break}F=F.getParent()}const $=M.skipTransform,H=M.relativeTo||D&&this.getStage()||void 0,G=this.getSelfRect(),ae=!M.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,z=G.width+ae,Q=G.height+ae,ee=!M.skipShadow&&this.hasShadow(),se=ee?this.shadowOffsetX():0,le=ee?this.shadowOffsetY():0,ye=z+Math.abs(se),ve=Q+Math.abs(le),de=ee&&this.shadowBlur()||0,Me=ye+de*2,B=ve+de*2,Z={width:Me,height:B,x:-(ae/2+de)+Math.min(se,0)+G.x,y:-(ae/2+de)+Math.min(le,0)+G.y};return $?Z:this._transformedRect(Z,H)}drawScene(M,D,F){const $=this.getLayer(),H=M||$.getCanvas(),G=H.getContext(),ue=this._getCanvasCache(),ae=this.getSceneFunc(),z=this.hasShadow();let Q;const ee=D===this;if(!this.isVisible()&&!ee)return this;if(ue){G.save();const se=this.getAbsoluteTransform(D).getMatrix();return G.transform(se[0],se[1],se[2],se[3],se[4],se[5]),this._drawCachedSceneCanvas(G),G.restore(),this}if(!ae)return this;if(G.save(),this._useBufferCanvas()){Q=this.getStage();const se=F||Q.bufferCanvas,le=se.getContext();le.clear(),le.save(),le._applyLineJoin(this);const ye=this.getAbsoluteTransform(D).getMatrix();le.transform(ye[0],ye[1],ye[2],ye[3],ye[4],ye[5]),ae.call(this,le,this),le.restore();const ve=se.pixelRatio;z&&G._applyShadow(this),G._applyOpacity(this),G._applyGlobalCompositeOperation(this),G.drawImage(se._canvas,se.x||0,se.y||0,se.width/ve,se.height/ve)}else{if(G._applyLineJoin(this),!ee){const se=this.getAbsoluteTransform(D).getMatrix();G.transform(se[0],se[1],se[2],se[3],se[4],se[5]),G._applyOpacity(this),G._applyGlobalCompositeOperation(this)}z&&G._applyShadow(this),ae.call(this,G,this)}return G.restore(),this}drawHit(M,D,F=!1){if(!this.shouldDrawHit(D,F))return this;const $=this.getLayer(),H=M||$.hitCanvas,G=H&&H.getContext(),ue=this.hitFunc()||this.sceneFunc(),ae=this._getCanvasCache(),z=ae&&ae.hit;if(this.colorKey||t.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),z){G.save();const ee=this.getAbsoluteTransform(D).getMatrix();return G.transform(ee[0],ee[1],ee[2],ee[3],ee[4],ee[5]),this._drawCachedHitCanvas(G),G.restore(),this}if(!ue)return this;if(G.save(),G._applyLineJoin(this),!(this===D)){const ee=this.getAbsoluteTransform(D).getMatrix();G.transform(ee[0],ee[1],ee[2],ee[3],ee[4],ee[5])}return ue.call(this,G,this),G.restore(),this}drawHitFromCache(M=0){const D=this._getCanvasCache(),F=this._getCachedSceneCanvas(),$=D.hit,H=$.getContext(),G=$.getWidth(),ue=$.getHeight();H.clear(),H.drawImage(F._canvas,0,0,G,ue);try{const ae=H.getImageData(0,0,G,ue),z=ae.data,Q=z.length,ee=t.Util._hexToRgb(this.colorKey);for(let se=0;se<Q;se+=4)z[se+3]>M?(z[se]=ee.r,z[se+1]=ee.g,z[se+2]=ee.b,z[se+3]=255):z[se+3]=0;H.putImageData(ae,0,0)}catch(ae){t.Util.error("Unable to draw hit graph from cached scene canvas. "+ae.message)}return this}hasPointerCapture(M){return o.hasPointerCapture(M,this)}setPointerCapture(M){o.setPointerCapture(M,this)}releaseCapture(M){o.releaseCapture(M,this)}}n.Shape=x,x.prototype._fillFunc=b,x.prototype._strokeFunc=S,x.prototype._fillFuncHit=E,x.prototype._strokeFuncHit=C,x.prototype._centroid=!1,x.prototype.nodeType="Shape",(0,a._registerNode)(x),x.prototype.eventListeners={},x.prototype.on.call(x.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",v),x.prototype.on.call(x.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",I),x.prototype.on.call(x.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",L),x.prototype.on.call(x.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",R),x.prototype.on.call(x.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",P),r.Factory.addGetterSetter(x,"stroke",void 0,(0,i.getStringOrGradientValidator)()),r.Factory.addGetterSetter(x,"strokeWidth",2,(0,i.getNumberValidator)()),r.Factory.addGetterSetter(x,"fillAfterStrokeEnabled",!1),r.Factory.addGetterSetter(x,"hitStrokeWidth","auto",(0,i.getNumberOrAutoValidator)()),r.Factory.addGetterSetter(x,"strokeHitEnabled",!0,(0,i.getBooleanValidator)()),r.Factory.addGetterSetter(x,"perfectDrawEnabled",!0,(0,i.getBooleanValidator)()),r.Factory.addGetterSetter(x,"shadowForStrokeEnabled",!0,(0,i.getBooleanValidator)()),r.Factory.addGetterSetter(x,"lineJoin"),r.Factory.addGetterSetter(x,"lineCap"),r.Factory.addGetterSetter(x,"sceneFunc"),r.Factory.addGetterSetter(x,"hitFunc"),r.Factory.addGetterSetter(x,"dash"),r.Factory.addGetterSetter(x,"dashOffset",0,(0,i.getNumberValidator)()),r.Factory.addGetterSetter(x,"shadowColor",void 0,(0,i.getStringValidator)()),r.Factory.addGetterSetter(x,"shadowBlur",0,(0,i.getNumberValidator)()),r.Factory.addGetterSetter(x,"shadowOpacity",1,(0,i.getNumberValidator)()),r.Factory.addComponentsGetterSetter(x,"shadowOffset",["x","y"]),r.Factory.addGetterSetter(x,"shadowOffsetX",0,(0,i.getNumberValidator)()),r.Factory.addGetterSetter(x,"shadowOffsetY",0,(0,i.getNumberValidator)()),r.Factory.addGetterSetter(x,"fillPatternImage"),r.Factory.addGetterSetter(x,"fill",void 0,(0,i.getStringOrGradientValidator)()),r.Factory.addGetterSetter(x,"fillPatternX",0,(0,i.getNumberValidator)()),r.Factory.addGetterSetter(x,"fillPatternY",0,(0,i.getNumberValidator)()),r.Factory.addGetterSetter(x,"fillLinearGradientColorStops"),r.Factory.addGetterSetter(x,"strokeLinearGradientColorStops"),r.Factory.addGetterSetter(x,"fillRadialGradientStartRadius",0),r.Factory.addGetterSetter(x,"fillRadialGradientEndRadius",0),r.Factory.addGetterSetter(x,"fillRadialGradientColorStops"),r.Factory.addGetterSetter(x,"fillPatternRepeat","repeat"),r.Factory.addGetterSetter(x,"fillEnabled",!0),r.Factory.addGetterSetter(x,"strokeEnabled",!0),r.Factory.addGetterSetter(x,"shadowEnabled",!0),r.Factory.addGetterSetter(x,"dashEnabled",!0),r.Factory.addGetterSetter(x,"strokeScaleEnabled",!0),r.Factory.addGetterSetter(x,"fillPriority","color"),r.Factory.addComponentsGetterSetter(x,"fillPatternOffset",["x","y"]),r.Factory.addGetterSetter(x,"fillPatternOffsetX",0,(0,i.getNumberValidator)()),r.Factory.addGetterSetter(x,"fillPatternOffsetY",0,(0,i.getNumberValidator)()),r.Factory.addComponentsGetterSetter(x,"fillPatternScale",["x","y"]),r.Factory.addGetterSetter(x,"fillPatternScaleX",1,(0,i.getNumberValidator)()),r.Factory.addGetterSetter(x,"fillPatternScaleY",1,(0,i.getNumberValidator)()),r.Factory.addComponentsGetterSetter(x,"fillLinearGradientStartPoint",["x","y"]),r.Factory.addComponentsGetterSetter(x,"strokeLinearGradientStartPoint",["x","y"]),r.Factory.addGetterSetter(x,"fillLinearGradientStartPointX",0),r.Factory.addGetterSetter(x,"strokeLinearGradientStartPointX",0),r.Factory.addGetterSetter(x,"fillLinearGradientStartPointY",0),r.Factory.addGetterSetter(x,"strokeLinearGradientStartPointY",0),r.Factory.addComponentsGetterSetter(x,"fillLinearGradientEndPoint",["x","y"]),r.Factory.addComponentsGetterSetter(x,"strokeLinearGradientEndPoint",["x","y"]),r.Factory.addGetterSetter(x,"fillLinearGradientEndPointX",0),r.Factory.addGetterSetter(x,"strokeLinearGradientEndPointX",0),r.Factory.addGetterSetter(x,"fillLinearGradientEndPointY",0),r.Factory.addGetterSetter(x,"strokeLinearGradientEndPointY",0),r.Factory.addComponentsGetterSetter(x,"fillRadialGradientStartPoint",["x","y"]),r.Factory.addGetterSetter(x,"fillRadialGradientStartPointX",0),r.Factory.addGetterSetter(x,"fillRadialGradientStartPointY",0),r.Factory.addComponentsGetterSetter(x,"fillRadialGradientEndPoint",["x","y"]),r.Factory.addGetterSetter(x,"fillRadialGradientEndPointX",0),r.Factory.addGetterSetter(x,"fillRadialGradientEndPointY",0),r.Factory.addGetterSetter(x,"fillPatternRotation",0),r.Factory.addGetterSetter(x,"fillRule",void 0,(0,i.getStringValidator)()),r.Factory.backCompat(x,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(or);Object.defineProperty(w_,"__esModule",{value:!0});w_.Layer=void 0;const vo=En,o2=od,Bd=fn,NP=_t,P3=la,Tte=Xe,Cte=or,Ite=ct,xte="#",kte="beforeDraw",Pte="draw",EF=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Ate=EF.length;let Nf=class extends o2.Container{constructor(e){super(e),this.canvas=new P3.SceneCanvas,this.hitCanvas=new P3.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this}setZIndex(e){super.setZIndex(e);const t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),e<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[e+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){Bd.Node.prototype.moveToTop.call(this);const e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!Bd.Node.prototype.moveUp.call(this))return!1;const t=this.getStage();return!t||!t.content?!1:(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(Bd.Node.prototype.moveDown.call(this)){const e=this.getStage();if(e){const t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(Bd.Node.prototype.moveToBottom.call(this)){const e=this.getStage();if(e){const t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const e=this.getNativeCanvasElement();return Bd.Node.prototype.remove.call(this),e&&e.parentNode&&vo.Util._isInDocument(e)&&e.parentNode.removeChild(e),this}getStage(){return this.parent}setSize({width:e,height:t}){return this.canvas.setSize(e,t),this.hitCanvas.setSize(e,t),this._setSmoothEnabled(),this}_validateAdd(e){const t=e.getType();t!=="Group"&&t!=="Shape"&&vo.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(e){return e=e||{},e.width=e.width||this.getWidth(),e.height=e.height||this.getHeight(),e.x=e.x!==void 0?e.x:this.x(),e.y=e.y!==void 0?e.y:this.y(),Bd.Node.prototype._toKonvaCanvas.call(this,e)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){vo.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){vo.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,vo.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(e){if(!this.isListening()||!this.isVisible())return null;let t=1,r=!1;for(;;){for(let s=0;s<Ate;s++){const i=EF[s],a=this._getIntersection({x:e.x+i.x*t,y:e.y+i.y*t}),o=a.shape;if(o)return o;if(r=!!a.antialiased,!a.antialiased)break}if(r)t+=1;else return null}}_getIntersection(e){const t=this.hitCanvas.pixelRatio,r=this.hitCanvas.context.getImageData(Math.round(e.x*t),Math.round(e.y*t),1,1).data,s=r[3];if(s===255){const i=vo.Util._rgbToHex(r[0],r[1],r[2]),a=Cte.shapes[xte+i];return a?{shape:a}:{antialiased:!0}}else if(s>0)return{antialiased:!0};return{}}drawScene(e,t,r){const s=this.getLayer(),i=e||s&&s.getCanvas();return this._fire(kte,{node:this}),this.clearBeforeDraw()&&i.getContext().clear(),o2.Container.prototype.drawScene.call(this,i,t,r),this._fire(Pte,{node:this}),this}drawHit(e,t){const r=this.getLayer(),s=e||r&&r.hitCanvas;return r&&r.clearBeforeDraw()&&r.getHitCanvas().getContext().clear(),o2.Container.prototype.drawHit.call(this,s,t),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(e){vo.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(e)}getHitGraphEnabled(e){return vo.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const e=this.parent;!!this.hitCanvas._canvas.parentNode?e.content.removeChild(this.hitCanvas._canvas):e.content.appendChild(this.hitCanvas._canvas)}destroy(){return vo.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};w_.Layer=Nf;Nf.prototype.nodeType="Layer";(0,Ite._registerNode)(Nf);NP.Factory.addGetterSetter(Nf,"imageSmoothingEnabled",!0);NP.Factory.addGetterSetter(Nf,"clearBeforeDraw",!0);NP.Factory.addGetterSetter(Nf,"hitGraphEnabled",!0,(0,Tte.getBooleanValidator)());var Z1={};Object.defineProperty(Z1,"__esModule",{value:!0});Z1.FastLayer=void 0;const Rte=En,Nte=w_,Ote=ct;class OP extends Nte.Layer{constructor(e){super(e),this.listening(!1),Rte.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}Z1.FastLayer=OP;OP.prototype.nodeType="FastLayer";(0,Ote._registerNode)(OP);var Of={};Object.defineProperty(Of,"__esModule",{value:!0});Of.Group=void 0;const Lte=En,Mte=od,Dte=ct;let LP=class extends Mte.Container{_validateAdd(e){const t=e.getType();t!=="Group"&&t!=="Shape"&&Lte.Util.throw("You may only add groups and shapes to groups.")}};Of.Group=LP;LP.prototype.nodeType="Group";(0,Dte._registerNode)(LP);var Lf={};Object.defineProperty(Lf,"__esModule",{value:!0});Lf.Animation=void 0;const l2=ct,A3=En,u2=function(){return l2.glob.performance&&l2.glob.performance.now?function(){return l2.glob.performance.now()}:function(){return new Date().getTime()}}();class Ua{constructor(e,t){this.id=Ua.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:u2(),frameRate:0},this.func=e,this.setLayers(t)}setLayers(e){let t=[];return e&&(t=Array.isArray(e)?e:[e]),this.layers=t,this}getLayers(){return this.layers}addLayer(e){const t=this.layers,r=t.length;for(let s=0;s<r;s++)if(t[s]._id===e._id)return!1;return this.layers.push(e),!0}isRunning(){const t=Ua.animations,r=t.length;for(let s=0;s<r;s++)if(t[s].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=u2(),Ua._addAnimation(this),this}stop(){return Ua._removeAnimation(this),this}_updateFrameObject(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(e){this.animations.push(e),this._handleAnimation()}static _removeAnimation(e){const t=e.id,r=this.animations,s=r.length;for(let i=0;i<s;i++)if(r[i].id===t){this.animations.splice(i,1);break}}static _runFrames(){const e={},t=this.animations;for(let r=0;r<t.length;r++){const s=t[r],i=s.layers,a=s.func;s._updateFrameObject(u2());const o=i.length;let l;if(a?l=a.call(s,s.frame)!==!1:l=!0,!!l)for(let u=0;u<o;u++){const h=i[u];h._id!==void 0&&(e[h._id]=h)}}for(const r in e)e.hasOwnProperty(r)&&e[r].batchDraw()}static _animationLoop(){const e=Ua;e.animations.length?(e._runFrames(),A3.Util.requestAnimFrame(e._animationLoop)):e.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,A3.Util.requestAnimFrame(this._animationLoop))}}Lf.Animation=Ua;Ua.animations=[];Ua.animIdCounter=0;Ua.animRunning=!1;var SF={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Easings=n.Tween=void 0;const e=En,t=Lf,r=fn,s=ct,i={node:1,duration:1,easing:1,onFinish:1,yoyo:1},a=1,o=2,l=3,u=["fill","stroke","shadowColor"];let h=0;class f{constructor(_,b,S,E,C,v,I){this.prop=_,this.propFunc=b,this.begin=E,this._pos=E,this.duration=v,this._change=0,this.prevPos=0,this.yoyo=I,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=S,this._change=C-this.begin,this.pause()}fire(_){const b=this[_];b&&b()}setTime(_){_>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():_<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=_,this.update())}getTime(){return this._time}setPosition(_){this.prevPos=this._pos,this.propFunc(_),this._pos=_}getPosition(_){return _===void 0&&(_=this._time),this.func(_,this.begin,this._change,this.duration)}play(){this.state=o,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=l,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(_){this.pause(),this._time=_,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const _=this.getTimer()-this._startTime;this.state===o?this.setTime(_):this.state===l&&this.setTime(this.duration-_)}pause(){this.state=a,this.fire("onPause")}getTimer(){return new Date().getTime()}}class p{constructor(_){const b=this,S=_.node,E=S._id,C=_.easing||n.Easings.Linear,v=!!_.yoyo;let I,L;typeof _.duration>"u"?I=.3:_.duration===0?I=.001:I=_.duration,this.node=S,this._id=h++;const R=S.getLayer()||(S instanceof s.Konva.Stage?S.getLayers():null);R||e.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new t.Animation(function(){b.tween.onEnterFrame()},R),this.tween=new f(L,function(P){b._tweenFunc(P)},C,0,1,I*1e3,v),this._addListeners(),p.attrs[E]||(p.attrs[E]={}),p.attrs[E][this._id]||(p.attrs[E][this._id]={}),p.tweens[E]||(p.tweens[E]={});for(L in _)i[L]===void 0&&this._addAttr(L,_[L]);this.reset(),this.onFinish=_.onFinish,this.onReset=_.onReset,this.onUpdate=_.onUpdate}_addAttr(_,b){const S=this.node,E=S._id;let C,v,I,L,R;const P=p.tweens[E][_];P&&delete p.attrs[E][P][_];let x=S.getAttr(_);if(e.Util._isArray(b))if(C=[],v=Math.max(b.length,x.length),_==="points"&&b.length!==x.length&&(b.length>x.length?(L=x,x=e.Util._prepareArrayForTween(x,b,S.closed())):(I=b,b=e.Util._prepareArrayForTween(b,x,S.closed()))),_.indexOf("fill")===0)for(let N=0;N<v;N++)if(N%2===0)C.push(b[N]-x[N]);else{const M=e.Util.colorToRGBA(x[N]);R=e.Util.colorToRGBA(b[N]),x[N]=M,C.push({r:R.r-M.r,g:R.g-M.g,b:R.b-M.b,a:R.a-M.a})}else for(let N=0;N<v;N++)C.push(b[N]-x[N]);else u.indexOf(_)!==-1?(x=e.Util.colorToRGBA(x),R=e.Util.colorToRGBA(b),C={r:R.r-x.r,g:R.g-x.g,b:R.b-x.b,a:R.a-x.a}):C=b-x;p.attrs[E][this._id][_]={start:x,diff:C,end:b,trueEnd:I,trueStart:L},p.tweens[E][_]=this._id}_tweenFunc(_){const b=this.node,S=p.attrs[b._id][this._id];let E,C,v,I,L,R,P,x;for(E in S){if(C=S[E],v=C.start,I=C.diff,x=C.end,e.Util._isArray(v))if(L=[],P=Math.max(v.length,x.length),E.indexOf("fill")===0)for(R=0;R<P;R++)R%2===0?L.push((v[R]||0)+I[R]*_):L.push("rgba("+Math.round(v[R].r+I[R].r*_)+","+Math.round(v[R].g+I[R].g*_)+","+Math.round(v[R].b+I[R].b*_)+","+(v[R].a+I[R].a*_)+")");else for(R=0;R<P;R++)L.push((v[R]||0)+I[R]*_);else u.indexOf(E)!==-1?L="rgba("+Math.round(v.r+I.r*_)+","+Math.round(v.g+I.g*_)+","+Math.round(v.b+I.b*_)+","+(v.a+I.a*_)+")":L=v+I*_;b.setAttr(E,L)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const _=this.node,b=p.attrs[_._id][this._id];b.points&&b.points.trueEnd&&_.setAttr("points",b.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const _=this.node,b=p.attrs[_._id][this._id];b.points&&b.points.trueStart&&_.points(b.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(_){return this.tween.seek(_*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const _=this.node._id,b=this._id,S=p.tweens[_];this.pause(),this.anim&&this.anim.stop();for(const E in S)delete p.tweens[_][E];delete p.attrs[_][b],p.tweens[_]&&(Object.keys(p.tweens[_]).length===0&&delete p.tweens[_],Object.keys(p.attrs[_]).length===0&&delete p.attrs[_])}}n.Tween=p,p.attrs={},p.tweens={},r.Node.prototype.to=function(y){const _=y.onFinish;y.node=this,y.onFinish=function(){this.destroy(),_&&_()},new p(y).play()},n.Easings={BackEaseIn(y,_,b,S){return b*(y/=S)*y*((1.70158+1)*y-1.70158)+_},BackEaseOut(y,_,b,S){return b*((y=y/S-1)*y*((1.70158+1)*y+1.70158)+1)+_},BackEaseInOut(y,_,b,S){let E=1.70158;return(y/=S/2)<1?b/2*(y*y*(((E*=1.525)+1)*y-E))+_:b/2*((y-=2)*y*(((E*=1.525)+1)*y+E)+2)+_},ElasticEaseIn(y,_,b,S,E,C){let v=0;return y===0?_:(y/=S)===1?_+b:(C||(C=S*.3),!E||E<Math.abs(b)?(E=b,v=C/4):v=C/(2*Math.PI)*Math.asin(b/E),-(E*Math.pow(2,10*(y-=1))*Math.sin((y*S-v)*(2*Math.PI)/C))+_)},ElasticEaseOut(y,_,b,S,E,C){let v=0;return y===0?_:(y/=S)===1?_+b:(C||(C=S*.3),!E||E<Math.abs(b)?(E=b,v=C/4):v=C/(2*Math.PI)*Math.asin(b/E),E*Math.pow(2,-10*y)*Math.sin((y*S-v)*(2*Math.PI)/C)+b+_)},ElasticEaseInOut(y,_,b,S,E,C){let v=0;return y===0?_:(y/=S/2)===2?_+b:(C||(C=S*(.3*1.5)),!E||E<Math.abs(b)?(E=b,v=C/4):v=C/(2*Math.PI)*Math.asin(b/E),y<1?-.5*(E*Math.pow(2,10*(y-=1))*Math.sin((y*S-v)*(2*Math.PI)/C))+_:E*Math.pow(2,-10*(y-=1))*Math.sin((y*S-v)*(2*Math.PI)/C)*.5+b+_)},BounceEaseOut(y,_,b,S){return(y/=S)<1/2.75?b*(7.5625*y*y)+_:y<2/2.75?b*(7.5625*(y-=1.5/2.75)*y+.75)+_:y<2.5/2.75?b*(7.5625*(y-=2.25/2.75)*y+.9375)+_:b*(7.5625*(y-=2.625/2.75)*y+.984375)+_},BounceEaseIn(y,_,b,S){return b-n.Easings.BounceEaseOut(S-y,0,b,S)+_},BounceEaseInOut(y,_,b,S){return y<S/2?n.Easings.BounceEaseIn(y*2,0,b,S)*.5+_:n.Easings.BounceEaseOut(y*2-S,0,b,S)*.5+b*.5+_},EaseIn(y,_,b,S){return b*(y/=S)*y+_},EaseOut(y,_,b,S){return-b*(y/=S)*(y-2)+_},EaseInOut(y,_,b,S){return(y/=S/2)<1?b/2*y*y+_:-b/2*(--y*(y-2)-1)+_},StrongEaseIn(y,_,b,S){return b*(y/=S)*y*y*y*y+_},StrongEaseOut(y,_,b,S){return b*((y=y/S-1)*y*y*y*y+1)+_},StrongEaseInOut(y,_,b,S){return(y/=S/2)<1?b/2*y*y*y*y*y+_:b/2*((y-=2)*y*y*y*y+2)+_},Linear(y,_,b,S){return b*y/S+_}}})(SF);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Konva=void 0;const e=ct,t=En,r=fn,s=od,i=vF,a=w_,o=Z1,l=Of,u=J1,h=or,f=Lf,p=SF,y=$o,_=la;n.Konva=t.Util._assign(e.Konva,{Util:t.Util,Transform:t.Transform,Node:r.Node,Container:s.Container,Stage:i.Stage,stages:i.stages,Layer:a.Layer,FastLayer:o.FastLayer,Group:l.Group,DD:u.DD,Shape:h.Shape,shapes:h.shapes,Animation:f.Animation,Tween:p.Tween,Easings:p.Easings,Context:y.Context,Canvas:_.Canvas}),n.default=n.Konva})(fw);var eb={};Object.defineProperty(eb,"__esModule",{value:!0});eb.Arc=void 0;const tb=_t,Fte=or,R3=ct,nb=Xe,$te=ct;class rl extends Fte.Shape{_sceneFunc(e){const t=R3.Konva.getAngle(this.angle()),r=this.clockwise();e.beginPath(),e.arc(0,0,this.outerRadius(),0,t,r),e.arc(0,0,this.innerRadius(),t,0,!r),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}getSelfRect(){const e=this.innerRadius(),t=this.outerRadius(),r=this.clockwise(),s=R3.Konva.getAngle(r?360-this.angle():this.angle()),i=Math.cos(Math.min(s,Math.PI)),a=1,o=Math.sin(Math.min(Math.max(Math.PI,s),3*Math.PI/2)),l=Math.sin(Math.min(s,Math.PI/2)),u=i*(i>0?e:t),h=a*t,f=o*(o>0?e:t),p=l*(l>0?t:e);return{x:u,y:r?-1*p:f,width:h-u,height:p-f}}}eb.Arc=rl;rl.prototype._centroid=!0;rl.prototype.className="Arc";rl.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"];(0,$te._registerNode)(rl);tb.Factory.addGetterSetter(rl,"innerRadius",0,(0,nb.getNumberValidator)());tb.Factory.addGetterSetter(rl,"outerRadius",0,(0,nb.getNumberValidator)());tb.Factory.addGetterSetter(rl,"angle",0,(0,nb.getNumberValidator)());tb.Factory.addGetterSetter(rl,"clockwise",!1,(0,nb.getBooleanValidator)());var rb={},b_={};Object.defineProperty(b_,"__esModule",{value:!0});b_.Line=void 0;const sb=_t,jte=ct,Ute=or,TF=Xe;function HC(n,e,t,r,s,i,a){const o=Math.sqrt(Math.pow(t-n,2)+Math.pow(r-e,2)),l=Math.sqrt(Math.pow(s-t,2)+Math.pow(i-r,2)),u=a*o/(o+l),h=a*l/(o+l),f=t-u*(s-n),p=r-u*(i-e),y=t+h*(s-n),_=r+h*(i-e);return[f,p,y,_]}function N3(n,e){const t=n.length,r=[];for(let s=2;s<t-2;s+=2){const i=HC(n[s-2],n[s-1],n[s],n[s+1],n[s+2],n[s+3],e);isNaN(i[0])||(r.push(i[0]),r.push(i[1]),r.push(n[s]),r.push(n[s+1]),r.push(i[2]),r.push(i[3]))}return r}let Fu=class extends Ute.Shape{constructor(e){super(e),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(e){const t=this.points(),r=t.length,s=this.tension(),i=this.closed(),a=this.bezier();if(!r)return;let o=0;if(e.beginPath(),e.moveTo(t[0],t[1]),s!==0&&r>4){const l=this.getTensionPoints(),u=l.length;for(o=i?0:4,i||e.quadraticCurveTo(l[0],l[1],l[2],l[3]);o<u-2;)e.bezierCurveTo(l[o++],l[o++],l[o++],l[o++],l[o++],l[o++]);i||e.quadraticCurveTo(l[u-2],l[u-1],t[r-2],t[r-1])}else if(a)for(o=2;o<r;)e.bezierCurveTo(t[o++],t[o++],t[o++],t[o++],t[o++],t[o++]);else for(o=2;o<r;o+=2)e.lineTo(t[o],t[o+1]);i?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():N3(this.points(),this.tension())}_getTensionPointsClosed(){const e=this.points(),t=e.length,r=this.tension(),s=HC(e[t-2],e[t-1],e[0],e[1],e[2],e[3],r),i=HC(e[t-4],e[t-3],e[t-2],e[t-1],e[0],e[1],r),a=N3(e,r);return[s[2],s[3]].concat(a).concat([i[0],i[1],e[t-2],e[t-1],i[2],i[3],s[0],s[1],e[0],e[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let e=this.points();if(e.length<4)return{x:e[0]||0,y:e[1]||0,width:0,height:0};this.tension()!==0?e=[e[0],e[1],...this._getTensionPoints(),e[e.length-2],e[e.length-1]]:e=this.points();let t=e[0],r=e[0],s=e[1],i=e[1],a,o;for(let l=0;l<e.length/2;l++)a=e[l*2],o=e[l*2+1],t=Math.min(t,a),r=Math.max(r,a),s=Math.min(s,o),i=Math.max(i,o);return{x:t,y:s,width:r-t,height:i-s}}};b_.Line=Fu;Fu.prototype.className="Line";Fu.prototype._attrsAffectingSize=["points","bezier","tension"];(0,jte._registerNode)(Fu);sb.Factory.addGetterSetter(Fu,"closed",!1);sb.Factory.addGetterSetter(Fu,"bezier",!1);sb.Factory.addGetterSetter(Fu,"tension",0,(0,TF.getNumberValidator)());sb.Factory.addGetterSetter(Fu,"points",[],(0,TF.getNumberArrayValidator)());var Mf={},CF={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.t2length=n.getQuadraticArcLength=n.getCubicArcLength=n.binomialCoefficients=n.cValues=n.tValues=void 0,n.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],n.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],n.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const e=(a,o,l)=>{let u,h;const p=l/2;u=0;for(let y=0;y<20;y++)h=p*n.tValues[20][y]+p,u+=n.cValues[20][y]*r(a,o,h);return p*u};n.getCubicArcLength=e;const t=(a,o,l)=>{l===void 0&&(l=1);const u=a[0]-2*a[1]+a[2],h=o[0]-2*o[1]+o[2],f=2*a[1]-2*a[0],p=2*o[1]-2*o[0],y=4*(u*u+h*h),_=4*(u*f+h*p),b=f*f+p*p;if(y===0)return l*Math.sqrt(Math.pow(a[2]-a[0],2)+Math.pow(o[2]-o[0],2));const S=_/(2*y),E=b/y,C=l+S,v=E-S*S,I=C*C+v>0?Math.sqrt(C*C+v):0,L=S*S+v>0?Math.sqrt(S*S+v):0,R=S+Math.sqrt(S*S+v)!==0?v*Math.log(Math.abs((C+I)/(S+L))):0;return Math.sqrt(y)/2*(C*I-S*L+R)};n.getQuadraticArcLength=t;function r(a,o,l){const u=s(1,l,a),h=s(1,l,o),f=u*u+h*h;return Math.sqrt(f)}const s=(a,o,l)=>{const u=l.length-1;let h,f;if(u===0)return 0;if(a===0){f=0;for(let p=0;p<=u;p++)f+=n.binomialCoefficients[u][p]*Math.pow(1-o,u-p)*Math.pow(o,p)*l[p];return f}else{h=new Array(u);for(let p=0;p<u;p++)h[p]=u*(l[p+1]-l[p]);return s(a-1,o,h)}},i=(a,o,l)=>{let u=1,h=a/o,f=(a-l(h))/o,p=0;for(;u>.001;){const y=l(h+f),_=Math.abs(a-y)/o;if(_<u)u=_,h+=f;else{const b=l(h-f),S=Math.abs(a-b)/o;S<u?(u=S,h-=f):f/=2}if(p++,p>500)break}return h};n.t2length=i})(CF);Object.defineProperty(Mf,"__esModule",{value:!0});Mf.Path=void 0;const Vte=_t,Bte=ct,zte=or,zd=CF;class er extends zte.Shape{constructor(e){super(e),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=er.parsePathData(this.data()),this.pathLength=er.getPathLength(this.dataArray)}_sceneFunc(e){const t=this.dataArray;e.beginPath();let r=!1;for(let s=0;s<t.length;s++){const i=t[s].command,a=t[s].points;switch(i){case"L":e.lineTo(a[0],a[1]);break;case"M":e.moveTo(a[0],a[1]);break;case"C":e.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5]);break;case"Q":e.quadraticCurveTo(a[0],a[1],a[2],a[3]);break;case"A":const o=a[0],l=a[1],u=a[2],h=a[3],f=a[4],p=a[5],y=a[6],_=a[7],b=u>h?u:h,S=u>h?1:u/h,E=u>h?h/u:1;e.translate(o,l),e.rotate(y),e.scale(S,E),e.arc(0,0,b,f,f+p,1-_),e.scale(1/S,1/E),e.rotate(-y),e.translate(-o,-l);break;case"z":r=!0,e.closePath();break}}!r&&!this.hasFill()?e.strokeShape(this):e.fillStrokeShape(this)}getSelfRect(){let e=[];this.dataArray.forEach(function(l){if(l.command==="A"){const u=l.points[4],h=l.points[5],f=l.points[4]+h;let p=Math.PI/180;if(Math.abs(u-f)<p&&(p=Math.abs(u-f)),h<0)for(let y=u-p;y>f;y-=p){const _=er.getPointOnEllipticalArc(l.points[0],l.points[1],l.points[2],l.points[3],y,0);e.push(_.x,_.y)}else for(let y=u+p;y<f;y+=p){const _=er.getPointOnEllipticalArc(l.points[0],l.points[1],l.points[2],l.points[3],y,0);e.push(_.x,_.y)}}else if(l.command==="C")for(let u=0;u<=1;u+=.01){const h=er.getPointOnCubicBezier(u,l.start.x,l.start.y,l.points[0],l.points[1],l.points[2],l.points[3],l.points[4],l.points[5]);e.push(h.x,h.y)}else e=e.concat(l.points)});let t=e[0],r=e[0],s=e[1],i=e[1],a,o;for(let l=0;l<e.length/2;l++)a=e[l*2],o=e[l*2+1],isNaN(a)||(t=Math.min(t,a),r=Math.max(r,a)),isNaN(o)||(s=Math.min(s,o),i=Math.max(i,o));return{x:t,y:s,width:r-t,height:i-s}}getLength(){return this.pathLength}getPointAtLength(e){return er.getPointAtLengthOfDataArray(e,this.dataArray)}static getLineLength(e,t,r,s){return Math.sqrt((r-e)*(r-e)+(s-t)*(s-t))}static getPathLength(e){let t=0;for(let r=0;r<e.length;++r)t+=e[r].pathLength;return t}static getPointAtLengthOfDataArray(e,t){let r,s=0,i=t.length;if(!i)return null;for(;s<i&&e>t[s].pathLength;)e-=t[s].pathLength,++s;if(s===i)return r=t[s-1].points.slice(-2),{x:r[0],y:r[1]};if(e<.01)return t[s].command==="M"?(r=t[s].points.slice(0,2),{x:r[0],y:r[1]}):{x:t[s].start.x,y:t[s].start.y};const a=t[s],o=a.points;switch(a.command){case"L":return er.getPointOnLine(e,a.start.x,a.start.y,o[0],o[1]);case"C":return er.getPointOnCubicBezier((0,zd.t2length)(e,er.getPathLength(t),b=>(0,zd.getCubicArcLength)([a.start.x,o[0],o[2],o[4]],[a.start.y,o[1],o[3],o[5]],b)),a.start.x,a.start.y,o[0],o[1],o[2],o[3],o[4],o[5]);case"Q":return er.getPointOnQuadraticBezier((0,zd.t2length)(e,er.getPathLength(t),b=>(0,zd.getQuadraticArcLength)([a.start.x,o[0],o[2]],[a.start.y,o[1],o[3]],b)),a.start.x,a.start.y,o[0],o[1],o[2],o[3]);case"A":const l=o[0],u=o[1],h=o[2],f=o[3],p=o[5],y=o[6];let _=o[4];return _+=p*e/a.pathLength,er.getPointOnEllipticalArc(l,u,h,f,_,y)}return null}static getPointOnLine(e,t,r,s,i,a,o){a=a??t,o=o??r;const l=this.getLineLength(t,r,s,i);if(l<1e-10)return{x:t,y:r};if(s===t)return{x:a,y:o+(i>r?e:-e)};const u=(i-r)/(s-t),h=Math.sqrt(e*e/(1+u*u))*(s<t?-1:1),f=u*h;if(Math.abs(o-r-u*(a-t))<1e-10)return{x:a+h,y:o+f};const p=((a-t)*(s-t)+(o-r)*(i-r))/(l*l),y=t+p*(s-t),_=r+p*(i-r),b=this.getLineLength(a,o,y,_),S=Math.sqrt(e*e-b*b),E=Math.sqrt(S*S/(1+u*u))*(s<t?-1:1),C=u*E;return{x:y+E,y:_+C}}static getPointOnCubicBezier(e,t,r,s,i,a,o,l,u){function h(S){return S*S*S}function f(S){return 3*S*S*(1-S)}function p(S){return 3*S*(1-S)*(1-S)}function y(S){return(1-S)*(1-S)*(1-S)}const _=l*h(e)+a*f(e)+s*p(e)+t*y(e),b=u*h(e)+o*f(e)+i*p(e)+r*y(e);return{x:_,y:b}}static getPointOnQuadraticBezier(e,t,r,s,i,a,o){function l(y){return y*y}function u(y){return 2*y*(1-y)}function h(y){return(1-y)*(1-y)}const f=a*l(e)+s*u(e)+t*h(e),p=o*l(e)+i*u(e)+r*h(e);return{x:f,y:p}}static getPointOnEllipticalArc(e,t,r,s,i,a){const o=Math.cos(a),l=Math.sin(a),u={x:r*Math.cos(i),y:s*Math.sin(i)};return{x:e+(u.x*o-u.y*l),y:t+(u.x*l+u.y*o)}}static parsePathData(e){if(!e)return[];let t=e;const r=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(let f=0;f<r.length;f++)t=t.replace(new RegExp(r[f],"g"),"|"+r[f]);const s=t.split("|"),i=[],a=[];let o=0,l=0;const u=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let h;for(let f=1;f<s.length;f++){let p=s[f],y=p.charAt(0);for(p=p.slice(1),a.length=0;h=u.exec(p);)a.push(h[0]);const _=[];for(let b=0,S=a.length;b<S;b++){if(a[b]==="00"){_.push(0,0);continue}const E=parseFloat(a[b]);isNaN(E)?_.push(0):_.push(E)}for(;_.length>0&&!isNaN(_[0]);){let b="",S=[];const E=o,C=l;let v,I,L,R,P,x,N,M,D,F;switch(y){case"l":o+=_.shift(),l+=_.shift(),b="L",S.push(o,l);break;case"L":o=_.shift(),l=_.shift(),S.push(o,l);break;case"m":const $=_.shift(),H=_.shift();if(o+=$,l+=H,b="M",i.length>2&&i[i.length-1].command==="z"){for(let G=i.length-2;G>=0;G--)if(i[G].command==="M"){o=i[G].points[0]+$,l=i[G].points[1]+H;break}}S.push(o,l),y="l";break;case"M":o=_.shift(),l=_.shift(),b="M",S.push(o,l),y="L";break;case"h":o+=_.shift(),b="L",S.push(o,l);break;case"H":o=_.shift(),b="L",S.push(o,l);break;case"v":l+=_.shift(),b="L",S.push(o,l);break;case"V":l=_.shift(),b="L",S.push(o,l);break;case"C":S.push(_.shift(),_.shift(),_.shift(),_.shift()),o=_.shift(),l=_.shift(),S.push(o,l);break;case"c":S.push(o+_.shift(),l+_.shift(),o+_.shift(),l+_.shift()),o+=_.shift(),l+=_.shift(),b="C",S.push(o,l);break;case"S":I=o,L=l,v=i[i.length-1],v.command==="C"&&(I=o+(o-v.points[2]),L=l+(l-v.points[3])),S.push(I,L,_.shift(),_.shift()),o=_.shift(),l=_.shift(),b="C",S.push(o,l);break;case"s":I=o,L=l,v=i[i.length-1],v.command==="C"&&(I=o+(o-v.points[2]),L=l+(l-v.points[3])),S.push(I,L,o+_.shift(),l+_.shift()),o+=_.shift(),l+=_.shift(),b="C",S.push(o,l);break;case"Q":S.push(_.shift(),_.shift()),o=_.shift(),l=_.shift(),S.push(o,l);break;case"q":S.push(o+_.shift(),l+_.shift()),o+=_.shift(),l+=_.shift(),b="Q",S.push(o,l);break;case"T":I=o,L=l,v=i[i.length-1],v.command==="Q"&&(I=o+(o-v.points[0]),L=l+(l-v.points[1])),o=_.shift(),l=_.shift(),b="Q",S.push(I,L,o,l);break;case"t":I=o,L=l,v=i[i.length-1],v.command==="Q"&&(I=o+(o-v.points[0]),L=l+(l-v.points[1])),o+=_.shift(),l+=_.shift(),b="Q",S.push(I,L,o,l);break;case"A":R=_.shift(),P=_.shift(),x=_.shift(),N=_.shift(),M=_.shift(),D=o,F=l,o=_.shift(),l=_.shift(),b="A",S=this.convertEndpointToCenterParameterization(D,F,o,l,N,M,R,P,x);break;case"a":R=_.shift(),P=_.shift(),x=_.shift(),N=_.shift(),M=_.shift(),D=o,F=l,o+=_.shift(),l+=_.shift(),b="A",S=this.convertEndpointToCenterParameterization(D,F,o,l,N,M,R,P,x);break}i.push({command:b||y,points:S,start:{x:E,y:C},pathLength:this.calcLength(E,C,b||y,S)})}(y==="z"||y==="Z")&&i.push({command:"z",points:[],start:void 0,pathLength:0})}return i}static calcLength(e,t,r,s){let i,a,o,l;const u=er;switch(r){case"L":return u.getLineLength(e,t,s[0],s[1]);case"C":return(0,zd.getCubicArcLength)([e,s[0],s[2],s[4]],[t,s[1],s[3],s[5]],1);case"Q":return(0,zd.getQuadraticArcLength)([e,s[0],s[2]],[t,s[1],s[3]],1);case"A":i=0;const h=s[4],f=s[5],p=s[4]+f;let y=Math.PI/180;if(Math.abs(h-p)<y&&(y=Math.abs(h-p)),a=u.getPointOnEllipticalArc(s[0],s[1],s[2],s[3],h,0),f<0)for(l=h-y;l>p;l-=y)o=u.getPointOnEllipticalArc(s[0],s[1],s[2],s[3],l,0),i+=u.getLineLength(a.x,a.y,o.x,o.y),a=o;else for(l=h+y;l<p;l+=y)o=u.getPointOnEllipticalArc(s[0],s[1],s[2],s[3],l,0),i+=u.getLineLength(a.x,a.y,o.x,o.y),a=o;return o=u.getPointOnEllipticalArc(s[0],s[1],s[2],s[3],p,0),i+=u.getLineLength(a.x,a.y,o.x,o.y),i}return 0}static convertEndpointToCenterParameterization(e,t,r,s,i,a,o,l,u){const h=u*(Math.PI/180),f=Math.cos(h)*(e-r)/2+Math.sin(h)*(t-s)/2,p=-1*Math.sin(h)*(e-r)/2+Math.cos(h)*(t-s)/2,y=f*f/(o*o)+p*p/(l*l);y>1&&(o*=Math.sqrt(y),l*=Math.sqrt(y));let _=Math.sqrt((o*o*(l*l)-o*o*(p*p)-l*l*(f*f))/(o*o*(p*p)+l*l*(f*f)));i===a&&(_*=-1),isNaN(_)&&(_=0);const b=_*o*p/l,S=_*-l*f/o,E=(e+r)/2+Math.cos(h)*b-Math.sin(h)*S,C=(t+s)/2+Math.sin(h)*b+Math.cos(h)*S,v=function(M){return Math.sqrt(M[0]*M[0]+M[1]*M[1])},I=function(M,D){return(M[0]*D[0]+M[1]*D[1])/(v(M)*v(D))},L=function(M,D){return(M[0]*D[1]<M[1]*D[0]?-1:1)*Math.acos(I(M,D))},R=L([1,0],[(f-b)/o,(p-S)/l]),P=[(f-b)/o,(p-S)/l],x=[(-1*f-b)/o,(-1*p-S)/l];let N=L(P,x);return I(P,x)<=-1&&(N=Math.PI),I(P,x)>=1&&(N=0),a===0&&N>0&&(N=N-2*Math.PI),a===1&&N<0&&(N=N+2*Math.PI),[E,C,o,l,R,N,h,a]}}Mf.Path=er;er.prototype.className="Path";er.prototype._attrsAffectingSize=["data"];(0,Bte._registerNode)(er);Vte.Factory.addGetterSetter(er,"data");Object.defineProperty(rb,"__esModule",{value:!0});rb.Arrow=void 0;const ib=_t,Gte=b_,IF=Xe,Wte=ct,O3=Mf;class ud extends Gte.Line{_sceneFunc(e){super._sceneFunc(e);const t=Math.PI*2,r=this.points();let s=r;const i=this.tension()!==0&&r.length>4;i&&(s=this.getTensionPoints());const a=this.pointerLength(),o=r.length;let l,u;if(i){const p=[s[s.length-4],s[s.length-3],s[s.length-2],s[s.length-1],r[o-2],r[o-1]],y=O3.Path.calcLength(s[s.length-4],s[s.length-3],"C",p),_=O3.Path.getPointOnQuadraticBezier(Math.min(1,1-a/y),p[0],p[1],p[2],p[3],p[4],p[5]);l=r[o-2]-_.x,u=r[o-1]-_.y}else l=r[o-2]-r[o-4],u=r[o-1]-r[o-3];const h=(Math.atan2(u,l)+t)%t,f=this.pointerWidth();this.pointerAtEnding()&&(e.save(),e.beginPath(),e.translate(r[o-2],r[o-1]),e.rotate(h),e.moveTo(0,0),e.lineTo(-a,f/2),e.lineTo(-a,-f/2),e.closePath(),e.restore(),this.__fillStroke(e)),this.pointerAtBeginning()&&(e.save(),e.beginPath(),e.translate(r[0],r[1]),i?(l=(s[0]+s[2])/2-r[0],u=(s[1]+s[3])/2-r[1]):(l=r[2]-r[0],u=r[3]-r[1]),e.rotate((Math.atan2(-u,-l)+t)%t),e.moveTo(0,0),e.lineTo(-a,f/2),e.lineTo(-a,-f/2),e.closePath(),e.restore(),this.__fillStroke(e))}__fillStroke(e){const t=this.dashEnabled();t&&(this.attrs.dashEnabled=!1,e.setLineDash([])),e.fillStrokeShape(this),t&&(this.attrs.dashEnabled=!0)}getSelfRect(){const e=super.getSelfRect(),t=this.pointerWidth()/2;return{x:e.x,y:e.y-t,width:e.width,height:e.height+t*2}}}rb.Arrow=ud;ud.prototype.className="Arrow";(0,Wte._registerNode)(ud);ib.Factory.addGetterSetter(ud,"pointerLength",10,(0,IF.getNumberValidator)());ib.Factory.addGetterSetter(ud,"pointerWidth",10,(0,IF.getNumberValidator)());ib.Factory.addGetterSetter(ud,"pointerAtBeginning",!1);ib.Factory.addGetterSetter(ud,"pointerAtEnding",!0);var ab={};Object.defineProperty(ab,"__esModule",{value:!0});ab.Circle=void 0;const Hte=_t,qte=or,Kte=Xe,Qte=ct;let Df=class extends qte.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius()!==e/2&&this.radius(e/2)}setHeight(e){this.radius()!==e/2&&this.radius(e/2)}};ab.Circle=Df;Df.prototype._centroid=!0;Df.prototype.className="Circle";Df.prototype._attrsAffectingSize=["radius"];(0,Qte._registerNode)(Df);Hte.Factory.addGetterSetter(Df,"radius",0,(0,Kte.getNumberValidator)());var ob={};Object.defineProperty(ob,"__esModule",{value:!0});ob.Ellipse=void 0;const MP=_t,Yte=or,xF=Xe,Jte=ct;class $u extends Yte.Shape{_sceneFunc(e){const t=this.radiusX(),r=this.radiusY();e.beginPath(),e.save(),t!==r&&e.scale(1,r/t),e.arc(0,0,t,0,Math.PI*2,!1),e.restore(),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(e){this.radiusX(e/2)}setHeight(e){this.radiusY(e/2)}}ob.Ellipse=$u;$u.prototype.className="Ellipse";$u.prototype._centroid=!0;$u.prototype._attrsAffectingSize=["radiusX","radiusY"];(0,Jte._registerNode)($u);MP.Factory.addComponentsGetterSetter($u,"radius",["x","y"]);MP.Factory.addGetterSetter($u,"radiusX",0,(0,xF.getNumberValidator)());MP.Factory.addGetterSetter($u,"radiusY",0,(0,xF.getNumberValidator)());var lb={};Object.defineProperty(lb,"__esModule",{value:!0});lb.Image=void 0;const c2=En,cd=_t,Xte=or,Zte=ct,E_=Xe;let to=class kF extends Xte.Shape{constructor(e){super(e),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",t=>{this._removeImageLoad(t.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const e=this.image();e&&e.complete||e&&e.readyState===4||e&&e.addEventListener&&e.addEventListener("load",this._loadListener)}_removeImageLoad(e){e&&e.removeEventListener&&e.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const e=!!this.cornerRadius(),t=this.hasShadow();return e&&t?!0:super._useBufferCanvas(!0)}_sceneFunc(e){const t=this.getWidth(),r=this.getHeight(),s=this.cornerRadius(),i=this.attrs.image;let a;if(i){const o=this.attrs.cropWidth,l=this.attrs.cropHeight;o&&l?a=[i,this.cropX(),this.cropY(),o,l,0,0,t,r]:a=[i,0,0,t,r]}(this.hasFill()||this.hasStroke()||s)&&(e.beginPath(),s?c2.Util.drawRoundedRectPath(e,t,r,s):e.rect(0,0,t,r),e.closePath(),e.fillStrokeShape(this)),i&&(s&&e.clip(),e.drawImage.apply(e,a))}_hitFunc(e){const t=this.width(),r=this.height(),s=this.cornerRadius();e.beginPath(),s?c2.Util.drawRoundedRectPath(e,t,r,s):e.rect(0,0,t,r),e.closePath(),e.fillStrokeShape(this)}getWidth(){var e,t;return(e=this.attrs.width)!==null&&e!==void 0?e:(t=this.image())===null||t===void 0?void 0:t.width}getHeight(){var e,t;return(e=this.attrs.height)!==null&&e!==void 0?e:(t=this.image())===null||t===void 0?void 0:t.height}static fromURL(e,t,r=null){const s=c2.Util.createImageElement();s.onload=function(){const i=new kF({image:s});t(i)},s.onerror=r,s.crossOrigin="Anonymous",s.src=e}};lb.Image=to;to.prototype.className="Image";(0,Zte._registerNode)(to);cd.Factory.addGetterSetter(to,"cornerRadius",0,(0,E_.getNumberOrArrayOfNumbersValidator)(4));cd.Factory.addGetterSetter(to,"image");cd.Factory.addComponentsGetterSetter(to,"crop",["x","y","width","height"]);cd.Factory.addGetterSetter(to,"cropX",0,(0,E_.getNumberValidator)());cd.Factory.addGetterSetter(to,"cropY",0,(0,E_.getNumberValidator)());cd.Factory.addGetterSetter(to,"cropWidth",0,(0,E_.getNumberValidator)());cd.Factory.addGetterSetter(to,"cropHeight",0,(0,E_.getNumberValidator)());var rf={};Object.defineProperty(rf,"__esModule",{value:!0});rf.Tag=rf.Label=void 0;const ub=_t,ene=or,tne=Of,DP=Xe,PF=ct,AF=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],nne="Change.konva",rne="none",qC="up",KC="right",QC="down",YC="left",sne=AF.length;class FP extends tne.Group{constructor(e){super(e),this.on("add.konva",function(t){this._addListeners(t.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(e){let t=this,r;const s=function(){t._sync()};for(r=0;r<sne;r++)e.on(AF[r]+nne,s)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let e=this.getText(),t=this.getTag(),r,s,i,a,o,l,u;if(e&&t){switch(r=e.width(),s=e.height(),i=t.pointerDirection(),a=t.pointerWidth(),u=t.pointerHeight(),o=0,l=0,i){case qC:o=r/2,l=-1*u;break;case KC:o=r+a,l=s/2;break;case QC:o=r/2,l=s+u;break;case YC:o=-1*a,l=s/2;break}t.setAttrs({x:-1*o,y:-1*l,width:r,height:s}),e.setAttrs({x:-1*o,y:-1*l})}}}rf.Label=FP;FP.prototype.className="Label";(0,PF._registerNode)(FP);class dd extends ene.Shape{_sceneFunc(e){const t=this.width(),r=this.height(),s=this.pointerDirection(),i=this.pointerWidth(),a=this.pointerHeight(),o=this.cornerRadius();let l=0,u=0,h=0,f=0;typeof o=="number"?l=u=h=f=Math.min(o,t/2,r/2):(l=Math.min(o[0]||0,t/2,r/2),u=Math.min(o[1]||0,t/2,r/2),f=Math.min(o[2]||0,t/2,r/2),h=Math.min(o[3]||0,t/2,r/2)),e.beginPath(),e.moveTo(l,0),s===qC&&(e.lineTo((t-i)/2,0),e.lineTo(t/2,-1*a),e.lineTo((t+i)/2,0)),e.lineTo(t-u,0),e.arc(t-u,u,u,Math.PI*3/2,0,!1),s===KC&&(e.lineTo(t,(r-a)/2),e.lineTo(t+i,r/2),e.lineTo(t,(r+a)/2)),e.lineTo(t,r-f),e.arc(t-f,r-f,f,0,Math.PI/2,!1),s===QC&&(e.lineTo((t+i)/2,r),e.lineTo(t/2,r+a),e.lineTo((t-i)/2,r)),e.lineTo(h,r),e.arc(h,r-h,h,Math.PI/2,Math.PI,!1),s===YC&&(e.lineTo(0,(r+a)/2),e.lineTo(-1*i,r/2),e.lineTo(0,(r-a)/2)),e.lineTo(0,l),e.arc(l,l,l,Math.PI,Math.PI*3/2,!1),e.closePath(),e.fillStrokeShape(this)}getSelfRect(){let e=0,t=0,r=this.pointerWidth(),s=this.pointerHeight(),i=this.pointerDirection(),a=this.width(),o=this.height();return i===qC?(t-=s,o+=s):i===QC?o+=s:i===YC?(e-=r*1.5,a+=r):i===KC&&(a+=r*1.5),{x:e,y:t,width:a,height:o}}}rf.Tag=dd;dd.prototype.className="Tag";(0,PF._registerNode)(dd);ub.Factory.addGetterSetter(dd,"pointerDirection",rne);ub.Factory.addGetterSetter(dd,"pointerWidth",0,(0,DP.getNumberValidator)());ub.Factory.addGetterSetter(dd,"pointerHeight",0,(0,DP.getNumberValidator)());ub.Factory.addGetterSetter(dd,"cornerRadius",0,(0,DP.getNumberOrArrayOfNumbersValidator)(4));var S_={};Object.defineProperty(S_,"__esModule",{value:!0});S_.Rect=void 0;const ine=_t,ane=or,one=ct,lne=En,une=Xe;let cb=class extends ane.Shape{_sceneFunc(e){const t=this.cornerRadius(),r=this.width(),s=this.height();e.beginPath(),t?lne.Util.drawRoundedRectPath(e,r,s,t):e.rect(0,0,r,s),e.closePath(),e.fillStrokeShape(this)}};S_.Rect=cb;cb.prototype.className="Rect";(0,one._registerNode)(cb);ine.Factory.addGetterSetter(cb,"cornerRadius",0,(0,une.getNumberOrArrayOfNumbersValidator)(4));var db={};Object.defineProperty(db,"__esModule",{value:!0});db.RegularPolygon=void 0;const RF=_t,cne=or,NF=Xe,dne=ct;class hd extends cne.Shape{_sceneFunc(e){const t=this._getPoints();e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let r=1;r<t.length;r++)e.lineTo(t[r].x,t[r].y);e.closePath(),e.fillStrokeShape(this)}_getPoints(){const e=this.attrs.sides,t=this.attrs.radius||0,r=[];for(let s=0;s<e;s++)r.push({x:t*Math.sin(s*2*Math.PI/e),y:-1*t*Math.cos(s*2*Math.PI/e)});return r}getSelfRect(){const e=this._getPoints();let t=e[0].x,r=e[0].y,s=e[0].x,i=e[0].y;return e.forEach(a=>{t=Math.min(t,a.x),r=Math.max(r,a.x),s=Math.min(s,a.y),i=Math.max(i,a.y)}),{x:t,y:s,width:r-t,height:i-s}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}db.RegularPolygon=hd;hd.prototype.className="RegularPolygon";hd.prototype._centroid=!0;hd.prototype._attrsAffectingSize=["radius"];(0,dne._registerNode)(hd);RF.Factory.addGetterSetter(hd,"radius",0,(0,NF.getNumberValidator)());RF.Factory.addGetterSetter(hd,"sides",0,(0,NF.getNumberValidator)());var hb={};Object.defineProperty(hb,"__esModule",{value:!0});hb.Ring=void 0;const OF=_t,hne=or,LF=Xe,fne=ct,L3=Math.PI*2;class fd extends hne.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.innerRadius(),0,L3,!1),e.moveTo(this.outerRadius(),0),e.arc(0,0,this.outerRadius(),L3,0,!0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}hb.Ring=fd;fd.prototype.className="Ring";fd.prototype._centroid=!0;fd.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,fne._registerNode)(fd);OF.Factory.addGetterSetter(fd,"innerRadius",0,(0,LF.getNumberValidator)());OF.Factory.addGetterSetter(fd,"outerRadius",0,(0,LF.getNumberValidator)());var fb={};Object.defineProperty(fb,"__esModule",{value:!0});fb.Sprite=void 0;const pd=_t,pne=or,mne=Lf,MF=Xe,gne=ct;class no extends pne.Shape{constructor(e){super(e),this._updated=!0,this.anim=new mne.Animation(()=>{const t=this._updated;return this._updated=!1,t}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(e){const t=this.animation(),r=this.frameIndex(),s=r*4,i=this.animations()[t],a=this.frameOffsets(),o=i[s+0],l=i[s+1],u=i[s+2],h=i[s+3],f=this.image();if((this.hasFill()||this.hasStroke())&&(e.beginPath(),e.rect(0,0,u,h),e.closePath(),e.fillStrokeShape(this)),f)if(a){const p=a[t],y=r*2;e.drawImage(f,o,l,u,h,p[y+0],p[y+1],u,h)}else e.drawImage(f,o,l,u,h,0,0,u,h)}_hitFunc(e){const t=this.animation(),r=this.frameIndex(),s=r*4,i=this.animations()[t],a=this.frameOffsets(),o=i[s+2],l=i[s+3];if(e.beginPath(),a){const u=a[t],h=r*2;e.rect(u[h+0],u[h+1],o,l)}else e.rect(0,0,o,l);e.closePath(),e.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const e=this;this.interval=setInterval(function(){e._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const e=this.getLayer();this.anim.setLayers(e),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const e=this.frameIndex(),t=this.animation(),r=this.animations(),s=r[t],i=s.length/4;e<i-1?this.frameIndex(e+1):this.frameIndex(0)}}fb.Sprite=no;no.prototype.className="Sprite";(0,gne._registerNode)(no);pd.Factory.addGetterSetter(no,"animation");pd.Factory.addGetterSetter(no,"animations");pd.Factory.addGetterSetter(no,"frameOffsets");pd.Factory.addGetterSetter(no,"image");pd.Factory.addGetterSetter(no,"frameIndex",0,(0,MF.getNumberValidator)());pd.Factory.addGetterSetter(no,"frameRate",17,(0,MF.getNumberValidator)());pd.Factory.backCompat(no,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});var pb={};Object.defineProperty(pb,"__esModule",{value:!0});pb.Star=void 0;const $P=_t,_ne=or,jP=Xe,yne=ct;class ju extends _ne.Shape{_sceneFunc(e){const t=this.innerRadius(),r=this.outerRadius(),s=this.numPoints();e.beginPath(),e.moveTo(0,0-r);for(let i=1;i<s*2;i++){const a=i%2===0?r:t,o=a*Math.sin(i*Math.PI/s),l=-1*a*Math.cos(i*Math.PI/s);e.lineTo(o,l)}e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}pb.Star=ju;ju.prototype.className="Star";ju.prototype._centroid=!0;ju.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,yne._registerNode)(ju);$P.Factory.addGetterSetter(ju,"numPoints",5,(0,jP.getNumberValidator)());$P.Factory.addGetterSetter(ju,"innerRadius",0,(0,jP.getNumberValidator)());$P.Factory.addGetterSetter(ju,"outerRadius",0,(0,jP.getNumberValidator)());var Ff={};Object.defineProperty(Ff,"__esModule",{value:!0});Ff.Text=void 0;Ff.stringToArray=fc;const JC=En,ls=_t,vne=or,d2=ct,Uu=Xe,wne=ct;function fc(n){return[...n].reduce((e,t,r,s)=>{if(new RegExp("\\p{Emoji}","u").test(t)){const i=s[r+1];i&&new RegExp("\\p{Emoji_Modifier}|\\u200D","u").test(i)?(e.push(t+i),s[r+1]=""):e.push(t)}else new RegExp("\\p{Regional_Indicator}{2}","u").test(t+(s[r+1]||""))?e.push(t+s[r+1]):r>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(t)?e[e.length-1]+=t:t&&e.push(t);return e},[])}const Gd="auto",bne="center",DF="inherit",zp="justify",Ene="Change.konva",Sne="2d",M3="-",FF="left",Tne="text",Cne="Text",Ine="top",xne="bottom",D3="middle",$F="normal",kne="px ",s0=" ",Pne="right",F3="rtl",Ane="word",Rne="char",$3="none",h2="…",jF=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],Nne=jF.length;function One(n){return n.split(",").map(e=>{e=e.trim();const t=e.indexOf(" ")>=0,r=e.indexOf('"')>=0||e.indexOf("'")>=0;return t&&!r&&(e=`"${e}"`),e}).join(", ")}let i0;function f2(){return i0||(i0=JC.Util.createCanvasElement().getContext(Sne),i0)}function Lne(n){n.fillText(this._partialText,this._partialTextX,this._partialTextY)}function Mne(n){n.setAttr("miterLimit",2),n.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function Dne(n){return n=n||{},!n.fillLinearGradientColorStops&&!n.fillRadialGradientColorStops&&!n.fillPatternImage&&(n.fill=n.fill||"black"),n}let In=class extends vne.Shape{constructor(e){super(Dne(e)),this._partialTextX=0,this._partialTextY=0;for(let t=0;t<Nne;t++)this.on(jF[t]+Ene,this._setTextData);this._setTextData()}_sceneFunc(e){const t=this.textArr,r=t.length;if(!this.text())return;let s=this.padding(),i=this.fontSize(),a=this.lineHeight()*i,o=this.verticalAlign(),l=this.direction(),u=0,h=this.align(),f=this.getWidth(),p=this.letterSpacing(),y=this.fill(),_=this.textDecoration(),b=_.indexOf("underline")!==-1,S=_.indexOf("line-through")!==-1,E;l=l===DF?e.direction:l;let C=a/2,v=D3;if(d2.Konva._fixTextRendering){const I=this.measureSize("M");v="alphabetic",C=(I.fontBoundingBoxAscent-I.fontBoundingBoxDescent)/2+a/2}for(l===F3&&e.setAttr("direction",l),e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",v),e.setAttr("textAlign",FF),o===D3?u=(this.getHeight()-r*a-s*2)/2:o===xne&&(u=this.getHeight()-r*a-s*2),e.translate(s,u+s),E=0;E<r;E++){let I=0,L=0;const R=t[E],P=R.text,x=R.width,N=R.lastInParagraph;if(e.save(),h===Pne?I+=f-x-s*2:h===bne&&(I+=(f-x-s*2)/2),b){e.save(),e.beginPath();const M=d2.Konva._fixTextRendering?Math.round(i/4):Math.round(i/2),D=I,F=C+L+M;e.moveTo(D,F);const $=h===zp&&!N?f-s*2:x;e.lineTo(D+Math.round($),F),e.lineWidth=i/15;const H=this._getLinearGradient();e.strokeStyle=H||y,e.stroke(),e.restore()}if(S){e.save(),e.beginPath();const M=d2.Konva._fixTextRendering?-Math.round(i/4):0;e.moveTo(I,C+L+M);const D=h===zp&&!N?f-s*2:x;e.lineTo(I+Math.round(D),C+L+M),e.lineWidth=i/15;const F=this._getLinearGradient();e.strokeStyle=F||y,e.stroke(),e.restore()}if(l!==F3&&(p!==0||h===zp)){const M=P.split(" ").length-1,D=fc(P);for(let F=0;F<D.length;F++){const $=D[F];$===" "&&!N&&h===zp&&(I+=(f-s*2-x)/M),this._partialTextX=I,this._partialTextY=C+L,this._partialText=$,e.fillStrokeShape(this),I+=this.measureSize($).width+p}}else p!==0&&e.setAttr("letterSpacing",`${p}px`),this._partialTextX=I,this._partialTextY=C+L,this._partialText=P,e.fillStrokeShape(this);e.restore(),r>1&&(C+=a)}}_hitFunc(e){const t=this.getWidth(),r=this.getHeight();e.beginPath(),e.rect(0,0,t,r),e.closePath(),e.fillStrokeShape(this)}setText(e){const t=JC.Util._isString(e)?e:e==null?"":e+"";return this._setAttr(Tne,t),this}getWidth(){return this.attrs.width===Gd||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===Gd||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return JC.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(e){var t,r,s,i,a,o,l,u,h,f,p;let y=f2(),_=this.fontSize(),b;y.save(),y.font=this._getContextFont(),b=y.measureText(e),y.restore();const S=_/100;return{actualBoundingBoxAscent:(t=b.actualBoundingBoxAscent)!==null&&t!==void 0?t:71.58203125*S,actualBoundingBoxDescent:(r=b.actualBoundingBoxDescent)!==null&&r!==void 0?r:0,actualBoundingBoxLeft:(s=b.actualBoundingBoxLeft)!==null&&s!==void 0?s:-7.421875*S,actualBoundingBoxRight:(i=b.actualBoundingBoxRight)!==null&&i!==void 0?i:75.732421875*S,alphabeticBaseline:(a=b.alphabeticBaseline)!==null&&a!==void 0?a:0,emHeightAscent:(o=b.emHeightAscent)!==null&&o!==void 0?o:100*S,emHeightDescent:(l=b.emHeightDescent)!==null&&l!==void 0?l:-20*S,fontBoundingBoxAscent:(u=b.fontBoundingBoxAscent)!==null&&u!==void 0?u:91*S,fontBoundingBoxDescent:(h=b.fontBoundingBoxDescent)!==null&&h!==void 0?h:21*S,hangingBaseline:(f=b.hangingBaseline)!==null&&f!==void 0?f:72.80000305175781*S,ideographicBaseline:(p=b.ideographicBaseline)!==null&&p!==void 0?p:-21*S,width:b.width,height:_}}_getContextFont(){return this.fontStyle()+s0+this.fontVariant()+s0+(this.fontSize()+kne)+One(this.fontFamily())}_addTextLine(e){this.align()===zp&&(e=e.trim());const r=this._getTextWidth(e);return this.textArr.push({text:e,width:r,lastInParagraph:!1})}_getTextWidth(e){const t=this.letterSpacing(),r=e.length;return f2().measureText(e).width+t*r}_setTextData(){let e=this.text().split(`
`),t=+this.fontSize(),r=0,s=this.lineHeight()*t,i=this.attrs.width,a=this.attrs.height,o=i!==Gd&&i!==void 0,l=a!==Gd&&a!==void 0,u=this.padding(),h=i-u*2,f=a-u*2,p=0,y=this.wrap(),_=y!==$3,b=y!==Rne&&_,S=this.ellipsis();this.textArr=[],f2().font=this._getContextFont();const E=S?this._getTextWidth(h2):0;for(let C=0,v=e.length;C<v;++C){let I=e[C],L=this._getTextWidth(I);if(o&&L>h)for(;I.length>0;){let R=0,P=fc(I).length,x="",N=0;for(;R<P;){const M=R+P>>>1,D=fc(I),F=D.slice(0,M+1).join(""),$=this._getTextWidth(F);(S&&l&&p+s>f?$+E:$)<=h?(R=M+1,x=F,N=$):P=M}if(x){if(b){const F=fc(I),$=fc(x),H=F[$.length],G=H===s0||H===M3;let ue;if(G&&N<=h)ue=$.length;else{const ae=$.lastIndexOf(s0),z=$.lastIndexOf(M3);ue=Math.max(ae,z)+1}ue>0&&(R=ue,x=F.slice(0,R).join(""),N=this._getTextWidth(x))}if(x=x.trimRight(),this._addTextLine(x),r=Math.max(r,N),p+=s,this._shouldHandleEllipsis(p)){this._tryToAddEllipsisToLastLine();break}if(I=fc(I).slice(R).join("").trimLeft(),I.length>0&&(L=this._getTextWidth(I),L<=h)){this._addTextLine(I),p+=s,r=Math.max(r,L);break}}else break}else this._addTextLine(I),p+=s,r=Math.max(r,L),this._shouldHandleEllipsis(p)&&C<v-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),l&&p+s>f)break}this.textHeight=t,this.textWidth=r}_shouldHandleEllipsis(e){const t=+this.fontSize(),r=this.lineHeight()*t,s=this.attrs.height,i=s!==Gd&&s!==void 0,a=this.padding(),o=s-a*2;return!(this.wrap()!==$3)||i&&e+r>o}_tryToAddEllipsisToLastLine(){const e=this.attrs.width,t=e!==Gd&&e!==void 0,r=this.padding(),s=e-r*2,i=this.ellipsis(),a=this.textArr[this.textArr.length-1];!a||!i||(t&&(this._getTextWidth(a.text+h2)<s||(a.text=a.text.slice(0,a.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(a.text+h2))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const e=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,t=this.hasShadow();return e&&t?!0:super._useBufferCanvas()}};Ff.Text=In;In.prototype._fillFunc=Lne;In.prototype._strokeFunc=Mne;In.prototype.className=Cne;In.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];(0,wne._registerNode)(In);ls.Factory.overWriteSetter(In,"width",(0,Uu.getNumberOrAutoValidator)());ls.Factory.overWriteSetter(In,"height",(0,Uu.getNumberOrAutoValidator)());ls.Factory.addGetterSetter(In,"direction",DF);ls.Factory.addGetterSetter(In,"fontFamily","Arial");ls.Factory.addGetterSetter(In,"fontSize",12,(0,Uu.getNumberValidator)());ls.Factory.addGetterSetter(In,"fontStyle",$F);ls.Factory.addGetterSetter(In,"fontVariant",$F);ls.Factory.addGetterSetter(In,"padding",0,(0,Uu.getNumberValidator)());ls.Factory.addGetterSetter(In,"align",FF);ls.Factory.addGetterSetter(In,"verticalAlign",Ine);ls.Factory.addGetterSetter(In,"lineHeight",1,(0,Uu.getNumberValidator)());ls.Factory.addGetterSetter(In,"wrap",Ane);ls.Factory.addGetterSetter(In,"ellipsis",!1,(0,Uu.getBooleanValidator)());ls.Factory.addGetterSetter(In,"letterSpacing",0,(0,Uu.getNumberValidator)());ls.Factory.addGetterSetter(In,"text","",(0,Uu.getStringValidator)());ls.Factory.addGetterSetter(In,"textDecoration","");var mb={};Object.defineProperty(mb,"__esModule",{value:!0});mb.TextPath=void 0;const p2=En,pa=_t,Fne=or,Gp=Mf,m2=Ff,UF=Xe,$ne=ct,jne="",VF="normal";function BF(n){n.fillText(this.partialText,0,0)}function zF(n){n.strokeText(this.partialText,0,0)}class lr extends Fne.Shape{constructor(e){super(e),this.dummyCanvas=p2.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return Gp.Path.getPathLength(this.dataArray)}_getPointAtLength(e){if(!this.attrs.data)return null;const t=this.pathLength;return e-1>t?null:Gp.Path.getPointAtLengthOfDataArray(e,this.dataArray)}_readDataAttribute(){this.dataArray=Gp.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(e){e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",this.textBaseline()),e.setAttr("textAlign","left"),e.save();const t=this.textDecoration(),r=this.fill(),s=this.fontSize(),i=this.glyphInfo;t==="underline"&&e.beginPath();for(let a=0;a<i.length;a++){e.save();const o=i[a].p0;e.translate(o.x,o.y),e.rotate(i[a].rotation),this.partialText=i[a].text,e.fillStrokeShape(this),t==="underline"&&(a===0&&e.moveTo(0,s/2+1),e.lineTo(s,s/2+1)),e.restore()}t==="underline"&&(e.strokeStyle=r,e.lineWidth=s/20,e.stroke()),e.restore()}_hitFunc(e){e.beginPath();const t=this.glyphInfo;if(t.length>=1){const r=t[0].p0;e.moveTo(r.x,r.y)}for(let r=0;r<t.length;r++){const s=t[r].p1;e.lineTo(s.x,s.y)}e.setAttr("lineWidth",this.fontSize()),e.setAttr("strokeStyle",this.colorKey),e.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return p2.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(e){return m2.Text.prototype.setText.call(this,e)}_getContextFont(){return m2.Text.prototype._getContextFont.call(this)}_getTextSize(e){const r=this.dummyCanvas.getContext("2d");r.save(),r.font=this._getContextFont();const s=r.measureText(e);return r.restore(),{width:s.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:e,height:t}=this._getTextSize(this.attrs.text);if(this.textWidth=e,this.textHeight=t,this.glyphInfo=[],!this.attrs.data)return null;const r=this.letterSpacing(),s=this.align(),i=this.kerningFunc(),a=Math.max(this.textWidth+((this.attrs.text||"").length-1)*r,0);let o=0;s==="center"&&(o=Math.max(0,this.pathLength/2-a/2)),s==="right"&&(o=Math.max(0,this.pathLength-a));const l=(0,m2.stringToArray)(this.text());let u=o;for(let h=0;h<l.length;h++){const f=this._getPointAtLength(u);if(!f)return;let p=this._getTextSize(l[h]).width+r;if(l[h]===" "&&s==="justify"){const C=this.text().split(" ").length-1;p+=(this.pathLength-a)/C}const y=this._getPointAtLength(u+p);if(!y)return;const _=Gp.Path.getLineLength(f.x,f.y,y.x,y.y);let b=0;if(i)try{b=i(l[h-1],l[h])*this.fontSize()}catch{b=0}f.x+=b,y.x+=b,this.textWidth+=b;const S=Gp.Path.getPointOnLine(b+_/2,f.x,f.y,y.x,y.y),E=Math.atan2(y.y-f.y,y.x-f.x);this.glyphInfo.push({transposeX:S.x,transposeY:S.y,text:l[h],rotation:E,p0:f,p1:y}),u+=p}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const e=[];this.glyphInfo.forEach(function(u){e.push(u.p0.x),e.push(u.p0.y),e.push(u.p1.x),e.push(u.p1.y)});let t=e[0]||0,r=e[0]||0,s=e[1]||0,i=e[1]||0,a,o;for(let u=0;u<e.length/2;u++)a=e[u*2],o=e[u*2+1],t=Math.min(t,a),r=Math.max(r,a),s=Math.min(s,o),i=Math.max(i,o);const l=this.fontSize();return{x:t-l/2,y:s-l/2,width:r-t+l,height:i-s+l}}destroy(){return p2.Util.releaseCanvas(this.dummyCanvas),super.destroy()}}mb.TextPath=lr;lr.prototype._fillFunc=BF;lr.prototype._strokeFunc=zF;lr.prototype._fillFuncHit=BF;lr.prototype._strokeFuncHit=zF;lr.prototype.className="TextPath";lr.prototype._attrsAffectingSize=["text","fontSize","data"];(0,$ne._registerNode)(lr);pa.Factory.addGetterSetter(lr,"data");pa.Factory.addGetterSetter(lr,"fontFamily","Arial");pa.Factory.addGetterSetter(lr,"fontSize",12,(0,UF.getNumberValidator)());pa.Factory.addGetterSetter(lr,"fontStyle",VF);pa.Factory.addGetterSetter(lr,"align","left");pa.Factory.addGetterSetter(lr,"letterSpacing",0,(0,UF.getNumberValidator)());pa.Factory.addGetterSetter(lr,"textBaseline","middle");pa.Factory.addGetterSetter(lr,"fontVariant",VF);pa.Factory.addGetterSetter(lr,"text",jne);pa.Factory.addGetterSetter(lr,"textDecoration","");pa.Factory.addGetterSetter(lr,"kerningFunc",void 0);var gb={};Object.defineProperty(gb,"__esModule",{value:!0});gb.Transformer=void 0;const Jt=En,Vt=_t,j3=fn,Une=or,Vne=S_,U3=Of,Qi=ct,Vu=Xe,Bne=ct,GF="tr-konva",zne=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(n=>n+`.${GF}`).join(" "),V3="nodesRect",Gne=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],Wne={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},Hne="ontouchstart"in Qi.Konva._global;function qne(n,e,t){if(n==="rotater")return t;e+=Jt.Util.degToRad(Wne[n]||0);const r=(Jt.Util.radToDeg(e)%360+360)%360;return Jt.Util._inRange(r,315+22.5,360)||Jt.Util._inRange(r,0,22.5)?"ns-resize":Jt.Util._inRange(r,45-22.5,45+22.5)?"nesw-resize":Jt.Util._inRange(r,90-22.5,90+22.5)?"ew-resize":Jt.Util._inRange(r,135-22.5,135+22.5)?"nwse-resize":Jt.Util._inRange(r,180-22.5,180+22.5)?"ns-resize":Jt.Util._inRange(r,225-22.5,225+22.5)?"nesw-resize":Jt.Util._inRange(r,270-22.5,270+22.5)?"ew-resize":Jt.Util._inRange(r,315-22.5,315+22.5)?"nwse-resize":(Jt.Util.error("Transformer has unknown angle for cursor detection: "+r),"pointer")}const mw=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function Kne(n){return{x:n.x+n.width/2*Math.cos(n.rotation)+n.height/2*Math.sin(-n.rotation),y:n.y+n.height/2*Math.cos(n.rotation)+n.width/2*Math.sin(n.rotation)}}function WF(n,e,t){const r=t.x+(n.x-t.x)*Math.cos(e)-(n.y-t.y)*Math.sin(e),s=t.y+(n.x-t.x)*Math.sin(e)+(n.y-t.y)*Math.cos(e);return{...n,rotation:n.rotation+e,x:r,y:s}}function Qne(n,e){const t=Kne(n);return WF(n,e,t)}function Yne(n,e,t){let r=e;for(let s=0;s<n.length;s++){const i=Qi.Konva.getAngle(n[s]),a=Math.abs(i-e)%(Math.PI*2);Math.min(a,Math.PI*2-a)<t&&(r=i)}return r}let XC=0,xt=class extends U3.Group{constructor(e){super(e),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(zne,this.update),this.getNode()&&this.update()}attachTo(e){return this.setNode(e),this}setNode(e){return Jt.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([e])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return GF+this._id}setNodes(e=[]){this._nodes&&this._nodes.length&&this.detach();const t=e.filter(s=>s.isAncestorOf(this)?(Jt.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=e=t,e.length===1&&this.useSingleNodeRotation()?this.rotation(e[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(s=>{const i=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(s._attrsAffectingSize.length){const a=s._attrsAffectingSize.map(o=>o+"Change."+this._getEventNamespace()).join(" ");s.on(a,i)}s.on(Gne.map(a=>a+`.${this._getEventNamespace()}`).join(" "),i),s.on(`absoluteTransformChange.${this._getEventNamespace()}`,i),this._proxyDrag(s)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(e){let t;e.on(`dragstart.${this._getEventNamespace()}`,r=>{t=e.getAbsolutePosition(),!this.isDragging()&&e!==this.findOne(".back")&&this.startDrag(r,!1)}),e.on(`dragmove.${this._getEventNamespace()}`,r=>{if(!t)return;const s=e.getAbsolutePosition(),i=s.x-t.x,a=s.y-t.y;this.nodes().forEach(o=>{if(o===e||o.isDragging())return;const l=o.getAbsolutePosition();o.setAbsolutePosition({x:l.x+i,y:l.y+a}),o.startDrag(r)}),t=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(e=>{e.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(V3),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(V3,this.__getNodeRect)}__getNodeShape(e,t=this.rotation(),r){const s=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),i=e.getAbsoluteScale(r),a=e.getAbsolutePosition(r),o=s.x*i.x-e.offsetX()*i.x,l=s.y*i.y-e.offsetY()*i.y,u=(Qi.Konva.getAngle(e.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),h={x:a.x+o*Math.cos(u)+l*Math.sin(-u),y:a.y+l*Math.cos(u)+o*Math.sin(u),width:s.width*i.x,height:s.height*i.y,rotation:u};return WF(h,-Qi.Konva.getAngle(t),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const t=[];this.nodes().map(u=>{const h=u.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),f=[{x:h.x,y:h.y},{x:h.x+h.width,y:h.y},{x:h.x+h.width,y:h.y+h.height},{x:h.x,y:h.y+h.height}],p=u.getAbsoluteTransform();f.forEach(function(y){const _=p.point(y);t.push(_)})});const r=new Jt.Transform;r.rotate(-Qi.Konva.getAngle(this.rotation()));let s=1/0,i=1/0,a=-1/0,o=-1/0;t.forEach(function(u){const h=r.point(u);s===void 0&&(s=a=h.x,i=o=h.y),s=Math.min(s,h.x),i=Math.min(i,h.y),a=Math.max(a,h.x),o=Math.max(o,h.y)}),r.invert();const l=r.point({x:s,y:i});return{x:l.x,y:l.y,width:a-s,height:o-i,rotation:Qi.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),mw.forEach(e=>{this._createAnchor(e)}),this._createAnchor("rotater")}_createAnchor(e){const t=new Vne.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:e+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:Hne?10:"auto"}),r=this;t.on("mousedown touchstart",function(s){r._handleMouseDown(s)}),t.on("dragstart",s=>{t.stopDrag(),s.cancelBubble=!0}),t.on("dragend",s=>{s.cancelBubble=!0}),t.on("mouseenter",()=>{const s=Qi.Konva.getAngle(this.rotation()),i=this.rotateAnchorCursor(),a=qne(e,s,i);t.getStage().content&&(t.getStage().content.style.cursor=a),this._cursorChange=!0}),t.on("mouseout",()=>{t.getStage().content&&(t.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(t)}_createBack(){const e=new Une.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(t,r){const s=r.getParent(),i=s.padding();t.beginPath(),t.rect(-i,-i,r.width()+i*2,r.height()+i*2),t.moveTo(r.width()/2,-i),s.rotateEnabled()&&s.rotateLineVisible()&&t.lineTo(r.width()/2,-s.rotateAnchorOffset()*Jt.Util._sign(r.height())-i),t.fillStrokeShape(r)},hitFunc:(t,r)=>{if(!this.shouldOverdrawWholeArea())return;const s=this.padding();t.beginPath(),t.rect(-s,-s,r.width()+s*2,r.height()+s*2),t.fillStrokeShape(r)}});this.add(e),this._proxyDrag(e),e.on("dragstart",t=>{t.cancelBubble=!0}),e.on("dragmove",t=>{t.cancelBubble=!0}),e.on("dragend",t=>{t.cancelBubble=!0}),this.on("dragmove",t=>{this.update()})}_handleMouseDown(e){if(this._transforming)return;this._movingAnchorName=e.target.name().split(" ")[0];const t=this._getNodeRect(),r=t.width,s=t.height,i=Math.sqrt(Math.pow(r,2)+Math.pow(s,2));this.sin=Math.abs(s/i),this.cos=Math.abs(r/i),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const a=e.target.getAbsolutePosition(),o=e.target.getStage().getPointerPosition();this._anchorDragOffset={x:o.x-a.x,y:o.y-a.y},XC++,this._fire("transformstart",{evt:e.evt,target:this.getNode()}),this._nodes.forEach(l=>{l._fire("transformstart",{evt:e.evt,target:l})})}_handleMouseMove(e){let t,r,s;const i=this.findOne("."+this._movingAnchorName),a=i.getStage();a.setPointersPositions(e);const o=a.getPointerPosition();let l={x:o.x-this._anchorDragOffset.x,y:o.y-this._anchorDragOffset.y};const u=i.getAbsolutePosition();this.anchorDragBoundFunc()&&(l=this.anchorDragBoundFunc()(u,l,e)),i.setAbsolutePosition(l);const h=i.getAbsolutePosition();if(u.x===h.x&&u.y===h.y)return;if(this._movingAnchorName==="rotater"){const C=this._getNodeRect();t=i.x()-C.width/2,r=-i.y()+C.height/2;let v=Math.atan2(-r,t)+Math.PI/2;C.height<0&&(v-=Math.PI);const L=Qi.Konva.getAngle(this.rotation())+v,R=Qi.Konva.getAngle(this.rotationSnapTolerance()),x=Yne(this.rotationSnaps(),L,R)-C.rotation,N=Qne(C,x);this._fitNodesInto(N,e);return}const f=this.shiftBehavior();let p;f==="inverted"?p=this.keepRatio()&&!e.shiftKey:f==="none"?p=this.keepRatio():p=this.keepRatio()||e.shiftKey;let y=this.centeredScaling()||e.altKey;if(this._movingAnchorName==="top-left"){if(p){const C=y?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};s=Math.sqrt(Math.pow(C.x-i.x(),2)+Math.pow(C.y-i.y(),2));const v=this.findOne(".top-left").x()>C.x?-1:1,I=this.findOne(".top-left").y()>C.y?-1:1;t=s*this.cos*v,r=s*this.sin*I,this.findOne(".top-left").x(C.x-t),this.findOne(".top-left").y(C.y-r)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(i.y());else if(this._movingAnchorName==="top-right"){if(p){const C=y?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};s=Math.sqrt(Math.pow(i.x()-C.x,2)+Math.pow(C.y-i.y(),2));const v=this.findOne(".top-right").x()<C.x?-1:1,I=this.findOne(".top-right").y()>C.y?-1:1;t=s*this.cos*v,r=s*this.sin*I,this.findOne(".top-right").x(C.x+t),this.findOne(".top-right").y(C.y-r)}var _=i.position();this.findOne(".top-left").y(_.y),this.findOne(".bottom-right").x(_.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(i.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(i.x());else if(this._movingAnchorName==="bottom-left"){if(p){const C=y?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};s=Math.sqrt(Math.pow(C.x-i.x(),2)+Math.pow(i.y()-C.y,2));const v=C.x<i.x()?-1:1,I=i.y()<C.y?-1:1;t=s*this.cos*v,r=s*this.sin*I,i.x(C.x-t),i.y(C.y+r)}_=i.position(),this.findOne(".top-left").x(_.x),this.findOne(".bottom-right").y(_.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(i.y());else if(this._movingAnchorName==="bottom-right"){if(p){const C=y?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};s=Math.sqrt(Math.pow(i.x()-C.x,2)+Math.pow(i.y()-C.y,2));const v=this.findOne(".bottom-right").x()<C.x?-1:1,I=this.findOne(".bottom-right").y()<C.y?-1:1;t=s*this.cos*v,r=s*this.sin*I,this.findOne(".bottom-right").x(C.x+t),this.findOne(".bottom-right").y(C.y+r)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(y=this.centeredScaling()||e.altKey,y){const C=this.findOne(".top-left"),v=this.findOne(".bottom-right"),I=C.x(),L=C.y(),R=this.getWidth()-v.x(),P=this.getHeight()-v.y();v.move({x:-I,y:-L}),C.move({x:R,y:P})}const b=this.findOne(".top-left").getAbsolutePosition();t=b.x,r=b.y;const S=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),E=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:t,y:r,width:S,height:E,rotation:Qi.Konva.getAngle(this.rotation())},e)}_handleMouseUp(e){this._removeEvents(e)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(e){var t;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const r=this.getNode();XC--,this._fire("transformend",{evt:e,target:r}),(t=this.getLayer())===null||t===void 0||t.batchDraw(),r&&this._nodes.forEach(s=>{var i;s._fire("transformend",{evt:e,target:s}),(i=s.getLayer())===null||i===void 0||i.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(e,t){const r=this._getNodeRect(),s=1;if(Jt.Util._inRange(e.width,-this.padding()*2-s,s)){this.update();return}if(Jt.Util._inRange(e.height,-this.padding()*2-s,s)){this.update();return}const i=new Jt.Transform;if(i.rotate(Qi.Konva.getAngle(this.rotation())),this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("left")>=0){const p=i.point({x:-this.padding()*2,y:0});e.x+=p.x,e.y+=p.y,e.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=p.x,this._anchorDragOffset.y-=p.y}else if(this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("right")>=0){const p=i.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=p.x,this._anchorDragOffset.y-=p.y,e.width+=this.padding()*2}if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("top")>=0){const p=i.point({x:0,y:-this.padding()*2});e.x+=p.x,e.y+=p.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=p.x,this._anchorDragOffset.y-=p.y,e.height+=this.padding()*2}else if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const p=i.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=p.x,this._anchorDragOffset.y-=p.y,e.height+=this.padding()*2}if(this.boundBoxFunc()){const p=this.boundBoxFunc()(r,e);p?e=p:Jt.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const a=1e7,o=new Jt.Transform;o.translate(r.x,r.y),o.rotate(r.rotation),o.scale(r.width/a,r.height/a);const l=new Jt.Transform,u=e.width/a,h=e.height/a;this.flipEnabled()===!1?(l.translate(e.x,e.y),l.rotate(e.rotation),l.translate(e.width<0?e.width:0,e.height<0?e.height:0),l.scale(Math.abs(u),Math.abs(h))):(l.translate(e.x,e.y),l.rotate(e.rotation),l.scale(u,h));const f=l.multiply(o.invert());this._nodes.forEach(p=>{var y;const _=p.getParent().getAbsoluteTransform(),b=p.getTransform().copy();b.translate(p.offsetX(),p.offsetY());const S=new Jt.Transform;S.multiply(_.copy().invert()).multiply(f).multiply(_).multiply(b);const E=S.decompose();p.setAttrs(E),(y=p.getLayer())===null||y===void 0||y.batchDraw()}),this.rotation(Jt.Util._getRotation(e.rotation)),this._nodes.forEach(p=>{this._fire("transform",{evt:t,target:p}),p._fire("transform",{evt:t,target:p})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(e,t){this.findOne(e).setAttrs(t)}update(){var e;const t=this._getNodeRect();this.rotation(Jt.Util._getRotation(t.rotation));const r=t.width,s=t.height,i=this.enabledAnchors(),a=this.resizeEnabled(),o=this.padding(),l=this.anchorSize(),u=this.find("._anchor");u.forEach(f=>{f.setAttrs({width:l,height:l,offsetX:l/2,offsetY:l/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:l/2+o,offsetY:l/2+o,visible:a&&i.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:r/2,y:0,offsetY:l/2+o,visible:a&&i.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:r,y:0,offsetX:l/2-o,offsetY:l/2+o,visible:a&&i.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:s/2,offsetX:l/2+o,visible:a&&i.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:r,y:s/2,offsetX:l/2-o,visible:a&&i.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:s,offsetX:l/2+o,offsetY:l/2-o,visible:a&&i.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:r/2,y:s,offsetY:l/2-o,visible:a&&i.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:r,y:s,offsetX:l/2-o,offsetY:l/2-o,visible:a&&i.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:r/2,y:-this.rotateAnchorOffset()*Jt.Util._sign(s)-o,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:r,height:s,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const h=this.anchorStyleFunc();h&&u.forEach(f=>{h(f)}),(e=this.getLayer())===null||e===void 0||e.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const e=this.findOne("."+this._movingAnchorName);e&&e.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),U3.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return j3.Node.prototype.toObject.call(this)}clone(e){return j3.Node.prototype.clone.call(this,e)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}};gb.Transformer=xt;xt.isTransforming=()=>XC>0;function Jne(n){return n instanceof Array||Jt.Util.warn("enabledAnchors value should be an array"),n instanceof Array&&n.forEach(function(e){mw.indexOf(e)===-1&&Jt.Util.warn("Unknown anchor name: "+e+". Available names are: "+mw.join(", "))}),n||[]}xt.prototype.className="Transformer";(0,Bne._registerNode)(xt);Vt.Factory.addGetterSetter(xt,"enabledAnchors",mw,Jne);Vt.Factory.addGetterSetter(xt,"flipEnabled",!0,(0,Vu.getBooleanValidator)());Vt.Factory.addGetterSetter(xt,"resizeEnabled",!0);Vt.Factory.addGetterSetter(xt,"anchorSize",10,(0,Vu.getNumberValidator)());Vt.Factory.addGetterSetter(xt,"rotateEnabled",!0);Vt.Factory.addGetterSetter(xt,"rotateLineVisible",!0);Vt.Factory.addGetterSetter(xt,"rotationSnaps",[]);Vt.Factory.addGetterSetter(xt,"rotateAnchorOffset",50,(0,Vu.getNumberValidator)());Vt.Factory.addGetterSetter(xt,"rotateAnchorCursor","crosshair");Vt.Factory.addGetterSetter(xt,"rotationSnapTolerance",5,(0,Vu.getNumberValidator)());Vt.Factory.addGetterSetter(xt,"borderEnabled",!0);Vt.Factory.addGetterSetter(xt,"anchorStroke","rgb(0, 161, 255)");Vt.Factory.addGetterSetter(xt,"anchorStrokeWidth",1,(0,Vu.getNumberValidator)());Vt.Factory.addGetterSetter(xt,"anchorFill","white");Vt.Factory.addGetterSetter(xt,"anchorCornerRadius",0,(0,Vu.getNumberValidator)());Vt.Factory.addGetterSetter(xt,"borderStroke","rgb(0, 161, 255)");Vt.Factory.addGetterSetter(xt,"borderStrokeWidth",1,(0,Vu.getNumberValidator)());Vt.Factory.addGetterSetter(xt,"borderDash");Vt.Factory.addGetterSetter(xt,"keepRatio",!0);Vt.Factory.addGetterSetter(xt,"shiftBehavior","default");Vt.Factory.addGetterSetter(xt,"centeredScaling",!1);Vt.Factory.addGetterSetter(xt,"ignoreStroke",!1);Vt.Factory.addGetterSetter(xt,"padding",0,(0,Vu.getNumberValidator)());Vt.Factory.addGetterSetter(xt,"nodes");Vt.Factory.addGetterSetter(xt,"node");Vt.Factory.addGetterSetter(xt,"boundBoxFunc");Vt.Factory.addGetterSetter(xt,"anchorDragBoundFunc");Vt.Factory.addGetterSetter(xt,"anchorStyleFunc");Vt.Factory.addGetterSetter(xt,"shouldOverdrawWholeArea",!1);Vt.Factory.addGetterSetter(xt,"useSingleNodeRotation",!0);Vt.Factory.backCompat(xt,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});var _b={};Object.defineProperty(_b,"__esModule",{value:!0});_b.Wedge=void 0;const yb=_t,Xne=or,Zne=ct,HF=Xe,ere=ct;class sl extends Xne.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.radius(),0,Zne.Konva.getAngle(this.angle()),this.clockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}_b.Wedge=sl;sl.prototype.className="Wedge";sl.prototype._centroid=!0;sl.prototype._attrsAffectingSize=["radius"];(0,ere._registerNode)(sl);yb.Factory.addGetterSetter(sl,"radius",0,(0,HF.getNumberValidator)());yb.Factory.addGetterSetter(sl,"angle",0,(0,HF.getNumberValidator)());yb.Factory.addGetterSetter(sl,"clockwise",!1);yb.Factory.backCompat(sl,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});var vb={};Object.defineProperty(vb,"__esModule",{value:!0});vb.Blur=void 0;const B3=_t,tre=fn,nre=Xe;function z3(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const rre=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],sre=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function ire(n,e){const t=n.data,r=n.width,s=n.height;let i,a,o,l,u,h,f,p,y,_,b,S,E,C,v,I,L,R,P,x;const N=e+e+1,M=r-1,D=s-1,F=e+1,$=F*(F+1)/2,H=new z3,G=rre[e],ue=sre[e];let ae=null,z=H,Q=null,ee=null;for(let se=1;se<N;se++)z=z.next=new z3,se===F&&(ae=z);z.next=H,o=a=0;for(let se=0;se<s;se++){S=E=C=v=l=u=h=f=0,p=F*(I=t[a]),y=F*(L=t[a+1]),_=F*(R=t[a+2]),b=F*(P=t[a+3]),l+=$*I,u+=$*L,h+=$*R,f+=$*P,z=H;for(let le=0;le<F;le++)z.r=I,z.g=L,z.b=R,z.a=P,z=z.next;for(let le=1;le<F;le++)i=a+((M<le?M:le)<<2),l+=(z.r=I=t[i])*(x=F-le),u+=(z.g=L=t[i+1])*x,h+=(z.b=R=t[i+2])*x,f+=(z.a=P=t[i+3])*x,S+=I,E+=L,C+=R,v+=P,z=z.next;Q=H,ee=ae;for(let le=0;le<r;le++)t[a+3]=P=f*G>>ue,P!==0?(P=255/P,t[a]=(l*G>>ue)*P,t[a+1]=(u*G>>ue)*P,t[a+2]=(h*G>>ue)*P):t[a]=t[a+1]=t[a+2]=0,l-=p,u-=y,h-=_,f-=b,p-=Q.r,y-=Q.g,_-=Q.b,b-=Q.a,i=o+((i=le+e+1)<M?i:M)<<2,S+=Q.r=t[i],E+=Q.g=t[i+1],C+=Q.b=t[i+2],v+=Q.a=t[i+3],l+=S,u+=E,h+=C,f+=v,Q=Q.next,p+=I=ee.r,y+=L=ee.g,_+=R=ee.b,b+=P=ee.a,S-=I,E-=L,C-=R,v-=P,ee=ee.next,a+=4;o+=r}for(let se=0;se<r;se++){E=C=v=S=u=h=f=l=0,a=se<<2,p=F*(I=t[a]),y=F*(L=t[a+1]),_=F*(R=t[a+2]),b=F*(P=t[a+3]),l+=$*I,u+=$*L,h+=$*R,f+=$*P,z=H;for(let ye=0;ye<F;ye++)z.r=I,z.g=L,z.b=R,z.a=P,z=z.next;let le=r;for(let ye=1;ye<=e;ye++)a=le+se<<2,l+=(z.r=I=t[a])*(x=F-ye),u+=(z.g=L=t[a+1])*x,h+=(z.b=R=t[a+2])*x,f+=(z.a=P=t[a+3])*x,S+=I,E+=L,C+=R,v+=P,z=z.next,ye<D&&(le+=r);a=se,Q=H,ee=ae;for(let ye=0;ye<s;ye++)i=a<<2,t[i+3]=P=f*G>>ue,P>0?(P=255/P,t[i]=(l*G>>ue)*P,t[i+1]=(u*G>>ue)*P,t[i+2]=(h*G>>ue)*P):t[i]=t[i+1]=t[i+2]=0,l-=p,u-=y,h-=_,f-=b,p-=Q.r,y-=Q.g,_-=Q.b,b-=Q.a,i=se+((i=ye+F)<D?i:D)*r<<2,l+=S+=Q.r=t[i],u+=E+=Q.g=t[i+1],h+=C+=Q.b=t[i+2],f+=v+=Q.a=t[i+3],Q=Q.next,p+=I=ee.r,y+=L=ee.g,_+=R=ee.b,b+=P=ee.a,S-=I,E-=L,C-=R,v-=P,ee=ee.next,a+=r}}const are=function(e){const t=Math.round(this.blurRadius());t>0&&ire(e,t)};vb.Blur=are;B3.Factory.addGetterSetter(tre.Node,"blurRadius",0,(0,nre.getNumberValidator)(),B3.Factory.afterSetFilter);var wb={};Object.defineProperty(wb,"__esModule",{value:!0});wb.Brighten=void 0;const G3=_t,ore=fn,lre=Xe,ure=function(n){const e=this.brightness()*255,t=n.data,r=t.length;for(let s=0;s<r;s+=4)t[s]+=e,t[s+1]+=e,t[s+2]+=e};wb.Brighten=ure;G3.Factory.addGetterSetter(ore.Node,"brightness",0,(0,lre.getNumberValidator)(),G3.Factory.afterSetFilter);var bb={};Object.defineProperty(bb,"__esModule",{value:!0});bb.Contrast=void 0;const W3=_t,cre=fn,dre=Xe,hre=function(n){const e=Math.pow((this.contrast()+100)/100,2),t=n.data,r=t.length;let s=150,i=150,a=150;for(let o=0;o<r;o+=4)s=t[o],i=t[o+1],a=t[o+2],s/=255,s-=.5,s*=e,s+=.5,s*=255,i/=255,i-=.5,i*=e,i+=.5,i*=255,a/=255,a-=.5,a*=e,a+=.5,a*=255,s=s<0?0:s>255?255:s,i=i<0?0:i>255?255:i,a=a<0?0:a>255?255:a,t[o]=s,t[o+1]=i,t[o+2]=a};bb.Contrast=hre;W3.Factory.addGetterSetter(cre.Node,"contrast",0,(0,dre.getNumberValidator)(),W3.Factory.afterSetFilter);var Eb={};Object.defineProperty(Eb,"__esModule",{value:!0});Eb.Emboss=void 0;const vu=_t,Sb=fn,fre=En,qF=Xe,pre=function(n){const e=this.embossStrength()*10,t=this.embossWhiteLevel()*255,r=this.embossDirection(),s=this.embossBlend(),i=n.data,a=n.width,o=n.height,l=a*4;let u=0,h=0,f=o;switch(r){case"top-left":u=-1,h=-1;break;case"top":u=-1,h=0;break;case"top-right":u=-1,h=1;break;case"right":u=0,h=1;break;case"bottom-right":u=1,h=1;break;case"bottom":u=1,h=0;break;case"bottom-left":u=1,h=-1;break;case"left":u=0,h=-1;break;default:fre.Util.error("Unknown emboss direction: "+r)}do{const p=(f-1)*l;let y=u;f+y<1&&(y=0),f+y>o&&(y=0);const _=(f-1+y)*a*4;let b=a;do{const S=p+(b-1)*4;let E=h;b+E<1&&(E=0),b+E>a&&(E=0);const C=_+(b-1+E)*4,v=i[S]-i[C],I=i[S+1]-i[C+1],L=i[S+2]-i[C+2];let R=v;const P=R>0?R:-R,x=I>0?I:-I,N=L>0?L:-L;if(x>P&&(R=I),N>P&&(R=L),R*=e,s){const M=i[S]+R,D=i[S+1]+R,F=i[S+2]+R;i[S]=M>255?255:M<0?0:M,i[S+1]=D>255?255:D<0?0:D,i[S+2]=F>255?255:F<0?0:F}else{let M=t-R;M<0?M=0:M>255&&(M=255),i[S]=i[S+1]=i[S+2]=M}}while(--b)}while(--f)};Eb.Emboss=pre;vu.Factory.addGetterSetter(Sb.Node,"embossStrength",.5,(0,qF.getNumberValidator)(),vu.Factory.afterSetFilter);vu.Factory.addGetterSetter(Sb.Node,"embossWhiteLevel",.5,(0,qF.getNumberValidator)(),vu.Factory.afterSetFilter);vu.Factory.addGetterSetter(Sb.Node,"embossDirection","top-left",void 0,vu.Factory.afterSetFilter);vu.Factory.addGetterSetter(Sb.Node,"embossBlend",!1,void 0,vu.Factory.afterSetFilter);var Tb={};Object.defineProperty(Tb,"__esModule",{value:!0});Tb.Enhance=void 0;const H3=_t,mre=fn,gre=Xe;function g2(n,e,t,r,s){const i=t-e,a=s-r;if(i===0)return r+a/2;if(a===0)return r;let o=(n-e)/i;return o=a*o+r,o}const _re=function(n){const e=n.data,t=e.length;let r=e[0],s=r,i,a=e[1],o=a,l,u=e[2],h=u,f;const p=this.enhance();if(p===0)return;for(let v=0;v<t;v+=4)i=e[v+0],i<r?r=i:i>s&&(s=i),l=e[v+1],l<a?a=l:l>o&&(o=l),f=e[v+2],f<u?u=f:f>h&&(h=f);s===r&&(s=255,r=0),o===a&&(o=255,a=0),h===u&&(h=255,u=0);let y,_,b,S,E,C;if(p>0)y=s+p*(255-s),_=r-p*(r-0),b=o+p*(255-o),S=a-p*(a-0),E=h+p*(255-h),C=u-p*(u-0);else{const v=(s+r)*.5;y=s+p*(s-v),_=r+p*(r-v);const I=(o+a)*.5;b=o+p*(o-I),S=a+p*(a-I);const L=(h+u)*.5;E=h+p*(h-L),C=u+p*(u-L)}for(let v=0;v<t;v+=4)e[v+0]=g2(e[v+0],r,s,_,y),e[v+1]=g2(e[v+1],a,o,S,b),e[v+2]=g2(e[v+2],u,h,C,E)};Tb.Enhance=_re;H3.Factory.addGetterSetter(mre.Node,"enhance",0,(0,gre.getNumberValidator)(),H3.Factory.afterSetFilter);var Cb={};Object.defineProperty(Cb,"__esModule",{value:!0});Cb.Grayscale=void 0;const yre=function(n){const e=n.data,t=e.length;for(let r=0;r<t;r+=4){const s=.34*e[r]+.5*e[r+1]+.16*e[r+2];e[r]=s,e[r+1]=s,e[r+2]=s}};Cb.Grayscale=yre;var Ib={};Object.defineProperty(Ib,"__esModule",{value:!0});Ib.HSL=void 0;const sf=_t,UP=fn,VP=Xe;sf.Factory.addGetterSetter(UP.Node,"hue",0,(0,VP.getNumberValidator)(),sf.Factory.afterSetFilter);sf.Factory.addGetterSetter(UP.Node,"saturation",0,(0,VP.getNumberValidator)(),sf.Factory.afterSetFilter);sf.Factory.addGetterSetter(UP.Node,"luminance",0,(0,VP.getNumberValidator)(),sf.Factory.afterSetFilter);const vre=function(n){const e=n.data,t=e.length,r=1,s=Math.pow(2,this.saturation()),i=Math.abs(this.hue()+360)%360,a=this.luminance()*127,o=r*s*Math.cos(i*Math.PI/180),l=r*s*Math.sin(i*Math.PI/180),u=.299*r+.701*o+.167*l,h=.587*r-.587*o+.33*l,f=.114*r-.114*o-.497*l,p=.299*r-.299*o-.328*l,y=.587*r+.413*o+.035*l,_=.114*r-.114*o+.293*l,b=.299*r-.3*o+1.25*l,S=.587*r-.586*o-1.05*l,E=.114*r+.886*o-.2*l;let C,v,I,L;for(let R=0;R<t;R+=4)C=e[R+0],v=e[R+1],I=e[R+2],L=e[R+3],e[R+0]=u*C+h*v+f*I+a,e[R+1]=p*C+y*v+_*I+a,e[R+2]=b*C+S*v+E*I+a,e[R+3]=L};Ib.HSL=vre;var xb={};Object.defineProperty(xb,"__esModule",{value:!0});xb.HSV=void 0;const af=_t,BP=fn,zP=Xe,wre=function(n){const e=n.data,t=e.length,r=Math.pow(2,this.value()),s=Math.pow(2,this.saturation()),i=Math.abs(this.hue()+360)%360,a=r*s*Math.cos(i*Math.PI/180),o=r*s*Math.sin(i*Math.PI/180),l=.299*r+.701*a+.167*o,u=.587*r-.587*a+.33*o,h=.114*r-.114*a-.497*o,f=.299*r-.299*a-.328*o,p=.587*r+.413*a+.035*o,y=.114*r-.114*a+.293*o,_=.299*r-.3*a+1.25*o,b=.587*r-.586*a-1.05*o,S=.114*r+.886*a-.2*o;for(let E=0;E<t;E+=4){const C=e[E+0],v=e[E+1],I=e[E+2],L=e[E+3];e[E+0]=l*C+u*v+h*I,e[E+1]=f*C+p*v+y*I,e[E+2]=_*C+b*v+S*I,e[E+3]=L}};xb.HSV=wre;af.Factory.addGetterSetter(BP.Node,"hue",0,(0,zP.getNumberValidator)(),af.Factory.afterSetFilter);af.Factory.addGetterSetter(BP.Node,"saturation",0,(0,zP.getNumberValidator)(),af.Factory.afterSetFilter);af.Factory.addGetterSetter(BP.Node,"value",0,(0,zP.getNumberValidator)(),af.Factory.afterSetFilter);var kb={};Object.defineProperty(kb,"__esModule",{value:!0});kb.Invert=void 0;const bre=function(n){const e=n.data,t=e.length;for(let r=0;r<t;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2]};kb.Invert=bre;var Pb={};Object.defineProperty(Pb,"__esModule",{value:!0});Pb.Kaleidoscope=void 0;const gw=_t,KF=fn,q3=En,QF=Xe,Ere=function(n,e,t){const r=n.data,s=e.data,i=n.width,a=n.height,o=t.polarCenterX||i/2,l=t.polarCenterY||a/2;let u=Math.sqrt(o*o+l*l),h=i-o,f=a-l;const p=Math.sqrt(h*h+f*f);u=p>u?p:u;const y=a,_=i,b=360/_*Math.PI/180;for(let S=0;S<_;S+=1){const E=Math.sin(S*b),C=Math.cos(S*b);for(let v=0;v<y;v+=1){h=Math.floor(o+u*v/y*C),f=Math.floor(l+u*v/y*E);let I=(f*i+h)*4;const L=r[I+0],R=r[I+1],P=r[I+2],x=r[I+3];I=(S+v*i)*4,s[I+0]=L,s[I+1]=R,s[I+2]=P,s[I+3]=x}}},Sre=function(n,e,t){const r=n.data,s=e.data,i=n.width,a=n.height,o=t.polarCenterX||i/2,l=t.polarCenterY||a/2;let u=Math.sqrt(o*o+l*l),h=i-o,f=a-l;const p=Math.sqrt(h*h+f*f);u=p>u?p:u;const y=a,_=i,b=0;let S,E;for(h=0;h<i;h+=1)for(f=0;f<a;f+=1){const C=h-o,v=f-l,I=Math.sqrt(C*C+v*v)*y/u;let L=(Math.atan2(v,C)*180/Math.PI+360+b)%360;L=L*_/360,S=Math.floor(L),E=Math.floor(I);let R=(E*i+S)*4;const P=r[R+0],x=r[R+1],N=r[R+2],M=r[R+3];R=(f*i+h)*4,s[R+0]=P,s[R+1]=x,s[R+2]=N,s[R+3]=M}},Tre=function(n){const e=n.width,t=n.height;let r,s,i,a,o,l,u,h,f,p,y=Math.round(this.kaleidoscopePower());const _=Math.round(this.kaleidoscopeAngle()),b=Math.floor(e*(_%360)/360);if(y<1)return;const S=q3.Util.createCanvasElement();S.width=e,S.height=t;const E=S.getContext("2d").getImageData(0,0,e,t);q3.Util.releaseCanvas(S),Ere(n,E,{polarCenterX:e/2,polarCenterY:t/2});let C=e/Math.pow(2,y);for(;C<=8;)C=C*2,y-=1;C=Math.ceil(C);let v=C,I=0,L=v,R=1;for(b+C>e&&(I=v,L=0,R=-1),s=0;s<t;s+=1)for(r=I;r!==L;r+=R)i=Math.round(r+b)%e,f=(e*s+i)*4,o=E.data[f+0],l=E.data[f+1],u=E.data[f+2],h=E.data[f+3],p=(e*s+r)*4,E.data[p+0]=o,E.data[p+1]=l,E.data[p+2]=u,E.data[p+3]=h;for(s=0;s<t;s+=1)for(v=Math.floor(C),a=0;a<y;a+=1){for(r=0;r<v+1;r+=1)f=(e*s+r)*4,o=E.data[f+0],l=E.data[f+1],u=E.data[f+2],h=E.data[f+3],p=(e*s+v*2-r-1)*4,E.data[p+0]=o,E.data[p+1]=l,E.data[p+2]=u,E.data[p+3]=h;v*=2}Sre(E,n,{})};Pb.Kaleidoscope=Tre;gw.Factory.addGetterSetter(KF.Node,"kaleidoscopePower",2,(0,QF.getNumberValidator)(),gw.Factory.afterSetFilter);gw.Factory.addGetterSetter(KF.Node,"kaleidoscopeAngle",0,(0,QF.getNumberValidator)(),gw.Factory.afterSetFilter);var Ab={};Object.defineProperty(Ab,"__esModule",{value:!0});Ab.Mask=void 0;const K3=_t,Cre=fn,Ire=Xe;function a0(n,e,t){let r=(t*n.width+e)*4;const s=[];return s.push(n.data[r++],n.data[r++],n.data[r++],n.data[r++]),s}function Wp(n,e){return Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)+Math.pow(n[2]-e[2],2))}function xre(n){const e=[0,0,0];for(let t=0;t<n.length;t++)e[0]+=n[t][0],e[1]+=n[t][1],e[2]+=n[t][2];return e[0]/=n.length,e[1]/=n.length,e[2]/=n.length,e}function kre(n,e){const t=a0(n,0,0),r=a0(n,n.width-1,0),s=a0(n,0,n.height-1),i=a0(n,n.width-1,n.height-1),a=e||10;if(Wp(t,r)<a&&Wp(r,i)<a&&Wp(i,s)<a&&Wp(s,t)<a){const o=xre([r,t,i,s]),l=[];for(let u=0;u<n.width*n.height;u++){const h=Wp(o,[n.data[u*4],n.data[u*4+1],n.data[u*4+2]]);l[u]=h<a?0:255}return l}}function Pre(n,e){for(let t=0;t<n.width*n.height;t++)n.data[4*t+3]=e[t]}function Are(n,e,t){const r=[1,1,1,1,0,1,1,1,1],s=Math.round(Math.sqrt(r.length)),i=Math.floor(s/2),a=[];for(let o=0;o<t;o++)for(let l=0;l<e;l++){const u=o*e+l;let h=0;for(let f=0;f<s;f++)for(let p=0;p<s;p++){const y=o+f-i,_=l+p-i;if(y>=0&&y<t&&_>=0&&_<e){const b=y*e+_,S=r[f*s+p];h+=n[b]*S}}a[u]=h===255*8?255:0}return a}function Rre(n,e,t){const r=[1,1,1,1,1,1,1,1,1],s=Math.round(Math.sqrt(r.length)),i=Math.floor(s/2),a=[];for(let o=0;o<t;o++)for(let l=0;l<e;l++){const u=o*e+l;let h=0;for(let f=0;f<s;f++)for(let p=0;p<s;p++){const y=o+f-i,_=l+p-i;if(y>=0&&y<t&&_>=0&&_<e){const b=y*e+_,S=r[f*s+p];h+=n[b]*S}}a[u]=h>=255*4?255:0}return a}function Nre(n,e,t){const r=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],s=Math.round(Math.sqrt(r.length)),i=Math.floor(s/2),a=[];for(let o=0;o<t;o++)for(let l=0;l<e;l++){const u=o*e+l;let h=0;for(let f=0;f<s;f++)for(let p=0;p<s;p++){const y=o+f-i,_=l+p-i;if(y>=0&&y<t&&_>=0&&_<e){const b=y*e+_,S=r[f*s+p];h+=n[b]*S}}a[u]=h}return a}const Ore=function(n){const e=this.threshold();let t=kre(n,e);return t&&(t=Are(t,n.width,n.height),t=Rre(t,n.width,n.height),t=Nre(t,n.width,n.height),Pre(n,t)),n};Ab.Mask=Ore;K3.Factory.addGetterSetter(Cre.Node,"threshold",0,(0,Ire.getNumberValidator)(),K3.Factory.afterSetFilter);var Rb={};Object.defineProperty(Rb,"__esModule",{value:!0});Rb.Noise=void 0;const Q3=_t,Lre=fn,Mre=Xe,Dre=function(n){const e=this.noise()*255,t=n.data,r=t.length,s=e/2;for(let i=0;i<r;i+=4)t[i+0]+=s-2*s*Math.random(),t[i+1]+=s-2*s*Math.random(),t[i+2]+=s-2*s*Math.random()};Rb.Noise=Dre;Q3.Factory.addGetterSetter(Lre.Node,"noise",.2,(0,Mre.getNumberValidator)(),Q3.Factory.afterSetFilter);var Nb={};Object.defineProperty(Nb,"__esModule",{value:!0});Nb.Pixelate=void 0;const Y3=_t,Fre=En,$re=fn,jre=Xe,Ure=function(n){let e=Math.ceil(this.pixelSize()),t=n.width,r=n.height,s=Math.ceil(t/e),i=Math.ceil(r/e),a=n.data;if(e<=0){Fre.Util.error("pixelSize value can not be <= 0");return}for(let o=0;o<s;o+=1)for(let l=0;l<i;l+=1){let u=0,h=0,f=0,p=0;const y=o*e,_=y+e,b=l*e,S=b+e;let E=0;for(let C=y;C<_;C+=1)if(!(C>=t))for(let v=b;v<S;v+=1){if(v>=r)continue;const I=(t*v+C)*4;u+=a[I+0],h+=a[I+1],f+=a[I+2],p+=a[I+3],E+=1}u=u/E,h=h/E,f=f/E,p=p/E;for(let C=y;C<_;C+=1)if(!(C>=t))for(let v=b;v<S;v+=1){if(v>=r)continue;const I=(t*v+C)*4;a[I+0]=u,a[I+1]=h,a[I+2]=f,a[I+3]=p}}};Nb.Pixelate=Ure;Y3.Factory.addGetterSetter($re.Node,"pixelSize",8,(0,jre.getNumberValidator)(),Y3.Factory.afterSetFilter);var Ob={};Object.defineProperty(Ob,"__esModule",{value:!0});Ob.Posterize=void 0;const J3=_t,Vre=fn,Bre=Xe,zre=function(n){const e=Math.round(this.levels()*254)+1,t=n.data,r=t.length,s=255/e;for(let i=0;i<r;i+=1)t[i]=Math.floor(t[i]/s)*s};Ob.Posterize=zre;J3.Factory.addGetterSetter(Vre.Node,"levels",.5,(0,Bre.getNumberValidator)(),J3.Factory.afterSetFilter);var Lb={};Object.defineProperty(Lb,"__esModule",{value:!0});Lb.RGB=void 0;const _w=_t,GP=fn,Gre=Xe,Wre=function(n){const e=n.data,t=e.length,r=this.red(),s=this.green(),i=this.blue();for(let a=0;a<t;a+=4){const o=(.34*e[a]+.5*e[a+1]+.16*e[a+2])/255;e[a]=o*r,e[a+1]=o*s,e[a+2]=o*i,e[a+3]=e[a+3]}};Lb.RGB=Wre;_w.Factory.addGetterSetter(GP.Node,"red",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});_w.Factory.addGetterSetter(GP.Node,"green",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});_w.Factory.addGetterSetter(GP.Node,"blue",0,Gre.RGBComponent,_w.Factory.afterSetFilter);var Mb={};Object.defineProperty(Mb,"__esModule",{value:!0});Mb.RGBA=void 0;const Og=_t,Db=fn,Hre=Xe,qre=function(n){const e=n.data,t=e.length,r=this.red(),s=this.green(),i=this.blue(),a=this.alpha();for(let o=0;o<t;o+=4){const l=1-a;e[o]=r*a+e[o]*l,e[o+1]=s*a+e[o+1]*l,e[o+2]=i*a+e[o+2]*l}};Mb.RGBA=qre;Og.Factory.addGetterSetter(Db.Node,"red",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});Og.Factory.addGetterSetter(Db.Node,"green",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});Og.Factory.addGetterSetter(Db.Node,"blue",0,Hre.RGBComponent,Og.Factory.afterSetFilter);Og.Factory.addGetterSetter(Db.Node,"alpha",1,function(n){return this._filterUpToDate=!1,n>1?1:n<0?0:n});var Fb={};Object.defineProperty(Fb,"__esModule",{value:!0});Fb.Sepia=void 0;const Kre=function(n){const e=n.data,t=e.length;for(let r=0;r<t;r+=4){const s=e[r+0],i=e[r+1],a=e[r+2];e[r+0]=Math.min(255,s*.393+i*.769+a*.189),e[r+1]=Math.min(255,s*.349+i*.686+a*.168),e[r+2]=Math.min(255,s*.272+i*.534+a*.131)}};Fb.Sepia=Kre;var $b={};Object.defineProperty($b,"__esModule",{value:!0});$b.Solarize=void 0;const Qre=function(n){const e=n.data,t=n.width,r=n.height,s=t*4;let i=r;do{const a=(i-1)*s;let o=t;do{const l=a+(o-1)*4;let u=e[l],h=e[l+1],f=e[l+2];u>127&&(u=255-u),h>127&&(h=255-h),f>127&&(f=255-f),e[l]=u,e[l+1]=h,e[l+2]=f}while(--o)}while(--i)};$b.Solarize=Qre;var jb={};Object.defineProperty(jb,"__esModule",{value:!0});jb.Threshold=void 0;const X3=_t,Yre=fn,Jre=Xe,Xre=function(n){const e=this.threshold()*255,t=n.data,r=t.length;for(let s=0;s<r;s+=1)t[s]=t[s]<e?0:255};jb.Threshold=Xre;X3.Factory.addGetterSetter(Yre.Node,"threshold",.5,(0,Jre.getNumberValidator)(),X3.Factory.afterSetFilter);Object.defineProperty(Q1,"__esModule",{value:!0});Q1.Konva=void 0;const Z3=fw,Zre=eb,ese=rb,tse=ab,nse=ob,rse=lb,e5=rf,sse=b_,ise=Mf,ase=S_,ose=db,lse=hb,use=fb,cse=pb,dse=Ff,hse=mb,fse=gb,pse=_b,mse=vb,gse=wb,_se=bb,yse=Eb,vse=Tb,wse=Cb,bse=Ib,Ese=xb,Sse=kb,Tse=Pb,Cse=Ab,Ise=Rb,xse=Nb,kse=Ob,Pse=Lb,Ase=Mb,Rse=Fb,Nse=$b,Ose=jb;Q1.Konva=Z3.Konva.Util._assign(Z3.Konva,{Arc:Zre.Arc,Arrow:ese.Arrow,Circle:tse.Circle,Ellipse:nse.Ellipse,Image:rse.Image,Label:e5.Label,Tag:e5.Tag,Line:sse.Line,Path:ise.Path,Rect:ase.Rect,RegularPolygon:ose.RegularPolygon,Ring:lse.Ring,Sprite:use.Sprite,Star:cse.Star,Text:dse.Text,TextPath:hse.TextPath,Transformer:fse.Transformer,Wedge:pse.Wedge,Filters:{Blur:mse.Blur,Brighten:gse.Brighten,Contrast:_se.Contrast,Emboss:yse.Emboss,Enhance:vse.Enhance,Grayscale:wse.Grayscale,HSL:bse.HSL,HSV:Ese.HSV,Invert:Sse.Invert,Kaleidoscope:Tse.Kaleidoscope,Mask:Cse.Mask,Noise:Ise.Noise,Pixelate:xse.Pixelate,Posterize:kse.Posterize,RGB:Pse.RGB,RGBA:Ase.RGBA,Sepia:Rse.Sepia,Solarize:Nse.Solarize,Threshold:Ose.Threshold}});var Lse=mF.exports;Object.defineProperty(Lse,"__esModule",{value:!0});const Mse=Q1;mF.exports=Mse.Konva;var ZC={exports:{}};(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;var t=fw;Object.defineProperty(e,"Konva",{enumerable:!0,get:function(){return t.Konva}});const r=fw;n.exports=r.Konva})(ZC,ZC.exports);var Dse=ZC.exports;const Lg=Jc(Dse);var YF={exports:{}};/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fse=function(e){var t={},r=Y,s=gm,i=Object.assign;function a(c){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+c,g=1;g<arguments.length;g++)d+="&args[]="+encodeURIComponent(arguments[g]);return"Minified React error #"+c+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),u=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),f=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),y=Symbol.for("react.provider"),_=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),I=Symbol.for("react.offscreen"),L=Symbol.iterator;function R(c){return c===null||typeof c!="object"?null:(c=L&&c[L]||c["@@iterator"],typeof c=="function"?c:null)}function P(c){if(c==null)return null;if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case h:return"Fragment";case u:return"Portal";case p:return"Profiler";case f:return"StrictMode";case S:return"Suspense";case E:return"SuspenseList"}if(typeof c=="object")switch(c.$$typeof){case _:return(c.displayName||"Context")+".Consumer";case y:return(c._context.displayName||"Context")+".Provider";case b:var d=c.render;return c=c.displayName,c||(c=d.displayName||d.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case C:return d=c.displayName||null,d!==null?d:P(c.type)||"Memo";case v:d=c._payload,c=c._init;try{return P(c(d))}catch{}}return null}function x(c){var d=c.type;switch(c.tag){case 24:return"Cache";case 9:return(d.displayName||"Context")+".Consumer";case 10:return(d._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return c=d.render,c=c.displayName||c.name||"",d.displayName||(c!==""?"ForwardRef("+c+")":"ForwardRef");case 7:return"Fragment";case 5:return d;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return P(d);case 8:return d===f?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d}return null}function N(c){var d=c,g=c;if(c.alternate)for(;d.return;)d=d.return;else{c=d;do d=c,d.flags&4098&&(g=d.return),c=d.return;while(c)}return d.tag===3?g:null}function M(c){if(N(c)!==c)throw Error(a(188))}function D(c){var d=c.alternate;if(!d){if(d=N(c),d===null)throw Error(a(188));return d!==c?null:c}for(var g=c,w=d;;){var T=g.return;if(T===null)break;var A=T.alternate;if(A===null){if(w=T.return,w!==null){g=w;continue}break}if(T.child===A.child){for(A=T.child;A;){if(A===g)return M(T),c;if(A===w)return M(T),d;A=A.sibling}throw Error(a(188))}if(g.return!==w.return)g=T,w=A;else{for(var U=!1,W=T.child;W;){if(W===g){U=!0,g=T,w=A;break}if(W===w){U=!0,w=T,g=A;break}W=W.sibling}if(!U){for(W=A.child;W;){if(W===g){U=!0,g=A,w=T;break}if(W===w){U=!0,w=A,g=T;break}W=W.sibling}if(!U)throw Error(a(189))}}if(g.alternate!==w)throw Error(a(190))}if(g.tag!==3)throw Error(a(188));return g.stateNode.current===g?c:d}function F(c){return c=D(c),c!==null?$(c):null}function $(c){if(c.tag===5||c.tag===6)return c;for(c=c.child;c!==null;){var d=$(c);if(d!==null)return d;c=c.sibling}return null}function H(c){if(c.tag===5||c.tag===6)return c;for(c=c.child;c!==null;){if(c.tag!==4){var d=H(c);if(d!==null)return d}c=c.sibling}return null}var G=Array.isArray,ue=e.getPublicInstance,ae=e.getRootHostContext,z=e.getChildHostContext,Q=e.prepareForCommit,ee=e.resetAfterCommit,se=e.createInstance,le=e.appendInitialChild,ye=e.finalizeInitialChildren,ve=e.prepareUpdate,de=e.shouldSetTextContent,Me=e.createTextInstance,B=e.scheduleTimeout,Z=e.cancelTimeout,be=e.noTimeout,Ce=e.isPrimaryRenderer,Le=e.supportsMutation,et=e.supportsPersistence,ht=e.supportsHydration,cn=e.getInstanceFromNode,ot=e.preparePortalMount,Gn=e.getCurrentEventPriority,Wn=e.detachDeletedInstance,Ir=e.supportsMicrotasks,Is=e.scheduleMicrotask,we=e.supportsTestSelectors,xs=e.findFiberRoot,Ge=e.getBoundingRect,Pe=e.getTextContent,$e=e.isHiddenSubtree,Se=e.matchAccessibilityRole,fe=e.setFocusIfFocusable,Ne=e.setupIntersectionObserver,Be=e.appendChild,Hn=e.appendChildToContainer,zu=e.commitTextUpdate,_d=e.commitMount,Gu=e.commitUpdate,L_=e.insertBefore,M_=e.insertInContainerBefore,Yf=e.removeChild,yE=e.removeChildFromContainer,D_=e.resetTextContent,Jf=e.hideInstance,F_=e.hideTextInstance,$_=e.unhideInstance,Wu=e.unhideTextInstance,Xf=e.clearContainer,Zf=e.cloneInstance,_a=e.createContainerChildSet,ep=e.appendChildToContainerChildSet,yd=e.finalizeContainerChildren,vd=e.replaceContainerChildren,il=e.cloneHiddenInstance,tp=e.cloneHiddenTextInstance,xr=e.canHydrateInstance,j_=e.canHydrateTextInstance,Hu=e.canHydrateSuspenseInstance,al=e.isSuspenseInstancePending,np=e.isSuspenseInstanceFallback,vE=e.getSuspenseInstanceFallbackErrorDetails,ol=e.registerSuspenseInstanceRetry,wd=e.getNextHydratableSibling,wE=e.getFirstHydratableChild,bd=e.getFirstHydratableChildWithinContainer,U_=e.getFirstHydratableChildWithinSuspenseInstance,rp=e.hydrateInstance,Ed=e.hydrateTextInstance,ya=e.hydrateSuspenseInstance,V_=e.getNextHydratableInstanceAfterSuspenseInstance,B_=e.commitHydratedContainer,sp=e.commitHydratedSuspenseInstance,ip=e.clearSuspenseBoundary,z_=e.clearSuspenseBoundaryFromContainer,G_=e.shouldDeleteUnhydratedTailInstances,bE=e.didNotMatchHydratedContainerTextInstance,Sd=e.didNotMatchHydratedTextInstance,Td;function so(c){if(Td===void 0)try{throw Error()}catch(g){var d=g.stack.trim().match(/\n( *(at )?)/);Td=d&&d[1]||""}return`
`+Td+c}var io=!1;function Li(c,d){if(!c||io)return"";io=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(pe){var w=pe}Reflect.construct(c,[],d)}else{try{d.call()}catch(pe){w=pe}c.call(d.prototype)}else{try{throw Error()}catch(pe){w=pe}c()}}catch(pe){if(pe&&w&&typeof pe.stack=="string"){for(var T=pe.stack.split(`
`),A=w.stack.split(`
`),U=T.length-1,W=A.length-1;1<=U&&0<=W&&T[U]!==A[W];)W--;for(;1<=U&&0<=W;U--,W--)if(T[U]!==A[W]){if(U!==1||W!==1)do if(U--,W--,0>W||T[U]!==A[W]){var te=`
`+T[U].replace(" at new "," at ");return c.displayName&&te.includes("<anonymous>")&&(te=te.replace("<anonymous>",c.displayName)),te}while(1<=U&&0<=W);break}}}finally{io=!1,Error.prepareStackTrace=g}return(c=c?c.displayName||c.name:"")?so(c):""}var ap=Object.prototype.hasOwnProperty,op=[],ao=-1;function Mi(c){return{current:c}}function Qt(c){0>ao||(c.current=op[ao],op[ao]=null,ao--)}function Bt(c,d){ao++,op[ao]=c.current,c.current=d}var hi={},qn=Mi(hi),kr=Mi(!1),oo=hi;function ll(c,d){var g=c.type.contextTypes;if(!g)return hi;var w=c.stateNode;if(w&&w.__reactInternalMemoizedUnmaskedChildContext===d)return w.__reactInternalMemoizedMaskedChildContext;var T={},A;for(A in g)T[A]=d[A];return w&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=d,c.__reactInternalMemoizedMaskedChildContext=T),T}function Pr(c){return c=c.childContextTypes,c!=null}function qu(){Qt(kr),Qt(qn)}function W_(c,d,g){if(qn.current!==hi)throw Error(a(168));Bt(qn,d),Bt(kr,g)}function va(c,d,g){var w=c.stateNode;if(d=d.childContextTypes,typeof w.getChildContext!="function")return g;w=w.getChildContext();for(var T in w)if(!(T in d))throw Error(a(108,x(c)||"Unknown",T));return i({},g,w)}function ks(c){return c=(c=c.stateNode)&&c.__reactInternalMemoizedMergedChildContext||hi,oo=qn.current,Bt(qn,c),Bt(kr,kr.current),!0}function Ku(c,d,g){var w=c.stateNode;if(!w)throw Error(a(169));g?(c=va(c,d,oo),w.__reactInternalMemoizedMergedChildContext=c,Qt(kr),Qt(qn),Bt(qn,c)):Qt(kr),Bt(kr,g)}var Gr=Math.clz32?Math.clz32:Cd,H_=Math.log,Zt=Math.LN2;function Cd(c){return c>>>=0,c===0?32:31-(H_(c)/Zt|0)|0}var wa=64,ba=4194304;function Qu(c){switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return c&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return c}}function Yu(c,d){var g=c.pendingLanes;if(g===0)return 0;var w=0,T=c.suspendedLanes,A=c.pingedLanes,U=g&268435455;if(U!==0){var W=U&~T;W!==0?w=Qu(W):(A&=U,A!==0&&(w=Qu(A)))}else U=g&~T,U!==0?w=Qu(U):A!==0&&(w=Qu(A));if(w===0)return 0;if(d!==0&&d!==w&&!(d&T)&&(T=w&-w,A=d&-d,T>=A||T===16&&(A&4194240)!==0))return d;if(w&4&&(w|=g&16),d=c.entangledLanes,d!==0)for(c=c.entanglements,d&=w;0<d;)g=31-Gr(d),T=1<<g,w|=c[g],d&=~T;return w}function EE(c,d){switch(c){case 1:case 2:case 4:return d+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function SE(c,d){for(var g=c.suspendedLanes,w=c.pingedLanes,T=c.expirationTimes,A=c.pendingLanes;0<A;){var U=31-Gr(A),W=1<<U,te=T[U];te===-1?(!(W&g)||W&w)&&(T[U]=EE(W,d)):te<=d&&(c.expiredLanes|=W),A&=~W}}function lp(c){return c=c.pendingLanes&-1073741825,c!==0?c:c&1073741824?1073741824:0}function q_(){var c=wa;return wa<<=1,!(wa&4194240)&&(wa=64),c}function lo(c){for(var d=[],g=0;31>g;g++)d.push(c);return d}function Ps(c,d,g){c.pendingLanes|=d,d!==536870912&&(c.suspendedLanes=0,c.pingedLanes=0),c=c.eventTimes,d=31-Gr(d),c[d]=g}function K_(c,d){var g=c.pendingLanes&~d;c.pendingLanes=d,c.suspendedLanes=0,c.pingedLanes=0,c.expiredLanes&=d,c.mutableReadLanes&=d,c.entangledLanes&=d,d=c.entanglements;var w=c.eventTimes;for(c=c.expirationTimes;0<g;){var T=31-Gr(g),A=1<<T;d[T]=0,w[T]=-1,c[T]=-1,g&=~A}}function Id(c,d){var g=c.entangledLanes|=d;for(c=c.entanglements;g;){var w=31-Gr(g),T=1<<w;T&d|c[w]&d&&(c[w]|=d),g&=~T}}var Tt=0;function uo(c){return c&=-c,1<c?4<c?c&268435455?16:536870912:4:1}var up=s.unstable_scheduleCallback,Q_=s.unstable_cancelCallback,TE=s.unstable_shouldYield,Ea=s.unstable_requestPaint,Ln=s.unstable_now,cp=s.unstable_ImmediatePriority,xd=s.unstable_UserBlockingPriority,ul=s.unstable_NormalPriority,Y_=s.unstable_IdlePriority,Sa=null,Wr=null;function J_(c){if(Wr&&typeof Wr.onCommitFiberRoot=="function")try{Wr.onCommitFiberRoot(Sa,c,void 0,(c.current.flags&128)===128)}catch{}}function dp(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var kt=typeof Object.is=="function"?Object.is:dp,Di=null,kd=!1,Pd=!1;function hp(c){Di===null?Di=[c]:Di.push(c)}function X_(c){kd=!0,hp(c)}function us(){if(!Pd&&Di!==null){Pd=!0;var c=0,d=Tt;try{var g=Di;for(Tt=1;c<g.length;c++){var w=g[c];do w=w(!0);while(w!==null)}Di=null,kd=!1}catch(T){throw Di!==null&&(Di=Di.slice(c+1)),up(cp,us),T}finally{Tt=d,Pd=!1}}return null}var co=[],Hr=0,Ju=null,Ad=0,ur=[],cs=0,Fi=null,As=1,fi="";function pi(c,d){co[Hr++]=Ad,co[Hr++]=Ju,Ju=c,Ad=d}function Z_(c,d,g){ur[cs++]=As,ur[cs++]=fi,ur[cs++]=Fi,Fi=c;var w=As;c=fi;var T=32-Gr(w)-1;w&=~(1<<T),g+=1;var A=32-Gr(d)+T;if(30<A){var U=T-T%5;A=(w&(1<<U)-1).toString(32),w>>=U,T-=U,As=1<<32-Gr(d)+T|g<<T|w,fi=A+c}else As=1<<A|g<<T|w,fi=c}function Rd(c){c.return!==null&&(pi(c,1),Z_(c,1,0))}function ho(c){for(;c===Ju;)Ju=co[--Hr],co[Hr]=null,Ad=co[--Hr],co[Hr]=null;for(;c===Fi;)Fi=ur[--cs],ur[cs]=null,fi=ur[--cs],ur[cs]=null,As=ur[--cs],ur[cs]=null}var qr=null,ds=null,Yt=!1,fo=!1,Rs=null;function Xu(c,d){var g=vi(5,null,null,0);g.elementType="DELETED",g.stateNode=d,g.return=c,d=c.deletions,d===null?(c.deletions=[g],c.flags|=16):d.push(g)}function fp(c,d){switch(c.tag){case 5:return d=xr(d,c.type,c.pendingProps),d!==null?(c.stateNode=d,qr=c,ds=wE(d),!0):!1;case 6:return d=j_(d,c.pendingProps),d!==null?(c.stateNode=d,qr=c,ds=null,!0):!1;case 13:if(d=Hu(d),d!==null){var g=Fi!==null?{id:As,overflow:fi}:null;return c.memoizedState={dehydrated:d,treeContext:g,retryLane:1073741824},g=vi(18,null,null,0),g.stateNode=d,g.return=c,c.child=g,qr=c,ds=null,!0}return!1;default:return!1}}function Nd(c){return(c.mode&1)!==0&&(c.flags&128)===0}function $i(c){if(Yt){var d=ds;if(d){var g=d;if(!fp(c,d)){if(Nd(c))throw Error(a(418));d=wd(g);var w=qr;d&&fp(c,d)?Xu(w,g):(c.flags=c.flags&-4097|2,Yt=!1,qr=c)}}else{if(Nd(c))throw Error(a(418));c.flags=c.flags&-4097|2,Yt=!1,qr=c}}}function pp(c){for(c=c.return;c!==null&&c.tag!==5&&c.tag!==3&&c.tag!==13;)c=c.return;qr=c}function Zu(c){if(!ht||c!==qr)return!1;if(!Yt)return pp(c),Yt=!0,!1;if(c.tag!==3&&(c.tag!==5||G_(c.type)&&!de(c.type,c.memoizedProps))){var d=ds;if(d){if(Nd(c))throw mp(),Error(a(418));for(;d;)Xu(c,d),d=wd(d)}}if(pp(c),c.tag===13){if(!ht)throw Error(a(316));if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(a(317));ds=V_(c)}else ds=qr?wd(c.stateNode):null;return!0}function mp(){for(var c=ds;c;)c=wd(c)}function po(){ht&&(ds=qr=null,fo=Yt=!1)}function cl(c){Rs===null?Rs=[c]:Rs.push(c)}var hs=o.ReactCurrentBatchConfig;function ec(c,d){if(kt(c,d))return!0;if(typeof c!="object"||c===null||typeof d!="object"||d===null)return!1;var g=Object.keys(c),w=Object.keys(d);if(g.length!==w.length)return!1;for(w=0;w<g.length;w++){var T=g[w];if(!ap.call(d,T)||!kt(c[T],d[T]))return!1}return!0}function ey(c){switch(c.tag){case 5:return so(c.type);case 16:return so("Lazy");case 13:return so("Suspense");case 19:return so("SuspenseList");case 0:case 2:case 15:return c=Li(c.type,!1),c;case 11:return c=Li(c.type.render,!1),c;case 1:return c=Li(c.type,!0),c;default:return""}}function mi(c,d,g){if(c=g.ref,c!==null&&typeof c!="function"&&typeof c!="object"){if(g._owner){if(g=g._owner,g){if(g.tag!==1)throw Error(a(309));var w=g.stateNode}if(!w)throw Error(a(147,c));var T=w,A=""+c;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===A?d.ref:(d=function(U){var W=T.refs;U===null?delete W[A]:W[A]=U},d._stringRef=A,d)}if(typeof c!="string")throw Error(a(284));if(!g._owner)throw Error(a(290,c))}return c}function m(c,d){throw c=Object.prototype.toString.call(d),Error(a(31,c==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":c))}function k(c){var d=c._init;return d(c._payload)}function O(c){function d(X,q){if(c){var re=X.deletions;re===null?(X.deletions=[q],X.flags|=16):re.push(q)}}function g(X,q){if(!c)return null;for(;q!==null;)d(X,q),q=q.sibling;return null}function w(X,q){for(X=new Map;q!==null;)q.key!==null?X.set(q.key,q):X.set(q.index,q),q=q.sibling;return X}function T(X,q){return X=_l(X,q),X.index=0,X.sibling=null,X}function A(X,q,re){return X.index=re,c?(re=X.alternate,re!==null?(re=re.index,re<q?(X.flags|=2,q):re):(X.flags|=2,q)):(X.flags|=1048576,q)}function U(X){return c&&X.alternate===null&&(X.flags|=2),X}function W(X,q,re,xe){return q===null||q.tag!==6?(q=mS(re,X.mode,xe),q.return=X,q):(q=T(q,re),q.return=X,q)}function te(X,q,re,xe){var We=re.type;return We===h?Oe(X,q,re.props.children,xe,re.key):q!==null&&(q.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===v&&k(We)===q.type)?(xe=T(q,re.props),xe.ref=mi(X,q,re),xe.return=X,xe):(xe=Py(re.type,re.key,re.props,null,X.mode,xe),xe.ref=mi(X,q,re),xe.return=X,xe)}function pe(X,q,re,xe){return q===null||q.tag!==4||q.stateNode.containerInfo!==re.containerInfo||q.stateNode.implementation!==re.implementation?(q=gS(re,X.mode,xe),q.return=X,q):(q=T(q,re.children||[]),q.return=X,q)}function Oe(X,q,re,xe,We){return q===null||q.tag!==7?(q=ac(re,X.mode,xe,We),q.return=X,q):(q=T(q,re),q.return=X,q)}function st(X,q,re){if(typeof q=="string"&&q!==""||typeof q=="number")return q=mS(""+q,X.mode,re),q.return=X,q;if(typeof q=="object"&&q!==null){switch(q.$$typeof){case l:return re=Py(q.type,q.key,q.props,null,X.mode,re),re.ref=mi(X,null,q),re.return=X,re;case u:return q=gS(q,X.mode,re),q.return=X,q;case v:var xe=q._init;return st(X,xe(q._payload),re)}if(G(q)||R(q))return q=ac(q,X.mode,re,null),q.return=X,q;m(X,q)}return null}function Ie(X,q,re,xe){var We=q!==null?q.key:null;if(typeof re=="string"&&re!==""||typeof re=="number")return We!==null?null:W(X,q,""+re,xe);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case l:return re.key===We?te(X,q,re,xe):null;case u:return re.key===We?pe(X,q,re,xe):null;case v:return We=re._init,Ie(X,q,We(re._payload),xe)}if(G(re)||R(re))return We!==null?null:Oe(X,q,re,xe,null);m(X,re)}return null}function on(X,q,re,xe,We){if(typeof xe=="string"&&xe!==""||typeof xe=="number")return X=X.get(re)||null,W(q,X,""+xe,We);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case l:return X=X.get(xe.key===null?re:xe.key)||null,te(q,X,xe,We);case u:return X=X.get(xe.key===null?re:xe.key)||null,pe(q,X,xe,We);case v:var lt=xe._init;return on(X,q,re,lt(xe._payload),We)}if(G(xe)||R(xe))return X=X.get(re)||null,Oe(q,X,xe,We,null);m(q,xe)}return null}function en(X,q,re,xe){for(var We=null,lt=null,it=q,Lt=q=0,fr=null;it!==null&&Lt<re.length;Lt++){it.index>Lt?(fr=it,it=null):fr=it.sibling;var Mt=Ie(X,it,re[Lt],xe);if(Mt===null){it===null&&(it=fr);break}c&&it&&Mt.alternate===null&&d(X,it),q=A(Mt,q,Lt),lt===null?We=Mt:lt.sibling=Mt,lt=Mt,it=fr}if(Lt===re.length)return g(X,it),Yt&&pi(X,Lt),We;if(it===null){for(;Lt<re.length;Lt++)it=st(X,re[Lt],xe),it!==null&&(q=A(it,q,Lt),lt===null?We=it:lt.sibling=it,lt=it);return Yt&&pi(X,Lt),We}for(it=w(X,it);Lt<re.length;Lt++)fr=on(it,X,Lt,re[Lt],xe),fr!==null&&(c&&fr.alternate!==null&&it.delete(fr.key===null?Lt:fr.key),q=A(fr,q,Lt),lt===null?We=fr:lt.sibling=fr,lt=fr);return c&&it.forEach(function(yl){return d(X,yl)}),Yt&&pi(X,Lt),We}function Ms(X,q,re,xe){var We=R(re);if(typeof We!="function")throw Error(a(150));if(re=We.call(re),re==null)throw Error(a(151));for(var lt=We=null,it=q,Lt=q=0,fr=null,Mt=re.next();it!==null&&!Mt.done;Lt++,Mt=re.next()){it.index>Lt?(fr=it,it=null):fr=it.sibling;var yl=Ie(X,it,Mt.value,xe);if(yl===null){it===null&&(it=fr);break}c&&it&&yl.alternate===null&&d(X,it),q=A(yl,q,Lt),lt===null?We=yl:lt.sibling=yl,lt=yl,it=fr}if(Mt.done)return g(X,it),Yt&&pi(X,Lt),We;if(it===null){for(;!Mt.done;Lt++,Mt=re.next())Mt=st(X,Mt.value,xe),Mt!==null&&(q=A(Mt,q,Lt),lt===null?We=Mt:lt.sibling=Mt,lt=Mt);return Yt&&pi(X,Lt),We}for(it=w(X,it);!Mt.done;Lt++,Mt=re.next())Mt=on(it,X,Lt,Mt.value,xe),Mt!==null&&(c&&Mt.alternate!==null&&it.delete(Mt.key===null?Lt:Mt.key),q=A(Mt,q,Lt),lt===null?We=Mt:lt.sibling=Mt,lt=Mt);return c&&it.forEach(function(YV){return d(X,YV)}),Yt&&pi(X,Lt),We}function yo(X,q,re,xe){if(typeof re=="object"&&re!==null&&re.type===h&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case l:e:{for(var We=re.key,lt=q;lt!==null;){if(lt.key===We){if(We=re.type,We===h){if(lt.tag===7){g(X,lt.sibling),q=T(lt,re.props.children),q.return=X,X=q;break e}}else if(lt.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===v&&k(We)===lt.type){g(X,lt.sibling),q=T(lt,re.props),q.ref=mi(X,lt,re),q.return=X,X=q;break e}g(X,lt);break}else d(X,lt);lt=lt.sibling}re.type===h?(q=ac(re.props.children,X.mode,xe,re.key),q.return=X,X=q):(xe=Py(re.type,re.key,re.props,null,X.mode,xe),xe.ref=mi(X,q,re),xe.return=X,X=xe)}return U(X);case u:e:{for(lt=re.key;q!==null;){if(q.key===lt)if(q.tag===4&&q.stateNode.containerInfo===re.containerInfo&&q.stateNode.implementation===re.implementation){g(X,q.sibling),q=T(q,re.children||[]),q.return=X,X=q;break e}else{g(X,q);break}else d(X,q);q=q.sibling}q=gS(re,X.mode,xe),q.return=X,X=q}return U(X);case v:return lt=re._init,yo(X,q,lt(re._payload),xe)}if(G(re))return en(X,q,re,xe);if(R(re))return Ms(X,q,re,xe);m(X,re)}return typeof re=="string"&&re!==""||typeof re=="number"?(re=""+re,q!==null&&q.tag===6?(g(X,q.sibling),q=T(q,re),q.return=X,X=q):(g(X,q),q=mS(re,X.mode,xe),q.return=X,X=q),U(X)):g(X,q)}return yo}var j=O(!0),K=O(!1),ne=Mi(null),ge=null,Pt=null,xn=null;function wt(){xn=Pt=ge=null}function Kn(c,d,g){Ce?(Bt(ne,d._currentValue),d._currentValue=g):(Bt(ne,d._currentValue2),d._currentValue2=g)}function Mn(c){var d=ne.current;Qt(ne),Ce?c._currentValue=d:c._currentValue2=d}function Ta(c,d,g){for(;c!==null;){var w=c.alternate;if((c.childLanes&d)!==d?(c.childLanes|=d,w!==null&&(w.childLanes|=d)):w!==null&&(w.childLanes&d)!==d&&(w.childLanes|=d),c===g)break;c=c.return}}function cr(c,d){ge=c,xn=Pt=null,c=c.dependencies,c!==null&&c.firstContext!==null&&(c.lanes&d&&(Ns=!0),c.firstContext=null)}function Ar(c){var d=Ce?c._currentValue:c._currentValue2;if(xn!==c)if(c={context:c,memoizedValue:d,next:null},Pt===null){if(ge===null)throw Error(a(308));Pt=c,ge.dependencies={lanes:0,firstContext:c}}else Pt=Pt.next=c;return d}var ji=null;function CE(c){ji===null?ji=[c]:ji.push(c)}function YA(c,d,g,w){var T=d.interleaved;return T===null?(g.next=g,CE(d)):(g.next=T.next,T.next=g),d.interleaved=g,Ca(c,w)}function Ca(c,d){c.lanes|=d;var g=c.alternate;for(g!==null&&(g.lanes|=d),g=c,c=c.return;c!==null;)c.childLanes|=d,g=c.alternate,g!==null&&(g.childLanes|=d),g=c,c=c.return;return g.tag===3?g.stateNode:null}var dl=!1;function IE(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function JA(c,d){c=c.updateQueue,d.updateQueue===c&&(d.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,effects:c.effects})}function mo(c,d){return{eventTime:c,lane:d,tag:0,payload:null,callback:null,next:null}}function hl(c,d,g){var w=c.updateQueue;if(w===null)return null;if(w=w.shared,ft&2){var T=w.pending;return T===null?d.next=d:(d.next=T.next,T.next=d),w.pending=d,Ca(c,g)}return T=w.interleaved,T===null?(d.next=d,CE(w)):(d.next=T.next,T.next=d),w.interleaved=d,Ca(c,g)}function ty(c,d,g){if(d=d.updateQueue,d!==null&&(d=d.shared,(g&4194240)!==0)){var w=d.lanes;w&=c.pendingLanes,g|=w,d.lanes=g,Id(c,g)}}function XA(c,d){var g=c.updateQueue,w=c.alternate;if(w!==null&&(w=w.updateQueue,g===w)){var T=null,A=null;if(g=g.firstBaseUpdate,g!==null){do{var U={eventTime:g.eventTime,lane:g.lane,tag:g.tag,payload:g.payload,callback:g.callback,next:null};A===null?T=A=U:A=A.next=U,g=g.next}while(g!==null);A===null?T=A=d:A=A.next=d}else T=A=d;g={baseState:w.baseState,firstBaseUpdate:T,lastBaseUpdate:A,shared:w.shared,effects:w.effects},c.updateQueue=g;return}c=g.lastBaseUpdate,c===null?g.firstBaseUpdate=d:c.next=d,g.lastBaseUpdate=d}function ny(c,d,g,w){var T=c.updateQueue;dl=!1;var A=T.firstBaseUpdate,U=T.lastBaseUpdate,W=T.shared.pending;if(W!==null){T.shared.pending=null;var te=W,pe=te.next;te.next=null,U===null?A=pe:U.next=pe,U=te;var Oe=c.alternate;Oe!==null&&(Oe=Oe.updateQueue,W=Oe.lastBaseUpdate,W!==U&&(W===null?Oe.firstBaseUpdate=pe:W.next=pe,Oe.lastBaseUpdate=te))}if(A!==null){var st=T.baseState;U=0,Oe=pe=te=null,W=A;do{var Ie=W.lane,on=W.eventTime;if((w&Ie)===Ie){Oe!==null&&(Oe=Oe.next={eventTime:on,lane:0,tag:W.tag,payload:W.payload,callback:W.callback,next:null});e:{var en=c,Ms=W;switch(Ie=d,on=g,Ms.tag){case 1:if(en=Ms.payload,typeof en=="function"){st=en.call(on,st,Ie);break e}st=en;break e;case 3:en.flags=en.flags&-65537|128;case 0:if(en=Ms.payload,Ie=typeof en=="function"?en.call(on,st,Ie):en,Ie==null)break e;st=i({},st,Ie);break e;case 2:dl=!0}}W.callback!==null&&W.lane!==0&&(c.flags|=64,Ie=T.effects,Ie===null?T.effects=[W]:Ie.push(W))}else on={eventTime:on,lane:Ie,tag:W.tag,payload:W.payload,callback:W.callback,next:null},Oe===null?(pe=Oe=on,te=st):Oe=Oe.next=on,U|=Ie;if(W=W.next,W===null){if(W=T.shared.pending,W===null)break;Ie=W,W=Ie.next,Ie.next=null,T.lastBaseUpdate=Ie,T.shared.pending=null}}while(!0);if(Oe===null&&(te=st),T.baseState=te,T.firstBaseUpdate=pe,T.lastBaseUpdate=Oe,d=T.shared.interleaved,d!==null){T=d;do U|=T.lane,T=T.next;while(T!==d)}else A===null&&(T.shared.lanes=0);nc|=U,c.lanes=U,c.memoizedState=st}}function ZA(c,d,g){if(c=d.effects,d.effects=null,c!==null)for(d=0;d<c.length;d++){var w=c[d],T=w.callback;if(T!==null){if(w.callback=null,w=g,typeof T!="function")throw Error(a(191,T));T.call(w)}}}var gp={},gi=Mi(gp),_p=Mi(gp),Od=Mi(gp);function Ia(c){if(c===gp)throw Error(a(174));return c}function xE(c,d){Bt(Od,d),Bt(_p,c),Bt(gi,gp),c=ae(d),Qt(gi),Bt(gi,c)}function Ld(){Qt(gi),Qt(_p),Qt(Od)}function eR(c){var d=Ia(Od.current),g=Ia(gi.current);d=z(g,c.type,d),g!==d&&(Bt(_p,c),Bt(gi,d))}function kE(c){_p.current===c&&(Qt(gi),Qt(_p))}var pn=Mi(0);function ry(c){for(var d=c;d!==null;){if(d.tag===13){var g=d.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||al(g)||np(g)))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if(d.flags&128)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===c)break;for(;d.sibling===null;){if(d.return===null||d.return===c)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var PE=[];function AE(){for(var c=0;c<PE.length;c++){var d=PE[c];Ce?d._workInProgressVersionPrimary=null:d._workInProgressVersionSecondary=null}PE.length=0}var sy=o.ReactCurrentDispatcher,RE=o.ReactCurrentBatchConfig,tc=0,mn=null,Qn=null,dr=null,iy=!1,yp=!1,vp=0,bV=0;function Kr(){throw Error(a(321))}function NE(c,d){if(d===null)return!1;for(var g=0;g<d.length&&g<c.length;g++)if(!kt(c[g],d[g]))return!1;return!0}function OE(c,d,g,w,T,A){if(tc=A,mn=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,sy.current=c===null||c.memoizedState===null?CV:IV,c=g(w,T),yp){A=0;do{if(yp=!1,vp=0,25<=A)throw Error(a(301));A+=1,dr=Qn=null,d.updateQueue=null,sy.current=xV,c=g(w,T)}while(yp)}if(sy.current=ly,d=Qn!==null&&Qn.next!==null,tc=0,dr=Qn=mn=null,iy=!1,d)throw Error(a(300));return c}function LE(){var c=vp!==0;return vp=0,c}function xa(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dr===null?mn.memoizedState=dr=c:dr=dr.next=c,dr}function _i(){if(Qn===null){var c=mn.alternate;c=c!==null?c.memoizedState:null}else c=Qn.next;var d=dr===null?mn.memoizedState:dr.next;if(d!==null)dr=d,Qn=c;else{if(c===null)throw Error(a(310));Qn=c,c={memoizedState:Qn.memoizedState,baseState:Qn.baseState,baseQueue:Qn.baseQueue,queue:Qn.queue,next:null},dr===null?mn.memoizedState=dr=c:dr=dr.next=c}return dr}function wp(c,d){return typeof d=="function"?d(c):d}function ME(c){var d=_i(),g=d.queue;if(g===null)throw Error(a(311));g.lastRenderedReducer=c;var w=Qn,T=w.baseQueue,A=g.pending;if(A!==null){if(T!==null){var U=T.next;T.next=A.next,A.next=U}w.baseQueue=T=A,g.pending=null}if(T!==null){A=T.next,w=w.baseState;var W=U=null,te=null,pe=A;do{var Oe=pe.lane;if((tc&Oe)===Oe)te!==null&&(te=te.next={lane:0,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null}),w=pe.hasEagerState?pe.eagerState:c(w,pe.action);else{var st={lane:Oe,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null};te===null?(W=te=st,U=w):te=te.next=st,mn.lanes|=Oe,nc|=Oe}pe=pe.next}while(pe!==null&&pe!==A);te===null?U=w:te.next=W,kt(w,d.memoizedState)||(Ns=!0),d.memoizedState=w,d.baseState=U,d.baseQueue=te,g.lastRenderedState=w}if(c=g.interleaved,c!==null){T=c;do A=T.lane,mn.lanes|=A,nc|=A,T=T.next;while(T!==c)}else T===null&&(g.lanes=0);return[d.memoizedState,g.dispatch]}function DE(c){var d=_i(),g=d.queue;if(g===null)throw Error(a(311));g.lastRenderedReducer=c;var w=g.dispatch,T=g.pending,A=d.memoizedState;if(T!==null){g.pending=null;var U=T=T.next;do A=c(A,U.action),U=U.next;while(U!==T);kt(A,d.memoizedState)||(Ns=!0),d.memoizedState=A,d.baseQueue===null&&(d.baseState=A),g.lastRenderedState=A}return[A,w]}function tR(){}function nR(c,d){var g=mn,w=_i(),T=d(),A=!kt(w.memoizedState,T);if(A&&(w.memoizedState=T,Ns=!0),w=w.queue,FE(iR.bind(null,g,w,c),[c]),w.getSnapshot!==d||A||dr!==null&&dr.memoizedState.tag&1){if(g.flags|=2048,bp(9,sR.bind(null,g,w,T,d),void 0,null),hr===null)throw Error(a(349));tc&30||rR(g,d,T)}return T}function rR(c,d,g){c.flags|=16384,c={getSnapshot:d,value:g},d=mn.updateQueue,d===null?(d={lastEffect:null,stores:null},mn.updateQueue=d,d.stores=[c]):(g=d.stores,g===null?d.stores=[c]:g.push(c))}function sR(c,d,g,w){d.value=g,d.getSnapshot=w,aR(d)&&oR(c)}function iR(c,d,g){return g(function(){aR(d)&&oR(c)})}function aR(c){var d=c.getSnapshot;c=c.value;try{var g=d();return!kt(c,g)}catch{return!0}}function oR(c){var d=Ca(c,1);d!==null&&yi(d,c,1,-1)}function lR(c){var d=xa();return typeof c=="function"&&(c=c()),d.memoizedState=d.baseState=c,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wp,lastRenderedState:c},d.queue=c,c=c.dispatch=TV.bind(null,mn,c),[d.memoizedState,c]}function bp(c,d,g,w){return c={tag:c,create:d,destroy:g,deps:w,next:null},d=mn.updateQueue,d===null?(d={lastEffect:null,stores:null},mn.updateQueue=d,d.lastEffect=c.next=c):(g=d.lastEffect,g===null?d.lastEffect=c.next=c:(w=g.next,g.next=c,c.next=w,d.lastEffect=c)),c}function uR(){return _i().memoizedState}function ay(c,d,g,w){var T=xa();mn.flags|=c,T.memoizedState=bp(1|d,g,void 0,w===void 0?null:w)}function oy(c,d,g,w){var T=_i();w=w===void 0?null:w;var A=void 0;if(Qn!==null){var U=Qn.memoizedState;if(A=U.destroy,w!==null&&NE(w,U.deps)){T.memoizedState=bp(d,g,A,w);return}}mn.flags|=c,T.memoizedState=bp(1|d,g,A,w)}function cR(c,d){return ay(8390656,8,c,d)}function FE(c,d){return oy(2048,8,c,d)}function dR(c,d){return oy(4,2,c,d)}function hR(c,d){return oy(4,4,c,d)}function fR(c,d){if(typeof d=="function")return c=c(),d(c),function(){d(null)};if(d!=null)return c=c(),d.current=c,function(){d.current=null}}function pR(c,d,g){return g=g!=null?g.concat([c]):null,oy(4,4,fR.bind(null,d,c),g)}function $E(){}function mR(c,d){var g=_i();d=d===void 0?null:d;var w=g.memoizedState;return w!==null&&d!==null&&NE(d,w[1])?w[0]:(g.memoizedState=[c,d],c)}function gR(c,d){var g=_i();d=d===void 0?null:d;var w=g.memoizedState;return w!==null&&d!==null&&NE(d,w[1])?w[0]:(c=c(),g.memoizedState=[c,d],c)}function _R(c,d,g){return tc&21?(kt(g,d)||(g=q_(),mn.lanes|=g,nc|=g,c.baseState=!0),d):(c.baseState&&(c.baseState=!1,Ns=!0),c.memoizedState=g)}function EV(c,d){var g=Tt;Tt=g!==0&&4>g?g:4,c(!0);var w=RE.transition;RE.transition={};try{c(!1),d()}finally{Tt=g,RE.transition=w}}function yR(){return _i().memoizedState}function SV(c,d,g){var w=ml(c);if(g={lane:w,action:g,hasEagerState:!1,eagerState:null,next:null},vR(c))wR(d,g);else if(g=YA(c,d,g,w),g!==null){var T=Jr();yi(g,c,w,T),bR(g,d,w)}}function TV(c,d,g){var w=ml(c),T={lane:w,action:g,hasEagerState:!1,eagerState:null,next:null};if(vR(c))wR(d,T);else{var A=c.alternate;if(c.lanes===0&&(A===null||A.lanes===0)&&(A=d.lastRenderedReducer,A!==null))try{var U=d.lastRenderedState,W=A(U,g);if(T.hasEagerState=!0,T.eagerState=W,kt(W,U)){var te=d.interleaved;te===null?(T.next=T,CE(d)):(T.next=te.next,te.next=T),d.interleaved=T;return}}catch{}finally{}g=YA(c,d,T,w),g!==null&&(T=Jr(),yi(g,c,w,T),bR(g,d,w))}}function vR(c){var d=c.alternate;return c===mn||d!==null&&d===mn}function wR(c,d){yp=iy=!0;var g=c.pending;g===null?d.next=d:(d.next=g.next,g.next=d),c.pending=d}function bR(c,d,g){if(g&4194240){var w=d.lanes;w&=c.pendingLanes,g|=w,d.lanes=g,Id(c,g)}}var ly={readContext:Ar,useCallback:Kr,useContext:Kr,useEffect:Kr,useImperativeHandle:Kr,useInsertionEffect:Kr,useLayoutEffect:Kr,useMemo:Kr,useReducer:Kr,useRef:Kr,useState:Kr,useDebugValue:Kr,useDeferredValue:Kr,useTransition:Kr,useMutableSource:Kr,useSyncExternalStore:Kr,useId:Kr,unstable_isNewReconciler:!1},CV={readContext:Ar,useCallback:function(c,d){return xa().memoizedState=[c,d===void 0?null:d],c},useContext:Ar,useEffect:cR,useImperativeHandle:function(c,d,g){return g=g!=null?g.concat([c]):null,ay(4194308,4,fR.bind(null,d,c),g)},useLayoutEffect:function(c,d){return ay(4194308,4,c,d)},useInsertionEffect:function(c,d){return ay(4,2,c,d)},useMemo:function(c,d){var g=xa();return d=d===void 0?null:d,c=c(),g.memoizedState=[c,d],c},useReducer:function(c,d,g){var w=xa();return d=g!==void 0?g(d):d,w.memoizedState=w.baseState=d,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:d},w.queue=c,c=c.dispatch=SV.bind(null,mn,c),[w.memoizedState,c]},useRef:function(c){var d=xa();return c={current:c},d.memoizedState=c},useState:lR,useDebugValue:$E,useDeferredValue:function(c){return xa().memoizedState=c},useTransition:function(){var c=lR(!1),d=c[0];return c=EV.bind(null,c[1]),xa().memoizedState=c,[d,c]},useMutableSource:function(){},useSyncExternalStore:function(c,d,g){var w=mn,T=xa();if(Yt){if(g===void 0)throw Error(a(407));g=g()}else{if(g=d(),hr===null)throw Error(a(349));tc&30||rR(w,d,g)}T.memoizedState=g;var A={value:g,getSnapshot:d};return T.queue=A,cR(iR.bind(null,w,A,c),[c]),w.flags|=2048,bp(9,sR.bind(null,w,A,g,d),void 0,null),g},useId:function(){var c=xa(),d=hr.identifierPrefix;if(Yt){var g=fi,w=As;g=(w&~(1<<32-Gr(w)-1)).toString(32)+g,d=":"+d+"R"+g,g=vp++,0<g&&(d+="H"+g.toString(32)),d+=":"}else g=bV++,d=":"+d+"r"+g.toString(32)+":";return c.memoizedState=d},unstable_isNewReconciler:!1},IV={readContext:Ar,useCallback:mR,useContext:Ar,useEffect:FE,useImperativeHandle:pR,useInsertionEffect:dR,useLayoutEffect:hR,useMemo:gR,useReducer:ME,useRef:uR,useState:function(){return ME(wp)},useDebugValue:$E,useDeferredValue:function(c){var d=_i();return _R(d,Qn.memoizedState,c)},useTransition:function(){var c=ME(wp)[0],d=_i().memoizedState;return[c,d]},useMutableSource:tR,useSyncExternalStore:nR,useId:yR,unstable_isNewReconciler:!1},xV={readContext:Ar,useCallback:mR,useContext:Ar,useEffect:FE,useImperativeHandle:pR,useInsertionEffect:dR,useLayoutEffect:hR,useMemo:gR,useReducer:DE,useRef:uR,useState:function(){return DE(wp)},useDebugValue:$E,useDeferredValue:function(c){var d=_i();return Qn===null?d.memoizedState=c:_R(d,Qn.memoizedState,c)},useTransition:function(){var c=DE(wp)[0],d=_i().memoizedState;return[c,d]},useMutableSource:tR,useSyncExternalStore:nR,useId:yR,unstable_isNewReconciler:!1};function Ui(c,d){if(c&&c.defaultProps){d=i({},d),c=c.defaultProps;for(var g in c)d[g]===void 0&&(d[g]=c[g]);return d}return d}function jE(c,d,g,w){d=c.memoizedState,g=g(w,d),g=g==null?d:i({},d,g),c.memoizedState=g,c.lanes===0&&(c.updateQueue.baseState=g)}var uy={isMounted:function(c){return(c=c._reactInternals)?N(c)===c:!1},enqueueSetState:function(c,d,g){c=c._reactInternals;var w=Jr(),T=ml(c),A=mo(w,T);A.payload=d,g!=null&&(A.callback=g),d=hl(c,A,T),d!==null&&(yi(d,c,T,w),ty(d,c,T))},enqueueReplaceState:function(c,d,g){c=c._reactInternals;var w=Jr(),T=ml(c),A=mo(w,T);A.tag=1,A.payload=d,g!=null&&(A.callback=g),d=hl(c,A,T),d!==null&&(yi(d,c,T,w),ty(d,c,T))},enqueueForceUpdate:function(c,d){c=c._reactInternals;var g=Jr(),w=ml(c),T=mo(g,w);T.tag=2,d!=null&&(T.callback=d),d=hl(c,T,w),d!==null&&(yi(d,c,w,g),ty(d,c,w))}};function ER(c,d,g,w,T,A,U){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(w,A,U):d.prototype&&d.prototype.isPureReactComponent?!ec(g,w)||!ec(T,A):!0}function SR(c,d,g){var w=!1,T=hi,A=d.contextType;return typeof A=="object"&&A!==null?A=Ar(A):(T=Pr(d)?oo:qn.current,w=d.contextTypes,A=(w=w!=null)?ll(c,T):hi),d=new d(g,A),c.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=uy,c.stateNode=d,d._reactInternals=c,w&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=T,c.__reactInternalMemoizedMaskedChildContext=A),d}function TR(c,d,g,w){c=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(g,w),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(g,w),d.state!==c&&uy.enqueueReplaceState(d,d.state,null)}function UE(c,d,g,w){var T=c.stateNode;T.props=g,T.state=c.memoizedState,T.refs={},IE(c);var A=d.contextType;typeof A=="object"&&A!==null?T.context=Ar(A):(A=Pr(d)?oo:qn.current,T.context=ll(c,A)),T.state=c.memoizedState,A=d.getDerivedStateFromProps,typeof A=="function"&&(jE(c,d,A,g),T.state=c.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(d=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),d!==T.state&&uy.enqueueReplaceState(T,T.state,null),ny(c,g,T,w),T.state=c.memoizedState),typeof T.componentDidMount=="function"&&(c.flags|=4194308)}function Md(c,d){try{var g="",w=d;do g+=ey(w),w=w.return;while(w);var T=g}catch(A){T=`
Error generating stack: `+A.message+`
`+A.stack}return{value:c,source:d,stack:T,digest:null}}function VE(c,d,g){return{value:c,source:null,stack:g??null,digest:d??null}}function BE(c,d){try{console.error(d.value)}catch(g){setTimeout(function(){throw g})}}var kV=typeof WeakMap=="function"?WeakMap:Map;function CR(c,d,g){g=mo(-1,g),g.tag=3,g.payload={element:null};var w=d.value;return g.callback=function(){Sy||(Sy=!0,lS=w),BE(c,d)},g}function IR(c,d,g){g=mo(-1,g),g.tag=3;var w=c.type.getDerivedStateFromError;if(typeof w=="function"){var T=d.value;g.payload=function(){return w(T)},g.callback=function(){BE(c,d)}}var A=c.stateNode;return A!==null&&typeof A.componentDidCatch=="function"&&(g.callback=function(){BE(c,d),typeof w!="function"&&(fl===null?fl=new Set([this]):fl.add(this));var U=d.stack;this.componentDidCatch(d.value,{componentStack:U!==null?U:""})}),g}function xR(c,d,g){var w=c.pingCache;if(w===null){w=c.pingCache=new kV;var T=new Set;w.set(d,T)}else T=w.get(d),T===void 0&&(T=new Set,w.set(d,T));T.has(g)||(T.add(g),c=BV.bind(null,c,d,g),d.then(c,c))}function kR(c){do{var d;if((d=c.tag===13)&&(d=c.memoizedState,d=d!==null?d.dehydrated!==null:!0),d)return c;c=c.return}while(c!==null);return null}function PR(c,d,g,w,T){return c.mode&1?(c.flags|=65536,c.lanes=T,c):(c===d?c.flags|=65536:(c.flags|=128,g.flags|=131072,g.flags&=-52805,g.tag===1&&(g.alternate===null?g.tag=17:(d=mo(-1,1),d.tag=2,hl(g,d,1))),g.lanes|=1),c)}var PV=o.ReactCurrentOwner,Ns=!1;function fs(c,d,g,w){d.child=c===null?K(d,null,g,w):j(d,c.child,g,w)}function AR(c,d,g,w,T){g=g.render;var A=d.ref;return cr(d,T),w=OE(c,d,g,w,A,T),g=LE(),c!==null&&!Ns?(d.updateQueue=c.updateQueue,d.flags&=-2053,c.lanes&=~T,go(c,d,T)):(Yt&&g&&Rd(d),d.flags|=1,fs(c,d,w,T),d.child)}function RR(c,d,g,w,T){if(c===null){var A=g.type;return typeof A=="function"&&!pS(A)&&A.defaultProps===void 0&&g.compare===null&&g.defaultProps===void 0?(d.tag=15,d.type=A,NR(c,d,A,w,T)):(c=Py(g.type,null,w,d,d.mode,T),c.ref=d.ref,c.return=d,d.child=c)}if(A=c.child,!(c.lanes&T)){var U=A.memoizedProps;if(g=g.compare,g=g!==null?g:ec,g(U,w)&&c.ref===d.ref)return go(c,d,T)}return d.flags|=1,c=_l(A,w),c.ref=d.ref,c.return=d,d.child=c}function NR(c,d,g,w,T){if(c!==null){var A=c.memoizedProps;if(ec(A,w)&&c.ref===d.ref)if(Ns=!1,d.pendingProps=w=A,(c.lanes&T)!==0)c.flags&131072&&(Ns=!0);else return d.lanes=c.lanes,go(c,d,T)}return zE(c,d,g,w,T)}function OR(c,d,g){var w=d.pendingProps,T=w.children,A=c!==null?c.memoizedState:null;if(w.mode==="hidden")if(!(d.mode&1))d.memoizedState={baseLanes:0,cachePool:null,transitions:null},Bt(Fd,Ks),Ks|=g;else{if(!(g&1073741824))return c=A!==null?A.baseLanes|g:g,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:c,cachePool:null,transitions:null},d.updateQueue=null,Bt(Fd,Ks),Ks|=c,null;d.memoizedState={baseLanes:0,cachePool:null,transitions:null},w=A!==null?A.baseLanes:g,Bt(Fd,Ks),Ks|=w}else A!==null?(w=A.baseLanes|g,d.memoizedState=null):w=g,Bt(Fd,Ks),Ks|=w;return fs(c,d,T,g),d.child}function LR(c,d){var g=d.ref;(c===null&&g!==null||c!==null&&c.ref!==g)&&(d.flags|=512,d.flags|=2097152)}function zE(c,d,g,w,T){var A=Pr(g)?oo:qn.current;return A=ll(d,A),cr(d,T),g=OE(c,d,g,w,A,T),w=LE(),c!==null&&!Ns?(d.updateQueue=c.updateQueue,d.flags&=-2053,c.lanes&=~T,go(c,d,T)):(Yt&&w&&Rd(d),d.flags|=1,fs(c,d,g,T),d.child)}function MR(c,d,g,w,T){if(Pr(g)){var A=!0;ks(d)}else A=!1;if(cr(d,T),d.stateNode===null)dy(c,d),SR(d,g,w),UE(d,g,w,T),w=!0;else if(c===null){var U=d.stateNode,W=d.memoizedProps;U.props=W;var te=U.context,pe=g.contextType;typeof pe=="object"&&pe!==null?pe=Ar(pe):(pe=Pr(g)?oo:qn.current,pe=ll(d,pe));var Oe=g.getDerivedStateFromProps,st=typeof Oe=="function"||typeof U.getSnapshotBeforeUpdate=="function";st||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(W!==w||te!==pe)&&TR(d,U,w,pe),dl=!1;var Ie=d.memoizedState;U.state=Ie,ny(d,w,U,T),te=d.memoizedState,W!==w||Ie!==te||kr.current||dl?(typeof Oe=="function"&&(jE(d,g,Oe,w),te=d.memoizedState),(W=dl||ER(d,g,W,w,Ie,te,pe))?(st||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount()),typeof U.componentDidMount=="function"&&(d.flags|=4194308)):(typeof U.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=w,d.memoizedState=te),U.props=w,U.state=te,U.context=pe,w=W):(typeof U.componentDidMount=="function"&&(d.flags|=4194308),w=!1)}else{U=d.stateNode,JA(c,d),W=d.memoizedProps,pe=d.type===d.elementType?W:Ui(d.type,W),U.props=pe,st=d.pendingProps,Ie=U.context,te=g.contextType,typeof te=="object"&&te!==null?te=Ar(te):(te=Pr(g)?oo:qn.current,te=ll(d,te));var on=g.getDerivedStateFromProps;(Oe=typeof on=="function"||typeof U.getSnapshotBeforeUpdate=="function")||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(W!==st||Ie!==te)&&TR(d,U,w,te),dl=!1,Ie=d.memoizedState,U.state=Ie,ny(d,w,U,T);var en=d.memoizedState;W!==st||Ie!==en||kr.current||dl?(typeof on=="function"&&(jE(d,g,on,w),en=d.memoizedState),(pe=dl||ER(d,g,pe,w,Ie,en,te)||!1)?(Oe||typeof U.UNSAFE_componentWillUpdate!="function"&&typeof U.componentWillUpdate!="function"||(typeof U.componentWillUpdate=="function"&&U.componentWillUpdate(w,en,te),typeof U.UNSAFE_componentWillUpdate=="function"&&U.UNSAFE_componentWillUpdate(w,en,te)),typeof U.componentDidUpdate=="function"&&(d.flags|=4),typeof U.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof U.componentDidUpdate!="function"||W===c.memoizedProps&&Ie===c.memoizedState||(d.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||W===c.memoizedProps&&Ie===c.memoizedState||(d.flags|=1024),d.memoizedProps=w,d.memoizedState=en),U.props=w,U.state=en,U.context=te,w=pe):(typeof U.componentDidUpdate!="function"||W===c.memoizedProps&&Ie===c.memoizedState||(d.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||W===c.memoizedProps&&Ie===c.memoizedState||(d.flags|=1024),w=!1)}return GE(c,d,g,w,A,T)}function GE(c,d,g,w,T,A){LR(c,d);var U=(d.flags&128)!==0;if(!w&&!U)return T&&Ku(d,g,!1),go(c,d,A);w=d.stateNode,PV.current=d;var W=U&&typeof g.getDerivedStateFromError!="function"?null:w.render();return d.flags|=1,c!==null&&U?(d.child=j(d,c.child,null,A),d.child=j(d,null,W,A)):fs(c,d,W,A),d.memoizedState=w.state,T&&Ku(d,g,!0),d.child}function DR(c){var d=c.stateNode;d.pendingContext?W_(c,d.pendingContext,d.pendingContext!==d.context):d.context&&W_(c,d.context,!1),xE(c,d.containerInfo)}function FR(c,d,g,w,T){return po(),cl(T),d.flags|=256,fs(c,d,g,w),d.child}var WE={dehydrated:null,treeContext:null,retryLane:0};function HE(c){return{baseLanes:c,cachePool:null,transitions:null}}function $R(c,d,g){var w=d.pendingProps,T=pn.current,A=!1,U=(d.flags&128)!==0,W;if((W=U)||(W=c!==null&&c.memoizedState===null?!1:(T&2)!==0),W?(A=!0,d.flags&=-129):(c===null||c.memoizedState!==null)&&(T|=1),Bt(pn,T&1),c===null)return $i(d),c=d.memoizedState,c!==null&&(c=c.dehydrated,c!==null)?(d.mode&1?np(c)?d.lanes=8:d.lanes=1073741824:d.lanes=1,null):(U=w.children,c=w.fallback,A?(w=d.mode,A=d.child,U={mode:"hidden",children:U},!(w&1)&&A!==null?(A.childLanes=0,A.pendingProps=U):A=Ay(U,w,0,null),c=ac(c,w,g,null),A.return=d,c.return=d,A.sibling=c,d.child=A,d.child.memoizedState=HE(g),d.memoizedState=WE,c):qE(d,U));if(T=c.memoizedState,T!==null&&(W=T.dehydrated,W!==null))return AV(c,d,U,w,W,T,g);if(A){A=w.fallback,U=d.mode,T=c.child,W=T.sibling;var te={mode:"hidden",children:w.children};return!(U&1)&&d.child!==T?(w=d.child,w.childLanes=0,w.pendingProps=te,d.deletions=null):(w=_l(T,te),w.subtreeFlags=T.subtreeFlags&14680064),W!==null?A=_l(W,A):(A=ac(A,U,g,null),A.flags|=2),A.return=d,w.return=d,w.sibling=A,d.child=w,w=A,A=d.child,U=c.child.memoizedState,U=U===null?HE(g):{baseLanes:U.baseLanes|g,cachePool:null,transitions:U.transitions},A.memoizedState=U,A.childLanes=c.childLanes&~g,d.memoizedState=WE,w}return A=c.child,c=A.sibling,w=_l(A,{mode:"visible",children:w.children}),!(d.mode&1)&&(w.lanes=g),w.return=d,w.sibling=null,c!==null&&(g=d.deletions,g===null?(d.deletions=[c],d.flags|=16):g.push(c)),d.child=w,d.memoizedState=null,w}function qE(c,d){return d=Ay({mode:"visible",children:d},c.mode,0,null),d.return=c,c.child=d}function cy(c,d,g,w){return w!==null&&cl(w),j(d,c.child,null,g),c=qE(d,d.pendingProps.children),c.flags|=2,d.memoizedState=null,c}function AV(c,d,g,w,T,A,U){if(g)return d.flags&256?(d.flags&=-257,w=VE(Error(a(422))),cy(c,d,U,w)):d.memoizedState!==null?(d.child=c.child,d.flags|=128,null):(A=w.fallback,T=d.mode,w=Ay({mode:"visible",children:w.children},T,0,null),A=ac(A,T,U,null),A.flags|=2,w.return=d,A.return=d,w.sibling=A,d.child=w,d.mode&1&&j(d,c.child,null,U),d.child.memoizedState=HE(U),d.memoizedState=WE,A);if(!(d.mode&1))return cy(c,d,U,null);if(np(T))return w=vE(T).digest,A=Error(a(419)),w=VE(A,w,void 0),cy(c,d,U,w);if(g=(U&c.childLanes)!==0,Ns||g){if(w=hr,w!==null){switch(U&-U){case 4:T=2;break;case 16:T=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:T=32;break;case 536870912:T=268435456;break;default:T=0}T=T&(w.suspendedLanes|U)?0:T,T!==0&&T!==A.retryLane&&(A.retryLane=T,Ca(c,T),yi(w,c,T,-1))}return fS(),w=VE(Error(a(421))),cy(c,d,U,w)}return al(T)?(d.flags|=128,d.child=c.child,d=zV.bind(null,c),ol(T,d),null):(c=A.treeContext,ht&&(ds=U_(T),qr=d,Yt=!0,Rs=null,fo=!1,c!==null&&(ur[cs++]=As,ur[cs++]=fi,ur[cs++]=Fi,As=c.id,fi=c.overflow,Fi=d)),d=qE(d,w.children),d.flags|=4096,d)}function jR(c,d,g){c.lanes|=d;var w=c.alternate;w!==null&&(w.lanes|=d),Ta(c.return,d,g)}function KE(c,d,g,w,T){var A=c.memoizedState;A===null?c.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:w,tail:g,tailMode:T}:(A.isBackwards=d,A.rendering=null,A.renderingStartTime=0,A.last=w,A.tail=g,A.tailMode=T)}function UR(c,d,g){var w=d.pendingProps,T=w.revealOrder,A=w.tail;if(fs(c,d,w.children,g),w=pn.current,w&2)w=w&1|2,d.flags|=128;else{if(c!==null&&c.flags&128)e:for(c=d.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&jR(c,g,d);else if(c.tag===19)jR(c,g,d);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===d)break e;for(;c.sibling===null;){if(c.return===null||c.return===d)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}w&=1}if(Bt(pn,w),!(d.mode&1))d.memoizedState=null;else switch(T){case"forwards":for(g=d.child,T=null;g!==null;)c=g.alternate,c!==null&&ry(c)===null&&(T=g),g=g.sibling;g=T,g===null?(T=d.child,d.child=null):(T=g.sibling,g.sibling=null),KE(d,!1,T,g,A);break;case"backwards":for(g=null,T=d.child,d.child=null;T!==null;){if(c=T.alternate,c!==null&&ry(c)===null){d.child=T;break}c=T.sibling,T.sibling=g,g=T,T=c}KE(d,!0,g,null,A);break;case"together":KE(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function dy(c,d){!(d.mode&1)&&c!==null&&(c.alternate=null,d.alternate=null,d.flags|=2)}function go(c,d,g){if(c!==null&&(d.dependencies=c.dependencies),nc|=d.lanes,!(g&d.childLanes))return null;if(c!==null&&d.child!==c.child)throw Error(a(153));if(d.child!==null){for(c=d.child,g=_l(c,c.pendingProps),d.child=g,g.return=d;c.sibling!==null;)c=c.sibling,g=g.sibling=_l(c,c.pendingProps),g.return=d;g.sibling=null}return d.child}function RV(c,d,g){switch(d.tag){case 3:DR(d),po();break;case 5:eR(d);break;case 1:Pr(d.type)&&ks(d);break;case 4:xE(d,d.stateNode.containerInfo);break;case 10:Kn(d,d.type._context,d.memoizedProps.value);break;case 13:var w=d.memoizedState;if(w!==null)return w.dehydrated!==null?(Bt(pn,pn.current&1),d.flags|=128,null):g&d.child.childLanes?$R(c,d,g):(Bt(pn,pn.current&1),c=go(c,d,g),c!==null?c.sibling:null);Bt(pn,pn.current&1);break;case 19:if(w=(g&d.childLanes)!==0,c.flags&128){if(w)return UR(c,d,g);d.flags|=128}var T=d.memoizedState;if(T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),Bt(pn,pn.current),w)break;return null;case 22:case 23:return d.lanes=0,OR(c,d,g)}return go(c,d,g)}function ka(c){c.flags|=4}function VR(c,d){if(c!==null&&c.child===d.child)return!0;if(d.flags&16)return!1;for(c=d.child;c!==null;){if(c.flags&12854||c.subtreeFlags&12854)return!1;c=c.sibling}return!0}var Ep,Sp,hy,fy;if(Le)Ep=function(c,d){for(var g=d.child;g!==null;){if(g.tag===5||g.tag===6)le(c,g.stateNode);else if(g.tag!==4&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return;g=g.return}g.sibling.return=g.return,g=g.sibling}},Sp=function(){},hy=function(c,d,g,w,T){if(c=c.memoizedProps,c!==w){var A=d.stateNode,U=Ia(gi.current);g=ve(A,g,c,w,T,U),(d.updateQueue=g)&&ka(d)}},fy=function(c,d,g,w){g!==w&&ka(d)};else if(et){Ep=function(c,d,g,w){for(var T=d.child;T!==null;){if(T.tag===5){var A=T.stateNode;g&&w&&(A=il(A,T.type,T.memoizedProps,T)),le(c,A)}else if(T.tag===6)A=T.stateNode,g&&w&&(A=tp(A,T.memoizedProps,T)),le(c,A);else if(T.tag!==4){if(T.tag===22&&T.memoizedState!==null)A=T.child,A!==null&&(A.return=T),Ep(c,T,!0,!0);else if(T.child!==null){T.child.return=T,T=T.child;continue}}if(T===d)break;for(;T.sibling===null;){if(T.return===null||T.return===d)return;T=T.return}T.sibling.return=T.return,T=T.sibling}};var BR=function(c,d,g,w){for(var T=d.child;T!==null;){if(T.tag===5){var A=T.stateNode;g&&w&&(A=il(A,T.type,T.memoizedProps,T)),ep(c,A)}else if(T.tag===6)A=T.stateNode,g&&w&&(A=tp(A,T.memoizedProps,T)),ep(c,A);else if(T.tag!==4){if(T.tag===22&&T.memoizedState!==null)A=T.child,A!==null&&(A.return=T),BR(c,T,!0,!0);else if(T.child!==null){T.child.return=T,T=T.child;continue}}if(T===d)break;for(;T.sibling===null;){if(T.return===null||T.return===d)return;T=T.return}T.sibling.return=T.return,T=T.sibling}};Sp=function(c,d){var g=d.stateNode;if(!VR(c,d)){c=g.containerInfo;var w=_a(c);BR(w,d,!1,!1),g.pendingChildren=w,ka(d),yd(c,w)}},hy=function(c,d,g,w,T){var A=c.stateNode,U=c.memoizedProps;if((c=VR(c,d))&&U===w)d.stateNode=A;else{var W=d.stateNode,te=Ia(gi.current),pe=null;U!==w&&(pe=ve(W,g,U,w,T,te)),c&&pe===null?d.stateNode=A:(A=Zf(A,pe,g,U,w,d,c,W),ye(A,g,w,T,te)&&ka(d),d.stateNode=A,c?ka(d):Ep(A,d,!1,!1))}},fy=function(c,d,g,w){g!==w?(c=Ia(Od.current),g=Ia(gi.current),d.stateNode=Me(w,c,g,d),ka(d)):d.stateNode=c.stateNode}}else Sp=function(){},hy=function(){},fy=function(){};function Tp(c,d){if(!Yt)switch(c.tailMode){case"hidden":d=c.tail;for(var g=null;d!==null;)d.alternate!==null&&(g=d),d=d.sibling;g===null?c.tail=null:g.sibling=null;break;case"collapsed":g=c.tail;for(var w=null;g!==null;)g.alternate!==null&&(w=g),g=g.sibling;w===null?d||c.tail===null?c.tail=null:c.tail.sibling=null:w.sibling=null}}function Qr(c){var d=c.alternate!==null&&c.alternate.child===c.child,g=0,w=0;if(d)for(var T=c.child;T!==null;)g|=T.lanes|T.childLanes,w|=T.subtreeFlags&14680064,w|=T.flags&14680064,T.return=c,T=T.sibling;else for(T=c.child;T!==null;)g|=T.lanes|T.childLanes,w|=T.subtreeFlags,w|=T.flags,T.return=c,T=T.sibling;return c.subtreeFlags|=w,c.childLanes=g,d}function NV(c,d,g){var w=d.pendingProps;switch(ho(d),d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qr(d),null;case 1:return Pr(d.type)&&qu(),Qr(d),null;case 3:return g=d.stateNode,Ld(),Qt(kr),Qt(qn),AE(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(c===null||c.child===null)&&(Zu(d)?ka(d):c===null||c.memoizedState.isDehydrated&&!(d.flags&256)||(d.flags|=1024,Rs!==null&&(dS(Rs),Rs=null))),Sp(c,d),Qr(d),null;case 5:kE(d),g=Ia(Od.current);var T=d.type;if(c!==null&&d.stateNode!=null)hy(c,d,T,w,g),c.ref!==d.ref&&(d.flags|=512,d.flags|=2097152);else{if(!w){if(d.stateNode===null)throw Error(a(166));return Qr(d),null}if(c=Ia(gi.current),Zu(d)){if(!ht)throw Error(a(175));c=rp(d.stateNode,d.type,d.memoizedProps,g,c,d,!fo),d.updateQueue=c,c!==null&&ka(d)}else{var A=se(T,w,g,c,d);Ep(A,d,!1,!1),d.stateNode=A,ye(A,T,w,g,c)&&ka(d)}d.ref!==null&&(d.flags|=512,d.flags|=2097152)}return Qr(d),null;case 6:if(c&&d.stateNode!=null)fy(c,d,c.memoizedProps,w);else{if(typeof w!="string"&&d.stateNode===null)throw Error(a(166));if(c=Ia(Od.current),g=Ia(gi.current),Zu(d)){if(!ht)throw Error(a(176));if(c=d.stateNode,g=d.memoizedProps,(w=Ed(c,g,d,!fo))&&(T=qr,T!==null))switch(T.tag){case 3:bE(T.stateNode.containerInfo,c,g,(T.mode&1)!==0);break;case 5:Sd(T.type,T.memoizedProps,T.stateNode,c,g,(T.mode&1)!==0)}w&&ka(d)}else d.stateNode=Me(w,c,g,d)}return Qr(d),null;case 13:if(Qt(pn),w=d.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(Yt&&ds!==null&&d.mode&1&&!(d.flags&128))mp(),po(),d.flags|=98560,T=!1;else if(T=Zu(d),w!==null&&w.dehydrated!==null){if(c===null){if(!T)throw Error(a(318));if(!ht)throw Error(a(344));if(T=d.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(a(317));ya(T,d)}else po(),!(d.flags&128)&&(d.memoizedState=null),d.flags|=4;Qr(d),T=!1}else Rs!==null&&(dS(Rs),Rs=null),T=!0;if(!T)return d.flags&65536?d:null}return d.flags&128?(d.lanes=g,d):(g=w!==null,g!==(c!==null&&c.memoizedState!==null)&&g&&(d.child.flags|=8192,d.mode&1&&(c===null||pn.current&1?Yn===0&&(Yn=3):fS())),d.updateQueue!==null&&(d.flags|=4),Qr(d),null);case 4:return Ld(),Sp(c,d),c===null&&ot(d.stateNode.containerInfo),Qr(d),null;case 10:return Mn(d.type._context),Qr(d),null;case 17:return Pr(d.type)&&qu(),Qr(d),null;case 19:if(Qt(pn),T=d.memoizedState,T===null)return Qr(d),null;if(w=(d.flags&128)!==0,A=T.rendering,A===null)if(w)Tp(T,!1);else{if(Yn!==0||c!==null&&c.flags&128)for(c=d.child;c!==null;){if(A=ry(c),A!==null){for(d.flags|=128,Tp(T,!1),c=A.updateQueue,c!==null&&(d.updateQueue=c,d.flags|=4),d.subtreeFlags=0,c=g,g=d.child;g!==null;)w=g,T=c,w.flags&=14680066,A=w.alternate,A===null?(w.childLanes=0,w.lanes=T,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=A.childLanes,w.lanes=A.lanes,w.child=A.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=A.memoizedProps,w.memoizedState=A.memoizedState,w.updateQueue=A.updateQueue,w.type=A.type,T=A.dependencies,w.dependencies=T===null?null:{lanes:T.lanes,firstContext:T.firstContext}),g=g.sibling;return Bt(pn,pn.current&1|2),d.child}c=c.sibling}T.tail!==null&&Ln()>oS&&(d.flags|=128,w=!0,Tp(T,!1),d.lanes=4194304)}else{if(!w)if(c=ry(A),c!==null){if(d.flags|=128,w=!0,c=c.updateQueue,c!==null&&(d.updateQueue=c,d.flags|=4),Tp(T,!0),T.tail===null&&T.tailMode==="hidden"&&!A.alternate&&!Yt)return Qr(d),null}else 2*Ln()-T.renderingStartTime>oS&&g!==1073741824&&(d.flags|=128,w=!0,Tp(T,!1),d.lanes=4194304);T.isBackwards?(A.sibling=d.child,d.child=A):(c=T.last,c!==null?c.sibling=A:d.child=A,T.last=A)}return T.tail!==null?(d=T.tail,T.rendering=d,T.tail=d.sibling,T.renderingStartTime=Ln(),d.sibling=null,c=pn.current,Bt(pn,w?c&1|2:c&1),d):(Qr(d),null);case 22:case 23:return hS(),g=d.memoizedState!==null,c!==null&&c.memoizedState!==null!==g&&(d.flags|=8192),g&&d.mode&1?Ks&1073741824&&(Qr(d),Le&&d.subtreeFlags&6&&(d.flags|=8192)):Qr(d),null;case 24:return null;case 25:return null}throw Error(a(156,d.tag))}function OV(c,d){switch(ho(d),d.tag){case 1:return Pr(d.type)&&qu(),c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 3:return Ld(),Qt(kr),Qt(qn),AE(),c=d.flags,c&65536&&!(c&128)?(d.flags=c&-65537|128,d):null;case 5:return kE(d),null;case 13:if(Qt(pn),c=d.memoizedState,c!==null&&c.dehydrated!==null){if(d.alternate===null)throw Error(a(340));po()}return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 19:return Qt(pn),null;case 4:return Ld(),null;case 10:return Mn(d.type._context),null;case 22:case 23:return hS(),null;case 24:return null;default:return null}}var py=!1,Yr=!1,LV=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function Dd(c,d){var g=c.ref;if(g!==null)if(typeof g=="function")try{g(null)}catch(w){dn(c,d,w)}else g.current=null}function QE(c,d,g){try{g()}catch(w){dn(c,d,w)}}var zR=!1;function MV(c,d){for(Q(c.containerInfo),Ae=d;Ae!==null;)if(c=Ae,d=c.child,(c.subtreeFlags&1028)!==0&&d!==null)d.return=c,Ae=d;else for(;Ae!==null;){c=Ae;try{var g=c.alternate;if(c.flags&1024)switch(c.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var w=g.memoizedProps,T=g.memoizedState,A=c.stateNode,U=A.getSnapshotBeforeUpdate(c.elementType===c.type?w:Ui(c.type,w),T);A.__reactInternalSnapshotBeforeUpdate=U}break;case 3:Le&&Xf(c.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(W){dn(c,c.return,W)}if(d=c.sibling,d!==null){d.return=c.return,Ae=d;break}Ae=c.return}return g=zR,zR=!1,g}function Cp(c,d,g){var w=d.updateQueue;if(w=w!==null?w.lastEffect:null,w!==null){var T=w=w.next;do{if((T.tag&c)===c){var A=T.destroy;T.destroy=void 0,A!==void 0&&QE(d,g,A)}T=T.next}while(T!==w)}}function my(c,d){if(d=d.updateQueue,d=d!==null?d.lastEffect:null,d!==null){var g=d=d.next;do{if((g.tag&c)===c){var w=g.create;g.destroy=w()}g=g.next}while(g!==d)}}function YE(c){var d=c.ref;if(d!==null){var g=c.stateNode;switch(c.tag){case 5:c=ue(g);break;default:c=g}typeof d=="function"?d(c):d.current=c}}function GR(c){var d=c.alternate;d!==null&&(c.alternate=null,GR(d)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(d=c.stateNode,d!==null&&Wn(d)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}function WR(c){return c.tag===5||c.tag===3||c.tag===4}function HR(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||WR(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function JE(c,d,g){var w=c.tag;if(w===5||w===6)c=c.stateNode,d?M_(g,c,d):Hn(g,c);else if(w!==4&&(c=c.child,c!==null))for(JE(c,d,g),c=c.sibling;c!==null;)JE(c,d,g),c=c.sibling}function XE(c,d,g){var w=c.tag;if(w===5||w===6)c=c.stateNode,d?L_(g,c,d):Be(g,c);else if(w!==4&&(c=c.child,c!==null))for(XE(c,d,g),c=c.sibling;c!==null;)XE(c,d,g),c=c.sibling}var Rr=null,Vi=!1;function Pa(c,d,g){for(g=g.child;g!==null;)ZE(c,d,g),g=g.sibling}function ZE(c,d,g){if(Wr&&typeof Wr.onCommitFiberUnmount=="function")try{Wr.onCommitFiberUnmount(Sa,g)}catch{}switch(g.tag){case 5:Yr||Dd(g,d);case 6:if(Le){var w=Rr,T=Vi;Rr=null,Pa(c,d,g),Rr=w,Vi=T,Rr!==null&&(Vi?yE(Rr,g.stateNode):Yf(Rr,g.stateNode))}else Pa(c,d,g);break;case 18:Le&&Rr!==null&&(Vi?z_(Rr,g.stateNode):ip(Rr,g.stateNode));break;case 4:Le?(w=Rr,T=Vi,Rr=g.stateNode.containerInfo,Vi=!0,Pa(c,d,g),Rr=w,Vi=T):(et&&(w=g.stateNode.containerInfo,T=_a(w),vd(w,T)),Pa(c,d,g));break;case 0:case 11:case 14:case 15:if(!Yr&&(w=g.updateQueue,w!==null&&(w=w.lastEffect,w!==null))){T=w=w.next;do{var A=T,U=A.destroy;A=A.tag,U!==void 0&&(A&2||A&4)&&QE(g,d,U),T=T.next}while(T!==w)}Pa(c,d,g);break;case 1:if(!Yr&&(Dd(g,d),w=g.stateNode,typeof w.componentWillUnmount=="function"))try{w.props=g.memoizedProps,w.state=g.memoizedState,w.componentWillUnmount()}catch(W){dn(g,d,W)}Pa(c,d,g);break;case 21:Pa(c,d,g);break;case 22:g.mode&1?(Yr=(w=Yr)||g.memoizedState!==null,Pa(c,d,g),Yr=w):Pa(c,d,g);break;default:Pa(c,d,g)}}function qR(c){var d=c.updateQueue;if(d!==null){c.updateQueue=null;var g=c.stateNode;g===null&&(g=c.stateNode=new LV),d.forEach(function(w){var T=GV.bind(null,c,w);g.has(w)||(g.add(w),w.then(T,T))})}}function Bi(c,d){var g=d.deletions;if(g!==null)for(var w=0;w<g.length;w++){var T=g[w];try{var A=c,U=d;if(Le){var W=U;e:for(;W!==null;){switch(W.tag){case 5:Rr=W.stateNode,Vi=!1;break e;case 3:Rr=W.stateNode.containerInfo,Vi=!0;break e;case 4:Rr=W.stateNode.containerInfo,Vi=!0;break e}W=W.return}if(Rr===null)throw Error(a(160));ZE(A,U,T),Rr=null,Vi=!1}else ZE(A,U,T);var te=T.alternate;te!==null&&(te.return=null),T.return=null}catch(pe){dn(T,d,pe)}}if(d.subtreeFlags&12854)for(d=d.child;d!==null;)KR(d,c),d=d.sibling}function KR(c,d){var g=c.alternate,w=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:if(Bi(d,c),Aa(c),w&4){try{Cp(3,c,c.return),my(3,c)}catch(Ie){dn(c,c.return,Ie)}try{Cp(5,c,c.return)}catch(Ie){dn(c,c.return,Ie)}}break;case 1:Bi(d,c),Aa(c),w&512&&g!==null&&Dd(g,g.return);break;case 5:if(Bi(d,c),Aa(c),w&512&&g!==null&&Dd(g,g.return),Le){if(c.flags&32){var T=c.stateNode;try{D_(T)}catch(Ie){dn(c,c.return,Ie)}}if(w&4&&(T=c.stateNode,T!=null)){var A=c.memoizedProps;if(g=g!==null?g.memoizedProps:A,w=c.type,d=c.updateQueue,c.updateQueue=null,d!==null)try{Gu(T,d,w,g,A,c)}catch(Ie){dn(c,c.return,Ie)}}}break;case 6:if(Bi(d,c),Aa(c),w&4&&Le){if(c.stateNode===null)throw Error(a(162));T=c.stateNode,A=c.memoizedProps,g=g!==null?g.memoizedProps:A;try{zu(T,g,A)}catch(Ie){dn(c,c.return,Ie)}}break;case 3:if(Bi(d,c),Aa(c),w&4){if(Le&&ht&&g!==null&&g.memoizedState.isDehydrated)try{B_(d.containerInfo)}catch(Ie){dn(c,c.return,Ie)}if(et){T=d.containerInfo,A=d.pendingChildren;try{vd(T,A)}catch(Ie){dn(c,c.return,Ie)}}}break;case 4:if(Bi(d,c),Aa(c),w&4&&et){A=c.stateNode,T=A.containerInfo,A=A.pendingChildren;try{vd(T,A)}catch(Ie){dn(c,c.return,Ie)}}break;case 13:Bi(d,c),Aa(c),T=c.child,T.flags&8192&&(A=T.memoizedState!==null,T.stateNode.isHidden=A,!A||T.alternate!==null&&T.alternate.memoizedState!==null||(aS=Ln())),w&4&&qR(c);break;case 22:var U=g!==null&&g.memoizedState!==null;if(c.mode&1?(Yr=(g=Yr)||U,Bi(d,c),Yr=g):Bi(d,c),Aa(c),w&8192){if(g=c.memoizedState!==null,(c.stateNode.isHidden=g)&&!U&&c.mode&1)for(Ae=c,w=c.child;w!==null;){for(d=Ae=w;Ae!==null;){U=Ae;var W=U.child;switch(U.tag){case 0:case 11:case 14:case 15:Cp(4,U,U.return);break;case 1:Dd(U,U.return);var te=U.stateNode;if(typeof te.componentWillUnmount=="function"){var pe=U,Oe=U.return;try{var st=pe;te.props=st.memoizedProps,te.state=st.memoizedState,te.componentWillUnmount()}catch(Ie){dn(pe,Oe,Ie)}}break;case 5:Dd(U,U.return);break;case 22:if(U.memoizedState!==null){JR(d);continue}}W!==null?(W.return=U,Ae=W):JR(d)}w=w.sibling}if(Le){e:if(w=null,Le)for(d=c;;){if(d.tag===5){if(w===null){w=d;try{T=d.stateNode,g?Jf(T):$_(d.stateNode,d.memoizedProps)}catch(Ie){dn(c,c.return,Ie)}}}else if(d.tag===6){if(w===null)try{A=d.stateNode,g?F_(A):Wu(A,d.memoizedProps)}catch(Ie){dn(c,c.return,Ie)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===c)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===c)break e;for(;d.sibling===null;){if(d.return===null||d.return===c)break e;w===d&&(w=null),d=d.return}w===d&&(w=null),d.sibling.return=d.return,d=d.sibling}}}break;case 19:Bi(d,c),Aa(c),w&4&&qR(c);break;case 21:break;default:Bi(d,c),Aa(c)}}function Aa(c){var d=c.flags;if(d&2){try{if(Le){e:{for(var g=c.return;g!==null;){if(WR(g)){var w=g;break e}g=g.return}throw Error(a(160))}switch(w.tag){case 5:var T=w.stateNode;w.flags&32&&(D_(T),w.flags&=-33);var A=HR(c);XE(c,A,T);break;case 3:case 4:var U=w.stateNode.containerInfo,W=HR(c);JE(c,W,U);break;default:throw Error(a(161))}}}catch(te){dn(c,c.return,te)}c.flags&=-3}d&4096&&(c.flags&=-4097)}function DV(c,d,g){Ae=c,QR(c)}function QR(c,d,g){for(var w=(c.mode&1)!==0;Ae!==null;){var T=Ae,A=T.child;if(T.tag===22&&w){var U=T.memoizedState!==null||py;if(!U){var W=T.alternate,te=W!==null&&W.memoizedState!==null||Yr;W=py;var pe=Yr;if(py=U,(Yr=te)&&!pe)for(Ae=T;Ae!==null;)U=Ae,te=U.child,U.tag===22&&U.memoizedState!==null?XR(T):te!==null?(te.return=U,Ae=te):XR(T);for(;A!==null;)Ae=A,QR(A),A=A.sibling;Ae=T,py=W,Yr=pe}YR(c)}else T.subtreeFlags&8772&&A!==null?(A.return=T,Ae=A):YR(c)}}function YR(c){for(;Ae!==null;){var d=Ae;if(d.flags&8772){var g=d.alternate;try{if(d.flags&8772)switch(d.tag){case 0:case 11:case 15:Yr||my(5,d);break;case 1:var w=d.stateNode;if(d.flags&4&&!Yr)if(g===null)w.componentDidMount();else{var T=d.elementType===d.type?g.memoizedProps:Ui(d.type,g.memoizedProps);w.componentDidUpdate(T,g.memoizedState,w.__reactInternalSnapshotBeforeUpdate)}var A=d.updateQueue;A!==null&&ZA(d,A,w);break;case 3:var U=d.updateQueue;if(U!==null){if(g=null,d.child!==null)switch(d.child.tag){case 5:g=ue(d.child.stateNode);break;case 1:g=d.child.stateNode}ZA(d,U,g)}break;case 5:var W=d.stateNode;g===null&&d.flags&4&&_d(W,d.type,d.memoizedProps,d);break;case 6:break;case 4:break;case 12:break;case 13:if(ht&&d.memoizedState===null){var te=d.alternate;if(te!==null){var pe=te.memoizedState;if(pe!==null){var Oe=pe.dehydrated;Oe!==null&&sp(Oe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(a(163))}Yr||d.flags&512&&YE(d)}catch(st){dn(d,d.return,st)}}if(d===c){Ae=null;break}if(g=d.sibling,g!==null){g.return=d.return,Ae=g;break}Ae=d.return}}function JR(c){for(;Ae!==null;){var d=Ae;if(d===c){Ae=null;break}var g=d.sibling;if(g!==null){g.return=d.return,Ae=g;break}Ae=d.return}}function XR(c){for(;Ae!==null;){var d=Ae;try{switch(d.tag){case 0:case 11:case 15:var g=d.return;try{my(4,d)}catch(te){dn(d,g,te)}break;case 1:var w=d.stateNode;if(typeof w.componentDidMount=="function"){var T=d.return;try{w.componentDidMount()}catch(te){dn(d,T,te)}}var A=d.return;try{YE(d)}catch(te){dn(d,A,te)}break;case 5:var U=d.return;try{YE(d)}catch(te){dn(d,U,te)}}}catch(te){dn(d,d.return,te)}if(d===c){Ae=null;break}var W=d.sibling;if(W!==null){W.return=d.return,Ae=W;break}Ae=d.return}}var gy=0,_y=1,yy=2,vy=3,wy=4;if(typeof Symbol=="function"&&Symbol.for){var Ip=Symbol.for;gy=Ip("selector.component"),_y=Ip("selector.has_pseudo_class"),yy=Ip("selector.role"),vy=Ip("selector.test_id"),wy=Ip("selector.text")}function eS(c){var d=cn(c);if(d!=null){if(typeof d.memoizedProps["data-testname"]!="string")throw Error(a(364));return d}if(c=xs(c),c===null)throw Error(a(362));return c.stateNode.current}function tS(c,d){switch(d.$$typeof){case gy:if(c.type===d.value)return!0;break;case _y:e:{d=d.value,c=[c,0];for(var g=0;g<c.length;){var w=c[g++],T=c[g++],A=d[T];if(w.tag!==5||!$e(w)){for(;A!=null&&tS(w,A);)T++,A=d[T];if(T===d.length){d=!0;break e}else for(w=w.child;w!==null;)c.push(w,T),w=w.sibling}}d=!1}return d;case yy:if(c.tag===5&&Se(c.stateNode,d.value))return!0;break;case wy:if((c.tag===5||c.tag===6)&&(c=Pe(c),c!==null&&0<=c.indexOf(d.value)))return!0;break;case vy:if(c.tag===5&&(c=c.memoizedProps["data-testname"],typeof c=="string"&&c.toLowerCase()===d.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function nS(c){switch(c.$$typeof){case gy:return"<"+(P(c.value)||"Unknown")+">";case _y:return":has("+(nS(c)||"")+")";case yy:return'[role="'+c.value+'"]';case wy:return'"'+c.value+'"';case vy:return'[data-testname="'+c.value+'"]';default:throw Error(a(365))}}function ZR(c,d){var g=[];c=[c,0];for(var w=0;w<c.length;){var T=c[w++],A=c[w++],U=d[A];if(T.tag!==5||!$e(T)){for(;U!=null&&tS(T,U);)A++,U=d[A];if(A===d.length)g.push(T);else for(T=T.child;T!==null;)c.push(T,A),T=T.sibling}}return g}function rS(c,d){if(!we)throw Error(a(363));c=eS(c),c=ZR(c,d),d=[],c=Array.from(c);for(var g=0;g<c.length;){var w=c[g++];if(w.tag===5)$e(w)||d.push(w.stateNode);else for(w=w.child;w!==null;)c.push(w),w=w.sibling}return d}var FV=Math.ceil,by=o.ReactCurrentDispatcher,sS=o.ReactCurrentOwner,kn=o.ReactCurrentBatchConfig,ft=0,hr=null,Dn=null,Nr=0,Ks=0,Fd=Mi(0),Yn=0,xp=null,nc=0,Ey=0,iS=0,kp=null,Os=null,aS=0,oS=1/0,_o=null;function $d(){oS=Ln()+500}var Sy=!1,lS=null,fl=null,Ty=!1,pl=null,Cy=0,Pp=0,uS=null,Iy=-1,xy=0;function Jr(){return ft&6?Ln():Iy!==-1?Iy:Iy=Ln()}function ml(c){return c.mode&1?ft&2&&Nr!==0?Nr&-Nr:hs.transition!==null?(xy===0&&(xy=q_()),xy):(c=Tt,c!==0?c:Gn()):1}function yi(c,d,g,w){if(50<Pp)throw Pp=0,uS=null,Error(a(185));Ps(c,g,w),(!(ft&2)||c!==hr)&&(c===hr&&(!(ft&2)&&(Ey|=g),Yn===4&&gl(c,Nr)),Ls(c,w),g===1&&ft===0&&!(d.mode&1)&&($d(),kd&&us()))}function Ls(c,d){var g=c.callbackNode;SE(c,d);var w=Yu(c,c===hr?Nr:0);if(w===0)g!==null&&Q_(g),c.callbackNode=null,c.callbackPriority=0;else if(d=w&-w,c.callbackPriority!==d){if(g!=null&&Q_(g),d===1)c.tag===0?X_(t4.bind(null,c)):hp(t4.bind(null,c)),Ir?Is(function(){!(ft&6)&&us()}):up(cp,us),g=null;else{switch(uo(w)){case 1:g=cp;break;case 4:g=xd;break;case 16:g=ul;break;case 536870912:g=Y_;break;default:g=ul}g=c4(g,e4.bind(null,c))}c.callbackPriority=d,c.callbackNode=g}}function e4(c,d){if(Iy=-1,xy=0,ft&6)throw Error(a(327));var g=c.callbackNode;if(ic()&&c.callbackNode!==g)return null;var w=Yu(c,c===hr?Nr:0);if(w===0)return null;if(w&30||w&c.expiredLanes||d)d=ky(c,w);else{d=w;var T=ft;ft|=2;var A=s4();(hr!==c||Nr!==d)&&(_o=null,$d(),rc(c,d));do try{UV();break}catch(W){r4(c,W)}while(!0);wt(),by.current=A,ft=T,Dn!==null?d=0:(hr=null,Nr=0,d=Yn)}if(d!==0){if(d===2&&(T=lp(c),T!==0&&(w=T,d=cS(c,T))),d===1)throw g=xp,rc(c,0),gl(c,w),Ls(c,Ln()),g;if(d===6)gl(c,w);else{if(T=c.current.alternate,!(w&30)&&!$V(T)&&(d=ky(c,w),d===2&&(A=lp(c),A!==0&&(w=A,d=cS(c,A))),d===1))throw g=xp,rc(c,0),gl(c,w),Ls(c,Ln()),g;switch(c.finishedWork=T,c.finishedLanes=w,d){case 0:case 1:throw Error(a(345));case 2:sc(c,Os,_o);break;case 3:if(gl(c,w),(w&130023424)===w&&(d=aS+500-Ln(),10<d)){if(Yu(c,0)!==0)break;if(T=c.suspendedLanes,(T&w)!==w){Jr(),c.pingedLanes|=c.suspendedLanes&T;break}c.timeoutHandle=B(sc.bind(null,c,Os,_o),d);break}sc(c,Os,_o);break;case 4:if(gl(c,w),(w&4194240)===w)break;for(d=c.eventTimes,T=-1;0<w;){var U=31-Gr(w);A=1<<U,U=d[U],U>T&&(T=U),w&=~A}if(w=T,w=Ln()-w,w=(120>w?120:480>w?480:1080>w?1080:1920>w?1920:3e3>w?3e3:4320>w?4320:1960*FV(w/1960))-w,10<w){c.timeoutHandle=B(sc.bind(null,c,Os,_o),w);break}sc(c,Os,_o);break;case 5:sc(c,Os,_o);break;default:throw Error(a(329))}}}return Ls(c,Ln()),c.callbackNode===g?e4.bind(null,c):null}function cS(c,d){var g=kp;return c.current.memoizedState.isDehydrated&&(rc(c,d).flags|=256),c=ky(c,d),c!==2&&(d=Os,Os=g,d!==null&&dS(d)),c}function dS(c){Os===null?Os=c:Os.push.apply(Os,c)}function $V(c){for(var d=c;;){if(d.flags&16384){var g=d.updateQueue;if(g!==null&&(g=g.stores,g!==null))for(var w=0;w<g.length;w++){var T=g[w],A=T.getSnapshot;T=T.value;try{if(!kt(A(),T))return!1}catch{return!1}}}if(g=d.child,d.subtreeFlags&16384&&g!==null)g.return=d,d=g;else{if(d===c)break;for(;d.sibling===null;){if(d.return===null||d.return===c)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function gl(c,d){for(d&=~iS,d&=~Ey,c.suspendedLanes|=d,c.pingedLanes&=~d,c=c.expirationTimes;0<d;){var g=31-Gr(d),w=1<<g;c[g]=-1,d&=~w}}function t4(c){if(ft&6)throw Error(a(327));ic();var d=Yu(c,0);if(!(d&1))return Ls(c,Ln()),null;var g=ky(c,d);if(c.tag!==0&&g===2){var w=lp(c);w!==0&&(d=w,g=cS(c,w))}if(g===1)throw g=xp,rc(c,0),gl(c,d),Ls(c,Ln()),g;if(g===6)throw Error(a(345));return c.finishedWork=c.current.alternate,c.finishedLanes=d,sc(c,Os,_o),Ls(c,Ln()),null}function n4(c){pl!==null&&pl.tag===0&&!(ft&6)&&ic();var d=ft;ft|=1;var g=kn.transition,w=Tt;try{if(kn.transition=null,Tt=1,c)return c()}finally{Tt=w,kn.transition=g,ft=d,!(ft&6)&&us()}}function hS(){Ks=Fd.current,Qt(Fd)}function rc(c,d){c.finishedWork=null,c.finishedLanes=0;var g=c.timeoutHandle;if(g!==be&&(c.timeoutHandle=be,Z(g)),Dn!==null)for(g=Dn.return;g!==null;){var w=g;switch(ho(w),w.tag){case 1:w=w.type.childContextTypes,w!=null&&qu();break;case 3:Ld(),Qt(kr),Qt(qn),AE();break;case 5:kE(w);break;case 4:Ld();break;case 13:Qt(pn);break;case 19:Qt(pn);break;case 10:Mn(w.type._context);break;case 22:case 23:hS()}g=g.return}if(hr=c,Dn=c=_l(c.current,null),Nr=Ks=d,Yn=0,xp=null,iS=Ey=nc=0,Os=kp=null,ji!==null){for(d=0;d<ji.length;d++)if(g=ji[d],w=g.interleaved,w!==null){g.interleaved=null;var T=w.next,A=g.pending;if(A!==null){var U=A.next;A.next=T,w.next=U}g.pending=w}ji=null}return c}function r4(c,d){do{var g=Dn;try{if(wt(),sy.current=ly,iy){for(var w=mn.memoizedState;w!==null;){var T=w.queue;T!==null&&(T.pending=null),w=w.next}iy=!1}if(tc=0,dr=Qn=mn=null,yp=!1,vp=0,sS.current=null,g===null||g.return===null){Yn=1,xp=d,Dn=null;break}e:{var A=c,U=g.return,W=g,te=d;if(d=Nr,W.flags|=32768,te!==null&&typeof te=="object"&&typeof te.then=="function"){var pe=te,Oe=W,st=Oe.tag;if(!(Oe.mode&1)&&(st===0||st===11||st===15)){var Ie=Oe.alternate;Ie?(Oe.updateQueue=Ie.updateQueue,Oe.memoizedState=Ie.memoizedState,Oe.lanes=Ie.lanes):(Oe.updateQueue=null,Oe.memoizedState=null)}var on=kR(U);if(on!==null){on.flags&=-257,PR(on,U,W,A,d),on.mode&1&&xR(A,pe,d),d=on,te=pe;var en=d.updateQueue;if(en===null){var Ms=new Set;Ms.add(te),d.updateQueue=Ms}else en.add(te);break e}else{if(!(d&1)){xR(A,pe,d),fS();break e}te=Error(a(426))}}else if(Yt&&W.mode&1){var yo=kR(U);if(yo!==null){!(yo.flags&65536)&&(yo.flags|=256),PR(yo,U,W,A,d),cl(Md(te,W));break e}}A=te=Md(te,W),Yn!==4&&(Yn=2),kp===null?kp=[A]:kp.push(A),A=U;do{switch(A.tag){case 3:A.flags|=65536,d&=-d,A.lanes|=d;var X=CR(A,te,d);XA(A,X);break e;case 1:W=te;var q=A.type,re=A.stateNode;if(!(A.flags&128)&&(typeof q.getDerivedStateFromError=="function"||re!==null&&typeof re.componentDidCatch=="function"&&(fl===null||!fl.has(re)))){A.flags|=65536,d&=-d,A.lanes|=d;var xe=IR(A,W,d);XA(A,xe);break e}}A=A.return}while(A!==null)}a4(g)}catch(We){d=We,Dn===g&&g!==null&&(Dn=g=g.return);continue}break}while(!0)}function s4(){var c=by.current;return by.current=ly,c===null?ly:c}function fS(){(Yn===0||Yn===3||Yn===2)&&(Yn=4),hr===null||!(nc&268435455)&&!(Ey&268435455)||gl(hr,Nr)}function ky(c,d){var g=ft;ft|=2;var w=s4();(hr!==c||Nr!==d)&&(_o=null,rc(c,d));do try{jV();break}catch(T){r4(c,T)}while(!0);if(wt(),ft=g,by.current=w,Dn!==null)throw Error(a(261));return hr=null,Nr=0,Yn}function jV(){for(;Dn!==null;)i4(Dn)}function UV(){for(;Dn!==null&&!TE();)i4(Dn)}function i4(c){var d=u4(c.alternate,c,Ks);c.memoizedProps=c.pendingProps,d===null?a4(c):Dn=d,sS.current=null}function a4(c){var d=c;do{var g=d.alternate;if(c=d.return,d.flags&32768){if(g=OV(g,d),g!==null){g.flags&=32767,Dn=g;return}if(c!==null)c.flags|=32768,c.subtreeFlags=0,c.deletions=null;else{Yn=6,Dn=null;return}}else if(g=NV(g,d,Ks),g!==null){Dn=g;return}if(d=d.sibling,d!==null){Dn=d;return}Dn=d=c}while(d!==null);Yn===0&&(Yn=5)}function sc(c,d,g){var w=Tt,T=kn.transition;try{kn.transition=null,Tt=1,VV(c,d,g,w)}finally{kn.transition=T,Tt=w}return null}function VV(c,d,g,w){do ic();while(pl!==null);if(ft&6)throw Error(a(327));g=c.finishedWork;var T=c.finishedLanes;if(g===null)return null;if(c.finishedWork=null,c.finishedLanes=0,g===c.current)throw Error(a(177));c.callbackNode=null,c.callbackPriority=0;var A=g.lanes|g.childLanes;if(K_(c,A),c===hr&&(Dn=hr=null,Nr=0),!(g.subtreeFlags&2064)&&!(g.flags&2064)||Ty||(Ty=!0,c4(ul,function(){return ic(),null})),A=(g.flags&15990)!==0,g.subtreeFlags&15990||A){A=kn.transition,kn.transition=null;var U=Tt;Tt=1;var W=ft;ft|=4,sS.current=null,MV(c,g),KR(g,c),ee(c.containerInfo),c.current=g,DV(g),Ea(),ft=W,Tt=U,kn.transition=A}else c.current=g;if(Ty&&(Ty=!1,pl=c,Cy=T),A=c.pendingLanes,A===0&&(fl=null),J_(g.stateNode),Ls(c,Ln()),d!==null)for(w=c.onRecoverableError,g=0;g<d.length;g++)T=d[g],w(T.value,{componentStack:T.stack,digest:T.digest});if(Sy)throw Sy=!1,c=lS,lS=null,c;return Cy&1&&c.tag!==0&&ic(),A=c.pendingLanes,A&1?c===uS?Pp++:(Pp=0,uS=c):Pp=0,us(),null}function ic(){if(pl!==null){var c=uo(Cy),d=kn.transition,g=Tt;try{if(kn.transition=null,Tt=16>c?16:c,pl===null)var w=!1;else{if(c=pl,pl=null,Cy=0,ft&6)throw Error(a(331));var T=ft;for(ft|=4,Ae=c.current;Ae!==null;){var A=Ae,U=A.child;if(Ae.flags&16){var W=A.deletions;if(W!==null){for(var te=0;te<W.length;te++){var pe=W[te];for(Ae=pe;Ae!==null;){var Oe=Ae;switch(Oe.tag){case 0:case 11:case 15:Cp(8,Oe,A)}var st=Oe.child;if(st!==null)st.return=Oe,Ae=st;else for(;Ae!==null;){Oe=Ae;var Ie=Oe.sibling,on=Oe.return;if(GR(Oe),Oe===pe){Ae=null;break}if(Ie!==null){Ie.return=on,Ae=Ie;break}Ae=on}}}var en=A.alternate;if(en!==null){var Ms=en.child;if(Ms!==null){en.child=null;do{var yo=Ms.sibling;Ms.sibling=null,Ms=yo}while(Ms!==null)}}Ae=A}}if(A.subtreeFlags&2064&&U!==null)U.return=A,Ae=U;else e:for(;Ae!==null;){if(A=Ae,A.flags&2048)switch(A.tag){case 0:case 11:case 15:Cp(9,A,A.return)}var X=A.sibling;if(X!==null){X.return=A.return,Ae=X;break e}Ae=A.return}}var q=c.current;for(Ae=q;Ae!==null;){U=Ae;var re=U.child;if(U.subtreeFlags&2064&&re!==null)re.return=U,Ae=re;else e:for(U=q;Ae!==null;){if(W=Ae,W.flags&2048)try{switch(W.tag){case 0:case 11:case 15:my(9,W)}}catch(We){dn(W,W.return,We)}if(W===U){Ae=null;break e}var xe=W.sibling;if(xe!==null){xe.return=W.return,Ae=xe;break e}Ae=W.return}}if(ft=T,us(),Wr&&typeof Wr.onPostCommitFiberRoot=="function")try{Wr.onPostCommitFiberRoot(Sa,c)}catch{}w=!0}return w}finally{Tt=g,kn.transition=d}}return!1}function o4(c,d,g){d=Md(g,d),d=CR(c,d,1),c=hl(c,d,1),d=Jr(),c!==null&&(Ps(c,1,d),Ls(c,d))}function dn(c,d,g){if(c.tag===3)o4(c,c,g);else for(;d!==null;){if(d.tag===3){o4(d,c,g);break}else if(d.tag===1){var w=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(fl===null||!fl.has(w))){c=Md(g,c),c=IR(d,c,1),d=hl(d,c,1),c=Jr(),d!==null&&(Ps(d,1,c),Ls(d,c));break}}d=d.return}}function BV(c,d,g){var w=c.pingCache;w!==null&&w.delete(d),d=Jr(),c.pingedLanes|=c.suspendedLanes&g,hr===c&&(Nr&g)===g&&(Yn===4||Yn===3&&(Nr&130023424)===Nr&&500>Ln()-aS?rc(c,0):iS|=g),Ls(c,d)}function l4(c,d){d===0&&(c.mode&1?(d=ba,ba<<=1,!(ba&130023424)&&(ba=4194304)):d=1);var g=Jr();c=Ca(c,d),c!==null&&(Ps(c,d,g),Ls(c,g))}function zV(c){var d=c.memoizedState,g=0;d!==null&&(g=d.retryLane),l4(c,g)}function GV(c,d){var g=0;switch(c.tag){case 13:var w=c.stateNode,T=c.memoizedState;T!==null&&(g=T.retryLane);break;case 19:w=c.stateNode;break;default:throw Error(a(314))}w!==null&&w.delete(d),l4(c,g)}var u4;u4=function(c,d,g){if(c!==null)if(c.memoizedProps!==d.pendingProps||kr.current)Ns=!0;else{if(!(c.lanes&g)&&!(d.flags&128))return Ns=!1,RV(c,d,g);Ns=!!(c.flags&131072)}else Ns=!1,Yt&&d.flags&1048576&&Z_(d,Ad,d.index);switch(d.lanes=0,d.tag){case 2:var w=d.type;dy(c,d),c=d.pendingProps;var T=ll(d,qn.current);cr(d,g),T=OE(null,d,w,c,T,g);var A=LE();return d.flags|=1,typeof T=="object"&&T!==null&&typeof T.render=="function"&&T.$$typeof===void 0?(d.tag=1,d.memoizedState=null,d.updateQueue=null,Pr(w)?(A=!0,ks(d)):A=!1,d.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,IE(d),T.updater=uy,d.stateNode=T,T._reactInternals=d,UE(d,w,c,g),d=GE(null,d,w,!0,A,g)):(d.tag=0,Yt&&A&&Rd(d),fs(null,d,T,g),d=d.child),d;case 16:w=d.elementType;e:{switch(dy(c,d),c=d.pendingProps,T=w._init,w=T(w._payload),d.type=w,T=d.tag=HV(w),c=Ui(w,c),T){case 0:d=zE(null,d,w,c,g);break e;case 1:d=MR(null,d,w,c,g);break e;case 11:d=AR(null,d,w,c,g);break e;case 14:d=RR(null,d,w,Ui(w.type,c),g);break e}throw Error(a(306,w,""))}return d;case 0:return w=d.type,T=d.pendingProps,T=d.elementType===w?T:Ui(w,T),zE(c,d,w,T,g);case 1:return w=d.type,T=d.pendingProps,T=d.elementType===w?T:Ui(w,T),MR(c,d,w,T,g);case 3:e:{if(DR(d),c===null)throw Error(a(387));w=d.pendingProps,A=d.memoizedState,T=A.element,JA(c,d),ny(d,w,null,g);var U=d.memoizedState;if(w=U.element,ht&&A.isDehydrated)if(A={element:w,isDehydrated:!1,cache:U.cache,pendingSuspenseBoundaries:U.pendingSuspenseBoundaries,transitions:U.transitions},d.updateQueue.baseState=A,d.memoizedState=A,d.flags&256){T=Md(Error(a(423)),d),d=FR(c,d,w,g,T);break e}else if(w!==T){T=Md(Error(a(424)),d),d=FR(c,d,w,g,T);break e}else for(ht&&(ds=bd(d.stateNode.containerInfo),qr=d,Yt=!0,Rs=null,fo=!1),g=K(d,null,w,g),d.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling;else{if(po(),w===T){d=go(c,d,g);break e}fs(c,d,w,g)}d=d.child}return d;case 5:return eR(d),c===null&&$i(d),w=d.type,T=d.pendingProps,A=c!==null?c.memoizedProps:null,U=T.children,de(w,T)?U=null:A!==null&&de(w,A)&&(d.flags|=32),LR(c,d),fs(c,d,U,g),d.child;case 6:return c===null&&$i(d),null;case 13:return $R(c,d,g);case 4:return xE(d,d.stateNode.containerInfo),w=d.pendingProps,c===null?d.child=j(d,null,w,g):fs(c,d,w,g),d.child;case 11:return w=d.type,T=d.pendingProps,T=d.elementType===w?T:Ui(w,T),AR(c,d,w,T,g);case 7:return fs(c,d,d.pendingProps,g),d.child;case 8:return fs(c,d,d.pendingProps.children,g),d.child;case 12:return fs(c,d,d.pendingProps.children,g),d.child;case 10:e:{if(w=d.type._context,T=d.pendingProps,A=d.memoizedProps,U=T.value,Kn(d,w,U),A!==null)if(kt(A.value,U)){if(A.children===T.children&&!kr.current){d=go(c,d,g);break e}}else for(A=d.child,A!==null&&(A.return=d);A!==null;){var W=A.dependencies;if(W!==null){U=A.child;for(var te=W.firstContext;te!==null;){if(te.context===w){if(A.tag===1){te=mo(-1,g&-g),te.tag=2;var pe=A.updateQueue;if(pe!==null){pe=pe.shared;var Oe=pe.pending;Oe===null?te.next=te:(te.next=Oe.next,Oe.next=te),pe.pending=te}}A.lanes|=g,te=A.alternate,te!==null&&(te.lanes|=g),Ta(A.return,g,d),W.lanes|=g;break}te=te.next}}else if(A.tag===10)U=A.type===d.type?null:A.child;else if(A.tag===18){if(U=A.return,U===null)throw Error(a(341));U.lanes|=g,W=U.alternate,W!==null&&(W.lanes|=g),Ta(U,g,d),U=A.sibling}else U=A.child;if(U!==null)U.return=A;else for(U=A;U!==null;){if(U===d){U=null;break}if(A=U.sibling,A!==null){A.return=U.return,U=A;break}U=U.return}A=U}fs(c,d,T.children,g),d=d.child}return d;case 9:return T=d.type,w=d.pendingProps.children,cr(d,g),T=Ar(T),w=w(T),d.flags|=1,fs(c,d,w,g),d.child;case 14:return w=d.type,T=Ui(w,d.pendingProps),T=Ui(w.type,T),RR(c,d,w,T,g);case 15:return NR(c,d,d.type,d.pendingProps,g);case 17:return w=d.type,T=d.pendingProps,T=d.elementType===w?T:Ui(w,T),dy(c,d),d.tag=1,Pr(w)?(c=!0,ks(d)):c=!1,cr(d,g),SR(d,w,T),UE(d,w,T,g),GE(null,d,w,!0,c,g);case 19:return UR(c,d,g);case 22:return OR(c,d,g)}throw Error(a(156,d.tag))};function c4(c,d){return up(c,d)}function WV(c,d,g,w){this.tag=c,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vi(c,d,g,w){return new WV(c,d,g,w)}function pS(c){return c=c.prototype,!(!c||!c.isReactComponent)}function HV(c){if(typeof c=="function")return pS(c)?1:0;if(c!=null){if(c=c.$$typeof,c===b)return 11;if(c===C)return 14}return 2}function _l(c,d){var g=c.alternate;return g===null?(g=vi(c.tag,d,c.key,c.mode),g.elementType=c.elementType,g.type=c.type,g.stateNode=c.stateNode,g.alternate=c,c.alternate=g):(g.pendingProps=d,g.type=c.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=c.flags&14680064,g.childLanes=c.childLanes,g.lanes=c.lanes,g.child=c.child,g.memoizedProps=c.memoizedProps,g.memoizedState=c.memoizedState,g.updateQueue=c.updateQueue,d=c.dependencies,g.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},g.sibling=c.sibling,g.index=c.index,g.ref=c.ref,g}function Py(c,d,g,w,T,A){var U=2;if(w=c,typeof c=="function")pS(c)&&(U=1);else if(typeof c=="string")U=5;else e:switch(c){case h:return ac(g.children,T,A,d);case f:U=8,T|=8;break;case p:return c=vi(12,g,d,T|2),c.elementType=p,c.lanes=A,c;case S:return c=vi(13,g,d,T),c.elementType=S,c.lanes=A,c;case E:return c=vi(19,g,d,T),c.elementType=E,c.lanes=A,c;case I:return Ay(g,T,A,d);default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case y:U=10;break e;case _:U=9;break e;case b:U=11;break e;case C:U=14;break e;case v:U=16,w=null;break e}throw Error(a(130,c==null?c:typeof c,""))}return d=vi(U,g,d,T),d.elementType=c,d.type=w,d.lanes=A,d}function ac(c,d,g,w){return c=vi(7,c,w,d),c.lanes=g,c}function Ay(c,d,g,w){return c=vi(22,c,w,d),c.elementType=I,c.lanes=g,c.stateNode={isHidden:!1},c}function mS(c,d,g){return c=vi(6,c,null,d),c.lanes=g,c}function gS(c,d,g){return d=vi(4,c.children!==null?c.children:[],c.key,d),d.lanes=g,d.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},d}function qV(c,d,g,w,T){this.tag=d,this.containerInfo=c,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=be,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=lo(0),this.expirationTimes=lo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lo(0),this.identifierPrefix=w,this.onRecoverableError=T,ht&&(this.mutableSourceEagerHydrationData=null)}function d4(c,d,g,w,T,A,U,W,te){return c=new qV(c,d,g,W,te),d===1?(d=1,A===!0&&(d|=8)):d=0,A=vi(3,null,null,d),c.current=A,A.stateNode=c,A.memoizedState={element:w,isDehydrated:g,cache:null,transitions:null,pendingSuspenseBoundaries:null},IE(A),c}function h4(c){if(!c)return hi;c=c._reactInternals;e:{if(N(c)!==c||c.tag!==1)throw Error(a(170));var d=c;do{switch(d.tag){case 3:d=d.stateNode.context;break e;case 1:if(Pr(d.type)){d=d.stateNode.__reactInternalMemoizedMergedChildContext;break e}}d=d.return}while(d!==null);throw Error(a(171))}if(c.tag===1){var g=c.type;if(Pr(g))return va(c,g,d)}return d}function f4(c){var d=c._reactInternals;if(d===void 0)throw typeof c.render=="function"?Error(a(188)):(c=Object.keys(c).join(","),Error(a(268,c)));return c=F(d),c===null?null:c.stateNode}function p4(c,d){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var g=c.retryLane;c.retryLane=g!==0&&g<d?g:d}}function Ry(c,d){p4(c,d),(c=c.alternate)&&p4(c,d)}function KV(c){return c=F(c),c===null?null:c.stateNode}function QV(){return null}return t.attemptContinuousHydration=function(c){if(c.tag===13){var d=Ca(c,134217728);if(d!==null){var g=Jr();yi(d,c,134217728,g)}Ry(c,134217728)}},t.attemptDiscreteHydration=function(c){if(c.tag===13){var d=Ca(c,1);if(d!==null){var g=Jr();yi(d,c,1,g)}Ry(c,1)}},t.attemptHydrationAtCurrentPriority=function(c){if(c.tag===13){var d=ml(c),g=Ca(c,d);if(g!==null){var w=Jr();yi(g,c,d,w)}Ry(c,d)}},t.attemptSynchronousHydration=function(c){switch(c.tag){case 3:var d=c.stateNode;if(d.current.memoizedState.isDehydrated){var g=Qu(d.pendingLanes);g!==0&&(Id(d,g|1),Ls(d,Ln()),!(ft&6)&&($d(),us()))}break;case 13:n4(function(){var w=Ca(c,1);if(w!==null){var T=Jr();yi(w,c,1,T)}}),Ry(c,1)}},t.batchedUpdates=function(c,d){var g=ft;ft|=1;try{return c(d)}finally{ft=g,ft===0&&($d(),kd&&us())}},t.createComponentSelector=function(c){return{$$typeof:gy,value:c}},t.createContainer=function(c,d,g,w,T,A,U){return d4(c,d,!1,null,g,w,T,A,U)},t.createHasPseudoClassSelector=function(c){return{$$typeof:_y,value:c}},t.createHydrationContainer=function(c,d,g,w,T,A,U,W,te){return c=d4(g,w,!0,c,T,A,U,W,te),c.context=h4(null),g=c.current,w=Jr(),T=ml(g),A=mo(w,T),A.callback=d??null,hl(g,A,T),c.current.lanes=T,Ps(c,T,w),Ls(c,w),c},t.createPortal=function(c,d,g){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:w==null?null:""+w,children:c,containerInfo:d,implementation:g}},t.createRoleSelector=function(c){return{$$typeof:yy,value:c}},t.createTestNameSelector=function(c){return{$$typeof:vy,value:c}},t.createTextSelector=function(c){return{$$typeof:wy,value:c}},t.deferredUpdates=function(c){var d=Tt,g=kn.transition;try{return kn.transition=null,Tt=16,c()}finally{Tt=d,kn.transition=g}},t.discreteUpdates=function(c,d,g,w,T){var A=Tt,U=kn.transition;try{return kn.transition=null,Tt=1,c(d,g,w,T)}finally{Tt=A,kn.transition=U,ft===0&&$d()}},t.findAllNodes=rS,t.findBoundingRects=function(c,d){if(!we)throw Error(a(363));d=rS(c,d),c=[];for(var g=0;g<d.length;g++)c.push(Ge(d[g]));for(d=c.length-1;0<d;d--){g=c[d];for(var w=g.x,T=w+g.width,A=g.y,U=A+g.height,W=d-1;0<=W;W--)if(d!==W){var te=c[W],pe=te.x,Oe=pe+te.width,st=te.y,Ie=st+te.height;if(w>=pe&&A>=st&&T<=Oe&&U<=Ie){c.splice(d,1);break}else if(w!==pe||g.width!==te.width||Ie<A||st>U){if(!(A!==st||g.height!==te.height||Oe<w||pe>T)){pe>w&&(te.width+=pe-w,te.x=w),Oe<T&&(te.width=T-pe),c.splice(d,1);break}}else{st>A&&(te.height+=st-A,te.y=A),Ie<U&&(te.height=U-st),c.splice(d,1);break}}}return c},t.findHostInstance=f4,t.findHostInstanceWithNoPortals=function(c){return c=D(c),c=c!==null?H(c):null,c===null?null:c.stateNode},t.findHostInstanceWithWarning=function(c){return f4(c)},t.flushControlled=function(c){var d=ft;ft|=1;var g=kn.transition,w=Tt;try{kn.transition=null,Tt=1,c()}finally{Tt=w,kn.transition=g,ft=d,ft===0&&($d(),us())}},t.flushPassiveEffects=ic,t.flushSync=n4,t.focusWithin=function(c,d){if(!we)throw Error(a(363));for(c=eS(c),d=ZR(c,d),d=Array.from(d),c=0;c<d.length;){var g=d[c++];if(!$e(g)){if(g.tag===5&&fe(g.stateNode))return!0;for(g=g.child;g!==null;)d.push(g),g=g.sibling}}return!1},t.getCurrentUpdatePriority=function(){return Tt},t.getFindAllNodesFailureDescription=function(c,d){if(!we)throw Error(a(363));var g=0,w=[];c=[eS(c),0];for(var T=0;T<c.length;){var A=c[T++],U=c[T++],W=d[U];if((A.tag!==5||!$e(A))&&(tS(A,W)&&(w.push(nS(W)),U++,U>g&&(g=U)),U<d.length))for(A=A.child;A!==null;)c.push(A,U),A=A.sibling}if(g<d.length){for(c=[];g<d.length;g++)c.push(nS(d[g]));return`findAllNodes was able to match part of the selector:
  `+(w.join(" > ")+`

No matching component was found for:
  `)+c.join(" > ")}return null},t.getPublicRootInstance=function(c){if(c=c.current,!c.child)return null;switch(c.child.tag){case 5:return ue(c.child.stateNode);default:return c.child.stateNode}},t.injectIntoDevTools=function(c){if(c={bundleType:c.bundleType,version:c.version,rendererPackageName:c.rendererPackageName,rendererConfig:c.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:KV,findFiberByHostInstance:c.findFiberByHostInstance||QV,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")c=!1;else{var d=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(d.isDisabled||!d.supportsFiber)c=!0;else{try{Sa=d.inject(c),Wr=d}catch{}c=!!d.checkDCE}}return c},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(c,d,g,w){if(!we)throw Error(a(363));c=rS(c,d);var T=Ne(c,g,w).disconnect;return{disconnect:function(){T()}}},t.registerMutableSourceForHydration=function(c,d){var g=d._getVersion;g=g(d._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[d,g]:c.mutableSourceEagerHydrationData.push(d,g)},t.runWithPriority=function(c,d){var g=Tt;try{return Tt=c,d()}finally{Tt=g}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(c,d,g,w){var T=d.current,A=Jr(),U=ml(T);return g=h4(g),d.context===null?d.context=g:d.pendingContext=g,d=mo(A,U),d.payload={element:c},w=w===void 0?null:w,w!==null&&(d.callback=w),c=hl(T,d,U),c!==null&&(yi(c,T,U,A),ty(c,T,U)),U},t};YF.exports=Fse;var $se=YF.exports;const jse=Jc($se);var JF={exports:{}},md={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */md.ConcurrentRoot=1;md.ContinuousEventPriority=4;md.DefaultEventPriority=16;md.DiscreteEventPriority=1;md.IdleEventPriority=536870912;md.LegacyRoot=0;JF.exports=md;var XF=JF.exports;const t5={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let n5=!1,r5=!1;const WP=".react-konva-event",Use=`ReactKonva: You have a Konva node with draggable = true and position defined but no onDragMove or onDragEnd events are handled.
Position of a node will be changed during drag&drop, so you should update state of the react app as well.
Consider to add onDragMove or onDragEnd events.
For more info see: https://github.com/konvajs/react-konva/issues/256
`,Vse=`ReactKonva: You are using "zIndex" attribute for a Konva node.
react-konva may get confused with ordering. Just define correct order of elements in your render function of a component.
For more info see: https://github.com/konvajs/react-konva/issues/194
`,Bse={};function Ub(n,e,t=Bse){if(!n5&&"zIndex"in e&&(console.warn(Vse),n5=!0),!r5&&e.draggable){var r=e.x!==void 0||e.y!==void 0,s=e.onDragEnd||e.onDragMove;r&&!s&&(console.warn(Use),r5=!0)}for(var i in t)if(!t5[i]){var a=i.slice(0,2)==="on",o=t[i]!==e[i];if(a&&o){var l=i.substr(2).toLowerCase();l.substr(0,7)==="content"&&(l="content"+l.substr(7,1).toUpperCase()+l.substr(8)),n.off(l,t[i])}var u=!e.hasOwnProperty(i);u&&n.setAttr(i,void 0)}var h=e._useStrictMode,f={},p=!1;const y={};for(var i in e)if(!t5[i]){var a=i.slice(0,2)==="on",_=t[i]!==e[i];if(a&&_){var l=i.substr(2).toLowerCase();l.substr(0,7)==="content"&&(l="content"+l.substr(7,1).toUpperCase()+l.substr(8)),e[i]&&(y[l]=e[i])}!a&&(e[i]!==t[i]||h&&e[i]!==n.getAttr(i))&&(p=!0,f[i]=e[i])}p&&(n.setAttrs(f),Bu(n));for(var l in y)n.on(l+WP,y[l])}function Bu(n){if(!ct.Konva.autoDrawEnabled){var e=n.getLayer()||n.getStage();e&&e.batchDraw()}}const ZF={},zse={};Lg.Node.prototype._applyProps=Ub;function Gse(n,e){if(typeof e=="string"){console.error(`Do not use plain text as child of Konva.Node. You are using text: ${e}`);return}n.add(e),Bu(n)}function Wse(n,e,t){let r=Lg[n];r||(console.error(`Konva has no node with the type ${n}. Group will be used instead. If you use minimal version of react-konva, just import required nodes into Konva: "import "konva/lib/shapes/${n}"  If you want to render DOM elements as part of canvas tree take a look into this demo: https://konvajs.github.io/docs/react/DOM_Portal.html`),r=Lg.Group);const s={},i={};for(var a in e){var o=a.slice(0,2)==="on";o?i[a]=e[a]:s[a]=e[a]}const l=new r(s);return Ub(l,i),l}function Hse(n,e,t){console.error(`Text components are not supported for now in ReactKonva. Your text is: "${n}"`)}function qse(n,e,t){return!1}function Kse(n){return n}function Qse(){return null}function Yse(){return null}function Jse(n,e,t,r){return zse}function Xse(){}function Zse(n){}function eie(n,e){return!1}function tie(){return ZF}function nie(){return ZF}const rie=setTimeout,sie=clearTimeout,iie=-1;function aie(n,e){return!1}const oie=!1,lie=!0,uie=!0;function cie(n,e){e.parent===n?e.moveToTop():n.add(e),Bu(n)}function die(n,e){e.parent===n?e.moveToTop():n.add(e),Bu(n)}function e$(n,e,t){e._remove(),n.add(e),e.setZIndex(t.getZIndex()),Bu(n)}function hie(n,e,t){e$(n,e,t)}function fie(n,e){e.destroy(),e.off(WP),Bu(n)}function pie(n,e){e.destroy(),e.off(WP),Bu(n)}function mie(n,e,t){console.error(`Text components are not yet supported in ReactKonva. You text is: "${t}"`)}function gie(n,e,t){}function _ie(n,e,t,r,s){Ub(n,s,r)}function yie(n){n.hide(),Bu(n)}function vie(n){}function wie(n,e){(e.visible==null||e.visible)&&n.show()}function bie(n,e){}function Eie(n){}function Sie(){}const Tie=()=>XF.DefaultEventPriority,Cie=Object.freeze(Object.defineProperty({__proto__:null,appendChild:cie,appendChildToContainer:die,appendInitialChild:Gse,cancelTimeout:sie,clearContainer:Eie,commitMount:gie,commitTextUpdate:mie,commitUpdate:_ie,createInstance:Wse,createTextInstance:Hse,detachDeletedInstance:Sie,finalizeInitialChildren:qse,getChildHostContext:nie,getCurrentEventPriority:Tie,getPublicInstance:Kse,getRootHostContext:tie,hideInstance:yie,hideTextInstance:vie,idlePriority:gm.unstable_IdlePriority,insertBefore:e$,insertInContainerBefore:hie,isPrimaryRenderer:oie,noTimeout:iie,now:gm.unstable_now,prepareForCommit:Qse,preparePortalMount:Yse,prepareUpdate:Jse,removeChild:fie,removeChildFromContainer:pie,resetAfterCommit:Xse,resetTextContent:Zse,run:gm.unstable_runWithPriority,scheduleTimeout:rie,shouldDeprioritizeSubtree:eie,shouldSetTextContent:aie,supportsMutation:uie,unhideInstance:wie,unhideTextInstance:bie,warnsIfNotActing:lie},Symbol.toStringTag,{value:"Module"}));var Iie=Object.defineProperty,xie=Object.defineProperties,kie=Object.getOwnPropertyDescriptors,s5=Object.getOwnPropertySymbols,Pie=Object.prototype.hasOwnProperty,Aie=Object.prototype.propertyIsEnumerable,i5=(n,e,t)=>e in n?Iie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,a5=(n,e)=>{for(var t in e||(e={}))Pie.call(e,t)&&i5(n,t,e[t]);if(s5)for(var t of s5(e))Aie.call(e,t)&&i5(n,t,e[t]);return n},Rie=(n,e)=>xie(n,kie(e)),o5,l5;typeof window<"u"&&((o5=window.document)!=null&&o5.createElement||((l5=window.navigator)==null?void 0:l5.product)==="ReactNative")?Y.useLayoutEffect:Y.useEffect;function t$(n,e,t){if(!n)return;if(t(n)===!0)return n;let r=n.child;for(;r;){const s=t$(r,e,t);if(s)return s;r=r.sibling}}function n$(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const u5=console.error;console.error=function(){const n=[...arguments].join("");if(n!=null&&n.startsWith("Warning:")&&n.includes("useContext")){console.error=u5;return}return u5.apply(this,arguments)};const HP=n$(Y.createContext(null));class r$ extends Y.Component{render(){return Y.createElement(HP.Provider,{value:this._reactInternals},this.props.children)}}function Nie(){const n=Y.useContext(HP);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=Y.useId();return Y.useMemo(()=>{for(const r of[n,n==null?void 0:n.alternate]){if(!r)continue;const s=t$(r,!1,i=>{let a=i.memoizedState;for(;a;){if(a.memoizedState===e)return!0;a=a.next}});if(s)return s}},[n,e])}function Oie(){const n=Nie(),[e]=Y.useState(()=>new Map);e.clear();let t=n;for(;t;){if(t.type&&typeof t.type=="object"){const s=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;s&&s!==HP&&!e.has(s)&&e.set(s,Y.useContext(n$(s)))}t=t.return}return e}function Lie(){const n=Oie();return Y.useMemo(()=>Array.from(n.keys()).reduce((e,t)=>r=>Y.createElement(e,null,Y.createElement(t.Provider,Rie(a5({},r),{value:n.get(t)}))),e=>Y.createElement(r$,a5({},e))),[n])}function Mie(n){const e=It.useRef({});return It.useLayoutEffect(()=>{e.current=n}),It.useLayoutEffect(()=>()=>{e.current={}},[]),e.current}const Die=n=>{const e=It.useRef(null),t=It.useRef(null),r=It.useRef(null),s=Mie(n),i=Lie(),a=o=>{const{forwardedRef:l}=n;l&&(typeof l=="function"?l(o):l.current=o)};return It.useLayoutEffect(()=>(t.current=new Lg.Stage({width:n.width,height:n.height,container:e.current}),a(t.current),r.current=rm.createContainer(t.current,XF.LegacyRoot,!1,null),rm.updateContainer(It.createElement(i,{},n.children),r.current),()=>{Lg.isBrowser&&(a(null),rm.updateContainer(null,r.current,null),t.current.destroy())}),[]),It.useLayoutEffect(()=>{a(t.current),Ub(t.current,n,s),rm.updateContainer(It.createElement(i,{},n.children),r.current,null)}),It.createElement("div",{ref:e,id:n.id,accessKey:n.accessKey,className:n.className,role:n.role,style:n.style,tabIndex:n.tabIndex,title:n.title})},Mg="Layer",c5="Group",of="Rect",s$="Circle",eI="Line",i$="Text",Fie="Transformer",rm=jse(Cie);rm.injectIntoDevTools({findHostInstanceByFiber:()=>null,bundleType:0,version:It.version,rendererPackageName:"react-konva"});const $ie=It.forwardRef((n,e)=>It.createElement(r$,{},It.createElement(Die,{...n,forwardedRef:e}))),jie={},d5=n=>{let e;const t=new Set,r=(h,f)=>{const p=typeof h=="function"?h(e):h;if(!Object.is(p,e)){const y=e;e=f??(typeof p!="object"||p===null)?p:Object.assign({},e,p),t.forEach(_=>_(e,y))}},s=()=>e,l={setState:r,getState:s,getInitialState:()=>u,subscribe:h=>(t.add(h),()=>t.delete(h)),destroy:()=>{(jie?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},u=e=n(r,s,l);return l},Uie=n=>n?d5(n):d5;var a$={exports:{}},o$={},l$={exports:{}},u$={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lf=Y;function Vie(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Bie=typeof Object.is=="function"?Object.is:Vie,zie=lf.useState,Gie=lf.useEffect,Wie=lf.useLayoutEffect,Hie=lf.useDebugValue;function qie(n,e){var t=e(),r=zie({inst:{value:t,getSnapshot:e}}),s=r[0].inst,i=r[1];return Wie(function(){s.value=t,s.getSnapshot=e,_2(s)&&i({inst:s})},[n,t,e]),Gie(function(){return _2(s)&&i({inst:s}),n(function(){_2(s)&&i({inst:s})})},[n]),Hie(t),t}function _2(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Bie(n,t)}catch{return!0}}function Kie(n,e){return e()}var Qie=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Kie:qie;u$.useSyncExternalStore=lf.useSyncExternalStore!==void 0?lf.useSyncExternalStore:Qie;l$.exports=u$;var Yie=l$.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vb=Y,Jie=Yie;function Xie(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Zie=typeof Object.is=="function"?Object.is:Xie,eae=Jie.useSyncExternalStore,tae=Vb.useRef,nae=Vb.useEffect,rae=Vb.useMemo,sae=Vb.useDebugValue;o$.useSyncExternalStoreWithSelector=function(n,e,t,r,s){var i=tae(null);if(i.current===null){var a={hasValue:!1,value:null};i.current=a}else a=i.current;i=rae(function(){function l(y){if(!u){if(u=!0,h=y,y=r(y),s!==void 0&&a.hasValue){var _=a.value;if(s(_,y))return f=_}return f=y}if(_=f,Zie(h,y))return _;var b=r(y);return s!==void 0&&s(_,b)?(h=y,_):(h=y,f=b)}var u=!1,h,f,p=t===void 0?null:t;return[function(){return l(e())},p===null?void 0:function(){return l(p())}]},[e,t,r,s]);var o=eae(n,i[0],i[1]);return nae(function(){a.hasValue=!0,a.value=o},[o]),sae(o),o};a$.exports=o$;var iae=a$.exports;const aae=Jc(iae),c$={},{useDebugValue:oae}=It,{useSyncExternalStoreWithSelector:lae}=aae;let h5=!1;const uae=n=>n;function cae(n,e=uae,t){(c$?"production":void 0)!=="production"&&t&&!h5&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),h5=!0);const r=lae(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return oae(r),r}const f5=n=>{(c$?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof n=="function"?Uie(n):n,t=(r,s)=>cae(e,r,s);return Object.assign(t,e),t},d$=n=>n?f5(n):f5,y2=2e3,Gt=d$(n=>({shapes:[],optimisticUpdates:new Map,addShape:e=>n(t=>({shapes:[...t.shapes,e]})),updateShape:(e,t)=>n(r=>({shapes:r.shapes.map(s=>s.id===e?{...s,...t}:s)})),updateShapeOptimistic:(e,t)=>n(r=>{const s=new Map(r.optimisticUpdates);s.set(e,{timestamp:Date.now(),updates:t});const i=Date.now();for(const[a,o]of s.entries())i-o.timestamp>y2&&s.delete(a);return{shapes:r.shapes.map(a=>a.id===e?{...a,...t}:a),optimisticUpdates:s}}),batchUpdateShapesOptimistic:e=>n(t=>{const r=new Map(t.optimisticUpdates),s=Date.now(),i=new Map;e.forEach(({shapeId:o,updates:l})=>{i.set(o,l),r.set(o,{timestamp:s,updates:l})});for(const[o,l]of r.entries())s-l.timestamp>y2&&r.delete(o);return{shapes:t.shapes.map(o=>{const l=i.get(o.id);return l?{...o,...l}:o}),optimisticUpdates:r}}),deleteShape:e=>n(t=>({shapes:t.shapes.filter(r=>r.id!==e)})),setShapes:e=>n(t=>{const r=Date.now();return{shapes:e.map(i=>{const a=t.optimisticUpdates.get(i.id);return a&&r-a.timestamp<y2?{...i,...a.updates}:i})}})})),dae=n=>{const e=["#4477AA","#EE6677","#228833","#CCBB44","#66CCEE","#AA3377","#BBBBBB","#EE99AA","#009988","#997700","#6699CC","#994455"];let t=0;for(let r=0;r<n.length;r++)t=n.charCodeAt(r)+((t<<5)-t);return e[Math.abs(t)%e.length]},wu=d$(n=>({user:null,firebaseUser:null,isAuthenticated:!1,isLoading:!0,error:null,setUser:(e,t)=>n({user:e,firebaseUser:t,isAuthenticated:!!e,error:null}),setLoading:e=>n({isLoading:e}),setError:e=>n({error:e,isLoading:!1}),clearUser:()=>n({user:null,firebaseUser:null,isAuthenticated:!1,isLoading:!1})})),hae=n=>{var t;const e=n.displayName||((t=n.email)==null?void 0:t.split("@")[0])||"Anonymous User";return{uid:n.uid,displayName:e.length>20?e.substring(0,20):e,email:n.email||"",cursorColor:dae(n.uid)}},fae="modulepreload",pae=function(n){return"/"+n},p5={},Fm=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(t.map(l=>{if(l=pae(l),l in p5)return;p5[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":fae,u||(f.as="script"),f.crossOrigin="",f.href=l,o&&f.setAttribute("nonce",o),document.head.appendChild(f),u)return new Promise((p,y)=>{f.addEventListener("load",p),f.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})};class mae{constructor(){Ct(this,"frameCount",0);Ct(this,"lastTime",performance.now());Ct(this,"fps",0);Ct(this,"isRunning",!1);Ct(this,"animationId");Ct(this,"fpsHistory",[]);Ct(this,"maxHistorySize",60);Ct(this,"firestoreReads",0);Ct(this,"firestoreWrites",0);Ct(this,"rtdbUpdates",0);Ct(this,"lastFirebaseLogTime",performance.now());Ct(this,"animate",()=>{if(!this.isRunning)return;const e=performance.now();if(this.frameCount++,e-this.lastTime>=1e3){if(this.fps=Math.round(this.frameCount*1e3/(e-this.lastTime)),this.frameCount=0,this.lastTime=e,this.fpsHistory.push(this.fps),this.fpsHistory.length>this.maxHistorySize&&this.fpsHistory.shift(),this.updateTitle(),this.fps<30){console.warn(`⚠️ Low FPS detected: ${this.fps} fps`);const t=this.fpsHistory.slice(-5),r=t.reduce((s,i)=>s+i,0)/t.length;r<25&&console.warn(`🔴 Consistently low FPS: ${r.toFixed(1)} fps average`)}e-this.lastFirebaseLogTime>=5e3&&(this.logFirebaseStats(),this.lastFirebaseLogTime=e)}this.animationId=requestAnimationFrame(this.animate)})}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.frameCount=0,console.log("🚀 Performance monitoring started"),this.animate())}updateTitle(){}logFirebaseStats(){const e=(performance.now()-this.lastFirebaseLogTime)/1e3;console.log(`📊 Firebase Operations (last ${e.toFixed(1)}s):`,{"Firestore Reads":this.firestoreReads,"Firestore Writes":this.firestoreWrites,"Realtime DB Updates":this.rtdbUpdates,"Read Rate":`${(this.firestoreReads/e).toFixed(1)}/s`,"Write Rate":`${(this.firestoreWrites/e).toFixed(1)}/s`,"RTDB Rate":`${(this.rtdbUpdates/e).toFixed(1)}/s`}),this.detectRateLimiting(),Math.floor(performance.now()/15e3)!==Math.floor(this.lastFirebaseLogTime/15e3)&&this.logMemoryUsage(),this.firestoreReads=0,this.firestoreWrites=0,this.rtdbUpdates=0}logFirestoreRead(e,t=1){}logFirestoreWrite(e,t=1){}logRTDBUpdate(e){}getStats(){const e=this.fpsHistory.length>0?this.fpsHistory.reduce((t,r)=>t+r,0)/this.fpsHistory.length:this.fps;return{currentFps:this.fps,averageFps:Math.round(e*10)/10,minFps:this.fpsHistory.length>0?Math.min(...this.fpsHistory):this.fps,maxFps:this.fpsHistory.length>0?Math.max(...this.fpsHistory):this.fps,firestoreReads:this.firestoreReads,firestoreWrites:this.firestoreWrites,rtdbUpdates:this.rtdbUpdates,isHealthy:e>30,performanceGrade:this.getPerformanceGrade(e)}}getPerformanceGrade(e){return e>=50?"A":e>=40?"B":e>=30?"C":e>=20?"D":"F"}logMemoryUsage(){}detectRateLimiting(){const e=this.firestoreWrites/5,t=this.firestoreReads/5;e>5&&console.warn(`⚠️ High Firestore write rate: ${e.toFixed(1)}/s - Consider batching`),t>10&&console.warn(`⚠️ High Firestore read rate: ${t.toFixed(1)}/s - Check for polling`)}stop(){this.isRunning=!1,this.animationId&&cancelAnimationFrame(this.animationId),document.title="CollabCanvas",console.log("🛑 Performance monitoring stopped")}}const qP=new mae,gae=(n,e)=>qP.logFirestoreRead(n,e),KP=(n,e)=>qP.logFirestoreWrite(n,e),QP=n=>qP.logRTDBUpdate(n);class $f{static async withRetry(e,t={}){const r={...this.DEFAULT_RETRY_OPTIONS,...t};let s;for(let i=0;i<=r.maxRetries;i++)try{return await e()}catch(a){if(s=a,this.isNonRetryableError(a))throw a;if(i<r.maxRetries){const o=Math.min(r.initialDelayMs*Math.pow(r.backoffMultiplier,i),r.maxDelayMs);console.log(`Operation failed (attempt ${i+1}/${r.maxRetries+1}), retrying in ${o}ms...`),await this.delay(o)}}throw s}static isNonRetryableError(e){const t=e==null?void 0:e.code;return["auth/invalid-user-token","auth/user-disabled","permission-denied","invalid-argument"].includes(t)}static delay(e){return new Promise(t=>setTimeout(t,e))}}Ct($f,"DEFAULT_RETRY_OPTIONS",{maxRetries:3,initialDelayMs:1e3,maxDelayMs:1e4,backoffMultiplier:2});const h$=async n=>$f.withRetry(async()=>{QP("initializePresence"),console.log(`🟢 Initializing presence for ${n.displayName}`);const e=el(Mu,`/sessions/global-canvas-v1/${n.uid}`),t={userId:n.uid,displayName:n.displayName||"Anonymous",email:n.email||"",cursorColor:n.cursorColor,cursorX:300,cursorY:200,lastSeen:kP(),isOnline:!0,currentlyEditing:null};await K1(e,t),await dF(e).remove(),console.log(`✅ Presence initialized for ${n.displayName} with auto-cleanup`)},{maxRetries:3}),yw=async(n,e,t,r=null)=>{try{QP("updateCursorPosition");const s=el(Mu,`/sessions/global-canvas-v1/${n}`),i={cursorX:e,cursorY:t,lastSeen:kP(),isOnline:!0};r!==void 0&&(i.currentlyEditing=r),await hF(s,i)}catch(s){console.error("❌ Failed to update cursor position:",s)}},jf=async(n,e)=>{QP("updateCurrentlyEditing");try{const t=el(Mu,`/sessions/global-canvas-v1/${n}/currentlyEditing`);await K1(t,e),console.log(`📝 User ${n} now editing: ${e||"nothing"}`)}catch(t){console.error("❌ Failed to update currently editing:",t)}},f$=n=>{console.log("🔄 Subscribing to presence updates...");const e=el(Mu,"/sessions/global-canvas-v1"),t=y_(e,r=>{const s=r.val()||{};console.log("📡 Presence update received:",Object.keys(s).length,"users"),n(s)},r=>{console.error("❌ Presence subscription error:",r)});return()=>{console.log("🔄 Unsubscribing from presence updates"),t()}},_ae=async n=>$f.withRetry(async()=>{const{remove:e}=await Fm(async()=>{const{remove:r}=await Promise.resolve().then(()=>Aee);return{remove:r}},void 0),t=el(Mu,`/sessions/global-canvas-v1/${n}`);await e(t),console.log(`🔴 Presence removed for user: ${n}`)},{maxRetries:2}),yae=Object.freeze(Object.defineProperty({__proto__:null,cleanupPresence:_ae,initializePresence:h$,subscribeToPresence:f$,updateCurrentlyEditing:jf,updateCursorPosition:yw},Symbol.toStringTag,{value:"Module"})),vae=n=>{const e=Y.useRef(0),t=Y.useRef({x:300,y:200}),r=Y.useRef(null),s=Y.useRef(null),i=Y.useRef(!1);Y.useEffect(()=>{n&&!i.current&&(yw(n.uid,300,200),i.current=!0)},[n]);const a=Y.useCallback((l,u)=>{if(!n)return;const h=Date.now(),f=t.current;if(Math.sqrt(Math.pow(l-f.x,2)+Math.pow(u-f.y,2))<5&&h-e.current<1e3)return;r.current&&(clearTimeout(r.current),r.current=null),s.current&&(clearTimeout(s.current),s.current=null);const y=h-e.current;y>=50?(o(n,l,u),e.current=h,t.current={x:l,y:u}):r.current=setTimeout(()=>{o(n,l,u),e.current=Date.now(),t.current={x:l,y:u}},50-y),s.current=setTimeout(()=>{},2e3)},[n]),o=Y.useCallback((l,u,h)=>{yw(l.uid,u,h)},[]);return{updateCursor:a}},wae=(n,e)=>{if(!e.current)return null;const t=e.current,r=t.container();if(!r)return null;const s=r.getBoundingClientRect(),i=n.clientX-s.left,a=n.clientY-s.top,l=t.getAbsoluteTransform().copy().invert().point({x:i,y:a});return{x:Math.round(l.x),y:Math.round(l.y)}},bae=(n,e)=>{const t=Y.useRef({x:0,y:0,time:0}),r=Y.useCallback(u=>{u.evt.preventDefault(),u.evt.stopPropagation();const h=n.current;if(!h)return;e==null||e(!0);const{deltaX:f,deltaY:p,ctrlKey:y,metaKey:_}=u.evt,b=Math.abs(p)<50;y||_?s(u,h,p):b&&(Math.abs(f)>0||Math.abs(p)>0)?i(h,f,p):s(u,h,p),setTimeout(()=>e==null?void 0:e(!1),50)},[n,e]),s=Y.useCallback((u,h,f)=>{const p=h.getPointerPosition();if(!p)return;const y=h.scaleX(),_=1+Math.abs(f)*.02,b=f>0?y/_:y*_,S=Math.max(.01,Math.min(100,b)),E={x:(p.x-h.x())/y,y:(p.y-h.y())/y};h.scale({x:S,y:S});const C={x:p.x-E.x*S,y:p.y-E.y*S},v=a(C,h,S);h.position(v)},[]),i=Y.useCallback((u,h,f)=>{const p=u.position(),y=Date.now(),_={x:p.x-h,y:p.y-f},b=u.scaleX(),S=a(_,u,b);u.position(S),t.current={x:h,y:f,time:y}},[]),a=Y.useCallback((u,h,f)=>{const p=h.width(),y=h.height(),_=5e3*f,b=5e3*f,S=Math.min(p,y)*.1;return{x:Math.max(p-_-S,Math.min(S,u.x)),y:Math.max(y-b-S,Math.min(S,u.y))}},[]),o=Y.useCallback(u=>{},[]),l=Y.useCallback(u=>{u.evt.preventDefault()},[]);return{handleWheel:r,handleTouchStart:o,handleTouchMove:l}},Eae=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function $m(n){return typeof n=="string"&&Eae.test(n)}function Sae(n){if(!$m(n))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Or=[];for(var v2=0;v2<256;++v2)Or.push((v2+256).toString(16).slice(1));function p$(n,e=0){return(Or[n[e+0]]+Or[n[e+1]]+Or[n[e+2]]+Or[n[e+3]]+"-"+Or[n[e+4]]+Or[n[e+5]]+"-"+Or[n[e+6]]+Or[n[e+7]]+"-"+Or[n[e+8]]+Or[n[e+9]]+"-"+Or[n[e+10]]+Or[n[e+11]]+Or[n[e+12]]+Or[n[e+13]]+Or[n[e+14]]+Or[n[e+15]]).toLowerCase()}var o0,Tae=new Uint8Array(16);function Cae(){if(!o0&&(o0=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!o0))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o0(Tae)}function Iae(n){n=unescape(encodeURIComponent(n));for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}var xae="6ba7b810-9dad-11d1-80b4-00c04fd430c8",kae="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Pae(n,e,t){function r(s,i,a,o){var l;if(typeof s=="string"&&(s=Iae(s)),typeof i=="string"&&(i=Sae(i)),((l=i)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var u=new Uint8Array(16+s.length);if(u.set(i),u.set(s,i.length),u=t(u),u[6]=u[6]&15|e,u[8]=u[8]&63|128,a){o=o||0;for(var h=0;h<16;++h)a[o+h]=u[h];return a}return p$(u)}try{r.name=n}catch{}return r.DNS=xae,r.URL=kae,r}var Aae=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const m5={randomUUID:Aae};function rs(n,e,t){if(m5.randomUUID&&!n)return m5.randomUUID();n=n||{};var r=n.random||(n.rng||Cae)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,p$(r)}function Rae(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function w2(n,e){return n<<e|n>>>32-e}function Nae(n){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var r=unescape(encodeURIComponent(n));n=[];for(var s=0;s<r.length;++s)n.push(r.charCodeAt(s))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var i=n.length/4+2,a=Math.ceil(i/16),o=new Array(a),l=0;l<a;++l){for(var u=new Uint32Array(16),h=0;h<16;++h)u[h]=n[l*64+h*4]<<24|n[l*64+h*4+1]<<16|n[l*64+h*4+2]<<8|n[l*64+h*4+3];o[l]=u}o[a-1][14]=(n.length-1)*8/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=(n.length-1)*8&4294967295;for(var f=0;f<a;++f){for(var p=new Uint32Array(80),y=0;y<16;++y)p[y]=o[f][y];for(var _=16;_<80;++_)p[_]=w2(p[_-3]^p[_-8]^p[_-14]^p[_-16],1);for(var b=t[0],S=t[1],E=t[2],C=t[3],v=t[4],I=0;I<80;++I){var L=Math.floor(I/20),R=w2(b,5)+Rae(L,S,E,C)+v+e[L]+p[I]>>>0;v=C,C=E,E=w2(S,30)>>>0,S=b,b=R}t[0]=t[0]+b>>>0,t[1]=t[1]+S>>>0,t[2]=t[2]+E>>>0,t[3]=t[3]+C>>>0,t[4]=t[4]+v>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var g5=Pae("v5",80,Nae);const Bb="canvas/global-canvas-v1/shapes",zb=async(n,e,t,r,s,i)=>$f.withRetry(async()=>{KP("createShape");const a=rs(),o=rd(Cn,Bb),l={type:t,x:n,y:e,width:100,height:100,fill:r,text:"",textColor:"#000000",fontSize:14,createdBy:s,createdAt:mu(),lastModifiedBy:s,lastModifiedAt:mu(),isLocked:!1,lockedBy:null};return await fJ(eo(o,a),l),console.log(`🎯 Shape created by ${i}:`,a),a},{maxRetries:2}),Oae=(n,e)=>{try{const t=rd(Cn,Bb),r=A1(t,cJ("createdAt","asc"));return pJ(r,i=>{gae("subscribeToShapes",i.size);const a=[];i.forEach(o=>{o.exists()&&a.push({id:o.id,...o.data()})}),console.log(`🔄 Shapes synced: ${a.length} total`),n(a)},i=>{console.error("Error subscribing to shapes:",i),e==null||e(i)})}catch(t){throw console.error("Error setting up shapes subscription:",t),t}},ar=async(n,e,t)=>$f.withRetry(async()=>{KP("updateShape");const r=eo(Cn,Bb,n),s={...e,lastModifiedBy:t,lastModifiedAt:mu()};await ZD(r,s),console.log("📝 Shape updated:",n)},{maxRetries:2}),YP=async n=>$f.withRetry(async()=>{KP("deleteShape");const e=eo(Cn,Bb,n);await e7(e),console.log("🗑️ Shape deleted:",n)},{maxRetries:2}),Lae=()=>{const{setShapes:n}=Gt();Y.useEffect(()=>{console.log("🔄 Setting up shape sync...");const e=Oae(t=>{n(t),console.log(`📦 Loaded ${t.length} shapes from Firestore:`),t.forEach(r=>{console.log(`   Shape ${r.id}: (${r.x}, ${r.y}) locked: ${r.isLocked}`)})},t=>{console.error("❌ Shape sync error:",t)});return()=>{console.log("🔄 Cleaning up shape sync..."),e==null||e()}},[n])},bu="canvas/global-canvas-v1/shapes",b2=async(n,e,t,r)=>{try{const s=eo(Cn,bu,n);return await Hk(Cn,async a=>{const o=await a.get(s);if(!o.exists())throw new Error("Shape not found");const l=o.data();return l.isLocked&&l.lockedBy!==e?{success:!1,alreadyLocked:!0,lockedBy:l.lockedBy}:(a.update(s,{isLocked:!0,lockedBy:e,lockedByName:t,lockedByColor:r,lastModifiedBy:e,lastModifiedAt:mu()}),console.log(`🔒 Lock acquired by ${t} for shape:`,n),setTimeout(()=>{jf(e,n).catch(u=>{console.warn("Failed to update currently editing status:",u)})},0),{success:!0})})}catch(s){return console.error("Error acquiring lock:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}},Z0=async(n,e,t,r)=>{try{const s=eo(Cn,bu,n);return await Hk(Cn,async a=>{const o=await a.get(s);if(!o.exists())throw new Error("Shape not found");if(o.data().lockedBy!==e)return console.warn("Cannot release lock not owned by user"),{success:!1,error:"Lock not owned by user"};const u={isLocked:!1,lockedBy:null,lockedByName:null,lockedByColor:null,lastModifiedBy:e,lastModifiedAt:mu()};return a.update(s,u),console.log(`🔓 Lock released by ${t} for shape:`,n,r?`with position (${r.x}, ${r.y})`:"without position update"),setTimeout(()=>{jf(e,null).catch(h=>{console.warn("Failed to clear currently editing status:",h)})},0),{success:!0}})}catch(s){return console.error("Error releasing lock:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}},_5=async(n,e,t,r)=>{try{console.log(`🔒 Batch acquiring locks for ${n.length} shapes`);const s=t7(Cn),i=[],a=rd(Cn,bu),o=10,l=[];for(let h=0;h<n.length;h+=o)l.push(n.slice(h,h+o));let u=[];for(const h of l){const f=A1(a,Vk(BD(),"in",h));(await f_(f)).forEach(y=>{const _=y.data();!_.isLocked||_.lockedBy===e?u.push(y.id):i.push(y.id)})}return u.forEach(h=>{const f=eo(Cn,bu,h);s.update(f,{isLocked:!0,lockedBy:e,lockedByName:t,lockedByColor:r,lastModifiedBy:e,lastModifiedAt:mu()})}),await s.commit(),console.log(`🔒 Batch acquired ${u.length} locks, ${i.length} failed`),u.length>0&&setTimeout(()=>{jf(e,u[0]).catch(h=>{console.warn("Failed to update currently editing status:",h)})},0),{successCount:u.length,failedIds:i}}catch(s){return console.error("Error batch acquiring locks:",s),{successCount:0,failedIds:n}}},y5=async(n,e)=>{try{console.log(`🔓 Batch releasing locks for ${n.length} shapes`);const t=t7(Cn),r=[],s=rd(Cn,bu),i=10,a=[];for(let l=0;l<n.length;l+=i)a.push(n.slice(l,l+i));let o=[];for(const l of a){const u=A1(s,Vk(BD(),"in",l));(await f_(u)).forEach(f=>{f.data().lockedBy===e?o.push(f.id):r.push(f.id)})}return o.forEach(l=>{const u=eo(Cn,bu,l);t.update(u,{isLocked:!1,lockedBy:null,lockedByName:null,lockedByColor:null,lastModifiedBy:e,lastModifiedAt:mu()})}),await t.commit(),console.log(`🔓 Batch released ${o.length} locks, ${r.length} failed`),setTimeout(()=>{jf(e,null).catch(l=>{console.warn("Failed to clear currently editing status:",l)})},0),{successCount:o.length,failedIds:r}}catch(t){return console.error("Error batch releasing locks:",t),{successCount:0,failedIds:n}}},Mae=async n=>{try{console.log(`🧹 Force releasing all locks for user: ${n}`);const e=rd(Cn,bu),t=A1(e,Vk("lockedBy","==",n)),r=await f_(t),s=r.docs.map(async i=>{const a=eo(Cn,bu,i.id);return Hk(Cn,async o=>{const l=await o.get(a);l.exists()&&l.data().lockedBy===n&&(o.update(a,{isLocked:!1,lockedBy:null,lastModifiedAt:mu()}),console.log(`🔓 Force unlocked shape: ${i.id}`),jf(n,null).catch(u=>{console.warn("Failed to clear currently editing status on force unlock:",u)}))})});await Promise.all(s),console.log(`✅ Released ${r.docs.length} locks for user: ${n}`)}catch(e){console.error("Error force releasing user locks:",e)}},Dae=()=>{Y.useEffect(()=>{console.log("🔄 Starting presence monitoring for lock cleanup");const n=el(Mu,"/sessions/global-canvas-v1");let e=new Set;const r=y_(n,s=>{const i=s.val()||{},a=new Set(Object.keys(i));e.forEach(o=>{a.has(o)||(console.log(`👻 User disconnected: ${o}, cleaning up locks`),Mae(o).catch(l=>{console.error("Failed to cleanup locks for disconnected user:",l)}))}),e=a},s=>{console.error("❌ Presence monitoring error:",s)});return()=>{console.log("🔄 Stopping presence monitoring"),r()}},[])},Fae=({width:n,height:e,listening:t})=>{const s=[];for(let a=0;a<=n/50;a++){const o=a*50;s.push(V.jsx(eI,{points:[o,0,o,e],stroke:"#f0f0f0",strokeWidth:.5,listening:!1},`v-${a}`))}const i=[];for(let a=0;a<=e/50;a++){const o=a*50;i.push(V.jsx(eI,{points:[0,o,n,o],stroke:"#f0f0f0",strokeWidth:.5,listening:!1},`h-${a}`))}return V.jsxs(Mg,{listening:t,children:[V.jsx(of,{x:0,y:0,width:n,height:e,fill:"white",listening:!1}),s,i,V.jsx(of,{x:0,y:0,width:n,height:e,stroke:"#cccccc",strokeWidth:2,fill:"transparent",listening:!1})]})},$ae=(n,e)=>{const t=n.shape,r=e.shape;return t.id===r.id&&t.x===r.x&&t.y===r.y&&t.width===r.width&&t.height===r.height&&t.fill===r.fill&&t.type===r.type&&t.text===r.text&&t.textColor===r.textColor&&t.fontSize===r.fontSize&&t.isLocked===r.isLocked&&t.lockedBy===r.lockedBy&&t.lockedByColor===r.lockedByColor&&n.isSelected===e.isSelected},m$=It.memo(({shape:n,isSelected:e,onSelect:t,shapeRef:r})=>{const{shapes:s}=Gt(),{user:i}=wu(),a=n.isLocked&&n.lockedBy===(i==null?void 0:i.uid),o=n.isLocked&&n.lockedBy!==(i==null?void 0:i.uid),l=!o&&!!i,u=Y.useCallback(async C=>{var v;if(!o&&i){const I=((v=C.evt)==null?void 0:v.shiftKey)||!1;t(C);const{updateShapeOptimistic:L}=Gt.getState(),R=s.filter(P=>P.lockedBy===i.uid&&P.id!==n.id);if(I)a?(L(n.id,{isLocked:!1,lockedBy:null,lockedByName:null,lockedByColor:null}),Z0(n.id,i.uid,i.displayName)):(L(n.id,{isLocked:!0,lockedBy:i.uid,lockedByName:i.displayName,lockedByColor:i.cursorColor}),b2(n.id,i.uid,i.displayName,i.cursorColor));else{if(a&&R.length===0)return;R.forEach(P=>{L(P.id,{isLocked:!1,lockedBy:null,lockedByName:null,lockedByColor:null})}),L(n.id,{isLocked:!0,lockedBy:i.uid,lockedByName:i.displayName,lockedByColor:i.cursorColor}),R.length>0&&Promise.all(R.map(P=>Z0(P.id,i.uid,i.displayName))),a||b2(n.id,i.uid,i.displayName,i.cursorColor)}}},[n.id,a,o,i,s,t]),h=Y.useRef(new Map),f=Y.useCallback(C=>{p.current.clear();const{shapes:v}=Gt.getState(),I=v.filter(R=>R.lockedBy===(i==null?void 0:i.uid));if(I.length>1&&a){console.log("🚀 Multi-select drag starting with",I.length,"shapes"),h.current.clear();const R=C.target.getLayer();I.forEach(P=>{const x=R==null?void 0:R.findOne(`#${P.id}`);x&&h.current.set(P.id,{startX:x.x(),startY:x.y()})})}else if(h.current.clear(),t({evt:{shiftKey:!1}}),!a&&i){const{updateShapeOptimistic:R}=Gt.getState();I.forEach(P=>{P.id!==n.id&&(R(P.id,{isLocked:!1,lockedBy:null,lockedByName:null,lockedByColor:null}),Z0(P.id,i.uid,i.displayName))}),R(n.id,{isLocked:!0,lockedBy:i.uid,lockedByName:i.displayName,lockedByColor:i.cursorColor}),b2(n.id,i.uid,i.displayName,i.cursorColor)}},[n.id,a,i,t]),p=Y.useRef(new Map),y=Y.useCallback(C=>{if(i){const x=C.target.getStage().getRelativePointerPosition();x&&yw(i.uid,Math.round(x.x),Math.round(x.y))}if(h.current.size<=1)return;const v=h.current.get(n.id);if(!v)return;const I=C.target.x()-v.startX,L=C.target.y()-v.startY,R=C.target.getLayer();R&&(p.current.size===0&&h.current.forEach((P,x)=>{if(x!==n.id){const N=R.findOne(`#${x}`);N&&p.current.set(x,N)}}),h.current.forEach((P,x)=>{if(x!==n.id){const N=p.current.get(x);N&&(N.x(P.startX+I),N.y(P.startY+L))}}),R.batchDraw())},[n.id,i]),_=Y.useCallback(C=>{if(!i)return;p.current.clear();const{updateShapeOptimistic:v,shapes:I}=Gt.getState();if(h.current.size>1){console.log(`💾 Saving positions for ${h.current.size} shapes`);const L=C.target.getLayer();h.current.forEach((R,P)=>{const x=I.find(F=>F.id===P);if(!x)return;let N=p.current.get(P);if(!N&&L&&(N=L.findOne(`#${P}`)),!N)return;let M=Math.round(N.x()),D=Math.round(N.y());x.type==="circle"&&(M=M-x.width/2,D=D-x.height/2),v(P,{x:M,y:D}),ar(P,{x:M,y:D},i.uid)}),h.current.clear()}else{let L=Math.round(C.target.x()),R=Math.round(C.target.y());n.type==="circle"&&(L=L-n.width/2,R=R-n.height/2),v(n.id,{x:L,y:R}),ar(n.id,{x:L,y:R},i.uid)}},[n.id,n.type,n.width,n.height,i]),b=Y.useCallback(C=>{const v=r.current;if(!v||!i)return;const I=v.scaleX(),L=v.scaleY();let R=Math.max(20,Math.round(v.width()*I)),P=Math.max(20,Math.round(v.height()*L)),x=Math.round(v.x()),N=Math.round(v.y());if(v.scaleX(1),v.scaleY(1),n.type==="circle"&&(x=x-R/2,N=N-P/2),n.type==="circle"){const D=Math.min(R,P)/2;x=Math.max(-R/2+D,Math.min(5e3-R/2-D,x)),N=Math.max(-P/2+D,Math.min(5e3-P/2-D,N))}else x+R>5e3&&(R=5e3-x),N+P>5e3&&(P=5e3-N),x<0&&(R=R+x,x=0),N<0&&(P=P+N,N=0);const{updateShapeOptimistic:M}=Gt.getState();M(n.id,{x,y:N,width:R,height:P}),ar(n.id,{x,y:N,width:R,height:P},i.uid)},[n.id,n.type,i,r]),S=Y.useCallback(C=>{const{shapes:v}=Gt.getState(),I=v.find(H=>H.id===n.id);if(!I)return C;const L=Math.max(1,I.width),R=Math.max(1,I.height),P=1;let x=Math.round(C.x/P)*P,N=Math.round(C.y/P)*P;if(v.filter(H=>H.lockedBy===(i==null?void 0:i.uid)).length>1&&h.current.size>1){const H=h.current.get(n.id);if(!H)return{x,y:N};const G=x-H.startX,ue=N-H.startY;let ae=G,z=ue;return h.current.forEach((Q,ee)=>{const se=v.find(Ce=>Ce.id===ee);if(!se)return;const le=Q.startX+G,ye=Q.startY+ue;let ve,de,Me,B;const Z=Math.max(1,se.width),be=Math.max(1,se.height);if(se.type==="circle"){const Ce=Math.min(Z,be)/2;ve=Ce,de=Math.max(Ce,5e3-Ce),Me=Ce,B=Math.max(Ce,5e3-Ce)}else ve=0,de=Math.max(0,5e3-Z),Me=0,B=Math.max(0,5e3-be);if(le<ve){const Ce=ve-Q.startX;ae=Math.max(ae,Ce)}else if(le>de){const Ce=de-Q.startX;ae=Math.min(ae,Ce)}if(ye<Me){const Ce=Me-Q.startY;z=Math.max(z,Ce)}else if(ye>B){const Ce=B-Q.startY;z=Math.min(z,Ce)}}),{x:H.startX+ae,y:H.startY+z}}if(I.type==="circle"){const H=Math.min(L,R)/2,G=Math.max(H,5e3-H);return{x:Math.max(H,Math.min(G,x)),y:Math.max(H,Math.min(G,N))}}const F=Math.max(0,5e3-L),$=Math.max(0,5e3-R);return{x:Math.max(0,Math.min(F,x)),y:Math.max(0,Math.min($,N))}},[n.id,i]),E=()=>{const C=a?(i==null?void 0:i.cursorColor)||"#0066ff":o?n.lockedByColor||"#ff6b6b":"transparent",v=a||o?2:0,I={fill:n.fill,stroke:C,strokeWidth:v,strokeScaleEnabled:!1,draggable:l,dragBoundFunc:l?S:void 0,onClick:u,onDragStart:f,onDragMove:y,onDragEnd:_,onTransformEnd:b,ref:r.callback||r};return n.type==="circle"?V.jsx(s$,{id:n.id,x:n.x+n.width/2,y:n.y+n.height/2,radius:Math.min(n.width,n.height)/2,...I}):V.jsx(of,{id:n.id,x:n.x,y:n.y,width:n.width,height:n.height,...I})};return V.jsxs(V.Fragment,{children:[E(),n.text&&V.jsx(i$,{x:n.x,y:n.y+n.height/2-7,width:n.width,text:n.text,fontSize:n.fontSize,fill:n.textColor,align:"center",verticalAlign:"middle",listening:!1})]})},$ae);m$.displayName="SimpleShape";const jae=({listening:n,isDragSelectingRef:e})=>{const{shapes:t}=Gt(),{user:r}=wu(),[s,i]=Y.useState([]),[a,o]=Y.useState(!1),l=Y.useRef(null),u=Y.useRef({}),[h,f]=Y.useState({visible:!1,x1:0,y1:0,x2:0,y2:0}),p=Y.useRef(!1);Y.useEffect(()=>{const R=x=>{x.shiftKey&&!a&&o(!0)},P=x=>{!x.shiftKey&&a&&o(!1)};return window.addEventListener("keydown",R),window.addEventListener("keyup",P),window.addEventListener("blur",()=>o(!1)),()=>{window.removeEventListener("keydown",R),window.removeEventListener("keyup",P),window.removeEventListener("blur",()=>o(!1))}},[a]),Y.useEffect(()=>{const R=l.current;R&&R.keepRatio(a)},[a]);const y=Y.useRef(new Map);Y.useEffect(()=>{var P,x,N;const R=l.current;if(R)if(s.length>0){const M=new Map;s.forEach(F=>{const $=t.find(H=>H.id===F);$&&M.set(F,$.type)});let D=s.length!==y.current.size;if(!D){for(const[F,$]of M.entries())if(y.current.get(F)!==$){D=!0;break}}if(D){y.current=M;const F=R.getLayer(),$=s.map(H=>F==null?void 0:F.findOne(`#${H}`)).filter(H=>H!=null);$.length>0?(R.nodes($),(P=R.getLayer())==null||P.batchDraw()):(R.nodes([]),(x=R.getLayer())==null||x.batchDraw())}}else y.current.clear(),R.nodes([]),(N=R.getLayer())==null||N.batchDraw()},[s,t]);const _=Y.useMemo(()=>r?t.filter(R=>R.lockedBy===r.uid).map(R=>R.id):[],[t,r]);Y.useEffect(()=>{(_.length!==s.length||!_.every(R=>s.includes(R)))&&i(_)},[_,s]);const b=Y.useCallback(R=>{var $;if(!((($=R.evt)==null?void 0:$.shiftKey)||!1))return;const x=R.target.name&&R.target.name()==="background-rect",N=R.target.getType();if(!(N==="Stage"||N==="Layer"||x))return;const F=R.target.getStage().getRelativePointerPosition();F&&(p.current=!0,e&&(e.current=!0),f({visible:!0,x1:F.x,y1:F.y,x2:F.x,y2:F.y}))},[e]),S=Y.useRef(0),E=Y.useCallback(R=>{if(!p.current)return;const P=performance.now();if(P-S.current<16)return;S.current=P;const N=R.target.getStage().getRelativePointerPosition();N&&f(M=>({...M,x2:N.x,y2:N.y}))},[]),C=Y.useCallback(()=>{if(!p.current){e&&(e.current=!1);return}p.current=!1;const R={x:Math.min(h.x1,h.x2),y:Math.min(h.y1,h.y2),width:Math.abs(h.x2-h.x1),height:Math.abs(h.y2-h.y1)},P=[];if(t.forEach(x=>{const N={x:x.x,y:x.y,width:x.width,height:x.height};!(R.x>N.x+N.width||R.x+R.width<N.x||R.y>N.y+N.height||R.y+R.height<N.y)&&P.push(x.id)}),P.length>0&&r){const{batchUpdateShapesOptimistic:x}=Gt.getState(),N=t.filter(F=>F.lockedBy===r.uid&&!P.includes(F.id)),M=P.filter(F=>{const $=t.find(H=>H.id===F);return $&&(!$.isLocked||$.lockedBy===r.uid)}),D=[...N.map(F=>({shapeId:F.id,updates:{isLocked:!1,lockedBy:null,lockedByName:null,lockedByColor:null}})),...M.map(F=>({shapeId:F,updates:{isLocked:!0,lockedBy:r.uid,lockedByName:r.displayName,lockedByColor:r.cursorColor}}))];if(D.length>0&&x(D),N.length>0){const F=N.map($=>$.id);y5(F,r.uid).catch($=>{console.error("Batch release failed:",$)})}M.length>0&&_5(M,r.uid,r.displayName,r.cursorColor).catch(F=>{console.error("Batch lock failed:",F)}),i(P)}f(x=>({...x,visible:!1}))},[h,t,r]),v=Y.useCallback(R=>{if(e&&e.current)return;const P=R.target.name&&R.target.name()==="background-rect";if(R.target===R.target.getStage()||P){if(r&&s.length>0){const{batchUpdateShapesOptimistic:N}=Gt.getState(),M=s.map(D=>({shapeId:D,updates:{isLocked:!1,lockedBy:null,lockedByName:null,lockedByColor:null}}));N(M),y5(s,r.uid).catch(D=>{console.error("Batch release failed:",D)}),R.cancelBubble=!0,R.evt&&R.evt.stopPropagation()}i([])}},[r,s,e]),I=Y.useCallback((R,P)=>{i(P?x=>x.includes(R)?x.filter(N=>N!==R):[...x,R]:[R])},[]);Y.useEffect(()=>{const R=async P=>{if((P.metaKey||P.ctrlKey)&&P.key==="a"){if(P.preventDefault(),!r)return;const{batchUpdateShapesOptimistic:x}=Gt.getState(),N=t.filter(F=>!F.isLocked||F.lockedBy===r.uid);if(N.length===0)return;console.log(`⚡ Select All: Batching ${N.length} shape updates`);const M=N.map(F=>({shapeId:F.id,updates:{isLocked:!0,lockedBy:r.uid,lockedByName:r.displayName,lockedByColor:r.cursorColor}}));x(M);const D=N.map(F=>F.id);_5(D,r.uid,r.displayName,r.cursorColor).catch(F=>{console.error("Batch lock acquisition failed:",F)})}};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[t,r]);const L=Y.useMemo(()=>({x:Math.min(h.x1,h.x2),y:Math.min(h.y1,h.y2),width:Math.abs(h.x2-h.x1),height:Math.abs(h.y2-h.y1)}),[h]);return V.jsxs(Mg,{listening:n,onMouseDown:b,onMouseMove:E,onMouseUp:C,children:[V.jsx(of,{name:"background-rect",x:0,y:0,width:5e3,height:5e3,fill:"transparent",listening:n,onClick:v,onTap:v}),t.map(R=>{const P=x=>{x&&(u.current[R.id]=x)};return V.jsx(m$,{shape:R,isSelected:s.includes(R.id),onSelect:x=>{var N;return I(R.id,((N=x.evt)==null?void 0:N.shiftKey)||!1)},shapeRef:{current:null,callback:P}},R.id)}),h.visible&&V.jsx(of,{x:L.x,y:L.y,width:L.width,height:L.height,fill:"rgba(0, 102, 255, 0.1)",stroke:(r==null?void 0:r.cursorColor)||"#0066ff",strokeWidth:1,dash:[4,4],listening:!1}),V.jsx(Fie,{ref:l,flipEnabled:!1,boundBoxFunc:(R,P)=>Math.abs(P.width)<20||Math.abs(P.height)<20?R:P,enabledAnchors:["top-left","top-right","bottom-left","bottom-right","top-center","middle-right","bottom-center","middle-left"],keepRatio:!1,anchorSize:8,anchorStroke:(r==null?void 0:r.cursorColor)||"#0066ff",anchorFill:"white",anchorStrokeWidth:2,borderStroke:(r==null?void 0:r.cursorColor)||"#0066ff",borderStrokeWidth:3,borderEnabled:!0,ignoreStroke:!0,rotateEnabled:!1})]})},Uae=({listening:n})=>V.jsx(Mg,{listening:n}),Vae=()=>{const{user:n}=wu(),[e,t]=Y.useState({});Y.useEffect(()=>{if(!n)return;const s=el(Mu,"/sessions/global-canvas-v1"),i=y_(s,a=>{const o=a.val()||{},l={};Object.entries(o).forEach(([u,h])=>{h.isOnline&&h.cursorX!==void 0&&h.cursorY!==void 0&&(l[u]={x:h.cursorX,y:h.cursorY,name:h.displayName||"Anonymous",color:h.cursorColor||"#666"})}),t(l)},{onlyOnce:!1});return()=>i()},[n==null?void 0:n.uid]);const r=Object.entries(e);return r.length===0?V.jsx(Mg,{listening:!1}):V.jsx(Mg,{listening:!1,children:r.map(([s,i])=>V.jsx(Bae,{cursor:i,isCurrentUser:s===(n==null?void 0:n.uid)},s))})},Bae=({cursor:n,isCurrentUser:e=!1})=>{const{x:t,y:r,name:s,color:i}=n,a=[0,0,0,14,4,10,6,16,8,15,6,9,10,9];return V.jsxs(c5,{x:t,y:r,children:[e?V.jsx(eI,{points:a,fill:i,stroke:"white",strokeWidth:1,closed:!0}):V.jsx(s$,{radius:6,fill:i,stroke:"white",strokeWidth:2}),V.jsxs(c5,{x:e?16:12,y:-8,children:[V.jsx(of,{width:s.length*6+6,height:16,fill:i,cornerRadius:2}),V.jsx(i$,{text:s,fontSize:11,fontFamily:"Arial",fill:"white",x:3,y:2})]})]})};function Gb(){return(Gb=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n}).apply(this,arguments)}function g$(n,e){if(n==null)return{};var t,r,s={},i=Object.keys(n);for(r=0;r<i.length;r++)e.indexOf(t=i[r])>=0||(s[t]=n[t]);return s}function tI(n){var e=Y.useRef(n),t=Y.useRef(function(r){e.current&&e.current(r)});return e.current=n,t.current}var Dg=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),n>t?t:n<e?e:n},jm=function(n){return"touches"in n},nI=function(n){return n&&n.ownerDocument.defaultView||self},v5=function(n,e,t){var r=n.getBoundingClientRect(),s=jm(e)?function(i,a){for(var o=0;o<i.length;o++)if(i[o].identifier===a)return i[o];return i[0]}(e.touches,t):e;return{left:Dg((s.pageX-(r.left+nI(n).pageXOffset))/r.width),top:Dg((s.pageY-(r.top+nI(n).pageYOffset))/r.height)}},w5=function(n){!jm(n)&&n.preventDefault()},_$=It.memo(function(n){var e=n.onMove,t=n.onKey,r=g$(n,["onMove","onKey"]),s=Y.useRef(null),i=tI(e),a=tI(t),o=Y.useRef(null),l=Y.useRef(!1),u=Y.useMemo(function(){var y=function(S){w5(S),(jm(S)?S.touches.length>0:S.buttons>0)&&s.current?i(v5(s.current,S,o.current)):b(!1)},_=function(){return b(!1)};function b(S){var E=l.current,C=nI(s.current),v=S?C.addEventListener:C.removeEventListener;v(E?"touchmove":"mousemove",y),v(E?"touchend":"mouseup",_)}return[function(S){var E=S.nativeEvent,C=s.current;if(C&&(w5(E),!function(I,L){return L&&!jm(I)}(E,l.current)&&C)){if(jm(E)){l.current=!0;var v=E.changedTouches||[];v.length&&(o.current=v[0].identifier)}C.focus(),i(v5(C,E,o.current)),b(!0)}},function(S){var E=S.which||S.keyCode;E<37||E>40||(S.preventDefault(),a({left:E===39?.05:E===37?-.05:0,top:E===40?.05:E===38?-.05:0}))},b]},[a,i]),h=u[0],f=u[1],p=u[2];return Y.useEffect(function(){return p},[p]),It.createElement("div",Gb({},r,{onTouchStart:h,onMouseDown:h,className:"react-colorful__interactive",ref:s,onKeyDown:f,tabIndex:0,role:"slider"}))}),JP=function(n){return n.filter(Boolean).join(" ")},y$=function(n){var e=n.color,t=n.left,r=n.top,s=r===void 0?.5:r,i=JP(["react-colorful__pointer",n.className]);return It.createElement("div",{className:i,style:{top:100*s+"%",left:100*t+"%"}},It.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},$r=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*n)/t},zae=function(n){return Kae(rI(n))},rI=function(n){return n[0]==="#"&&(n=n.substring(1)),n.length<6?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:n.length===4?$r(parseInt(n[3]+n[3],16)/255,2):1}:{r:parseInt(n.substring(0,2),16),g:parseInt(n.substring(2,4),16),b:parseInt(n.substring(4,6),16),a:n.length===8?$r(parseInt(n.substring(6,8),16)/255,2):1}},Gae=function(n){return qae(Hae(n))},Wae=function(n){var e=n.s,t=n.v,r=n.a,s=(200-e)*t/100;return{h:$r(n.h),s:$r(s>0&&s<200?e*t/100/(s<=100?s:200-s)*100:0),l:$r(s/2),a:$r(r,2)}},sI=function(n){var e=Wae(n);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},Hae=function(n){var e=n.h,t=n.s,r=n.v,s=n.a;e=e/360*6,t/=100,r/=100;var i=Math.floor(e),a=r*(1-t),o=r*(1-(e-i)*t),l=r*(1-(1-e+i)*t),u=i%6;return{r:$r(255*[r,o,a,a,l,r][u]),g:$r(255*[l,r,r,o,a,a][u]),b:$r(255*[a,a,l,r,r,o][u]),a:$r(s,2)}},l0=function(n){var e=n.toString(16);return e.length<2?"0"+e:e},qae=function(n){var e=n.r,t=n.g,r=n.b,s=n.a,i=s<1?l0($r(255*s)):"";return"#"+l0(e)+l0(t)+l0(r)+i},Kae=function(n){var e=n.r,t=n.g,r=n.b,s=n.a,i=Math.max(e,t,r),a=i-Math.min(e,t,r),o=a?i===e?(t-r)/a:i===t?2+(r-e)/a:4+(e-t)/a:0;return{h:$r(60*(o<0?o+6:o)),s:$r(i?a/i*100:0),v:$r(i/255*100),a:s}},Qae=It.memo(function(n){var e=n.hue,t=n.onChange,r=JP(["react-colorful__hue",n.className]);return It.createElement("div",{className:r},It.createElement(_$,{onMove:function(s){t({h:360*s.left})},onKey:function(s){t({h:Dg(e+360*s.left,0,360)})},"aria-label":"Hue","aria-valuenow":$r(e),"aria-valuemax":"360","aria-valuemin":"0"},It.createElement(y$,{className:"react-colorful__hue-pointer",left:e/360,color:sI({h:e,s:100,v:100,a:1})})))}),Yae=It.memo(function(n){var e=n.hsva,t=n.onChange,r={backgroundColor:sI({h:e.h,s:100,v:100,a:1})};return It.createElement("div",{className:"react-colorful__saturation",style:r},It.createElement(_$,{onMove:function(s){t({s:100*s.left,v:100-100*s.top})},onKey:function(s){t({s:Dg(e.s+100*s.left,0,100),v:Dg(e.v-100*s.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+$r(e.s)+"%, Brightness "+$r(e.v)+"%"},It.createElement(y$,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:sI(e)})))}),v$=function(n,e){if(n===e)return!0;for(var t in n)if(n[t]!==e[t])return!1;return!0},Jae=function(n,e){return n.toLowerCase()===e.toLowerCase()||v$(rI(n),rI(e))};function Xae(n,e,t){var r=tI(t),s=Y.useState(function(){return n.toHsva(e)}),i=s[0],a=s[1],o=Y.useRef({color:e,hsva:i});Y.useEffect(function(){if(!n.equal(e,o.current.color)){var u=n.toHsva(e);o.current={hsva:u,color:e},a(u)}},[e,n]),Y.useEffect(function(){var u;v$(i,o.current.hsva)||n.equal(u=n.fromHsva(i),o.current.color)||(o.current={hsva:i,color:u},r(u))},[i,n,r]);var l=Y.useCallback(function(u){a(function(h){return Object.assign({},h,u)})},[]);return[i,l]}var Zae=typeof window<"u"?Y.useLayoutEffect:Y.useEffect,eoe=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},b5=new Map,toe=function(n){Zae(function(){var e=n.current?n.current.ownerDocument:document;if(e!==void 0&&!b5.has(e)){var t=e.createElement("style");t.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,b5.set(e,t);var r=eoe();r&&t.setAttribute("nonce",r),e.head.appendChild(t)}},[])},noe=function(n){var e=n.className,t=n.colorModel,r=n.color,s=r===void 0?t.defaultColor:r,i=n.onChange,a=g$(n,["className","colorModel","color","onChange"]),o=Y.useRef(null);toe(o);var l=Xae(t,s,i),u=l[0],h=l[1],f=JP(["react-colorful",e]);return It.createElement("div",Gb({},a,{ref:o,className:f}),It.createElement(Yae,{hsva:u,onChange:h}),It.createElement(Qae,{hue:u.h,onChange:h,className:"react-colorful__last-control"}))},roe={defaultColor:"000",toHsva:zae,fromHsva:function(n){return Gae({h:n.h,s:n.s,v:n.v,a:1})},equal:Jae},soe=function(n){return It.createElement(noe,Gb({},n,{colorModel:roe}))};const ioe=[{name:"Red",value:"#ef4444",shortcut:"1"},{name:"Green",value:"#22c55e",shortcut:"2"},{name:"Blue",value:"#3b82f6",shortcut:"3"},{name:"Grey",value:"#CCCCCC",shortcut:"4"}],aoe=({currentShapeType:n,onShapeTypeChange:e,currentColor:t,onColorChange:r,customColor:s,onCustomColorChange:i})=>{const[a,o]=Y.useState(!1),[l,u]=Y.useState(s),[h,f]=Y.useState(s),p=Y.useRef(null),y=E=>{E.preventDefault(),E.stopPropagation(),f(t),r(s),u(s),o(!0)},_=E=>{u(E),r(E)},b=E=>{E.preventDefault(),E.stopPropagation(),console.log("Custom color accepted:",l),i(l),r(l),o(!1)},S=E=>{E.preventDefault(),E.stopPropagation(),r(h),o(!1)};return It.useEffect(()=>{if(!a)return;const E=C=>{p.current&&!p.current.contains(C.target)&&o(!1)};return document.addEventListener("mousedown",E),()=>document.removeEventListener("mousedown",E)},[a]),V.jsxs("div",{className:"absolute top-4 left-4 z-10 bg-white rounded-lg shadow-lg border border-gray-200 p-3",children:[V.jsx("div",{className:"flex gap-2 mb-3",children:V.jsx("div",{className:"text-xs text-gray-500 font-medium mb-1 w-full",children:"Shape"})}),V.jsxs("div",{className:"flex gap-2 mb-4",children:[V.jsx("button",{onClick:()=>e("rectangle"),className:`
            w-12 h-12 rounded-lg border-2 flex items-center justify-center transition-all duration-200
            ${n==="rectangle"?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-300 bg-white text-gray-600 hover:border-gray-400 hover:bg-gray-50"}
          `,title:"Rectangle (R)",children:V.jsx("div",{className:"w-6 h-4 border-2 border-current rounded-sm"})}),V.jsx("button",{onClick:()=>e("circle"),className:`
            w-12 h-12 rounded-lg border-2 flex items-center justify-center transition-all duration-200
            ${n==="circle"?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-300 bg-white text-gray-600 hover:border-gray-400 hover:bg-gray-50"}
          `,title:"Circle (C)",children:V.jsx("div",{className:"w-6 h-6 border-2 border-current rounded-full"})})]}),V.jsxs("div",{className:"border-t border-gray-200 pt-3",children:[V.jsx("div",{className:"text-xs text-gray-500 font-medium mb-2",children:"Color"}),V.jsxs("div",{className:"flex gap-2",children:[ioe.map(E=>V.jsx("button",{onClick:()=>r(E.value),className:`
                w-8 h-8 rounded-lg border-2 transition-all duration-200 relative
                ${t===E.value?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"}
              `,style:{backgroundColor:E.value},title:`${E.name} (${E.shortcut})`,children:t===E.value&&V.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:V.jsx("svg",{className:"w-4 h-4 text-white drop-shadow-sm",fill:"currentColor",viewBox:"0 0 20 20",children:V.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})},E.value)),V.jsxs("div",{className:"relative",children:[V.jsx("button",{onClick:y,className:`
                w-8 h-8 rounded-lg border-2 transition-all duration-200 relative overflow-hidden
                ${t===s?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"}
              `,style:{backgroundColor:s},title:"Custom Color (5)",children:V.jsx("div",{className:"absolute bottom-0 right-0 p-0.5",children:V.jsx("svg",{className:"w-3 h-3 text-white drop-shadow-md",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})})})}),a&&V.jsxs("div",{ref:p,className:"absolute left-0 top-10 z-50 bg-white rounded-lg shadow-xl border border-gray-300 p-3",onClick:E=>E.stopPropagation(),children:[V.jsx(soe,{color:l,onChange:_}),V.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[V.jsx("div",{className:"w-8 h-8 rounded border-2 border-gray-300",style:{backgroundColor:l}}),V.jsx("input",{type:"text",value:l,onChange:E=>u(E.target.value),className:"flex-1 px-2 py-1 text-xs border border-gray-300 rounded font-mono uppercase",placeholder:"#000000"})]}),V.jsxs("div",{className:"mt-2 flex gap-2",children:[V.jsxs("button",{onClick:b,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded text-sm font-medium flex items-center justify-center gap-1",children:[V.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:V.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Apply"]}),V.jsx("button",{onClick:S,className:"px-3 py-1.5 border border-gray-300 hover:bg-gray-50 rounded text-sm text-gray-700",children:"Cancel"})]})]})]})]})]})]})};var Ft;(function(n){n.assertEqual=s=>{};function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return n.objectValues(a)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},n.find=(s,i)=>{for(const a of s)if(i(a))return a},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(Ft||(Ft={}));var E5;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(E5||(E5={}));const Fe=Ft.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pl=n=>{switch(typeof n){case"undefined":return Fe.undefined;case"string":return Fe.string;case"number":return Number.isNaN(n)?Fe.nan:Fe.number;case"boolean":return Fe.boolean;case"function":return Fe.function;case"bigint":return Fe.bigint;case"symbol":return Fe.symbol;case"object":return Array.isArray(n)?Fe.array:n===null?Fe.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?Fe.promise:typeof Map<"u"&&n instanceof Map?Fe.map:typeof Set<"u"&&n instanceof Set?Fe.set:typeof Date<"u"&&n instanceof Date?Fe.date:Fe.object;default:return Fe.unknown}},me=Ft.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Yo extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,l=0;for(;l<a.path.length;){const u=a.path[l];l===a.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(a))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return s(this),r}static assert(e){if(!(e instanceof Yo))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ft.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)if(s.path.length>0){const i=s.path[0];t[i]=t[i]||[],t[i].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Yo.create=n=>new Yo(n);const iI=(n,e)=>{let t;switch(n.code){case me.invalid_type:n.received===Fe.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case me.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,Ft.jsonStringifyReplacer)}`;break;case me.unrecognized_keys:t=`Unrecognized key(s) in object: ${Ft.joinValues(n.keys,", ")}`;break;case me.invalid_union:t="Invalid input";break;case me.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Ft.joinValues(n.options)}`;break;case me.invalid_enum_value:t=`Invalid enum value. Expected ${Ft.joinValues(n.options)}, received '${n.received}'`;break;case me.invalid_arguments:t="Invalid function arguments";break;case me.invalid_return_type:t="Invalid function return type";break;case me.invalid_date:t="Invalid date";break;case me.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:Ft.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case me.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="bigint"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case me.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case me.custom:t="Invalid input";break;case me.invalid_intersection_types:t="Intersection results could not be merged";break;case me.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case me.not_finite:t="Number must be finite";break;default:t=e.defaultError,Ft.assertNever(n)}return{message:t}};let ooe=iI;function loe(){return ooe}const uoe=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="";const l=r.filter(u=>!!u).slice().reverse();for(const u of l)o=u(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}};function ke(n,e){const t=loe(),r=uoe({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===iI?void 0:iI].filter(s=>!!s)});n.common.issues.push(r)}class oi{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return rt;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t){const i=await s.key,a=await s.value;r.push({key:i,value:a})}return oi.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return rt;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(r[i.value]=a.value)}return{status:e.value,value:r}}}const rt=Object.freeze({status:"aborted"}),sm=n=>({status:"dirty",value:n}),Oi=n=>({status:"valid",value:n}),S5=n=>n.status==="aborted",T5=n=>n.status==="dirty",uf=n=>n.status==="valid",vw=n=>typeof Promise<"u"&&n instanceof Promise;var je;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(je||(je={}));class Eu{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const C5=(n,e)=>{if(uf(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Yo(n.common.issues);return this._error=t,this._error}}};function gt(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{const{message:l}=n;return a.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:l??r??o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:l??t??o.defaultError}},description:s}}class Ot{get description(){return this._def.description}_getType(e){return Pl(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Pl(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new oi,ctx:{common:e.parent.common,data:e.data,parsedType:Pl(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(vw(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){const r={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pl(e)},s=this._parseSync({data:e,path:r.path,parent:r});return C5(r,s)}"~validate"(e){var r,s;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pl(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:t});return uf(i)?{value:i.value}:{issues:t.common.issues}}catch(i){(s=(r=i==null?void 0:i.message)==null?void 0:r.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(i=>uf(i)?{value:i.value}:{issues:t.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pl(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(vw(s)?s:Promise.resolve(s));return C5(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:me.custom,...r(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(l=>l?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new df({schema:this,typeName:ie.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return ou.create(this,this._def)}nullable(){return hf.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Qa.create(this)}promise(){return Sw.create(this,this._def)}or(e){return bw.create([this,e],this._def)}and(e){return Ew.create(this,e,this._def)}transform(e){return new df({...gt(this._def),schema:this,typeName:ie.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new lI({...gt(this._def),innerType:this,defaultValue:t,typeName:ie.ZodDefault})}brand(){return new Noe({typeName:ie.ZodBranded,type:this,...gt(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new uI({...gt(this._def),innerType:this,catchValue:t,typeName:ie.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return XP.create(this,e)}readonly(){return cI.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const coe=/^c[^\s-]{8,}$/i,doe=/^[0-9a-z]+$/,hoe=/^[0-9A-HJKMNP-TV-Z]{26}$/i,foe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,poe=/^[a-z0-9_-]{21}$/i,moe=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,goe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,_oe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,yoe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let E2;const voe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,woe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,boe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Eoe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Soe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Toe=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,w$="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Coe=new RegExp(`^${w$}$`);function b$(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);const t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Ioe(n){return new RegExp(`^${b$(n)}$`)}function xoe(n){let e=`${w$}T${b$(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function koe(n,e){return!!((e==="v4"||!e)&&voe.test(n)||(e==="v6"||!e)&&boe.test(n))}function Poe(n,e){if(!moe.test(n))return!1;try{const[t]=n.split(".");if(!t)return!1;const r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function Aoe(n,e){return!!((e==="v4"||!e)&&woe.test(n)||(e==="v6"||!e)&&Eoe.test(n))}class Bl extends Ot{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Fe.string){const i=this._getOrReturnCtx(e);return ke(i,{code:me.invalid_type,expected:Fe.string,received:i.parsedType}),rt}const r=new oi;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),ke(s,{code:me.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),ke(s,{code:me.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?ke(s,{code:me.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&ke(s,{code:me.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")_oe.test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"email",code:me.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")E2||(E2=new RegExp(yoe,"u")),E2.test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"emoji",code:me.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")foe.test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"uuid",code:me.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")poe.test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"nanoid",code:me.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")coe.test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"cuid",code:me.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")doe.test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"cuid2",code:me.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")hoe.test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"ulid",code:me.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),ke(s,{validation:"url",code:me.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"regex",code:me.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),ke(s,{code:me.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),ke(s,{code:me.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),ke(s,{code:me.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?xoe(i).test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{code:me.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?Coe.test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{code:me.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?Ioe(i).test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{code:me.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?goe.test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"duration",code:me.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?koe(e.data,i.version)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"ip",code:me.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?Poe(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"jwt",code:me.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?Aoe(e.data,i.version)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"cidr",code:me.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?Soe.test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"base64",code:me.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?Toe.test(e.data)||(s=this._getOrReturnCtx(e,s),ke(s,{validation:"base64url",code:me.invalid_string,message:i.message}),r.dirty()):Ft.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:me.invalid_string,...je.errToObj(r)})}_addCheck(e){return new Bl({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...je.errToObj(e)})}url(e){return this._addCheck({kind:"url",...je.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...je.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...je.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...je.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...je.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...je.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...je.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...je.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...je.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...je.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...je.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...je.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...je.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...je.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...je.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...je.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...je.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...je.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...je.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...je.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...je.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...je.errToObj(t)})}nonempty(e){return this.min(1,je.errToObj(e))}trim(){return new Bl({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Bl({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Bl({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Bl.create=n=>new Bl({checks:[],typeName:ie.ZodString,coerce:(n==null?void 0:n.coerce)??!1,...gt(n)});function Roe(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=Number.parseInt(n.toFixed(s).replace(".","")),a=Number.parseInt(e.toFixed(s).replace(".",""));return i%a/10**s}class Fg extends Ot{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Fe.number){const i=this._getOrReturnCtx(e);return ke(i,{code:me.invalid_type,expected:Fe.number,received:i.parsedType}),rt}let r;const s=new oi;for(const i of this._def.checks)i.kind==="int"?Ft.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),ke(r,{code:me.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),ke(r,{code:me.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),ke(r,{code:me.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?Roe(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),ke(r,{code:me.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),ke(r,{code:me.not_finite,message:i.message}),s.dirty()):Ft.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,je.toString(t))}gt(e,t){return this.setLimit("min",e,!1,je.toString(t))}lte(e,t){return this.setLimit("max",e,!0,je.toString(t))}lt(e,t){return this.setLimit("max",e,!1,je.toString(t))}setLimit(e,t,r,s){return new Fg({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:je.toString(s)}]})}_addCheck(e){return new Fg({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:je.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:je.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:je.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:je.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:je.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:je.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:je.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:je.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:je.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Ft.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Fg.create=n=>new Fg({checks:[],typeName:ie.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...gt(n)});class $g extends Ot{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Fe.bigint)return this._getInvalidInput(e);let r;const s=new oi;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),ke(r,{code:me.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),ke(r,{code:me.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),ke(r,{code:me.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):Ft.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return ke(t,{code:me.invalid_type,expected:Fe.bigint,received:t.parsedType}),rt}gte(e,t){return this.setLimit("min",e,!0,je.toString(t))}gt(e,t){return this.setLimit("min",e,!1,je.toString(t))}lte(e,t){return this.setLimit("max",e,!0,je.toString(t))}lt(e,t){return this.setLimit("max",e,!1,je.toString(t))}setLimit(e,t,r,s){return new $g({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:je.toString(s)}]})}_addCheck(e){return new $g({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:je.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:je.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:je.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:je.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:je.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}$g.create=n=>new $g({checks:[],typeName:ie.ZodBigInt,coerce:(n==null?void 0:n.coerce)??!1,...gt(n)});class I5 extends Ot{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Fe.boolean){const r=this._getOrReturnCtx(e);return ke(r,{code:me.invalid_type,expected:Fe.boolean,received:r.parsedType}),rt}return Oi(e.data)}}I5.create=n=>new I5({typeName:ie.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...gt(n)});class ww extends Ot{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Fe.date){const i=this._getOrReturnCtx(e);return ke(i,{code:me.invalid_type,expected:Fe.date,received:i.parsedType}),rt}if(Number.isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return ke(i,{code:me.invalid_date}),rt}const r=new oi;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),ke(s,{code:me.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),ke(s,{code:me.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):Ft.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ww({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:je.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:je.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}ww.create=n=>new ww({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:ie.ZodDate,...gt(n)});class x5 extends Ot{_parse(e){if(this._getType(e)!==Fe.symbol){const r=this._getOrReturnCtx(e);return ke(r,{code:me.invalid_type,expected:Fe.symbol,received:r.parsedType}),rt}return Oi(e.data)}}x5.create=n=>new x5({typeName:ie.ZodSymbol,...gt(n)});class k5 extends Ot{_parse(e){if(this._getType(e)!==Fe.undefined){const r=this._getOrReturnCtx(e);return ke(r,{code:me.invalid_type,expected:Fe.undefined,received:r.parsedType}),rt}return Oi(e.data)}}k5.create=n=>new k5({typeName:ie.ZodUndefined,...gt(n)});class P5 extends Ot{_parse(e){if(this._getType(e)!==Fe.null){const r=this._getOrReturnCtx(e);return ke(r,{code:me.invalid_type,expected:Fe.null,received:r.parsedType}),rt}return Oi(e.data)}}P5.create=n=>new P5({typeName:ie.ZodNull,...gt(n)});class aI extends Ot{constructor(){super(...arguments),this._any=!0}_parse(e){return Oi(e.data)}}aI.create=n=>new aI({typeName:ie.ZodAny,...gt(n)});class A5 extends Ot{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Oi(e.data)}}A5.create=n=>new A5({typeName:ie.ZodUnknown,...gt(n)});class Su extends Ot{_parse(e){const t=this._getOrReturnCtx(e);return ke(t,{code:me.invalid_type,expected:Fe.never,received:t.parsedType}),rt}}Su.create=n=>new Su({typeName:ie.ZodNever,...gt(n)});class R5 extends Ot{_parse(e){if(this._getType(e)!==Fe.undefined){const r=this._getOrReturnCtx(e);return ke(r,{code:me.invalid_type,expected:Fe.void,received:r.parsedType}),rt}return Oi(e.data)}}R5.create=n=>new R5({typeName:ie.ZodVoid,...gt(n)});class Qa extends Ot{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==Fe.array)return ke(t,{code:me.invalid_type,expected:Fe.array,received:t.parsedType}),rt;if(s.exactLength!==null){const a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(ke(t,{code:a?me.too_big:me.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(ke(t,{code:me.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(ke(t,{code:me.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new Eu(t,a,t.path,o)))).then(a=>oi.mergeArray(r,a));const i=[...t.data].map((a,o)=>s.type._parseSync(new Eu(t,a,t.path,o)));return oi.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new Qa({...this._def,minLength:{value:e,message:je.toString(t)}})}max(e,t){return new Qa({...this._def,maxLength:{value:e,message:je.toString(t)}})}length(e,t){return new Qa({...this._def,exactLength:{value:e,message:je.toString(t)}})}nonempty(e){return this.min(1,e)}}Qa.create=(n,e)=>new Qa({type:n,minLength:null,maxLength:null,exactLength:null,typeName:ie.ZodArray,...gt(e)});function eh(n){if(n instanceof $n){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=ou.create(eh(r))}return new $n({...n._def,shape:()=>e})}else return n instanceof Qa?new Qa({...n._def,type:eh(n.element)}):n instanceof ou?ou.create(eh(n.unwrap())):n instanceof hf?hf.create(eh(n.unwrap())):n instanceof Hc?Hc.create(n.items.map(e=>eh(e))):n}class $n extends Ot{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Ft.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Fe.object){const u=this._getOrReturnCtx(e);return ke(u,{code:me.invalid_type,expected:Fe.object,received:u.parsedType}),rt}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Su&&this._def.unknownKeys==="strip"))for(const u in s.data)a.includes(u)||o.push(u);const l=[];for(const u of a){const h=i[u],f=s.data[u];l.push({key:{status:"valid",value:u},value:h._parse(new Eu(s,f,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Su){const u=this._def.unknownKeys;if(u==="passthrough")for(const h of o)l.push({key:{status:"valid",value:h},value:{status:"valid",value:s.data[h]}});else if(u==="strict")o.length>0&&(ke(s,{code:me.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const h of o){const f=s.data[h];l.push({key:{status:"valid",value:h},value:u._parse(new Eu(s,f,s.path,h)),alwaysSet:h in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const u=[];for(const h of l){const f=await h.key,p=await h.value;u.push({key:f,value:p,alwaysSet:h.alwaysSet})}return u}).then(u=>oi.mergeObjectSync(r,u)):oi.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return je.errToObj,new $n({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var i,a;const s=((a=(i=this._def).errorMap)==null?void 0:a.call(i,t,r).message)??r.defaultError;return t.code==="unrecognized_keys"?{message:je.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new $n({...this._def,unknownKeys:"strip"})}passthrough(){return new $n({...this._def,unknownKeys:"passthrough"})}extend(e){return new $n({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new $n({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ie.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new $n({...this._def,catchall:e})}pick(e){const t={};for(const r of Ft.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new $n({...this._def,shape:()=>t})}omit(e){const t={};for(const r of Ft.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new $n({...this._def,shape:()=>t})}deepPartial(){return eh(this)}partial(e){const t={};for(const r of Ft.objectKeys(this.shape)){const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}return new $n({...this._def,shape:()=>t})}required(e){const t={};for(const r of Ft.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof ou;)i=i._def.innerType;t[r]=i}return new $n({...this._def,shape:()=>t})}keyof(){return E$(Ft.objectKeys(this.shape))}}$n.create=(n,e)=>new $n({shape:()=>n,unknownKeys:"strip",catchall:Su.create(),typeName:ie.ZodObject,...gt(e)});$n.strictCreate=(n,e)=>new $n({shape:()=>n,unknownKeys:"strict",catchall:Su.create(),typeName:ie.ZodObject,...gt(e)});$n.lazycreate=(n,e)=>new $n({shape:n,unknownKeys:"strip",catchall:Su.create(),typeName:ie.ZodObject,...gt(e)});class bw extends Ot{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new Yo(o.ctx.common.issues));return ke(t,{code:me.invalid_union,unionErrors:a}),rt}if(t.common.async)return Promise.all(r.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const l of r){const u={...t,common:{...t.common,issues:[]},parent:null},h=l._parseSync({data:t.data,path:t.path,parent:u});if(h.status==="valid")return h;h.status==="dirty"&&!i&&(i={result:h,ctx:u}),u.common.issues.length&&a.push(u.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(l=>new Yo(l));return ke(t,{code:me.invalid_union,unionErrors:o}),rt}}get options(){return this._def.options}}bw.create=(n,e)=>new bw({options:n,typeName:ie.ZodUnion,...gt(e)});function oI(n,e){const t=Pl(n),r=Pl(e);if(n===e)return{valid:!0,data:n};if(t===Fe.object&&r===Fe.object){const s=Ft.objectKeys(e),i=Ft.objectKeys(n).filter(o=>s.indexOf(o)!==-1),a={...n,...e};for(const o of i){const l=oI(n[o],e[o]);if(!l.valid)return{valid:!1};a[o]=l.data}return{valid:!0,data:a}}else if(t===Fe.array&&r===Fe.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const a=n[i],o=e[i],l=oI(a,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===Fe.date&&r===Fe.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class Ew extends Ot{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,a)=>{if(S5(i)||S5(a))return rt;const o=oI(i.value,a.value);return o.valid?((T5(i)||T5(a))&&t.dirty(),{status:t.value,value:o.data}):(ke(r,{code:me.invalid_intersection_types}),rt)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Ew.create=(n,e,t)=>new Ew({left:n,right:e,typeName:ie.ZodIntersection,...gt(t)});class Hc extends Ot{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Fe.array)return ke(r,{code:me.invalid_type,expected:Fe.array,received:r.parsedType}),rt;if(r.data.length<this._def.items.length)return ke(r,{code:me.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),rt;!this._def.rest&&r.data.length>this._def.items.length&&(ke(r,{code:me.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((a,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new Eu(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(i).then(a=>oi.mergeArray(t,a)):oi.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new Hc({...this._def,rest:e})}}Hc.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Hc({items:n,typeName:ie.ZodTuple,rest:null,...gt(e)})};class N5 extends Ot{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Fe.map)return ke(r,{code:me.invalid_type,expected:Fe.map,received:r.parsedType}),rt;const s=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([o,l],u)=>({key:s._parse(new Eu(r,o,r.path,[u,"key"])),value:i._parse(new Eu(r,l,r.path,[u,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of a){const u=await l.key,h=await l.value;if(u.status==="aborted"||h.status==="aborted")return rt;(u.status==="dirty"||h.status==="dirty")&&t.dirty(),o.set(u.value,h.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const l of a){const u=l.key,h=l.value;if(u.status==="aborted"||h.status==="aborted")return rt;(u.status==="dirty"||h.status==="dirty")&&t.dirty(),o.set(u.value,h.value)}return{status:t.value,value:o}}}}N5.create=(n,e,t)=>new N5({valueType:e,keyType:n,typeName:ie.ZodMap,...gt(t)});class jg extends Ot{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Fe.set)return ke(r,{code:me.invalid_type,expected:Fe.set,received:r.parsedType}),rt;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(ke(r,{code:me.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(ke(r,{code:me.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function a(l){const u=new Set;for(const h of l){if(h.status==="aborted")return rt;h.status==="dirty"&&t.dirty(),u.add(h.value)}return{status:t.value,value:u}}const o=[...r.data.values()].map((l,u)=>i._parse(new Eu(r,l,r.path,u)));return r.common.async?Promise.all(o).then(l=>a(l)):a(o)}min(e,t){return new jg({...this._def,minSize:{value:e,message:je.toString(t)}})}max(e,t){return new jg({...this._def,maxSize:{value:e,message:je.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}jg.create=(n,e)=>new jg({valueType:n,minSize:null,maxSize:null,typeName:ie.ZodSet,...gt(e)});class O5 extends Ot{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}O5.create=(n,e)=>new O5({getter:n,typeName:ie.ZodLazy,...gt(e)});class L5 extends Ot{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return ke(t,{received:t.data,code:me.invalid_literal,expected:this._def.value}),rt}return{status:"valid",value:e.data}}get value(){return this._def.value}}L5.create=(n,e)=>new L5({value:n,typeName:ie.ZodLiteral,...gt(e)});function E$(n,e){return new cf({values:n,typeName:ie.ZodEnum,...gt(e)})}class cf extends Ot{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return ke(t,{expected:Ft.joinValues(r),received:t.parsedType,code:me.invalid_type}),rt}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return ke(t,{received:t.data,code:me.invalid_enum_value,options:r}),rt}return Oi(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return cf.create(e,{...this._def,...t})}exclude(e,t=this._def){return cf.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}cf.create=E$;class M5 extends Ot{_parse(e){const t=Ft.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==Fe.string&&r.parsedType!==Fe.number){const s=Ft.objectValues(t);return ke(r,{expected:Ft.joinValues(s),received:r.parsedType,code:me.invalid_type}),rt}if(this._cache||(this._cache=new Set(Ft.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=Ft.objectValues(t);return ke(r,{received:r.data,code:me.invalid_enum_value,options:s}),rt}return Oi(e.data)}get enum(){return this._def.values}}M5.create=(n,e)=>new M5({values:n,typeName:ie.ZodNativeEnum,...gt(e)});class Sw extends Ot{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Fe.promise&&t.common.async===!1)return ke(t,{code:me.invalid_type,expected:Fe.promise,received:t.parsedType}),rt;const r=t.parsedType===Fe.promise?t.data:Promise.resolve(t.data);return Oi(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Sw.create=(n,e)=>new Sw({type:n,typeName:ie.ZodPromise,...gt(e)});class df extends Ot{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ie.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{ke(r,a),a.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(r.data,i);if(r.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return rt;const l=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return l.status==="aborted"?rt:l.status==="dirty"||t.value==="dirty"?sm(l.value):l});{if(t.value==="aborted")return rt;const o=this._def.schema._parseSync({data:a,path:r.path,parent:r});return o.status==="aborted"?rt:o.status==="dirty"||t.value==="dirty"?sm(o.value):o}}if(s.type==="refinement"){const a=o=>{const l=s.refinement(o,i);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?rt:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?rt:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!uf(a))return rt;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>uf(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):rt);Ft.assertNever(s)}}df.create=(n,e,t)=>new df({schema:n,typeName:ie.ZodEffects,effect:e,...gt(t)});df.createWithPreprocess=(n,e,t)=>new df({schema:e,effect:{type:"preprocess",transform:n},typeName:ie.ZodEffects,...gt(t)});class ou extends Ot{_parse(e){return this._getType(e)===Fe.undefined?Oi(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ou.create=(n,e)=>new ou({innerType:n,typeName:ie.ZodOptional,...gt(e)});class hf extends Ot{_parse(e){return this._getType(e)===Fe.null?Oi(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}hf.create=(n,e)=>new hf({innerType:n,typeName:ie.ZodNullable,...gt(e)});class lI extends Ot{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===Fe.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}lI.create=(n,e)=>new lI({innerType:n,typeName:ie.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...gt(e)});class uI extends Ot{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return vw(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Yo(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Yo(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}uI.create=(n,e)=>new uI({innerType:n,typeName:ie.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...gt(e)});class D5 extends Ot{_parse(e){if(this._getType(e)!==Fe.nan){const r=this._getOrReturnCtx(e);return ke(r,{code:me.invalid_type,expected:Fe.nan,received:r.parsedType}),rt}return{status:"valid",value:e.data}}}D5.create=n=>new D5({typeName:ie.ZodNaN,...gt(n)});class Noe extends Ot{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class XP extends Ot{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?rt:i.status==="dirty"?(t.dirty(),sm(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?rt:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new XP({in:e,out:t,typeName:ie.ZodPipeline})}}class cI extends Ot{_parse(e){const t=this._def.innerType._parse(e),r=s=>(uf(s)&&(s.value=Object.freeze(s.value)),s);return vw(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}}cI.create=(n,e)=>new cI({innerType:n,typeName:ie.ZodReadonly,...gt(e)});var ie;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(ie||(ie={}));const ZP=Bl.create,F5=aI.create;Su.create;Qa.create;const eA=$n.create;bw.create;Ew.create;Hc.create;cf.create;Sw.create;ou.create;hf.create;var Wb={exports:{}},S$={};function Ni(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var Ooe=Ni;Ni.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Ni.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Ni.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};Ni.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Ni.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};Ni.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};Ni.prototype.start=Ni.prototype.try;Ni.prototype.errors=function(){return this._errors};Ni.prototype.attempts=function(){return this._attempts};Ni.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var s=this._errors[r],i=s.message,a=(n[i]||0)+1;n[i]=a,a>=t&&(e=s,t=a)}return e};(function(n){var e=Ooe;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)r[s]=t[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<r.retries;a++)i.push(this.createTimeout(a,r));return t&&t.forever&&!i.length&&i.push(this.createTimeout(a,r)),i.sort(function(o,l){return o-l}),i},n.createTimeout=function(t,r){var s=r.randomize?Math.random()+1:1,i=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return i=Math.min(i,r.maxTimeout),i},n.wrap=function(t,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var a=0;a<s.length;a++){var o=s[a],l=t[o];t[o]=(function(h){var f=n.operation(r),p=Array.prototype.slice.call(arguments,1),y=p.pop();p.push(function(_){f.retry(_)||(_&&(arguments[0]=f.mainError()),y.apply(this,arguments))}),f.attempt(function(){h.apply(t,p)})}).bind(t,l),t[o].options=r}}})(S$);var Loe=S$;const Moe=Loe,Doe=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class T$ extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const Foe=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},$oe=n=>Doe.includes(n),C$=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const s=Moe.operation(e);s.attempt(async i=>{try{t(await n(i))}catch(a){if(!(a instanceof Error)){r(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof T$)s.stop(),r(a.originalError);else if(a instanceof TypeError&&!$oe(a.message))s.stop(),r(a);else{Foe(a,i,e);try{await e.onFailedAttempt(a)}catch(o){r(o);return}s.retry(a)||r(s.mainError())}}})});Wb.exports=C$;Wb.exports.default=C$;Wb.exports.AbortError=T$;var joe=Wb.exports;const Tw=Jc(joe);let Uoe=class{getStore(){}run(e,t){return t()}};const S2=Symbol.for("ls:tracing_async_local_storage"),Voe=new Uoe;let Boe=class{getInstance(){return globalThis[S2]??Voe}initializeGlobalInstance(e){globalThis[S2]===void 0&&(globalThis[S2]=e)}};const zoe=new Boe;function Goe(n=!1){const e=zoe.getInstance().getStore();if(!n&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function tA(n){return typeof n=="function"&&"langsmith:traceable"in n}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const Woe=Object.prototype.hasOwnProperty;function dI(n,e){return Woe.call(n,e)}function hI(n){if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)dI(n,t)&&e.push(t);return e}function Ba(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function fI(n){let e=0;const t=n.length;let r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Wd(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function Hoe(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function pI(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(pI(n[t]))return!0}else if(typeof n=="object"){const t=hI(n),r=t.length;for(var e=0;e<r;e++)if(pI(n[t[e]]))return!0}}return!1}function $5(n,e){const t=[n];for(const r in e){const s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&t.push(`${r}: ${s}`)}return t.join(`
`)}class qoe extends Error{constructor(e,t,r,s,i){super($5(e,{name:t,index:r,operation:s,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=$5(e,{name:t,index:r,operation:s,tree:i})}}const jn=qoe,yh={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=mI(t,this.path);r&&(r=Ba(r));const s=Um(t,{op:"remove",path:this.from}).removed;return Um(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:r}},copy:function(n,e,t){const r=mI(t,this.from);return Um(t,{op:"add",path:this.path,value:Ba(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:Iw(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}};var Koe={add:function(n,e,t){return fI(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:yh.move,copy:yh.copy,test:yh.test,_get:yh._get};function mI(n,e){if(e=="")return n;var t={op:"_get",path:e};return Um(n,t),t.value}function Um(n,e,t=!1,r=!0,s=!0,i=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):gI(e,0)),e.path===""){let a={newDocument:n};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=n,a;if(e.op==="move"||e.op==="copy")return a.newDocument=mI(n,e.from),e.op==="move"&&(a.removed=n),a;if(e.op==="test"){if(a.test=Iw(n,e.value),a.test===!1)throw new jn("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return a.newDocument=n,a}else{if(e.op==="remove")return a.removed=n,a.newDocument=null,a;if(e.op==="_get")return e.value=n,a;if(t)throw new jn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,n);return a}}else{r||(n=Ba(n));const o=(e.path||"").split("/");let l=n,u=1,h=o.length,f,p,y;for(typeof t=="function"?y=t:y=gI;;){if(p=o[u],p&&p.indexOf("~")!=-1&&(p=Hoe(p)),s&&(p=="__proto__"||p=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&f===void 0&&(l[p]===void 0?f=o.slice(0,u).join("/"):u==h-1&&(f=e.path),f!==void 0&&y(e,0,n,f)),u++,Array.isArray(l)){if(p==="-")p=l.length;else{if(t&&!fI(p))throw new jn("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,n);fI(p)&&(p=~~p)}if(u>=h){if(t&&e.op==="add"&&p>l.length)throw new jn("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,n);const _=Koe[e.op].call(e,l,p,n);if(_.test===!1)throw new jn("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return _}}else if(u>=h){const _=yh[e.op].call(e,l,p,n);if(_.test===!1)throw new jn("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return _}if(l=l[p],t&&u<h&&(!l||typeof l!="object"))throw new jn("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,n)}}}function Cw(n,e,t,r=!0,s=!0){if(t&&!Array.isArray(e))throw new jn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=Ba(n));const i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=Um(n,e[a],t,!0,s,a),n=i[a].newDocument;return i.newDocument=n,i}function gI(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new jn("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(yh[n.op]){if(typeof n.path!="string")throw new jn("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new jn('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new jn("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new jn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&pI(n.value))throw new jn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var s=n.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new jn("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new jn("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var a={op:"_get",path:n.from,value:void 0},o=Qoe([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new jn("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new jn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function Qoe(n,e,t){try{if(!Array.isArray(n))throw new jn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Cw(Ba(e),Ba(n),t||!0);else{t=t||gI;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(s){if(s instanceof jn)return s;throw s}}function Iw(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),s,i,a;if(t&&r){if(i=n.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!Iw(n[s],e[s]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!Iw(n[a],e[a]))return!1;return!0}return n!==n&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function I$(n,e,t,r,s){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=hI(e),a=hI(n),o=!1,l=a.length-1;l>=0;l--){var u=a[l],h=n[u];if(dI(e,u)&&!(e[u]===void 0&&h!==void 0&&Array.isArray(e)===!1)){var f=e[u];typeof h=="object"&&h!=null&&typeof f=="object"&&f!=null&&Array.isArray(h)===Array.isArray(f)?I$(h,f,t,r+"/"+Wd(u),s):h!==f&&(s&&t.push({op:"test",path:r+"/"+Wd(u),value:Ba(h)}),t.push({op:"replace",path:r+"/"+Wd(u),value:Ba(f)}))}else Array.isArray(n)===Array.isArray(e)?(s&&t.push({op:"test",path:r+"/"+Wd(u),value:Ba(h)}),t.push({op:"remove",path:r+"/"+Wd(u)}),o=!0):(s&&t.push({op:"test",path:r,value:n}),t.push({op:"replace",path:r,value:e}))}if(!(!o&&i.length==a.length))for(var l=0;l<i.length;l++){var u=i[l];!dI(n,u)&&e[u]!==void 0&&t.push({op:"add",path:r+"/"+Wd(u),value:Ba(e[u])})}}}function Yoe(n,e,t=!1){var r=[];return I$(n,e,r,"",t),r}const Joe="gen_ai.operation.name",Xoe="gen_ai.system",j5="gen_ai.request.model",Zoe="gen_ai.response.model",U5="gen_ai.usage.input_tokens",V5="gen_ai.usage.output_tokens",B5="gen_ai.usage.total_tokens",ele="gen_ai.request.max_tokens",tle="gen_ai.request.temperature",nle="gen_ai.request.top_p",rle="gen_ai.request.frequency_penalty",sle="gen_ai.request.presence_penalty",ile="gen_ai.response.finish_reasons",ale="gen_ai.prompt",ole="gen_ai.completion",lle="gen_ai.request.extra_query",ule="gen_ai.request.extra_body",cle="gen_ai.serialized.name",dle="gen_ai.serialized.signature",hle="gen_ai.serialized.doc",fle="gen_ai.response.id",ple="gen_ai.response.service_tier",mle="gen_ai.response.system_fingerprint",gle="gen_ai.usage.input_token_details",_le="gen_ai.usage.output_token_details",yle="langsmith.trace.session_id",vle="langsmith.trace.session_name",wle="langsmith.span.kind",ble="langsmith.trace.name",Ele="langsmith.metadata",z5="langsmith.span.tags",Sle="langsmith.request.streaming",Tle="langsmith.request.headers",Cle=(...n)=>fetch(...n),x$=Symbol.for("ls:fetch_implementation"),Ile=()=>{const n=globalThis[x$];return n?typeof n=="function"&&"Headers"in n&&"Request"in n&&"Response"in n:!1},xle=n=>async(...e)=>{if(n||Us("DEBUG")==="true"){const[r,s]=e;console.log(`→ ${(s==null?void 0:s.method)||"GET"} ${r}`)}const t=await(globalThis[x$]??Cle)(...e);return(n||Us("DEBUG")==="true")&&console.log(`← ${t.status} ${t.statusText} ${t.url}`),t},k$=()=>Us("PROJECT")??Xa("LANGCHAIN_SESSION")??"default",P$="0.3.74";var Vm={};let Na;const kle=()=>typeof window<"u"&&typeof window.document<"u",Ple=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Ale=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),A$=()=>typeof Deno<"u",Rle=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!A$(),R$=()=>Na||(typeof Bun<"u"?Na="bun":kle()?Na="browser":Rle()?Na="node":Ple()?Na="webworker":Ale()?Na="jsdom":A$()?Na="deno":Na="other",Na);let T2;function N$(){if(T2===void 0){const n=R$(),e=Ole();T2={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:P$,...e}}return T2}function O$(){const n=Nle(),e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,s]of Object.entries(n))typeof s=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function Nle(){const n={};try{if(typeof process<"u"&&Vm)for(const[e,t]of Object.entries(Vm))(e.startsWith("LANGCHAIN_")||e.startsWith("LANGSMITH_"))&&t!=null&&((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&typeof t=="string"?n[e]=t.slice(0,2)+"*".repeat(t.length-4)+t.slice(-2):n[e]=t)}catch{}return n}function Xa(n){try{return typeof process<"u"?Vm==null?void 0:Vm[n]:void 0}catch{return}}function Us(n){return Xa(`LANGSMITH_${n}`)||Xa(`LANGCHAIN_${n}`)}let C2;function Ole(){if(C2!==void 0)return C2;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=Xa(t);r!==void 0&&(e[t]=r)}return C2=e,e}function L$(){return Xa("OTEL_ENABLED")==="true"||Us("OTEL_ENABLED")==="true"}class Lle{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){!this.hasWarned&&L$()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let r;if(t.length===1&&typeof t[0]=="function"?r=t[0]:t.length===2&&typeof t[1]=="function"?r=t[1]:t.length===3&&typeof t[2]=="function"&&(r=t[2]),typeof r=="function")return r()}}class Mle{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new Lle})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}}class Dle{active(){return{}}with(e,t){return t()}}const I2=Symbol.for("ls:otel_trace"),x2=Symbol.for("ls:otel_context"),G5=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),Fle=new Mle,$le=new Dle;class jle{getTraceInstance(){return globalThis[I2]??Fle}getContextInstance(){return globalThis[x2]??$le}initializeGlobalInstances(e){globalThis[I2]===void 0&&(globalThis[I2]=e.trace),globalThis[x2]===void 0&&(globalThis[x2]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[G5]=e}getDefaultOTLPTracerComponents(){return globalThis[G5]??void 0}}const nA=new jle;function M$(){return nA.getTraceInstance()}function Ule(){return nA.getContextInstance()}function Vle(){return nA.getDefaultOTLPTracerComponents()}const Ble={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function zle(n){return Ble[n]||n}class Gle{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(const r of e)try{if(!r.run)continue;if(r.operation==="post"){const s=this.createSpanForRun(r,r.run,t.get(r.id));s&&!r.run.end_time&&this.spans.set(r.id,s)}else this.updateSpanForRun(r,r.run)}catch(s){console.error(`Error processing operation ${r.id}:`,s)}}createSpanForRun(e,t,r){const s=r&&M$().getSpan(r);if(s)try{return this.finishSpanSetup(s,t,e)}catch(i){console.error(`Failed to create span for run ${e.id}:`,i);return}}finishSpanSetup(e,t,r){return this.setSpanAttributes(e,t,r),t.error?(e.setStatus({code:2}),e.recordException(new Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{const r=this.spans.get(e.id);if(!r){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(r,t,e),t.error?(r.setStatus({code:2}),r.recordException(new Error(t.error))):r.setStatus({code:1});const s=t.end_time;s&&(r.end(new Date(s)),this.spans.delete(e.id))}catch(r){console.error(`Failed to update span for run ${e.id}:`,r)}}extractModelName(e){var t;if((t=e.extra)!=null&&t.metadata){const r=e.extra.metadata;if(r.ls_model_name)return r.ls_model_name;if(r.invocation_params){const s=r.invocation_params;if(s.model)return s.model;if(s.model_name)return s.model_name}}}setSpanAttributes(e,t,r){var o;if("run_type"in t&&t.run_type){e.setAttribute(wle,t.run_type);const l=zle(t.run_type||"chain");e.setAttribute(Joe,l)}"name"in t&&t.name&&e.setAttribute(ble,t.name),"session_id"in t&&t.session_id&&e.setAttribute(yle,t.session_id),"session_name"in t&&t.session_name&&e.setAttribute(vle,t.session_name),this.setGenAiSystem(e,t);const s=this.extractModelName(t);s&&e.setAttribute(j5,s),"prompt_tokens"in t&&typeof t.prompt_tokens=="number"&&e.setAttribute(U5,t.prompt_tokens),"completion_tokens"in t&&typeof t.completion_tokens=="number"&&e.setAttribute(V5,t.completion_tokens),"total_tokens"in t&&typeof t.total_tokens=="number"&&e.setAttribute(B5,t.total_tokens),this.setInvocationParameters(e,t);const i=((o=t.extra)==null?void 0:o.metadata)||{};for(const[l,u]of Object.entries(i))u!=null&&e.setAttribute(`${Ele}.${l}`,String(u));const a=t.tags;if(a&&Array.isArray(a)?e.setAttribute(z5,a.join(", ")):a&&e.setAttribute(z5,String(a)),"serialized"in t&&typeof t.serialized=="object"){const l=t.serialized;l.name&&e.setAttribute(cle,String(l.name)),l.signature&&e.setAttribute(dle,String(l.signature)),l.doc&&e.setAttribute(hle,String(l.doc))}this.setIOAttributes(e,r)}setGenAiSystem(e,t){let r="langchain";const s=this.extractModelName(t);if(s){const i=s.toLowerCase();i.includes("anthropic")||i.startsWith("claude")?r="anthropic":i.includes("bedrock")?r="aws.bedrock":i.includes("azure")&&i.includes("openai")?r="az.ai.openai":i.includes("azure")&&i.includes("inference")?r="az.ai.inference":i.includes("cohere")?r="cohere":i.includes("deepseek")?r="deepseek":i.includes("gemini")?r="gemini":i.includes("groq")?r="groq":i.includes("watson")||i.includes("ibm")?r="ibm.watsonx.ai":i.includes("mistral")?r="mistral_ai":i.includes("gpt")||i.includes("openai")?r="openai":i.includes("perplexity")||i.includes("sonar")?r="perplexity":i.includes("vertex")?r="vertex_ai":(i.includes("xai")||i.includes("grok"))&&(r="xai")}e.setAttribute(Xoe,r)}setInvocationParameters(e,t){var s,i;if(!((i=(s=t.extra)==null?void 0:s.metadata)!=null&&i.invocation_params))return;const r=t.extra.metadata.invocation_params;r.max_tokens!==void 0&&e.setAttribute(ele,r.max_tokens),r.temperature!==void 0&&e.setAttribute(tle,r.temperature),r.top_p!==void 0&&e.setAttribute(nle,r.top_p),r.frequency_penalty!==void 0&&e.setAttribute(rle,r.frequency_penalty),r.presence_penalty!==void 0&&e.setAttribute(sle,r.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{const r=t.run.inputs;typeof r=="object"&&r!==null&&(r.model&&Array.isArray(r.messages)&&e.setAttribute(j5,r.model),r.stream!==void 0&&e.setAttribute(Sle,r.stream),r.extra_headers&&e.setAttribute(Tle,JSON.stringify(r.extra_headers)),r.extra_query&&e.setAttribute(lle,JSON.stringify(r.extra_query)),r.extra_body&&e.setAttribute(ule,JSON.stringify(r.extra_body))),e.setAttribute(ale,JSON.stringify(r))}catch(r){console.debug(`Failed to process inputs for run ${t.id}`,r)}if(t.run.outputs)try{const r=t.run.outputs,s=this.getUnifiedRunTokens(r);if(s&&(e.setAttribute(U5,s[0]),e.setAttribute(V5,s[1]),e.setAttribute(B5,s[0]+s[1])),r&&typeof r=="object"){if(r.model&&e.setAttribute(Zoe,String(r.model)),r.id&&e.setAttribute(fle,r.id),r.choices&&Array.isArray(r.choices)){const i=r.choices.map(a=>a.finish_reason).filter(a=>a).map(String);i.length>0&&e.setAttribute(ile,i.join(", "))}if(r.service_tier&&e.setAttribute(ple,r.service_tier),r.system_fingerprint&&e.setAttribute(mle,r.system_fingerprint),r.usage_metadata&&typeof r.usage_metadata=="object"){const i=r.usage_metadata;i.input_token_details&&e.setAttribute(gle,JSON.stringify(i.input_token_details)),i.output_token_details&&e.setAttribute(_le,JSON.stringify(i.output_token_details))}}e.setAttribute(ole,JSON.stringify(r))}catch(r){console.debug(`Failed to process outputs for run ${t.id}`,r)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;const r=Object.keys(e);for(const a of r){const o=e[a];if(!(!o||typeof o!="object")&&(t=this.extractUnifiedRunTokens(o.usage_metadata),t||o.lc===1&&o.kwargs&&typeof o.kwargs=="object"&&(t=this.extractUnifiedRunTokens(o.kwargs.usage_metadata),t)))return t}const s=e.generations||[];if(!Array.isArray(s))return null;const i=Array.isArray(s[0])?s.flat():s;for(const a of i)if(typeof a=="object"&&a.message&&typeof a.message=="object"&&a.message.kwargs&&typeof a.message.kwargs=="object"&&(t=this.extractUnifiedRunTokens(a.message.kwargs.usage_metadata),t))return t;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}}var D$={},F$={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(l,u,h){this.fn=l,this.context=u,this.once=h||!1}function i(l,u,h,f,p){if(typeof h!="function")throw new TypeError("The listener must be a function");var y=new s(h,f||l,p),_=t?t+u:u;return l._events[_]?l._events[_].fn?l._events[_]=[l._events[_],y]:l._events[_].push(y):(l._events[_]=y,l._eventsCount++),l}function a(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],h,f;if(this._eventsCount===0)return u;for(f in h=this._events)e.call(h,f)&&u.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(h)):u},o.prototype.listeners=function(u){var h=t?t+u:u,f=this._events[h];if(!f)return[];if(f.fn)return[f.fn];for(var p=0,y=f.length,_=new Array(y);p<y;p++)_[p]=f[p].fn;return _},o.prototype.listenerCount=function(u){var h=t?t+u:u,f=this._events[h];return f?f.fn?1:f.length:0},o.prototype.emit=function(u,h,f,p,y,_){var b=t?t+u:u;if(!this._events[b])return!1;var S=this._events[b],E=arguments.length,C,v;if(S.fn){switch(S.once&&this.removeListener(u,S.fn,void 0,!0),E){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,h),!0;case 3:return S.fn.call(S.context,h,f),!0;case 4:return S.fn.call(S.context,h,f,p),!0;case 5:return S.fn.call(S.context,h,f,p,y),!0;case 6:return S.fn.call(S.context,h,f,p,y,_),!0}for(v=1,C=new Array(E-1);v<E;v++)C[v-1]=arguments[v];S.fn.apply(S.context,C)}else{var I=S.length,L;for(v=0;v<I;v++)switch(S[v].once&&this.removeListener(u,S[v].fn,void 0,!0),E){case 1:S[v].fn.call(S[v].context);break;case 2:S[v].fn.call(S[v].context,h);break;case 3:S[v].fn.call(S[v].context,h,f);break;case 4:S[v].fn.call(S[v].context,h,f,p);break;default:if(!C)for(L=1,C=new Array(E-1);L<E;L++)C[L-1]=arguments[L];S[v].fn.apply(S[v].context,C)}}return!0},o.prototype.on=function(u,h,f){return i(this,u,h,f,!1)},o.prototype.once=function(u,h,f){return i(this,u,h,f,!0)},o.prototype.removeListener=function(u,h,f,p){var y=t?t+u:u;if(!this._events[y])return this;if(!h)return a(this,y),this;var _=this._events[y];if(_.fn)_.fn===h&&(!p||_.once)&&(!f||_.context===f)&&a(this,y);else{for(var b=0,S=[],E=_.length;b<E;b++)(_[b].fn!==h||p&&!_[b].once||f&&_[b].context!==f)&&S.push(_[b]);S.length?this._events[y]=S.length===1?S[0]:S:a(this,y)}return this},o.prototype.removeAllListeners=function(u){var h;return u?(h=t?t+u:u,this._events[h]&&a(this,h)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(F$);var Wle=F$.exports,Hb={exports:{}},Hle=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})));const qle=Hle;class $$ extends Error{constructor(e){super(e),this.name="TimeoutError"}}const j$=(n,e,t)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}const i=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(l){s(l)}return}const a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new $$(a);typeof n.cancel=="function"&&n.cancel(),s(o)},e);qle(n.then(r,s),()=>{clearTimeout(i)})});Hb.exports=j$;Hb.exports.default=j$;Hb.exports.TimeoutError=$$;var Kle=Hb.exports,rA={},sA={};Object.defineProperty(sA,"__esModule",{value:!0});function Qle(n,e,t){let r=0,s=n.length;for(;s>0;){const i=s/2|0;let a=r+i;t(n[a],e)<=0?(r=++a,s-=i+1):s=i}return r}sA.default=Qle;Object.defineProperty(rA,"__esModule",{value:!0});const Yle=sA;class Jle{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}const s=Yle.default(this._queue,r,(i,a)=>a.priority-i.priority);this._queue.splice(s,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}rA.default=Jle;Object.defineProperty(D$,"__esModule",{value:!0});const Xle=Wle,U$=Kle,Zle=rA,u0=()=>{},eue=new U$.TimeoutError;class tue extends Xle{constructor(e){var t,r,s,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=u0,this._resolveIdle=u0,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:Zle.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=u0,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=u0,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,s)=>{const i=async()=>{this._pendingCount++,this._intervalCount++;try{const a=this._timeout===void 0&&t.timeout===void 0?e():U$.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(eue)});r(await a)}catch(a){s(a)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var jo=D$.default=tue;const nue=[429,500,502,503,504];let W5=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in jo?this.queue=new jo.default({concurrency:this.maxConcurrency}):this.queue=new jo({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add(()=>Tw(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.name==="TimeoutError"||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const i=s==null?void 0:s.response;if(r&&await r(i))return;const a=(i==null?void 0:i.status)??(s==null?void 0:s.status);if(a&&!nue.includes(+a))throw s},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}};function H5(n){return typeof(n==null?void 0:n._getType)=="function"}function q5(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}const rue=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function at(n,e){if(!rue.test(n)){const t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}const K5={};function _I(n){K5[n]||(console.warn(n),K5[n]=!0)}var yI={exports:{}};const sue="2.0.0",V$=256,iue=Number.MAX_SAFE_INTEGER||9007199254740991,aue=16,oue=V$-6,lue=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var qb={MAX_LENGTH:V$,MAX_SAFE_COMPONENT_LENGTH:aue,MAX_SAFE_BUILD_LENGTH:oue,MAX_SAFE_INTEGER:iue,RELEASE_TYPES:lue,SEMVER_SPEC_VERSION:sue,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},k2={};const uue=typeof process=="object"&&k2&&k2.NODE_DEBUG&&/\bsemver\b/i.test(k2.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{};var Kb=uue;(function(n,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:s}=qb,i=Kb;e=n.exports={};const a=e.re=[],o=e.safeRe=[],l=e.src=[],u=e.safeSrc=[],h=e.t={};let f=0;const p="[a-zA-Z0-9-]",y=[["\\s",1],["\\d",s],[p,r]],_=S=>{for(const[E,C]of y)S=S.split(`${E}*`).join(`${E}{0,${C}}`).split(`${E}+`).join(`${E}{1,${C}}`);return S},b=(S,E,C)=>{const v=_(E),I=f++;i(S,I,E),h[S]=I,l[I]=E,u[I]=v,a[I]=new RegExp(E,C?"g":void 0),o[I]=new RegExp(v,C?"g":void 0)};b("NUMERICIDENTIFIER","0|[1-9]\\d*"),b("NUMERICIDENTIFIERLOOSE","\\d+"),b("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),b("MAINVERSION",`(${l[h.NUMERICIDENTIFIER]})\\.(${l[h.NUMERICIDENTIFIER]})\\.(${l[h.NUMERICIDENTIFIER]})`),b("MAINVERSIONLOOSE",`(${l[h.NUMERICIDENTIFIERLOOSE]})\\.(${l[h.NUMERICIDENTIFIERLOOSE]})\\.(${l[h.NUMERICIDENTIFIERLOOSE]})`),b("PRERELEASEIDENTIFIER",`(?:${l[h.NONNUMERICIDENTIFIER]}|${l[h.NUMERICIDENTIFIER]})`),b("PRERELEASEIDENTIFIERLOOSE",`(?:${l[h.NONNUMERICIDENTIFIER]}|${l[h.NUMERICIDENTIFIERLOOSE]})`),b("PRERELEASE",`(?:-(${l[h.PRERELEASEIDENTIFIER]}(?:\\.${l[h.PRERELEASEIDENTIFIER]})*))`),b("PRERELEASELOOSE",`(?:-?(${l[h.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[h.PRERELEASEIDENTIFIERLOOSE]})*))`),b("BUILDIDENTIFIER",`${p}+`),b("BUILD",`(?:\\+(${l[h.BUILDIDENTIFIER]}(?:\\.${l[h.BUILDIDENTIFIER]})*))`),b("FULLPLAIN",`v?${l[h.MAINVERSION]}${l[h.PRERELEASE]}?${l[h.BUILD]}?`),b("FULL",`^${l[h.FULLPLAIN]}$`),b("LOOSEPLAIN",`[v=\\s]*${l[h.MAINVERSIONLOOSE]}${l[h.PRERELEASELOOSE]}?${l[h.BUILD]}?`),b("LOOSE",`^${l[h.LOOSEPLAIN]}$`),b("GTLT","((?:<|>)?=?)"),b("XRANGEIDENTIFIERLOOSE",`${l[h.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),b("XRANGEIDENTIFIER",`${l[h.NUMERICIDENTIFIER]}|x|X|\\*`),b("XRANGEPLAIN",`[v=\\s]*(${l[h.XRANGEIDENTIFIER]})(?:\\.(${l[h.XRANGEIDENTIFIER]})(?:\\.(${l[h.XRANGEIDENTIFIER]})(?:${l[h.PRERELEASE]})?${l[h.BUILD]}?)?)?`),b("XRANGEPLAINLOOSE",`[v=\\s]*(${l[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[h.XRANGEIDENTIFIERLOOSE]})(?:${l[h.PRERELEASELOOSE]})?${l[h.BUILD]}?)?)?`),b("XRANGE",`^${l[h.GTLT]}\\s*${l[h.XRANGEPLAIN]}$`),b("XRANGELOOSE",`^${l[h.GTLT]}\\s*${l[h.XRANGEPLAINLOOSE]}$`),b("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),b("COERCE",`${l[h.COERCEPLAIN]}(?:$|[^\\d])`),b("COERCEFULL",l[h.COERCEPLAIN]+`(?:${l[h.PRERELEASE]})?(?:${l[h.BUILD]})?(?:$|[^\\d])`),b("COERCERTL",l[h.COERCE],!0),b("COERCERTLFULL",l[h.COERCEFULL],!0),b("LONETILDE","(?:~>?)"),b("TILDETRIM",`(\\s*)${l[h.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",b("TILDE",`^${l[h.LONETILDE]}${l[h.XRANGEPLAIN]}$`),b("TILDELOOSE",`^${l[h.LONETILDE]}${l[h.XRANGEPLAINLOOSE]}$`),b("LONECARET","(?:\\^)"),b("CARETTRIM",`(\\s*)${l[h.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",b("CARET",`^${l[h.LONECARET]}${l[h.XRANGEPLAIN]}$`),b("CARETLOOSE",`^${l[h.LONECARET]}${l[h.XRANGEPLAINLOOSE]}$`),b("COMPARATORLOOSE",`^${l[h.GTLT]}\\s*(${l[h.LOOSEPLAIN]})$|^$`),b("COMPARATOR",`^${l[h.GTLT]}\\s*(${l[h.FULLPLAIN]})$|^$`),b("COMPARATORTRIM",`(\\s*)${l[h.GTLT]}\\s*(${l[h.LOOSEPLAIN]}|${l[h.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",b("HYPHENRANGE",`^\\s*(${l[h.XRANGEPLAIN]})\\s+-\\s+(${l[h.XRANGEPLAIN]})\\s*$`),b("HYPHENRANGELOOSE",`^\\s*(${l[h.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[h.XRANGEPLAINLOOSE]})\\s*$`),b("STAR","(<|>)?=?\\s*\\*"),b("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),b("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(yI,yI.exports);var T_=yI.exports;const cue=Object.freeze({loose:!0}),due=Object.freeze({}),hue=n=>n?typeof n!="object"?cue:n:due;var iA=hue;const Q5=/^[0-9]+$/,B$=(n,e)=>{if(typeof n=="number"&&typeof e=="number")return n===e?0:n<e?-1:1;const t=Q5.test(n),r=Q5.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1},fue=(n,e)=>B$(e,n);var z$={compareIdentifiers:B$,rcompareIdentifiers:fue};const c0=Kb,{MAX_LENGTH:Y5,MAX_SAFE_INTEGER:d0}=qb,{safeRe:h0,t:f0}=T_,pue=iA,{compareIdentifiers:P2}=z$;let mue=class Ma{constructor(e,t){if(t=pue(t),e instanceof Ma){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Y5)throw new TypeError(`version is longer than ${Y5} characters`);c0("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?h0[f0.LOOSE]:h0[f0.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>d0||this.major<0)throw new TypeError("Invalid major version");if(this.minor>d0||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>d0||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const i=+s;if(i>=0&&i<d0)return i}return s}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(c0("SemVer.compare",this.version,this.options,e),!(e instanceof Ma)){if(typeof e=="string"&&e===this.version)return 0;e=new Ma(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Ma||(e=new Ma(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof Ma||(e=new Ma(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],s=e.prerelease[t];if(c0("prerelease compare",t,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return P2(r,s)}while(++t)}compareBuild(e){e instanceof Ma||(e=new Ma(e,this.options));let t=0;do{const r=this.build[t],s=e.build[t];if(c0("build compare",t,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return P2(r,s)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(t){const s=`-${t}`.match(this.options.loose?h0[f0.PRERELEASELOOSE]:h0[f0.PRERELEASE]);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const s=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(t){let i=[t,s];r===!1&&(i=[t]),P2(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var aA=mue;const J5=aA,gue=(n,e,t)=>new J5(n,t).compare(new J5(e,t));var Uf=gue;const _ue=Uf,yue=(n,e,t)=>_ue(n,e,t)>0;var vue=yue;const wue=Uf,bue=(n,e,t)=>wue(n,e,t)<0;var Eue=bue;const Sue=Uf,Tue=(n,e,t)=>Sue(n,e,t)===0;var Cue=Tue;const Iue=Uf,xue=(n,e,t)=>Iue(n,e,t)!==0;var kue=xue;const Pue=Uf,Aue=(n,e,t)=>Pue(n,e,t)>=0;var Rue=Aue;const Nue=Uf,Oue=(n,e,t)=>Nue(n,e,t)<=0;var Lue=Oue;const Mue=Cue,Due=kue,Fue=vue,$ue=Rue,jue=Eue,Uue=Lue,Vue=(n,e,t,r)=>{switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return Mue(n,t,r);case"!=":return Due(n,t,r);case">":return Fue(n,t,r);case">=":return $ue(n,t,r);case"<":return jue(n,t,r);case"<=":return Uue(n,t,r);default:throw new TypeError(`Invalid operator: ${e}`)}};var Bue=Vue;const{safeRe:rye,t:sye}=T_;class zue{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){const s=this.map.keys().next().value;this.delete(s)}this.map.set(e,t)}return this}}var Gue=zue,A2,X5;function ma(){if(X5)return A2;X5=1;const n=/\s+/g;class e{constructor(G,ue){if(ue=s(ue),G instanceof e)return G.loose===!!ue.loose&&G.includePrerelease===!!ue.includePrerelease?G:new e(G.raw,ue);if(G instanceof i)return this.raw=G.value,this.set=[[G]],this.formatted=void 0,this;if(this.options=ue,this.loose=!!ue.loose,this.includePrerelease=!!ue.includePrerelease,this.raw=G.trim().replace(n," "),this.set=this.raw.split("||").map(ae=>this.parseRange(ae.trim())).filter(ae=>ae.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const ae=this.set[0];if(this.set=this.set.filter(z=>!b(z[0])),this.set.length===0)this.set=[ae];else if(this.set.length>1){for(const z of this.set)if(z.length===1&&S(z[0])){this.set=[z];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let G=0;G<this.set.length;G++){G>0&&(this.formatted+="||");const ue=this.set[G];for(let ae=0;ae<ue.length;ae++)ae>0&&(this.formatted+=" "),this.formatted+=ue[ae].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(G){const ae=((this.options.includePrerelease&&y)|(this.options.loose&&_))+":"+G,z=r.get(ae);if(z)return z;const Q=this.options.loose,ee=Q?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];G=G.replace(ee,F(this.options.includePrerelease)),a("hyphen replace",G),G=G.replace(l[u.COMPARATORTRIM],h),a("comparator trim",G),G=G.replace(l[u.TILDETRIM],f),a("tilde trim",G),G=G.replace(l[u.CARETTRIM],p),a("caret trim",G);let se=G.split(" ").map(de=>C(de,this.options)).join(" ").split(/\s+/).map(de=>D(de,this.options));Q&&(se=se.filter(de=>(a("loose invalid filter",de,this.options),!!de.match(l[u.COMPARATORLOOSE])))),a("range list",se);const le=new Map,ye=se.map(de=>new i(de,this.options));for(const de of ye){if(b(de))return[de];le.set(de.value,de)}le.size>1&&le.has("")&&le.delete("");const ve=[...le.values()];return r.set(ae,ve),ve}intersects(G,ue){if(!(G instanceof e))throw new TypeError("a Range is required");return this.set.some(ae=>E(ae,ue)&&G.set.some(z=>E(z,ue)&&ae.every(Q=>z.every(ee=>Q.intersects(ee,ue)))))}test(G){if(!G)return!1;if(typeof G=="string")try{G=new o(G,this.options)}catch{return!1}for(let ue=0;ue<this.set.length;ue++)if($(this.set[ue],G,this.options))return!0;return!1}}A2=e;const t=Gue,r=new t,s=iA,i=Qb(),a=Kb,o=aA,{safeRe:l,t:u,comparatorTrimReplace:h,tildeTrimReplace:f,caretTrimReplace:p}=T_,{FLAG_INCLUDE_PRERELEASE:y,FLAG_LOOSE:_}=qb,b=H=>H.value==="<0.0.0-0",S=H=>H.value==="",E=(H,G)=>{let ue=!0;const ae=H.slice();let z=ae.pop();for(;ue&&ae.length;)ue=ae.every(Q=>z.intersects(Q,G)),z=ae.pop();return ue},C=(H,G)=>(H=H.replace(l[u.BUILD],""),a("comp",H,G),H=R(H,G),a("caret",H),H=I(H,G),a("tildes",H),H=x(H,G),a("xrange",H),H=M(H,G),a("stars",H),H),v=H=>!H||H.toLowerCase()==="x"||H==="*",I=(H,G)=>H.trim().split(/\s+/).map(ue=>L(ue,G)).join(" "),L=(H,G)=>{const ue=G.loose?l[u.TILDELOOSE]:l[u.TILDE];return H.replace(ue,(ae,z,Q,ee,se)=>{a("tilde",H,ae,z,Q,ee,se);let le;return v(z)?le="":v(Q)?le=`>=${z}.0.0 <${+z+1}.0.0-0`:v(ee)?le=`>=${z}.${Q}.0 <${z}.${+Q+1}.0-0`:se?(a("replaceTilde pr",se),le=`>=${z}.${Q}.${ee}-${se} <${z}.${+Q+1}.0-0`):le=`>=${z}.${Q}.${ee} <${z}.${+Q+1}.0-0`,a("tilde return",le),le})},R=(H,G)=>H.trim().split(/\s+/).map(ue=>P(ue,G)).join(" "),P=(H,G)=>{a("caret",H,G);const ue=G.loose?l[u.CARETLOOSE]:l[u.CARET],ae=G.includePrerelease?"-0":"";return H.replace(ue,(z,Q,ee,se,le)=>{a("caret",H,z,Q,ee,se,le);let ye;return v(Q)?ye="":v(ee)?ye=`>=${Q}.0.0${ae} <${+Q+1}.0.0-0`:v(se)?Q==="0"?ye=`>=${Q}.${ee}.0${ae} <${Q}.${+ee+1}.0-0`:ye=`>=${Q}.${ee}.0${ae} <${+Q+1}.0.0-0`:le?(a("replaceCaret pr",le),Q==="0"?ee==="0"?ye=`>=${Q}.${ee}.${se}-${le} <${Q}.${ee}.${+se+1}-0`:ye=`>=${Q}.${ee}.${se}-${le} <${Q}.${+ee+1}.0-0`:ye=`>=${Q}.${ee}.${se}-${le} <${+Q+1}.0.0-0`):(a("no pr"),Q==="0"?ee==="0"?ye=`>=${Q}.${ee}.${se}${ae} <${Q}.${ee}.${+se+1}-0`:ye=`>=${Q}.${ee}.${se}${ae} <${Q}.${+ee+1}.0-0`:ye=`>=${Q}.${ee}.${se} <${+Q+1}.0.0-0`),a("caret return",ye),ye})},x=(H,G)=>(a("replaceXRanges",H,G),H.split(/\s+/).map(ue=>N(ue,G)).join(" ")),N=(H,G)=>{H=H.trim();const ue=G.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return H.replace(ue,(ae,z,Q,ee,se,le)=>{a("xRange",H,ae,z,Q,ee,se,le);const ye=v(Q),ve=ye||v(ee),de=ve||v(se),Me=de;return z==="="&&Me&&(z=""),le=G.includePrerelease?"-0":"",ye?z===">"||z==="<"?ae="<0.0.0-0":ae="*":z&&Me?(ve&&(ee=0),se=0,z===">"?(z=">=",ve?(Q=+Q+1,ee=0,se=0):(ee=+ee+1,se=0)):z==="<="&&(z="<",ve?Q=+Q+1:ee=+ee+1),z==="<"&&(le="-0"),ae=`${z+Q}.${ee}.${se}${le}`):ve?ae=`>=${Q}.0.0${le} <${+Q+1}.0.0-0`:de&&(ae=`>=${Q}.${ee}.0${le} <${Q}.${+ee+1}.0-0`),a("xRange return",ae),ae})},M=(H,G)=>(a("replaceStars",H,G),H.trim().replace(l[u.STAR],"")),D=(H,G)=>(a("replaceGTE0",H,G),H.trim().replace(l[G.includePrerelease?u.GTE0PRE:u.GTE0],"")),F=H=>(G,ue,ae,z,Q,ee,se,le,ye,ve,de,Me)=>(v(ae)?ue="":v(z)?ue=`>=${ae}.0.0${H?"-0":""}`:v(Q)?ue=`>=${ae}.${z}.0${H?"-0":""}`:ee?ue=`>=${ue}`:ue=`>=${ue}${H?"-0":""}`,v(ye)?le="":v(ve)?le=`<${+ye+1}.0.0-0`:v(de)?le=`<${ye}.${+ve+1}.0-0`:Me?le=`<=${ye}.${ve}.${de}-${Me}`:H?le=`<${ye}.${ve}.${+de+1}-0`:le=`<=${le}`,`${ue} ${le}`.trim()),$=(H,G,ue)=>{for(let ae=0;ae<H.length;ae++)if(!H[ae].test(G))return!1;if(G.prerelease.length&&!ue.includePrerelease){for(let ae=0;ae<H.length;ae++)if(a(H[ae].semver),H[ae].semver!==i.ANY&&H[ae].semver.prerelease.length>0){const z=H[ae].semver;if(z.major===G.major&&z.minor===G.minor&&z.patch===G.patch)return!0}return!1}return!0};return A2}var R2,Z5;function Qb(){if(Z5)return R2;Z5=1;const n=Symbol("SemVer ANY");class e{static get ANY(){return n}constructor(h,f){if(f=t(f),h instanceof e){if(h.loose===!!f.loose)return h;h=h.value}h=h.trim().split(/\s+/).join(" "),a("comparator",h,f),this.options=f,this.loose=!!f.loose,this.parse(h),this.semver===n?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(h){const f=this.options.loose?r[s.COMPARATORLOOSE]:r[s.COMPARATOR],p=h.match(f);if(!p)throw new TypeError(`Invalid comparator: ${h}`);this.operator=p[1]!==void 0?p[1]:"",this.operator==="="&&(this.operator=""),p[2]?this.semver=new o(p[2],this.options.loose):this.semver=n}toString(){return this.value}test(h){if(a("Comparator.test",h,this.options.loose),this.semver===n||h===n)return!0;if(typeof h=="string")try{h=new o(h,this.options)}catch{return!1}return i(h,this.operator,this.semver,this.options)}intersects(h,f){if(!(h instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(h.value,f).test(this.value):h.operator===""?h.value===""?!0:new l(this.value,f).test(h.semver):(f=t(f),f.includePrerelease&&(this.value==="<0.0.0-0"||h.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||h.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&h.operator.startsWith(">")||this.operator.startsWith("<")&&h.operator.startsWith("<")||this.semver.version===h.semver.version&&this.operator.includes("=")&&h.operator.includes("=")||i(this.semver,"<",h.semver,f)&&this.operator.startsWith(">")&&h.operator.startsWith("<")||i(this.semver,">",h.semver,f)&&this.operator.startsWith("<")&&h.operator.startsWith(">")))}}R2=e;const t=iA,{safeRe:r,t:s}=T_,i=Bue,a=Kb,o=aA,l=ma();return R2}ma();ma();ma();ma();ma();ma();const Wue=Qb(),{ANY:iye}=Wue;ma();ma();ma();const oA=Qb(),{ANY:aye}=oA;new oA(">=0.0.0-0");new oA(">=0.0.0");const N2=T_,e9=qb,t9=z$;Qb();ma();N2.re,N2.src,N2.t,e9.SEMVER_SPEC_VERSION,e9.RELEASE_TYPES,t9.compareIdentifiers,t9.rcompareIdentifiers;function El(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);const[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){const[s,i]=e.split("/",2);if(!s||!i)throw new Error(`Invalid identifier format: ${n}`);return[s,i,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}class Hue extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function Ue(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}if(n.status===403)try{const a=await n.json();(a==null?void 0:a.error)==="org_scoped_key_requires_workspace"&&(r="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch{const o=new Error(`${n.status} ${n.statusText}`);throw o.status=n==null?void 0:n.status,o}if(r===void 0)try{r=await n.text()}catch{r=""}const s=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Message: ${r}`;if(n.status===409)throw new Hue(s);const i=new Error(s);throw i.status=n.status,i}const G$="ERR_CONFLICTING_ENDPOINTS";class que extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:G$}),this.name="ConflictingEndpointsError"}}function Kue(n){return typeof n=="object"&&n!==null&&n.code===G$}var n9="[...]",Que={result:"[Circular]"},xw=[],vh=[];const Yue=new TextEncoder;function Jue(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function p0(n){return Yue.encode(n)}function W$(n){if(n&&typeof n=="object"&&n!==null){if(n instanceof Map)return Object.fromEntries(n);if(n instanceof Set)return Array.from(n);if(n instanceof Date)return n.toISOString();if(n instanceof RegExp)return n.toString();if(n instanceof Error)return{name:n.name,message:n.message}}else if(typeof n=="bigint")return n.toString();return n}function Xue(n){return function(e,t){return W$(t)}}function Qs(n,e,t,r,s){var i;try{const a=JSON.stringify(n,Xue(t),r);return p0(a)}catch(a){if(!((i=a.message)!=null&&i.includes("Converting circular structure to JSON")))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),p0("[Unserializable]");Us("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof s>"u"&&(s=Jue()),vI(n,"",0,[],void 0,0,s);let o;try{vh.length===0?o=JSON.stringify(n,t,r):o=JSON.stringify(n,Zue(t),r)}catch{return p0("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;xw.length!==0;){const l=xw.pop();l.length===4?Object.defineProperty(l[0],l[1],l[3]):l[0][l[1]]=l[2]}}return p0(o)}}function O2(n,e,t,r){var s=Object.getOwnPropertyDescriptor(r,t);s.get!==void 0?s.configurable?(Object.defineProperty(r,t,{value:n}),xw.push([r,t,e,s])):vh.push([e,t,n]):(r[t]=n,xw.push([r,t,e]))}function vI(n,e,t,r,s,i,a){i+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){O2(Que,n,e,s);return}if(typeof a.depthLimit<"u"&&i>a.depthLimit){O2(n9,n,e,s);return}if(typeof a.edgesLimit<"u"&&t+1>a.edgesLimit){O2(n9,n,e,s);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)vI(n[o],o,o,r,n,i,a);else{n=W$(n);var l=Object.keys(n);for(o=0;o<l.length;o++){var u=l[o];vI(n[u],u,o,r,n,i,a)}}r.pop()}}function Zue(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(vh.length>0)for(var r=0;r<vh.length;r++){var s=vh[r];if(s[1]===e&&s[0]===t){t=s[2],vh.splice(r,1);break}}return n.call(this,e,t)}}function r9(n,e){const t=N$(),r=e??O$(),s=n.extra??{},i=s.metadata;return n.extra={...s,runtime:{...t,...s==null?void 0:s.runtime},metadata:{...r,...r.revision_id||"revision_id"in n&&n.revision_id?{revision_id:("revision_id"in n?n.revision_id:void 0)??r.revision_id}:{},...i}},n}const ece=n=>{const e=(n==null?void 0:n.toString())??Us("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},tce=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function nce(n){const e=[];for await(const t of n)e.push(t);return e}function m0(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const rce=async n=>{if((n==null?void 0:n.status)===429){const e=parseInt(n.headers.get("retry-after")??"10",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function s9(n){return typeof n=="number"?Number(n.toFixed(4)):n}class sce{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const r=new Promise(i=>{t=i}),s=Qs(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:r,size:s}),this.sizeBytes+=s,r}pop({upToSizeBytes:e,upToSize:t}){var i;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const r=[];let s=0;for(;s+(((i=this.peek())==null?void 0:i.size)??0)<e&&this.items.length>0&&r.length<t;){const a=this.items.shift();a&&(r.push(a),s+=a.size,this.sizeBytes-=a.size)}if(r.length===0&&this.items.length>0){const a=this.items.shift();r.push(a),s+=a.size,this.sizeBytes-=a.size}return[r.map(a=>({action:a.action,item:a.payload,otelContext:a.otelContext,apiKey:a.apiKey,apiUrl:a.apiUrl})),()=>r.forEach(a=>a.itemPromiseResolve())]}}const ice=24*1024*1024,ace=1e4,oce=100,i9="https://api.smith.langchain.com";class Ug{get _fetch(){return this.fetchImplementation||xle(this.debug)}constructor(e={}){var r;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new sce}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Xa("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:Xa("LANGSMITH_DEBUG")==="true"});const t=Ug.getDefaultClientConfig();if(this.tracingSampleRate=ece(e.tracingSamplingRate),this.apiUrl=m0(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=m0(e.apiKey??t.apiKey),this.webUrl=m0(e.webUrl??t.webUrl),(r=this.webUrl)!=null&&r.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=m0(e.workspaceId??Us("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new W5({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation,this.batchIngestCaller=new W5({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:rce,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,L$()&&(this.langSmithToOTELTranslator=new Gle),this.cachedLSEnvVarsForMetadata=O$()}static getDefaultClientConfig(){const e=Us("API_KEY"),t=Us("ENDPOINT")??i9,r=Us("HIDE_INPUTS")==="true",s=Us("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:tce(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${P$}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=await this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${r}`;return await this.caller.call(async()=>{const a=await this._fetch(s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(a,`fetch ${e}`),a})}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let s=Number(t.get("offset"))||0;const i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(i));const a=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(async()=>{const u=await this._fetch(a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(u,`fetch ${e}`),u}),l=r?r(await o.json()):await o.json();if(l.length===0||(yield l,l.length<i))break;s+=l.length}}async*_getCursorPaginatedList(e,t=null,r="POST",s="runs"){const i=t?{...t}:{};for(;;){const a=JSON.stringify(i),l=await(await this.caller.call(async()=>{const h=await this._fetch(`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Ue(h,`fetch ${e}`),h})).json();if(!l||!l[s])break;yield l[s];const u=l.cursors;if(!u||!u.next)break;i.cursor=u.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const s of e)this.filteredPostUuids.has(s.trace_id)?s.id===s.trace_id&&this.filteredPostUuids.delete(s.trace_id):r.push(s);return r}else{const r=[];for(const s of e){const i=s.trace_id??s.id;this.filteredPostUuids.has(i)||(s.id===i?this._shouldSample()?r.push(s):this.filteredPostUuids.add(i):r.push(s))}return r}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??ice}async _getBatchSizeLimit(){var t;const e=await this._ensureServerInfo();return this.batchSizeLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit)??oce}async _getDatasetExamplesMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t}){const r=[];for(;this.autoBatchQueue.items.length>0;){const[s,i]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:t});if(!s.length){i();break}const a=s.reduce((u,h)=>{const f=h.apiUrl??this.apiUrl,p=h.apiKey??this.apiKey,_=h.apiKey===this.apiKey&&h.apiUrl===this.apiUrl?"default":`${f}|${p}`;return u[_]||(u[_]=[]),u[_].push(h),u},{}),o=[];for(const[u,h]of Object.entries(a)){const f=this._processBatch(h,{apiUrl:u==="default"?void 0:u.split("|")[0],apiKey:u==="default"?void 0:u.split("|")[1]});o.push(f)}const l=Promise.all(o).finally(i);r.push(l)}return Promise.all(r)}async _processBatch(e,t){var r,s;if(e.length)try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{const i={runCreates:e.filter(o=>o.action==="create").map(o=>o.item),runUpdates:e.filter(o=>o.action==="update").map(o=>o.item)},a=await this._ensureServerInfo();if((r=a==null?void 0:a.batch_ingest_config)!=null&&r.use_multipart_endpoint){const o=(s=a==null?void 0:a.instance_flags)==null?void 0:s.gzip_body_enabled;await this.multipartIngestRuns(i,{...t,useGzip:o})}else await this.batchIngestRuns(i,t)}}catch(i){console.error("Error exporting batch:",i)}}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){const t=new Map,r=[];for(const s of e)s.item.id&&s.otelContext&&(t.set(s.item.id,s.otelContext),s.action==="create"?r.push({operation:"post",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}):r.push({operation:"patch",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}));this.langSmithToOTELTranslator.exportBatch(r,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=r9(e.item,this.cachedLSEnvVarsForMetadata);const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const r=await this._getBatchSizeLimitBytes(),s=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>r||this.autoBatchQueue.items.length>s)&&this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:s}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:s})},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const t=await(await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(ace),...this.fetchOptions});return await Ue(r,"get server info"),r})).json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes(),t=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t})}_cloneCurrentOTELContext(){const e=M$(),t=Ule();if(this.langSmithToOTELTranslator!==void 0){const r=e.getActiveSpan();if(r)return e.setSpan(t.active(),r)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;const r={...this.headers,"Content-Type":"application/json"},s=e.project_name;delete e.project_name;const i=await this.prepareRunCreateOrUpdateInputs({session_name:s,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){const l=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:i,otelContext:l,apiKey:t==null?void 0:t.apiKey,apiUrl:t==null?void 0:t.apiUrl}).catch(console.error);return}const a=r9(i,this.cachedLSEnvVarsForMetadata);(t==null?void 0:t.apiKey)!==void 0&&(r["x-api-key"]=t.apiKey),(t==null?void 0:t.workspaceId)!==void 0&&(r["x-tenant-id"]=t.workspaceId);const o=Qs(a,`Creating run with id: ${a.id}`);await this.caller.call(async()=>{const l=await this._fetch(`${(t==null?void 0:t.apiUrl)??this.apiUrl}/runs`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await Ue(l,"create run",!0),l})}async batchIngestRuns({runCreates:e,runUpdates:t},r){if(e===void 0&&t===void 0)return;let s=await Promise.all((e==null?void 0:e.map(l=>this.prepareRunCreateOrUpdateInputs(l)))??[]),i=await Promise.all((t==null?void 0:t.map(l=>this.prepareRunCreateOrUpdateInputs(l)))??[]);if(s.length>0&&i.length>0){const l=s.reduce((h,f)=>(f.id&&(h[f.id]=f),h),{}),u=[];for(const h of i)h.id!==void 0&&l[h.id]?l[h.id]={...l[h.id],...h}:u.push(h);s=Object.values(l),i=u}const a={post:s,patch:i};if(!a.post.length&&!a.patch.length)return;const o={post:[],patch:[]};for(const l of["post","patch"]){const u=l,h=a[u].reverse();let f=h.pop();for(;f!==void 0;)o[u].push(f),f=h.pop()}if(o.post.length>0||o.patch.length>0){const l=o.post.map(u=>u.id).concat(o.patch.map(u=>u.id)).join(",");await this._postBatchIngestRuns(Qs(o,`Ingesting runs with ids: ${l}`),r)}}async _postBatchIngestRuns(e,t){const r={...this.headers,"Content-Type":"application/json",Accept:"application/json"};(t==null?void 0:t.apiKey)!==void 0&&(r["x-api-key"]=t.apiKey),await this.batchIngestCaller.call(async()=>{const s=await this._fetch(`${(t==null?void 0:t.apiUrl)??this.apiUrl}/runs/batch`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await Ue(s,"batch create run",!0),s})}async multipartIngestRuns({runCreates:e,runUpdates:t},r){if(e===void 0&&t===void 0)return;const s={};let i=[];for(const f of e??[]){const p=await this.prepareRunCreateOrUpdateInputs(f);p.id!==void 0&&p.attachments!==void 0&&(s[p.id]=p.attachments),delete p.attachments,i.push(p)}let a=[];for(const f of t??[])a.push(await this.prepareRunCreateOrUpdateInputs(f));if(i.find(f=>f.trace_id===void 0||f.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(f=>f.trace_id===void 0||f.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&a.length>0){const f=i.reduce((y,_)=>(_.id&&(y[_.id]=_),y),{}),p=[];for(const y of a)y.id!==void 0&&f[y.id]?f[y.id]={...f[y.id],...y}:p.push(y);i=Object.values(f),a=p}if(i.length===0&&a.length===0)return;const u=[],h=[];for(const[f,p]of[["post",i],["patch",a]])for(const y of p){const{inputs:_,outputs:b,events:S,extra:E,error:C,serialized:v,attachments:I,...L}=y,R={inputs:_,outputs:b,events:S,extra:E,error:C,serialized:v},P=Qs(L,`Serializing for multipart ingestion of run with id: ${L.id}`);h.push({name:`${f}.${L.id}`,payload:new Blob([P],{type:`application/json; length=${P.length}`})});for(const[x,N]of Object.entries(R)){if(N===void 0)continue;const M=Qs(N,`Serializing ${x} for multipart ingestion of run with id: ${L.id}`);h.push({name:`${f}.${L.id}.${x}`,payload:new Blob([M],{type:`application/json; length=${M.length}`})})}if(L.id!==void 0){const x=s[L.id];if(x){delete s[L.id];for(const[N,M]of Object.entries(x)){let D,F;if(Array.isArray(M)?[D,F]=M:(D=M.mimeType,F=M.data),N.includes(".")){console.warn(`Skipping attachment '${N}' for run ${L.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}h.push({name:`attachment.${L.id}.${N}`,payload:new Blob([F],{type:`${D}; length=${F.byteLength}`})})}}}u.push(`trace=${L.trace_id},id=${L.id}`)}await this._sendMultipartRequest(h,u.join("; "),r)}async _createNodeFetchBody(e,t){const r=[];for(const a of e)r.push(new Blob([`--${t}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r
`,`Content-Type: ${a.payload.type}\r
\r
`])),r.push(a.payload),r.push(new Blob([`\r
`]));return r.push(new Blob([`--${t}--\r
`])),await new Blob(r).arrayBuffer()}async _createMultipartStream(e,t){const r=new TextEncoder;return new ReadableStream({async start(i){const a=async o=>{typeof o=="string"?i.enqueue(r.encode(o)):i.enqueue(o)};for(const o of e){await a(`--${t}\r
`),await a(`Content-Disposition: form-data; name="${o.name}"\r
`),await a(`Content-Type: ${o.payload.type}\r
\r
`);const u=o.payload.stream().getReader();try{let h;for(;!(h=await u.read()).done;)i.enqueue(h.value)}finally{u.releaseLock()}await a(`\r
`)}await a(`--${t}--\r
`),i.close()}})}async _sendMultipartRequest(e,t,r){const s="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),i=Ile(),a=()=>this._createNodeFetchBody(e,s),o=()=>this._createMultipartStream(e,s),l=async u=>this.batchIngestCaller.call(async()=>{const h=await u(),f={...this.headers,"Content-Type":`multipart/form-data; boundary=${s}`};(r==null?void 0:r.apiKey)!==void 0&&(f["x-api-key"]=r.apiKey);let p=h;r!=null&&r.useGzip&&typeof h=="object"&&"pipeThrough"in h&&(p=h.pipeThrough(new CompressionStream("gzip")),f["Content-Encoding"]="gzip");const y=await this._fetch(`${(r==null?void 0:r.apiUrl)??this.apiUrl}/runs/multipart`,{method:"POST",headers:f,body:p,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(y,"Failed to send multipart request",!0),y});try{let u,h=!1;!i&&!this.multipartStreamingDisabled&&R$()!=="bun"?(h=!0,u=await l(o)):u=await l(a),(!this.multipartStreamingDisabled||h)&&u.status===422&&((r==null?void 0:r.apiUrl)??this.apiUrl)!==i9&&(console.warn(`Streaming multipart upload to ${(r==null?void 0:r.apiUrl)??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,u=await l(a))}catch(u){console.warn(`${u.message.trim()}

Context: ${t}`)}}async updateRun(e,t,r){at(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));const s={...t,id:e};if(!this._filterForSampling([s],!0).length)return;if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){const o=this._cloneCurrentOTELContext();if(t.end_time!==void 0&&s.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:r==null?void 0:r.apiKey,apiUrl:r==null?void 0:r.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:r==null?void 0:r.apiKey,apiUrl:r==null?void 0:r.apiUrl}).catch(console.error);return}const i={...this.headers,"Content-Type":"application/json"};(r==null?void 0:r.apiKey)!==void 0&&(i["x-api-key"]=r.apiKey),(r==null?void 0:r.workspaceId)!==void 0&&(i["x-tenant-id"]=r.workspaceId);const a=Qs(t,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{const o=await this._fetch(`${(r==null?void 0:r.apiUrl)??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Ue(o,"update run",!0),o})}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){at(e);let r=await this._get(`/runs/${e}`);return t&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let s;t.session_id?s=t.session_id:r!=null&&r.projectName?s=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?s=r==null?void 0:r.projectId:s=(await this.readProject({projectName:Us("PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){var i;const t=await nce(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},s={};t.sort((a,o)=>((a==null?void 0:a.dotted_order)??"").localeCompare((o==null?void 0:o.dotted_order)??""));for(const a of t){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);(i=a.dotted_order)!=null&&i.startsWith(e.dotted_order??"")&&a.id!==e.id&&(a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),s[a.id]=a)}e.child_runs=r[e.id]||[];for(const a in r)a!==e.id&&(s[a].child_runs=r[a]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:l,isRoot:u,runType:h,error:f,id:p,query:y,filter:_,traceFilter:b,treeFilter:S,limit:E,select:C,order:v}=e;let I=[];if(t&&(I=Array.isArray(t)?t:[t]),r){const x=Array.isArray(r)?r:[r],N=await Promise.all(x.map(M=>this.readProject({projectName:M}).then(D=>D.id)));I.push(...N)}const L=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],R={session:I.length?I:null,run_type:h,reference_example:a,query:y,filter:_,trace_filter:b,tree_filter:S,execution_order:l,parent_run:s,start_time:o?o.toISOString():null,error:f,id:p,limit:E,trace:i,select:C||L,is_root:u,order:v};R.select.includes("child_run_ids")&&_I("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let P=0;for await(const x of this._getCursorPaginatedList("/runs/query",R))if(E){if(P>=E)break;if(x.length+P>E){yield*x.slice(0,E-P);break}P+=x.length,yield*x}else yield*x}async*listGroupRuns(e){const{projectId:t,projectName:r,groupBy:s,filter:i,startTime:a,endTime:o,limit:l,offset:u}=e,f={session_id:t||(await this.readProject({projectName:r})).id,group_by:s,filter:i,start_time:a?a.toISOString():null,end_time:o?o.toISOString():null,limit:Number(l)||100};let p=Number(u)||0;const y="/runs/group",_=`${this.apiUrl}${y}`;for(;;){const b={...f,offset:p},S=Object.fromEntries(Object.entries(b).filter(([R,P])=>P!==void 0)),E=JSON.stringify(S),v=await(await this.caller.call(async()=>{const R=await this._fetch(_,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:E});return await Ue(R,`Failed to fetch ${y}`),R})).json(),{groups:I,total:L}=v;if(I.length===0)break;for(const R of I)yield R;if(p+=I.length,p>=L)break}}async getRunStats({id:e,trace:t,parentRun:r,runType:s,projectNames:i,projectIds:a,referenceExampleIds:o,startTime:l,endTime:u,error:h,query:f,filter:p,traceFilter:y,treeFilter:_,isRoot:b,dataSourceType:S}){let E=a||[];i&&(E=[...a||[],...await Promise.all(i.map(P=>this.readProject({projectName:P}).then(x=>x.id)))]);const v=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:s,session:E,reference_example:o,start_time:l,end_time:u,error:h,query:f,filter:p,trace_filter:y,tree_filter:_,is_root:b,data_source_type:S}).filter(([P,x])=>x!==void 0)),I=JSON.stringify(v);return await(await this.caller.call(async()=>{const P=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:I});return await Ue(P,"get run stats"),P})).json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||rs()};at(e);const s=JSON.stringify(r),a=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await Ue(o,"share run"),o})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){at(e),await this.caller.call(async()=>{const t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(t,"unshare run",!0),t})}async readRunSharedLink(e){at(e);const r=await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(s,"read run shared link"),s})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const a of t)r.append("id",a);return at(e),await(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(a,"list shared runs"),a})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),at(e);const s=await(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(i,"read dataset shared schema"),i})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};at(e);const s=JSON.stringify(r),a=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await Ue(o,"share dataset"),o})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){at(e),await this.caller.call(async()=>{const t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(t,"unshare dataset",!0),t})}async readSharedDataset(e){return at(e),await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(s,"read shared dataset"),s})).json()}async listSharedExamples(e,t){const r={};t!=null&&t.exampleIds&&(r.id=t.exampleIds);const s=new URLSearchParams;Object.entries(r).forEach(([o,l])=>{Array.isArray(l)?l.forEach(u=>s.append(o,u)):s.append(o,l)});const i=await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(o,"list shared examples"),o}),a=await i.json();if(!i.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${Array.isArray(a.detail)?a.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`);return a.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){const o=s?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,u=i||{};r&&(u.metadata=r);const h={name:e,extra:u,description:t};a!==null&&(h.reference_dataset_id=a);const f=JSON.stringify(h);return await(await this.caller.call(async()=>{const _=await this._fetch(l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:f});return await Ue(_,"create project"),_})).json()}async updateProject(e,{name:t=null,description:r=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=i;s&&(l={...l||{},metadata:s});const u=JSON.stringify({name:t,extra:l,description:r,end_time:a?new Date(a).toISOString():null});return await(await this.caller.call(async()=>{const p=await this._fetch(o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await Ue(p,"update project"),p})).json()}async hasProject({projectId:e,projectName:t}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)at(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const i=await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(a,"has project"),a});try{const a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let s="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)at(e),s+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&i.append("include_stats",r.toString());const a=await this._get(s,i);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:s,referenceDatasetName:i,includeStats:a,datasetVersion:o,referenceFree:l,metadata:u}={}){const h=new URLSearchParams;if(e!==void 0)for(const f of e)h.append("id",f);if(t!==void 0&&h.append("name",t),r!==void 0&&h.append("name_contains",r),s!==void 0)h.append("reference_dataset",s);else if(i!==void 0){const f=await this.readDataset({datasetName:i});h.append("reference_dataset",f.id)}a!==void 0&&h.append("include_stats",a.toString()),o!==void 0&&h.append("dataset_version",o),l!==void 0&&h.append("reference_free",l.toString()),u!==void 0&&h.append("metadata",JSON.stringify(u));for await(const f of this._getPaginated("/sessions",h))yield*f}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,at(r),await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(s,`delete session ${r} (${t})`,!0),s})}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:s,description:i,dataType:a,name:o}){const l=`${this.apiUrl}/datasets/upload`,u=new FormData;return u.append("file",e,t),r.forEach(p=>{u.append("input_keys",p)}),s.forEach(p=>{u.append("output_keys",p)}),i&&u.append("description",i),a&&u.append("data_type",a),o&&u.append("name",o),await(await this.caller.call(async()=>{const p=await this._fetch(l,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await Ue(p,"upload CSV"),p})).json()}async createDataset(e,{description:t,dataType:r,inputsSchema:s,outputsSchema:i,metadata:a}={}){const o={name:e,description:t,extra:a?{metadata:a}:void 0};r&&(o.data_type=r),s&&(o.inputs_schema_definition=s),i&&(o.outputs_schema_definition=i);const l=JSON.stringify(o);return await(await this.caller.call(async()=>{const f=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await Ue(f,"create dataset"),f})).json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e&&t)throw new Error("Must provide either datasetName or datasetId, not both");if(e)at(e),r+=`/${e}`;else if(t)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(r,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:s}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:t})).id);const a=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:s,datasetNameContains:i,metadata:a}={}){const o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const u of r)l.append("id",u);s!==void 0&&l.append("name",s),i!==void 0&&l.append("name_contains",i),a!==void 0&&l.append("metadata",JSON.stringify(a));for await(const u of this._getPaginated(o,l))yield*u}async updateDataset(e){const{datasetId:t,datasetName:r,...s}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:r})).id;at(i);const a=JSON.stringify(s);return await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Ue(l,"update dataset"),l})).json()}async updateDatasetTag(e){const{datasetId:t,datasetName:r,asOf:s,tag:i}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:r})).id;at(a);const o=JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:i});await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await Ue(l,"update dataset tags",!0),l})}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)at(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{const i=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(i,`delete ${r}`,!0),i})}async indexDataset({datasetId:e,datasetName:t,tag:r}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),at(s);const a=JSON.stringify({tag:r});await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Ue(l,"index dataset"),l})).json()}async similarExamples(e,t,r,{filter:s}={}){const i={limit:r,inputs:e};s!==void 0&&(i.filter=s),at(t);const a=JSON.stringify(i);return(await(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/datasets/${t}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:a});return await Ue(u,"fetch similar examples"),u})).json()).examples}async createExample(e,t,r){var h;if(a9(e)&&(t!==void 0||r!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=t?r==null?void 0:r.datasetId:e.dataset_id;const i=t?r==null?void 0:r.datasetName:e.dataset_name;if(s===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:i})).id);const a=(t?r==null?void 0:r.createdAt:e.created_at)||new Date;let o;a9(e)?o=e:o={inputs:e,outputs:t,created_at:a==null?void 0:a.toISOString(),id:r==null?void 0:r.exampleId,metadata:r==null?void 0:r.metadata,split:r==null?void 0:r.split,source_run_id:r==null?void 0:r.sourceRunId,use_source_run_io:r==null?void 0:r.useSourceRunIO,use_source_run_attachments:r==null?void 0:r.useSourceRunAttachments,attachments:r==null?void 0:r.attachments};const l=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(((h=l.example_ids)==null?void 0:h[0])??rs())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const C=e;let v=C[0].dataset_id;const I=C[0].dataset_name;if(v===void 0&&I===void 0)throw new Error("Must provide either datasetName or datasetId");if(v!==void 0&&I!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");v===void 0&&(v=(await this.readDataset({datasetName:I})).id);const L=await this._uploadExamplesMultipart(v,C);return await Promise.all(L.example_ids.map(P=>this.readExample(P)))}const{inputs:t,outputs:r,metadata:s,splits:i,sourceRunIds:a,useSourceRunIOs:o,useSourceRunAttachments:l,attachments:u,exampleIds:h,datasetId:f,datasetName:p}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let y=f;const _=p;if(y===void 0&&_===void 0)throw new Error("Must provide either datasetName or datasetId");if(y!==void 0&&_!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");y===void 0&&(y=(await this.readDataset({datasetName:_})).id);const b=t.map((C,v)=>({dataset_id:y,inputs:C,outputs:r==null?void 0:r[v],metadata:s==null?void 0:s[v],split:i==null?void 0:i[v],id:h==null?void 0:h[v],attachments:u==null?void 0:u[v],source_run_id:a==null?void 0:a[v],use_source_run_io:o==null?void 0:o[v],use_source_run_attachments:l==null?void 0:l[v]})),S=await this._uploadExamplesMultipart(y,b);return await Promise.all(S.example_ids.map(C=>this.readExample(C)))}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const s=e.map(a=>H5(a)?q5(a):a),i=H5(t)?q5(t):t;return this.createExample({input:s},{output:i},r)}async readExample(e){at(e);const t=`/examples/${e}`,r=await this._get(t),{attachment_urls:s,...i}=r,a=i;return s&&(a.attachments=Object.entries(s).reduce((o,[l,u])=>(o[l.slice(11)]={presigned_url:u.presigned_url,mime_type:u.mime_type},o),{})),a}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:s,splits:i,inlineS3Urls:a,metadata:o,limit:l,offset:u,filter:h,includeAttachments:f}={}){let p;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)p=e;else if(t!==void 0)p=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const y=new URLSearchParams({dataset:p}),_=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;_&&y.append("as_of",_);const b=a??!0;if(y.append("inline_s3_urls",b.toString()),r!==void 0)for(const E of r)y.append("id",E);if(i!==void 0)for(const E of i)y.append("splits",E);if(o!==void 0){const E=JSON.stringify(o);y.append("metadata",E)}l!==void 0&&y.append("limit",l.toString()),u!==void 0&&y.append("offset",u.toString()),h!==void 0&&y.append("filter",h),f===!0&&["attachment_urls","outputs","metadata"].forEach(E=>y.append("select",E));let S=0;for await(const E of this._getPaginated("/examples",y)){for(const C of E){const{attachment_urls:v,...I}=C,L=I;v&&(L.attachments=Object.entries(v).reduce((R,[P,x])=>(R[P.slice(11)]={presigned_url:x.presigned_url,mime_type:x.mime_type||void 0},R),{})),yield L,S++}if(l!==void 0&&S>=l)break}}async deleteExample(e){at(e);const t=`/examples/${e}`;await this.caller.call(async()=>{const r=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(r,`delete ${t}`,!0),r})}async updateExample(e,t){let r;t?r=e:r=e.id,at(r);let s;t?s={id:r,...t}:s=e;let i;return s.dataset_id!==void 0?i=s.dataset_id:i=(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(i,[s])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:s}){let i;if(e?i=e:i=(await this.readDataset({datasetName:t})).id,at(i),r&&s||!r&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const a=new URLSearchParams;return r!==void 0&&a.append("as_of",typeof r=="string"?r:r.toISOString()),s!==void 0&&a.append("tag",s),await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${i}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(l,"read dataset version"),l})).json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,at(s);const i=new URLSearchParams,a=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return a&&i.append("as_of",a),await this._get(`/datasets/${s}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:s,remove:i=!1}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,at(a);const o={split_name:r,examples:s.map(u=>(at(u),u)),remove:i},l=JSON.stringify(o);await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await Ue(u,"update dataset splits",!0),u})}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){_I("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));const o=await t.evaluateRun(a,i),[l,u]=await this._logEvaluationFeedback(o,a,r);return u[0]}async createFeedback(e,t,{score:r,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:h,feedbackConfig:f,projectId:p,comparativeExperimentId:y}){var C;if(!e&&!p)throw new Error("One of runId or projectId must be provided");if(e&&p)throw new Error("Only one of runId or projectId can be provided");const _={type:l??"api",metadata:o??{}};u!==void 0&&(_==null?void 0:_.metadata)!==void 0&&!_.metadata.__run&&(_.metadata.__run={run_id:u}),(_==null?void 0:_.metadata)!==void 0&&((C=_.metadata.__run)==null?void 0:C.run_id)!==void 0&&at(_.metadata.__run.run_id);const b={id:h??rs(),run_id:e,key:t,score:s9(r),value:s,correction:i,comment:a,feedback_source:_,comparative_experiment_id:y,feedbackConfig:f,session_id:p},S=JSON.stringify(b),E=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{const v=await this._fetch(E,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:S});return await Ue(v,"create feedback",!0),v}),b}async updateFeedback(e,{score:t,value:r,correction:s,comment:i}){const a={};t!=null&&(a.score=s9(t)),r!=null&&(a.value=r),s!=null&&(a.correction=s),i!=null&&(a.comment=i),at(e);const o=JSON.stringify(a);await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await Ue(l,"update feedback",!0),l})}async readFeedback(e){at(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){at(e);const t=`/feedback/${e}`;await this.caller.call(async()=>{const r=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(r,`delete ${t}`,!0),r})}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(e)for(const i of e)at(i),s.append("run",i);if(t)for(const i of t)s.append("key",i);if(r)for(const i of r)s.append("source",i);for await(const i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:s}={}){const i={run_id:e,feedback_key:t,feedback_config:s};r?typeof r=="string"?i.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(i.expires_in=r):i.expires_in={hours:3};const a=JSON.stringify(i);return await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Ue(l,"create presigned feedback token"),l})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:s,description:i,metadata:a,id:o}){var f;if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:i,created_at:(f=s??new Date)==null?void 0:f.toISOString(),extra:{}};a&&(l.extra.metadata=a);const u=JSON.stringify(l);return(await this.caller.call(async()=>{const p=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await Ue(p,"create comparative experiment"),p})).json()}async*listPresignedFeedbackTokens(e){at(e);const t=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,r){const s=this._selectEvalResults(e),i=[];for(const a of s){let o=r||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let l=null;a.targetRunId?l=a.targetRunId:t&&(l=t.id),i.push(await this.createFeedback(l,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[s,i]}async logEvaluationFeedback(e,t,r){const[s]=await this._logEvaluationFeedback(e,t,r);return s}async*listAnnotationQueues(e={}){const{queueIds:t,name:r,nameContains:s,limit:i}=e,a=new URLSearchParams;t&&t.forEach((l,u)=>{at(l,`queueIds[${u}]`),a.append("ids",l)}),r&&a.append("name",r),s&&a.append("name_contains",s),a.append("limit",(i!==void 0?Math.min(i,100):100).toString());let o=0;for await(const l of this._getPaginated("/annotation-queues",a))if(yield*l,o++,i!==void 0&&o>=i)break}async createAnnotationQueue(e){const{name:t,description:r,queueId:s,rubricInstructions:i}=e,a={name:t,description:r,id:s||rs(),rubric_instructions:i},o=JSON.stringify(Object.fromEntries(Object.entries(a).filter(([u,h])=>h!==void 0)));return(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await Ue(u,"create annotation queue"),u})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${at(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(r,"read annotation queue"),r})).json()}async updateAnnotationQueue(e,t){const{name:r,description:s,rubricInstructions:i}=t,a=JSON.stringify({name:r,description:s,rubric_instructions:i});await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/annotation-queues/${at(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Ue(o,"update annotation queue",!0),o})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{const t=await this._fetch(`${this.apiUrl}/annotation-queues/${at(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(t,"delete annotation queue",!0),t})}async addRunsToAnnotationQueue(e,t){const r=JSON.stringify(t.map((s,i)=>at(s,`runIds[${i}]`).toString()));await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/annotation-queues/${at(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await Ue(s,"add runs to annotation queue",!0),s})}async getRunFromAnnotationQueue(e,t){const r=`/annotation-queues/${at(e,"queueId")}/run`;return(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(i,"get run from annotation queue"),i})).json()}async deleteRunFromAnnotationQueue(e,t){await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${at(e,"queueId")}/runs/${at(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(r,"delete run from annotation queue",!0),r})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${at(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(r,"get size from annotation queue"),r})).json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const r=await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(s,"get latest commit hash"),s})).json();if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[r,s,i]=El(e),a=JSON.stringify({like:t});return(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/likes/${r}/${s}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Ue(l,`${t?"like":"unlike"} prompt`),l})).json()}async _getPromptUrl(e){const[t,r,s]=El(e);if(await this._currentTenantIsOwner(t)){const i=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${r}/${s.substring(0,8)}?organizationId=${i.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${i.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const r of this._getPaginated("/repos",t,s=>s.repos))yield*r}async getPrompt(e){const[t,r,s]=El(e),i=await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return(o==null?void 0:o.status)===404?null:(await Ue(o,"get prompt"),o)}),a=await(i==null?void 0:i.json());return a!=null&&a.repo?a.repo:null}async createPrompt(e,t){const r=await this._getSettings();if(t!=null&&t.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,i,a]=El(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:i,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},l=JSON.stringify(o),u=await this.caller.call(async()=>{const f=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await Ue(f,"create prompt"),f}),{repo:h}=await u.json();return h}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,i,a]=El(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${s}/${i}`):r==null?void 0:r.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},u=JSON.stringify(l),f=await(await this.caller.call(async()=>{const p=await this._fetch(`${this.apiUrl}/commits/${s}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await Ue(p,"create commit"),p})).json();return this._getPromptUrl(`${s}/${i}${f.commit_hash?`:${f.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var a;if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const o of t){const l=o.id,u={...o.metadata&&{metadata:o.metadata},...o.split&&{split:o.split}},h=Qs(u,`Serializing body for example with id: ${l}`),f=new Blob([h],{type:"application/json"});if(r.append(l,f),o.inputs){const p=Qs(o.inputs,`Serializing inputs for example with id: ${l}`),y=new Blob([p],{type:"application/json"});r.append(`${l}.inputs`,y)}if(o.outputs){const p=Qs(o.outputs,`Serializing outputs whle updating example with id: ${l}`),y=new Blob([p],{type:"application/json"});r.append(`${l}.outputs`,y)}if(o.attachments)for(const[p,y]of Object.entries(o.attachments)){let _,b;Array.isArray(y)?[_,b]=y:(_=y.mimeType,b=y.data);const S=new Blob([b],{type:`${_}; length=${b.byteLength}`});r.append(`${l}.attachment.${p}`,S)}if(o.attachments_operations){const p=Qs(o.attachments_operations,`Serializing attachments while updating example with id: ${l}`),y=new Blob([p],{type:"application/json"});r.append(`${l}.attachments_operations`,y)}}const s=e??((a=t[0])==null?void 0:a.dataset_id);return(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${s}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await Ue(o,"update examples"),o})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const i of t){const a=(i.id??rs()).toString(),o={created_at:i.created_at,...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split},...i.source_run_id&&{source_run_id:i.source_run_id},...i.use_source_run_io&&{use_source_run_io:i.use_source_run_io},...i.use_source_run_attachments&&{use_source_run_attachments:i.use_source_run_attachments}},l=Qs(o,`Serializing body for uploaded example with id: ${a}`),u=new Blob([l],{type:"application/json"});if(r.append(a,u),i.inputs){const h=Qs(i.inputs,`Serializing inputs for uploaded example with id: ${a}`),f=new Blob([h],{type:"application/json"});r.append(`${a}.inputs`,f)}if(i.outputs){const h=Qs(i.outputs,`Serializing outputs for uploaded example with id: ${a}`),f=new Blob([h],{type:"application/json"});r.append(`${a}.outputs`,f)}if(i.attachments)for(const[h,f]of Object.entries(i.attachments)){let p,y;Array.isArray(f)?[p,y]=f:(p=f.mimeType,y=f.data);const _=new Blob([y],{type:`${p}; length=${y.byteLength}`});r.append(`${a}.attachment.${h}`,_)}}return(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await Ue(i,"upload examples"),i})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,s]=El(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const i={};if((t==null?void 0:t.description)!==void 0&&(i.description=t.description),(t==null?void 0:t.readme)!==void 0&&(i.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(i.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(i.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(i.is_archived=t.isArchived),Object.keys(i).length===0)throw new Error("No valid update options provided");const a=JSON.stringify(i);return(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/repos/${r}/${s}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Ue(l,"update prompt"),l})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,r,s]=El(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(a,"delete prompt"),a})).json()}async pullPromptCommit(e,t){const[r,s,i]=El(e),o=await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/commits/${r}/${s}/${i}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ue(l,"pull prompt commit"),l})).json();return{owner:r,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const r=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:r=this.apiUrl,datasetName:s}=t,[i,a]=this.parseTokenOrUrl(e,r),o=new Ug({apiUrl:i,apiKey:"placeholder"}),l=await o.readSharedDataset(a),u=s||l.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}const h=await o.listSharedExamples(a),f=await this.createDataset(u,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:h.map(p=>p.inputs),outputs:h.flatMap(p=>p.outputs?[p.outputs]:[]),datasetId:f.id})}catch(p){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),p}}parseTokenOrUrl(e,t,r=2,s="dataset"){try{return at(e),[t,e]}catch{}try{const a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=r){const o=a[a.length-r];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}async awaitPendingTraceBatches(){var e,t;if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:r})=>r),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await((t=(e=Vle())==null?void 0:e.DEFAULT_LANGSMITH_SPAN_PROCESSOR)==null?void 0:t.forceFlush())}}function a9(n){return"dataset_id"in n||"dataset_name"in n}const lce=n=>!!["TRACING_V2","TRACING"].find(t=>Us(t)==="true"),L2=Symbol.for("lc:context_variables");function uce(n){return n.replace(/[-:.]/g,"")}function H$(n,e,t=1){const r=t.toFixed(0).slice(0,3).padStart(3,"0"),s=`${new Date(n).toISOString().slice(0,-1)}${r}Z`;return{dottedOrder:uce(s)+e,microsecondPrecisionDatestring:s}}class kw{constructor(e,t,r,s){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=r,this.replicas=s}static fromHeader(e){const t=e.split(",");let r={},s=[],i,a;for(const o of t){const[l,u]=o.split("="),h=decodeURIComponent(u);l==="langsmith-metadata"?r=JSON.parse(h):l==="langsmith-tags"?s=h.split(","):l==="langsmith-project"?i=h:l==="langsmith-replicas"&&(a=JSON.parse(h))}return new kw(r,s,i,a)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class Fs{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),cce(e)){Object.assign(this,{...e});return}const t=Fs.getDefaultConfig(),{metadata:r,...s}=e,i=s.client??Fs.getSharedClient(),a={...r,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:a},Object.assign(this,{...t,...s,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=mce(this.replicas),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const{dottedOrder:l,microsecondPrecisionDatestring:u}=H$(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+l:this.dotted_order=l,this._serialized_start_time=u}}set metadata(e){var t;this.extra={...this.extra,metadata:{...(t=this.extra)==null?void 0:t.metadata,...e}}}get metadata(){var e;return(e=this.extra)==null?void 0:e.metadata}static getDefaultConfig(){return{id:rs(),run_type:"chain",project_name:k$(),child_runs:[],api_url:Xa("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Xa("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return Fs.sharedClient||(Fs.sharedClient=new Ug),Fs.sharedClient}createChild(e){var l,u,h,f,p,y;const t=this.child_execution_order+1,r=new Fs({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});L2 in this&&(r[L2]=this[L2]);const s=Symbol.for("lc:child_config"),i=((l=e.extra)==null?void 0:l[s])??this.extra[s];if(hce(i)){const _={...i},b=dce(_.callbacks)?(h=(u=_.callbacks).copy)==null?void 0:h.call(u):void 0;b&&(Object.assign(b,{_parentRunId:r.id}),(y=(p=(f=b.handlers)==null?void 0:f.find(q$))==null?void 0:p.updateFromRunTree)==null||y.call(p,r),_.callbacks=b),r.extra[s]=_}const a=new Set;let o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,r=!0){var o,l;const s=e.extra??{};if(((o=s==null?void 0:s.runtime)==null?void 0:o.library)===void 0&&(s.runtime||(s.runtime={}),t))for(const[u,h]of Object.entries(t))s.runtime[u]||(s.runtime[u]=h);let i,a;return r?(a=((l=e.parent_run)==null?void 0:l.id)??e.parent_run_id,i=[]):(i=e.child_runs.map(u=>this._convertToCreate(u,t,r)),a=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,r=!0){const s=this._convertToCreate(this,t,r);if(e===this.project_name)return s;const i=f=>g5(`${f}:${e}`,g5.DNS),a=i(s.id),o=s.trace_id?i(s.trace_id):void 0,l=s.parent_run_id?i(s.parent_run_id):void 0;let u;if(s.dotted_order){const f=fce(s.dotted_order),p=[];for(let _=0;_<f.length-1;_++){const[b,S]=f[_],E=i(S);p.push(b.toISOString().replace(/[-:]/g,"").replace(".","")+E)}const[y]=f[f.length-1];p.push(y.toISOString().replace(/[-:]/g,"").replace(".","")+a),u=p.join(".")}else u=void 0;return{...s,id:a,trace_id:o,parent_run_id:l,dotted_order:u,session_name:e}}async postRun(e=!0){try{const t=N$();if(this.replicas&&this.replicas.length>0)for(const{projectName:r,apiKey:s,apiUrl:i,workspaceId:a}of this.replicas){const o=this._remapForProject(r??this.project_name,t,!0);await this.client.createRun(o,{apiKey:s,apiUrl:i,workspaceId:a})}else{const r=this._convertToCreate(this,t,e);await this.client.createRun(r)}if(!e){_I("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const r of this.child_runs)await r.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(e){var t;if(this.replicas&&this.replicas.length>0)for(const{projectName:r,apiKey:s,apiUrl:i,workspaceId:a,updates:o}of this.replicas){const l=this._remapForProject(r??this.project_name),u={id:l.id,outputs:l.outputs,error:l.error,parent_run_id:l.parent_run_id,session_name:l.session_name,reference_example_id:l.reference_example_id,end_time:l.end_time,dotted_order:l.dotted_order,trace_id:l.trace_id,events:l.events,tags:l.tags,extra:l.extra,attachments:this.attachments,...o};e!=null&&e.excludeInputs||(u.inputs=l.inputs),await this.client.updateRun(l.id,u,{apiKey:s,apiUrl:i,workspaceId:a})}else try{const r={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:((t=this.parent_run)==null?void 0:t.id)??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e!=null&&e.excludeInputs||(r.inputs=this.inputs),await this.client.updateRun(this.id,r)}catch(r){console.error(`Error in patchRun for run ${this.id}`,r)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var u,h,f,p;const r=e==null?void 0:e.callbacks;let s,i,a,o=lce();if(r){const y=((u=r==null?void 0:r.getParentRunId)==null?void 0:u.call(r))??"",_=(h=r==null?void 0:r.handlers)==null?void 0:h.find(b=>(b==null?void 0:b.name)=="langchain_tracer");s=(f=_==null?void 0:_.getRun)==null?void 0:f.call(_,y),i=_==null?void 0:_.projectName,a=_==null?void 0:_.client,o=o||!!_}return s?new Fs({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:a,tracingEnabled:o,project_name:i,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(p=s==null?void 0:s.extra)==null?void 0:p.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new Fs({...t,client:a,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var u;const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=r["langsmith-trace"];if(!s||typeof s!="string")return;const i=s.trim(),a=i.split(".").map(h=>{const[f,p]=h.split("Z");return{strTime:f,time:Date.parse(f+"Z"),uuid:p}}),o=a[0].uuid,l={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(u=a.at(-1))==null?void 0:u.uuid,trace_id:o,dotted_order:i};if(r.baggage&&typeof r.baggage=="string"){const h=kw.fromHeader(r.baggage);l.metadata=h.metadata,l.tags=h.tags,l.project_name=h.project_name,l.replicas=h.replicas}return new Fs(l)}toHeaders(e){var r;const t={"langsmith-trace":this.dotted_order,baggage:new kw((r=this.extra)==null?void 0:r.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[s,i]of Object.entries(t))e.set(s,i);return t}}Object.defineProperty(Fs,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function cce(n){return n!=null&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function q$(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function o9(n){return Array.isArray(n)&&n.some(e=>q$(e))}function dce(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function hce(n){var e;return n!=null&&typeof n.callbacks=="object"&&(o9((e=n.callbacks)==null?void 0:e.handlers)||o9(n.callbacks))}function fce(n){return n.split(".").map(t=>{const r=t.slice(0,-36),s=t.slice(-36),i=parseInt(r.slice(0,4)),a=parseInt(r.slice(4,6))-1,o=parseInt(r.slice(6,8)),l=parseInt(r.slice(9,11)),u=parseInt(r.slice(11,13)),h=parseInt(r.slice(13,15)),f=parseInt(r.slice(15,21));return[new Date(i,a,o,l,u,h,f/1e3),s]})}function pce(){const n=Xa("LANGSMITH_RUNS_ENDPOINTS");if(!n)return[];try{const e=JSON.parse(n);if(Array.isArray(e)){const t=[];for(const r of e){if(typeof r!="object"||r===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof r}`);continue}if(typeof r.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof r.api_url}`);continue}if(typeof r.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof r.api_key}`);continue}t.push({apiUrl:r.api_url.replace(/\/$/,""),apiKey:r.api_key})}return t}else if(typeof e=="object"&&e!==null){gce(e);const t=[];for(const[r,s]of Object.entries(e)){const i=r.replace(/\/$/,"");if(typeof s=="string")t.push({apiUrl:i,apiKey:s});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${r}: expected string, got ${typeof s}`);continue}}return t}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS – must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof e}`),[]}catch(e){if(Kue(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS – must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function mce(n){return n?n.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):pce()}function gce(n){if(Object.keys(n).length>0&&Us("ENDPOINT"))throw new que}var _ce=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const yce=Jc(_ce);var K$={exports:{}};const vce=/[\p{Lu}]/u,wce=/[\p{Ll}]/u,l9=/^[\p{Lu}](?![\p{Lu}])/gu,Q$=/([\p{Alpha}\p{N}_]|$)/u,Y$=/[_.\- ]+/,bce=new RegExp("^"+Y$.source),u9=new RegExp(Y$.source+Q$.source,"gu"),c9=new RegExp("\\d+"+Q$.source,"gu"),Ece=(n,e,t)=>{let r=!1,s=!1,i=!1;for(let a=0;a<n.length;a++){const o=n[a];r&&vce.test(o)?(n=n.slice(0,a)+"-"+n.slice(a),r=!1,i=s,s=!0,a++):s&&i&&wce.test(o)?(n=n.slice(0,a-1)+"-"+n.slice(a-1),i=s,s=!1,r=!0):(r=e(o)===o&&t(o)!==o,i=s,s=t(o)===o&&e(o)!==o)}return n},Sce=(n,e)=>(l9.lastIndex=0,n.replace(l9,t=>e(t))),Tce=(n,e)=>(u9.lastIndex=0,c9.lastIndex=0,n.replace(u9,(t,r)=>e(r)).replace(c9,t=>e(t))),J$=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(i=>i.trim()).filter(i=>i.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),r=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=Ece(n,t,r)),n=n.replace(bce,""),e.preserveConsecutiveUppercase?n=Sce(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),Tce(n,r))};K$.exports=J$;K$.exports.default=J$;function Cce(n,e){return(e==null?void 0:e[n])||yce(n)}function Ice(n,e,t){const r={};for(const s in n)Object.hasOwn(n,s)&&(r[e(s,t)]=n[s]);return r}function d9(n){return Array.isArray(n)?[...n]:{...n}}function xce(n,e){const t=d9(n);for(const[r,s]of Object.entries(e)){const[i,...a]=r.split(".").reverse();let o=t;for(const l of a.reverse()){if(o[l]===void 0)break;o[l]=d9(o[l]),o=o[l]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}function X$(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class qc{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,X$(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([r])=>{var s;return(s=this.lc_serializable_keys)==null?void 0:s.includes(r)})):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof qc||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let i=this,a=r;const[o,...l]=s.split(".").reverse();for(const u of l.reverse()){if(!(u in i)||i[u]===void 0)return;(!(u in a)||a[u]===void 0)&&(typeof i[u]=="object"&&i[u]!=null?a[u]={}:Array.isArray(i[u])&&(a[u]=[])),i=i[u],a=a[u]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:Ice(Object.keys(t).length?xce(r,t):r,Cce,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}var M2={};const kce=()=>typeof window<"u"&&typeof window.document<"u",Pce=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Ace=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),lA=()=>typeof Deno<"u",Rce=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!lA(),Nce=()=>{let n;return kce()?n="browser":Rce()?n="node":Pce()?n="webworker":Ace()?n="jsdom":lA()?n="deno":n="other",n};let D2;function Oce(){return D2===void 0&&(D2={library:"langchain-js",runtime:Nce()}),D2}function lu(n){try{return typeof process<"u"?M2==null?void 0:M2[n]:lA()?Deno==null?void 0:Deno.env.get(n):void 0}catch{return}}class Lce{}function Mce(n){return"lc_prefer_streaming"in n&&n.lc_prefer_streaming}class C_ extends Lce{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,X$(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:lu("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return qc.prototype.toJSON.call(this)}toJSONNotImplemented(){return qc.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends C_{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:rs()}),Object.assign(this,e)}}return new t}}const Dce=n=>{const e=n;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"},Fce=n=>{if(n)return n.events=n.events??[],n.child_runs=n.child_runs??[],n};function wI(n,e){if(n)return new Fs({...n,start_time:n._serialized_start_time??n.start_time,parent_run:wI(e),child_runs:n.child_runs.map(t=>wI(t)).filter(t=>t!==void 0),extra:{...n.extra,runtime:Oce()},tracingEnabled:!1})}function F2(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function Hp(n){return typeof n._addRunToRunMap=="function"}class I_ extends C_{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?Fce(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const{dottedOrder:t,microsecondPrecisionDatestring:r}=H$(new Date(e.start_time).getTime(),e.id,e.execution_order),s={...e},i=this.getRunById(s.parent_run_id);if(s.parent_run_id!==void 0?i&&(this._addChildRun(i,s),i.child_execution_order=Math.max(i.child_execution_order,s.child_execution_order),s.trace_id=i.trace_id,i.dotted_order!==void 0&&(s.dotted_order=[i.dotted_order,t].join("."),s._serialized_start_time=r)):(s.trace_id=s.id,s.dotted_order=t,s._serialized_start_time=r),this.usesRunTreeMap){const a=wI(s,i);a!==void 0&&this.runTreeMap.set(s.id,a)}else this.runMap.set(s.id,s);return s}async _endTrace(e){var r;const t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await((r=this.onRunUpdate)==null?void 0:r.call(this,e)),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,s,i,a,o,l){const u=this._getExecutionOrder(s),h=Date.now(),f=o?{...i,metadata:o}:i,p={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:h,serialized:e,events:[{name:"start",time:new Date(h).toISOString()}],inputs:{prompts:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:f??{},tags:a||[]};return this._addRunToRunMap(p)}async handleLLMStart(e,t,r,s,i,a,o,l){var h,f;const u=this.getRunById(r)??this._createRunForLLMStart(e,t,r,s,i,a,o,l);return await((h=this.onRunCreate)==null?void 0:h.call(this,u)),await((f=this.onLLMStart)==null?void 0:f.call(this,u)),u}_createRunForChatModelStart(e,t,r,s,i,a,o,l){const u=this._getExecutionOrder(s),h=Date.now(),f=o?{...i,metadata:o}:i,p={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:h,serialized:e,events:[{name:"start",time:new Date(h).toISOString()}],inputs:{messages:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:f??{},tags:a||[]};return this._addRunToRunMap(p)}async handleChatModelStart(e,t,r,s,i,a,o,l){var h,f;const u=this.getRunById(r)??this._createRunForChatModelStart(e,t,r,s,i,a,o,l);return await((h=this.onRunCreate)==null?void 0:h.call(this,u)),await((f=this.onLLMStart)==null?void 0:f.call(this,u)),u}async handleLLMEnd(e,t,r,s,i){var o;const a=this.getRunById(t);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleLLMError(e,t,r,s,i){var o;const a=this.getRunById(t);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForChainStart(e,t,r,s,i,a,o,l){const u=this._getExecutionOrder(s),h=Date.now(),f={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:h,serialized:e,events:[{name:"start",time:new Date(h).toISOString()}],inputs:t,execution_order:u,child_execution_order:u,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(f)}async handleChainStart(e,t,r,s,i,a,o,l){var h,f;const u=this.getRunById(r)??this._createRunForChainStart(e,t,r,s,i,a,o,l);return await((h=this.onRunCreate)==null?void 0:h.call(this,u)),await((f=this.onChainStart)==null?void 0:f.call(this,u)),u}async handleChainEnd(e,t,r,s,i){var o;const a=this.getRunById(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=F2(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=F2(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,t,r,s,i){var o;const a=this.getRunById(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=F2(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForToolStart(e,t,r,s,i,a,o){const l=this._getExecutionOrder(s),u=Date.now(),h={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(h)}async handleToolStart(e,t,r,s,i,a,o){var u,h;const l=this.getRunById(r)??this._createRunForToolStart(e,t,r,s,i,a,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((h=this.onToolStart)==null?void 0:h.call(this,l)),l}async handleToolEnd(e,t){var s;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleToolError(e,t){var s;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,t){var i;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleAgentEnd(e,t){var s;const r=this.getRunById(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,r)))}_createRunForRetrieverStart(e,t,r,s,i,a,o){const l=this._getExecutionOrder(s),u=Date.now(),h={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:t},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(h)}async handleRetrieverStart(e,t,r,s,i,a,o){var u,h;const l=this.getRunById(r)??this._createRunForRetrieverStart(e,t,r,s,i,a,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((h=this.onRetrieverStart)==null?void 0:h.call(this,l)),l}async handleRetrieverEnd(e,t){var s;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,t){var s;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleText(e,t){var s;const r=this.getRunById(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,r)))}async handleLLMNewToken(e,t,r,s,i,a){var l;const o=this.getRunById(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a==null?void 0:a.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}}var uA={exports:{}};uA.exports;(function(n){const t=(i=0)=>a=>`\x1B[${38+i};5;${a}m`,r=(i=0)=>(a,o,l)=>`\x1B[${38+i};2;${a};${o};${l}m`;function s(){const i=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,l]of Object.entries(a)){for(const[u,h]of Object.entries(l))a[u]={open:`\x1B[${h[0]}m`,close:`\x1B[${h[1]}m`},l[u]=a[u],i.set(h[0],h[1]);Object.defineProperty(a,o,{value:l,enumerable:!1})}return Object.defineProperty(a,"codes",{value:i,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=r(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,l,u)=>o===l&&l===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(l/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!l)return[0,0,0];let{colorString:u}=l.groups;u.length===3&&(u=u.split("").map(f=>f+f).join(""));const h=Number.parseInt(u,16);return[h>>16&255,h>>8&255,h&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(n,"exports",{enumerable:!0,get:s})})(uA);var $ce=uA.exports;const Z$=Jc($ce);function ps(n,e){return`${n.open}${e}${n.close}`}function bi(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function h9(n){return typeof n=="string"?n.trim():n==null?n:bi(n,n.toString())}function Sl(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Ds}=Z$;class f9 extends I_{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const s=this.runMap.get(r.parent_run_id);if(s)t.push(s),r=s;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((s,i,a)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?ps(Z$.bold,o):o}).join(" > ");return ps(Ds.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${ps(Ds.green,"[chain/start]")} [${t}] Entering Chain run with input: ${bi(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${ps(Ds.cyan,"[chain/end]")} [${t}] [${Sl(e)}] Exiting Chain run with output: ${bi(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${ps(Ds.red,"[chain/error]")} [${t}] [${Sl(e)}] Chain run errored with error: ${bi(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${ps(Ds.green,"[llm/start]")} [${t}] Entering LLM run with input: ${bi(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${ps(Ds.cyan,"[llm/end]")} [${t}] [${Sl(e)}] Exiting LLM run with output: ${bi(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${ps(Ds.red,"[llm/error]")} [${t}] [${Sl(e)}] LLM run errored with error: ${bi(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${ps(Ds.green,"[tool/start]")} [${t}] Entering Tool run with input: "${h9(e.inputs.input)}"`)}onToolEnd(e){var r;const t=this.getBreadcrumbs(e);console.log(`${ps(Ds.cyan,"[tool/end]")} [${t}] [${Sl(e)}] Exiting Tool run with output: "${h9((r=e.outputs)==null?void 0:r.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${ps(Ds.red,"[tool/error]")} [${t}] [${Sl(e)}] Tool run errored with error: ${bi(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${ps(Ds.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${bi(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${ps(Ds.cyan,"[retriever/end]")} [${t}] [${Sl(e)}] Exiting Retriever run with output: ${bi(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${ps(Ds.red,"[retriever/error]")} [${t}] [${Sl(e)}] Retriever run errored with error: ${bi(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${ps(Ds.blue,"[agent/action]")} [${r}] Agent selected action: ${bi(t.actions[t.actions.length-1],"[action]")}`)}}function Yb(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function Bm(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}function jce(n){return!!(n&&typeof n=="object"&&"toolCall"in n&&n.toolCall!=null&&typeof n.toolCall=="object"&&"id"in n.toolCall&&typeof n.toolCall.id=="string")}class bI extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function p9(n,e=cA){n=n.trim();const t=n.indexOf("```");if(t===-1)return e(n);let r=n.substring(t+3);r.startsWith(`json
`)?r=r.substring(5):r.startsWith("json")?r=r.substring(4):r.startsWith(`
`)&&(r=r.substring(1));const s=r.indexOf("```");let i=r;return s!==-1&&(i=r.substring(0,s)),e(i.trim())}function cA(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="";const t=[];let r=!1,s=!1;for(let i of n){if(r)i==='"'&&!s?r=!1:i===`
`&&!s?i="\\n":i==="\\"?s=!s:s=!1;else if(i==='"')r=!0,s=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}r&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch{return null}}function Kc(n){return typeof n=="object"&&n!==null&&"type"in n&&typeof n.type=="string"&&"source_type"in n&&(n.source_type==="url"||n.source_type==="base64"||n.source_type==="text"||n.source_type==="id")}function Uce(n){return Kc(n)&&n.source_type==="url"&&"url"in n&&typeof n.url=="string"}function Vce(n){return Kc(n)&&n.source_type==="base64"&&"data"in n&&typeof n.data=="string"}function Bce(n){if(Kc(n)){if(n.source_type==="url")return{type:"image_url",image_url:{url:n.url}};if(n.source_type==="base64"){if(!n.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${n.mime_type};base64,${n.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function m9(n){const e=n.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${n}" - does not match type/subtype format.`);const t=e[0].trim(),r=e[1].trim();if(t===""||r==="")throw new Error(`Invalid mime type: "${n}" - type or subtype is empty.`);const s={};for(const i of n.split(";").slice(1)){const a=i.split("=");if(a.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${n}".`);const o=a[0].trim(),l=a[1].trim();if(o==="")throw new Error(`Invalid parameter syntax in mime type: "${n}".`);s[o]=l}return{type:t,subtype:r,parameters:s}}function g9({dataUrl:n,asTypedArray:e=!1}){const t=n.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let r;if(t){r=t[1].toLowerCase();const s=e?Uint8Array.from(atob(t[2]),i=>i.charCodeAt(0)):t[2];return{mime_type:r,data:s}}}function ej(n,e){if(n.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(n)}if(n.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(n)}if(n.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(n)}if(n.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(n)}throw new Error(`Unable to convert content block type '${n.type}' to provider-specific format: not recognized.`)}function Vf(n,e){return typeof n=="string"?n===""?e:typeof e=="string"?n+e:Array.isArray(e)&&e.some(t=>Kc(t))?[{type:"text",source_type:"text",text:n},...e]:[{type:"text",text:n},...e]:Array.isArray(e)?Jb(n,e)??[...n,...e]:e===""?n:Array.isArray(n)&&n.some(t=>Kc(t))?[...n,{type:"file",source_type:"text",text:e}]:[...n,{type:"text",text:e}]}function zce(n,e){return n==="error"||e==="error"?"error":"success"}function Gce(n,e){function t(r,s){if(typeof r!="object"||r===null||r===void 0)return r;if(s>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(a=>t(a,s+1));const i={};for(const a of Object.keys(r))i[a]=t(r[a],s+1);return i}return JSON.stringify(t(n,0),null,2)}class Ya extends qc{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=Gce(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function Es(n,e){const t={...n};for(const[r,s]of Object.entries(e))if(t[r]==null)t[r]=s;else{if(s==null)continue;if(typeof t[r]!=typeof s||Array.isArray(t[r])!==Array.isArray(s))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;["id","name","output_version","model_provider"].includes(r)?t[r]=s:t[r]+=s}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=Es(t[r],s);else if(Array.isArray(t[r]))t[r]=Jb(t[r],s);else{if(t[r]===s)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function Jb(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{const t=[...n];for(const r of e)if(typeof r=="object"&&r!==null&&"index"in r&&typeof r.index=="number"){const s=t.findIndex(i=>{const a=typeof i=="object",o="index"in i&&i.index===r.index,l="id"in i&&"id"in r&&(i==null?void 0:i.id)===(r==null?void 0:r.id),u=!("id"in i)||!(i!=null&&i.id)||!("id"in r)||!(r!=null&&r.id);return a&&o&&(l||u)});s!==-1&&typeof t[s]=="object"&&t[s]!==null?t[s]=Es(t[s],r):t.push(r)}else{if(typeof r=="object"&&r!==null&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}function Wce(n,e){if(!n&&!e)throw new Error("Cannot merge two undefined objects.");if(!n||!e)return n||e;if(typeof n!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof n}
Right ${typeof e}`);if(typeof n=="string"&&typeof e=="string")return n+e;if(Array.isArray(n)&&Array.isArray(e))return Jb(n,e);if(typeof n=="object"&&typeof e=="object")return Es(n,e);if(n===e)return n;throw new Error(`Can not merge objects of different types.
Left ${n}
Right ${e}`)}class Bf extends Ya{}function Hce(n){return typeof n.role=="string"}function x_(n){return typeof(n==null?void 0:n._getType)=="function"}function qce(n){return x_(n)&&typeof n.concat=="function"}function Kce(n){return n!=null&&typeof n=="object"&&"lc_direct_tool_output"in n&&n.lc_direct_tool_output===!0}class EI extends Ya{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status,this.metadata=e.metadata}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class dA extends Bf{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new dA({content:Vf(this.content,e.content),additional_kwargs:Es(this.additional_kwargs,e.additional_kwargs),response_metadata:Es(this.response_metadata,e.response_metadata),artifact:Wce(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:zce(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function Qce(n){const e=[],t=[];for(const r of n)if(r.function){const s=r.function.name;try{const i=JSON.parse(r.function.arguments),a={name:s||"",args:i||{},id:r.id};e.push(a)}catch{t.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}class ff extends Ya{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var s;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;const i=(s=r.additional_kwargs)==null?void 0:s.tool_calls,a=r.tool_calls;i!=null&&i.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(i!=null&&a===void 0){const[o,l]=Qce(i);r.tool_calls=o??[],r.invalid_tool_calls=l??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function k_(n){return n._getType()==="ai"}function _9(n){return n._getType()==="ai"}class Tu extends Bf{constructor(e){var r,s;let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const i=e.tool_call_chunks.reduce((l,u)=>{const h=l.findIndex(([f])=>"id"in u&&u.id&&"index"in u&&u.index!==void 0?u.id===f.id&&u.index===f.index:"id"in u&&u.id?u.id===f.id:"index"in u&&u.index!==void 0?u.index===f.index:!1);return h!==-1?l[h].push(u):l.push([u]),l},[]),a=[],o=[];for(const l of i){let u={};const h=((r=l[0])==null?void 0:r.name)??"",f=l.map(_=>_.args||"").join(""),p=f.length?f:"{}",y=(s=l[0])==null?void 0:s.id;try{if(u=cA(p),!y||u===null||typeof u!="object"||Array.isArray(u))throw new Error("Malformed tool call chunk args.");a.push({name:h,args:u,id:y,type:"tool_call"})}catch{o.push({name:h,args:p,id:y,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:a,invalid_tool_calls:o,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var r,s,i,a,o,l,u,h,f,p,y,_,b,S,E,C,v,I,L,R,P,x,N,M,D,F,$,H,G,ue,ae,z,Q,ee,se,le,ye,ve,de,Me;const t={content:Vf(this.content,e.content),additional_kwargs:Es(this.additional_kwargs,e.additional_kwargs),response_metadata:Es(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const B=Jb(this.tool_call_chunks,e.tool_call_chunks);B!==void 0&&B.length>0&&(t.tool_call_chunks=B)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const B={...(((s=(r=this.usage_metadata)==null?void 0:r.input_token_details)==null?void 0:s.audio)!==void 0||((a=(i=e.usage_metadata)==null?void 0:i.input_token_details)==null?void 0:a.audio)!==void 0)&&{audio:(((l=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:l.audio)??0)+(((h=(u=e.usage_metadata)==null?void 0:u.input_token_details)==null?void 0:h.audio)??0)},...(((p=(f=this.usage_metadata)==null?void 0:f.input_token_details)==null?void 0:p.cache_read)!==void 0||((_=(y=e.usage_metadata)==null?void 0:y.input_token_details)==null?void 0:_.cache_read)!==void 0)&&{cache_read:(((S=(b=this.usage_metadata)==null?void 0:b.input_token_details)==null?void 0:S.cache_read)??0)+(((C=(E=e.usage_metadata)==null?void 0:E.input_token_details)==null?void 0:C.cache_read)??0)},...(((I=(v=this.usage_metadata)==null?void 0:v.input_token_details)==null?void 0:I.cache_creation)!==void 0||((R=(L=e.usage_metadata)==null?void 0:L.input_token_details)==null?void 0:R.cache_creation)!==void 0)&&{cache_creation:(((x=(P=this.usage_metadata)==null?void 0:P.input_token_details)==null?void 0:x.cache_creation)??0)+(((M=(N=e.usage_metadata)==null?void 0:N.input_token_details)==null?void 0:M.cache_creation)??0)}},Z={...(((F=(D=this.usage_metadata)==null?void 0:D.output_token_details)==null?void 0:F.audio)!==void 0||((H=($=e.usage_metadata)==null?void 0:$.output_token_details)==null?void 0:H.audio)!==void 0)&&{audio:(((ue=(G=this.usage_metadata)==null?void 0:G.output_token_details)==null?void 0:ue.audio)??0)+(((z=(ae=e.usage_metadata)==null?void 0:ae.output_token_details)==null?void 0:z.audio)??0)},...(((ee=(Q=this.usage_metadata)==null?void 0:Q.output_token_details)==null?void 0:ee.reasoning)!==void 0||((le=(se=e.usage_metadata)==null?void 0:se.output_token_details)==null?void 0:le.reasoning)!==void 0)&&{reasoning:(((ve=(ye=this.usage_metadata)==null?void 0:ye.output_token_details)==null?void 0:ve.reasoning)??0)+(((Me=(de=e.usage_metadata)==null?void 0:de.output_token_details)==null?void 0:Me.reasoning)??0)}},be=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Ce=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Le={input_tokens:be.input_tokens+Ce.input_tokens,output_tokens:be.output_tokens+Ce.output_tokens,total_tokens:be.total_tokens+Ce.total_tokens,...Object.keys(B).length>0&&{input_token_details:B},...Object.keys(Z).length>0&&{output_token_details:Z}};t.usage_metadata=Le}return new Tu(t)}}class gd extends Ya{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return gd}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class Xb extends Bf{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Xb({content:Vf(this.content,e.content),additional_kwargs:Es(this.additional_kwargs,e.additional_kwargs),response_metadata:Es(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class Zb extends Bf{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Zb({content:Vf(this.content,e.content),additional_kwargs:Es(this.additional_kwargs,e.additional_kwargs),response_metadata:Es(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class zf extends Ya{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}}class eE extends Bf{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new eE({content:Vf(this.content,e.content),additional_kwargs:Es(this.additional_kwargs,e.additional_kwargs),response_metadata:Es(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class Yce extends Ya{constructor(e){super({...e,content:""}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e.id}_getType(){return"remove"}get _printableFields(){return{...super._printableFields,id:this.id}}}class SI extends Ya{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}}class Vg extends Bf{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new Vg({content:Vf(this.content,e.content),additional_kwargs:Es(this.additional_kwargs,e.additional_kwargs),response_metadata:Es(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function Jce(n){return Bm(n)?n:typeof n.id=="string"&&n.type==="function"&&typeof n.function=="object"&&n.function!==null&&"arguments"in n.function&&typeof n.function.arguments=="string"&&"name"in n.function&&typeof n.function.name=="string"?{id:n.id,args:JSON.parse(n.function.arguments),name:n.function.name,type:"tool_call"}:n}function Xce(n){return typeof n=="object"&&n!=null&&n.lc===1&&Array.isArray(n.id)&&n.kwargs!=null&&typeof n.kwargs=="object"}function $2(n){let e,t;if(Xce(n)){const r=n.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?e="user":r==="AIMessage"||r==="AIMessageChunk"?e="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?e="system":r==="FunctionMessage"||r==="FunctionMessageChunk"?e="function":r==="ToolMessage"||r==="ToolMessageChunk"?e="tool":e="unknown",t=n.kwargs}else{const{type:r,...s}=n;e=r,t=s}if(e==="human"||e==="user")return new zf(t);if(e==="ai"||e==="assistant"){const{tool_calls:r,...s}=t;if(!Array.isArray(r))return new ff(t);const i=r.map(Jce);return new ff({...s,tool_calls:i})}else{if(e==="system")return new SI(t);if(e==="developer")return new SI({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new EI({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});if(e==="remove"&&"id"in t&&typeof t.id=="string")return new Yce({...t,id:t.id});throw Yb(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(n,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function zl(n){if(typeof n=="string")return new zf(n);if(x_(n))return n;if(Array.isArray(n)){const[e,t]=n;return $2({type:e,content:t})}else if(Hce(n)){const{role:e,...t}=n;return $2({...t,type:e})}else return $2(n)}function tj(n,e="Human",t="AI"){const r=[];for(const s of n){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="tool")i="Tool";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const a=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);r.push(`${i}: ${a}${o}`)}return r.join(`
`)}function Zce(n){var t;const e=n._getType();if(e==="human")return new eE({...n});if(e==="ai"){let r={...n};return"tool_calls"in r&&(r={...r,tool_call_chunks:(t=r.tool_calls)==null?void 0:t.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new Tu({...r})}else{if(e==="system")return new Vg({...n});if(e==="function")return new Zb({...n});if(gd.isInstance(n))return new Xb({...n});throw new Error("Unknown message type.")}}let j2;const ede=()=>{if(j2===void 0){const n=lu("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};j2=new Ug(n)}return j2};class zm extends I_{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});const{exampleId:t,projectName:r,client:s,replicas:i}=e;this.projectName=r??k$(),this.replicas=i,this.exampleId=t,this.client=s??ede();const a=zm.getTraceableRunTree();a&&this.updateFromRunTree(a)}async persistRun(e){}async onRunCreate(e){const t=this.getRunTreeWithTracingConfig(e.id);await(t==null?void 0:t.postRun())}async onRunUpdate(e){const t=this.getRunTreeWithTracingConfig(e.id);await(t==null?void 0:t.patchRun())}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){this.runTreeMap.set(e.id,e);let t=e;const r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();const s=[t];for(;s.length>0;){const i=s.shift();!i||r.has(i.id)||(r.add(i.id),this.runTreeMap.set(i.id,i),i.child_runs&&s.push(...i.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){const t=this.runTreeMap.get(e);if(t)return new Fs({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return Goe(!0)}catch{return}}}const nj=Symbol.for("ls:tracing_async_local_storage"),ev=Symbol.for("lc:context_variables"),tde=n=>{globalThis[nj]=n},Bg=()=>globalThis[nj];let Gm;function nde(){const n="default"in jo?jo.default:jo;return new n({autoStart:!0,concurrency:1})}function rde(){return typeof Gm>"u"&&(Gm=nde()),Gm}async function nr(n,e){if(e===!0){const t=Bg();t!==void 0?await t.run(void 0,async()=>n()):await n()}else Gm=rde(),Gm.add(async()=>{const t=Bg();t!==void 0?await t.run(void 0,async()=>n()):await n()})}const sde=n=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>lu(t)==="true");function rj(n){var r;const e=Bg();if(e===void 0)return;const t=e.getStore();return(r=t==null?void 0:t[ev])==null?void 0:r[n]}const ide=Symbol("lc:configure_hooks"),ade=()=>rj(ide)||[];function ode(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}class lde{setHandler(e){return this.setHandlers([e])}}class tE{constructor(e,t,r,s,i,a,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,s,i){await Promise.all(this.handlers.map(a=>nr(async()=>{var o;try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,this.runId,this.tags,this.metadata))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}}class ude extends tE{getChild(e){const t=new vs(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw s}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`),t.raiseError)throw e}},t.awaitHandlers)))}}class y9 extends tE{async handleLLMNewToken(e,t,r,s,i,a){await Promise.all(this.handlers.map(o=>nr(async()=>{var l;if(!o.ignoreLLM)try{await((l=o.handleLLMNewToken)==null?void 0:l.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}async handleLLMError(e,t,r,s,i){await Promise.all(this.handlers.map(a=>nr(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleLLMEnd(e,t,r,s,i){await Promise.all(this.handlers.map(a=>nr(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}}class cde extends tE{getChild(e){const t=new vs(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,s,i){await Promise.all(this.handlers.map(a=>nr(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleChainEnd(e,t,r,s,i){await Promise.all(this.handlers.map(a=>nr(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class dde extends tE{getChild(e){const t=new vs(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class vs extends lde{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,s=void 0,i=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,h)=>{const f=h===0&&r?r:rs();return await Promise.all(this.handlers.map(p=>{if(!p.ignoreLLM)return Hp(p)&&p._createRunForLLMStart(e,[u],f,this._parentRunId,i,this.tags,this.metadata,l),nr(async()=>{var y;try{await((y=p.handleLLMStart)==null?void 0:y.call(p,e,[u],f,this._parentRunId,i,this.tags,this.metadata,l))}catch(_){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleLLMStart: ${_}`),p.raiseError)throw _}},p.awaitHandlers)})),new y9(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,s=void 0,i=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,h)=>{const f=h===0&&r?r:rs();return await Promise.all(this.handlers.map(p=>{if(!p.ignoreLLM)return Hp(p)&&p._createRunForChatModelStart(e,[u],f,this._parentRunId,i,this.tags,this.metadata,l),nr(async()=>{var y,_;try{if(p.handleChatModelStart)await((y=p.handleChatModelStart)==null?void 0:y.call(p,e,[u],f,this._parentRunId,i,this.tags,this.metadata,l));else if(p.handleLLMStart){const b=tj(u);await((_=p.handleLLMStart)==null?void 0:_.call(p,e,[b],f,this._parentRunId,i,this.tags,this.metadata,l))}}catch(b){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleLLMStart: ${b}`),p.raiseError)throw b}},p.awaitHandlers)})),new y9(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=rs(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return Hp(l)&&l._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,s,o),nr(async()=>{var u;try{await((u=l.handleChainStart)==null?void 0:u.call(l,e,t,r,this._parentRunId,this.tags,this.metadata,s,o))}catch(h){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${h}`),l.raiseError)throw h}},l.awaitHandlers)})),new cde(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=rs(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return Hp(l)&&l._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),nr(async()=>{var u;try{await((u=l.handleToolStart)==null?void 0:u.call(l,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(h){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${h}`),l.raiseError)throw h}},l.awaitHandlers)})),new dde(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=rs(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return Hp(l)&&l._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),nr(async()=>{var u;try{await((u=l.handleRetrieverStart)==null?void 0:u.call(l,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(h){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${h}`),l.raiseError)throw h}},l.awaitHandlers)})),new ude(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,s,i){await Promise.all(this.handlers.map(a=>nr(async()=>{var o;if(!a.ignoreCustomEvent)try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,r,this.tags,this.metadata))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new vs(this._parentRunId);for(const s of this.handlers){const i=this.inheritableHandlers.includes(s);r.addHandler(s,i)}for(const s of this.tags){const i=this.inheritableTags.includes(s);r.addTags([s],i)}for(const s of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},i)}for(const s of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||r.addHandler(s,t);return r}static fromHandlers(e){class t extends C_{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:rs()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static configure(e,t,r,s,i,a,o){return this._configureSync(e,t,r,s,i,a,o)}static _configureSync(e,t,r,s,i,a,o){var p;let l;(e||t)&&(Array.isArray(e)||!e?(l=new vs,l.setHandlers((e==null?void 0:e.map(Pw))??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(Pw):t==null?void 0:t.handlers,!1));const u=lu("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),h=((p=zm.getTraceableRunTree())==null?void 0:p.tracingEnabled)||sde(),f=h||(lu("LANGCHAIN_TRACING")??!1);if(u||f){if(l||(l=new vs),u&&!l.handlers.some(y=>y.name===f9.prototype.name)){const y=new f9;l.addHandler(y,!0)}if(f&&!l.handlers.some(y=>y.name==="langchain_tracer")&&h){const y=new zm;l.addHandler(y,!0)}if(h){const y=zm.getTraceableRunTree();if(y&&l._parentRunId===void 0){l._parentRunId=y.id;const _=l.handlers.find(b=>b.name==="langchain_tracer");_==null||_.updateFromRunTree(y)}}}for(const{contextVar:y,inheritable:_=!0,handlerClass:b,envVar:S}of ade()){const E=S&&lu(S)==="true"&&b;let C;const v=y!==void 0?rj(y):void 0;v&&Dce(v)?C=v:E&&(C=new b({})),C!==void 0&&(l||(l=new vs),l.handlers.some(I=>I.name===C.name)||l.addHandler(C,_))}return(r||s)&&l&&(l.addTags(r??[]),l.addTags(s??[],!1)),(i||a)&&l&&(l.addMetadata(i??{}),l.addMetadata(a??{},!1)),l}}function Pw(n){return"name"in n?n:C_.fromMethods(n)}class hde{getStore(){}run(e,t){return t()}enterWith(e){}}const fde=new hde,v9=Symbol.for("lc:child_config");class pde{getInstance(){return Bg()??fde}getRunnableConfig(){var t,r;return(r=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:r[v9]}runWithConfig(e,t,r){var h;const s=vs._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),i=this.getInstance(),a=i.getStore(),o=s==null?void 0:s.getParentRunId(),l=(h=s==null?void 0:s.handlers)==null?void 0:h.find(f=>(f==null?void 0:f.name)==="langchain_tracer");let u;return l&&o?u=l.getRunTreeWithTracingConfig(o):r||(u=new Fs({name:"<runnable_lambda>",tracingEnabled:!1})),u&&(u.extra={...u.extra,[v9]:e}),a!==void 0&&a[ev]!==void 0&&(u===void 0&&(u={}),u[ev]=a[ev]),i.run(u,t)}initializeGlobalInstance(e){Bg()===void 0&&tde(e)}}const Cu=new pde,U2=25;async function ua(n){return vs._configureSync(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function TI(...n){const e={};for(const t of n.filter(r=>!!r))for(const r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){const s=e[r]??[];e[r]=[...new Set(s.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){const s=e.callbacks,i=t.callbacks;if(Array.isArray(i))if(!s)e.callbacks=i;else if(Array.isArray(s))e.callbacks=s.concat(i);else{const a=s.copy();for(const o of i)a.addHandler(Pw(o),!0);e.callbacks=a}else if(i)if(!s)e.callbacks=i;else if(Array.isArray(s)){const a=i.copy();for(const o of s)a.addHandler(Pw(o),!0);e.callbacks=a}else e.callbacks=new vs(i._parentRunId,{handlers:s.handlers.concat(i.handlers),inheritableHandlers:s.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(i.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(i.inheritableTags))),metadata:{...s.metadata,...i.metadata}})}else{const s=r;e[s]=t[s]??e[s]}return e}const mde=new Set(["string","number","boolean"]);function jt(n){var r;const e=Cu.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:i,...a}=e;t=Object.entries(a).reduce((o,[l,u])=>(u!==void 0&&(o[l]=u),o),t)}if(n&&(t=Object.entries(n).reduce((s,[i,a])=>(a!==void 0&&(s[i]=a),s),t)),t!=null&&t.configurable)for(const s of Object.keys(t.configurable))mde.has(typeof t.configurable[s])&&!((r=t.metadata)!=null&&r[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=t.configurable[s]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const s=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,s])):t.signal=s,delete t.timeout}return t}function ss(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:s,configurable:i,runId:a}={}){const o=jt(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),i!==void 0&&(o.configurable={...o.configurable,...i}),a!==void 0&&delete o.runId,o}function pf(n){return n?{configurable:n.configurable,recursionLimit:n.recursionLimit,callbacks:n.callbacks,tags:n.tags,metadata:n.metadata,maxConcurrency:n.maxConcurrency,timeout:n.timeout,signal:n.signal}:void 0}async function Iu(n,e){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!(e!=null&&e.aborted))throw r}),new Promise((r,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class li extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new li({start(r){return s();function s(){return t.read().then(({done:i,value:a})=>{if(i){r.close();return}return r.enqueue(a),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new li({async pull(t){const{value:r,done:s}=await e.next();s&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function sj(n,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){const i=await n.next();for(const a of t)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function nE(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){const t={...n};for(const[r,s]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=nE(t[r],s):t[r]=s;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}class Gf{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((r,s)=>{Cu.runWithConfig(pf(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(r,s):this.firstResult.then(i=>r(void 0),s)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?Cu.runWithConfig(pf(this.config),this.signal?async()=>Iu(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function gde(n,e,t,r,...s){const i=new Gf({generator:e,startSetup:t,signal:r}),a=await i.setup;return{output:n(i,a,...s),setup:a}}class Al{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=Cw({},t);return new zg({ops:t,state:r[r.length-1].newDocument})}}class zg extends Al{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=Cw(this.state,e.ops);return new zg({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=Cw({},e.ops);return new zg({ops:e.ops,state:t[t.length-1].newDocument})}}const _de=n=>n.name==="log_stream_tracer";async function w9(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function b9(n,e){const{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function yde(n){return n!==void 0&&n.message!==void 0}class E9 extends I_{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=li.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new Al({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Al({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await w9(e,this._schemaFormat)),await this.writer.write(new Al({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await w9(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await b9(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const s=new Al({ops:r});await this.writer.write(s)}finally{if(e.id===this.rootId){const t=new Al({ops:[{op:"replace",path:"/final_output",value:await b9(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const i=e.inputs.messages!==void 0;let a;i?yde(r==null?void 0:r.chunk)?a=r==null?void 0:r.chunk:a=new Tu({id:`run-${e.id}`,content:t}):a=t;const o=new Al({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}}const S9="__run";class mf{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new mf({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Qc extends mf{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Qc({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function g0({name:n,serialized:e}){return n!==void 0?n:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const vde=n=>n.name==="event_stream_tracer";class wde extends I_{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=li.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),r}async*tapOutputIterable(e,t){const r=await t.next();if(r.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield r.value;return}function i(o,l){return o==="llm"&&typeof l=="string"?new mf({text:l}):l}let a=this.tappedPromises.get(e);if(a===void 0){let o;a=new Promise(l=>{o=l}),this.tappedPromises.set(e,a);try{const l={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...l,data:{chunk:i(s.runType,r.value)}},s),yield r.value;for await(const u of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...l,data:{chunk:i(s.runType,u)}},s),yield u}finally{o()}}else{yield r.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var a,o;const t=g0(e),r=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,s);const i=`on_${r}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,t,r){const s=this.runInfoMap.get(e.id);let i,a;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")a="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?i=new Tu({content:t,id:`run-${e.id}`}):i=r.chunk.message;else if(s.runType==="llm")a="on_llm_stream",(r==null?void 0:r.chunk)===void 0?i=new mf({text:t}):i=r.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:a,data:{chunk:i},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var a,o,l;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(a=e.outputs)==null?void 0:a.generations;let i;if(t.runType==="chat_model"){for(const u of s??[]){if(i!==void 0)break;i=(o=u[0])==null?void 0:o.message}r="on_chat_model_end"}else if(t.runType==="llm")i={generations:s==null?void 0:s.map(u=>u.map(h=>({text:h.text,generationInfo:h.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var a,o;const t=g0(e),r=e.run_type??"chain",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:e.run_type};let i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},s.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,s.inputs=e.inputs.input):(i.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${r}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},a={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(a.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:r,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var s,i;const t=g0(e),r={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{}},r)}async onToolEnd(e){var s;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var i,a;const t=g0(e),s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((a=e.extra)==null?void 0:a.metadata)??{}},s)}async onRetrieverEnd(e){var r;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){const s=this.runInfoMap.get(r);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const bde=[400,401,402,403,404,405,406,407,409],Ede=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&bde.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const s=new Error(n==null?void 0:n.message);throw s.name="InsufficientQuotaError",s}};class hA{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??Ede;const t="default"in jo?jo.default:jo;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Tw(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class ij extends I_{constructor({config:e,onStart:t,onEnd:r,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function fA(n){return n?n.lc_runnable:!1}class Sde{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||s.some(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&s.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),r}}function V2(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}const Tde=["*","_","`"];function Cde(n){let e="";for(const[t,r]of Object.entries(n))e+=`	classDef ${t} ${r};
`;return e}function Ide(n,e,t){const{firstNode:r,lastNode:s,nodeColors:i,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=t??{};let u=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){const y="default",_={[y]:"{0}({1})"};r!==void 0&&(_[r]="{0}([{1}]):::first"),s!==void 0&&(_[s]="{0}([{1}]):::last");for(const[b,S]of Object.entries(n)){const E=S.name.split(":").pop()??"";let v=Tde.some(L=>E.startsWith(L)&&E.endsWith(L))?`<p>${E}</p>`:E;Object.keys(S.metadata??{}).length&&(v+=`<hr/><small><em>${Object.entries(S.metadata??{}).map(([L,R])=>`${L} = ${R}`).join(`
`)}</em></small>`);const I=(_[b]??_[y]).replace("{0}",V2(b)).replace("{1}",v);u+=`	${I}
`}}const h={};for(const y of e){const _=y.source.split(":"),b=y.target.split(":"),S=_.filter((E,C)=>E===b[C]).join(":");h[S]||(h[S]=[]),h[S].push(y)}const f=new Set;function p(y,_){const b=y.length===1&&y[0].source===y[0].target;if(_&&!b){const S=_.split(":").pop();if(f.has(S))throw new Error(`Found duplicate subgraph '${S}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);f.add(S),u+=`	subgraph ${S}
`}for(const S of y){const{source:E,target:C,data:v,conditional:I}=S;let L="";if(v!==void 0){let R=v;const P=R.split(" ");P.length>l&&(R=Array.from({length:Math.ceil(P.length/l)},(x,N)=>P.slice(N*l,(N+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),L=I?` -. &nbsp;${R}&nbsp; .-> `:` -- &nbsp;${R}&nbsp; --> `}else L=I?" -.-> ":" --> ";u+=`	${V2(E)}${L}${V2(C)};
`}for(const S in h)S.startsWith(`${_}:`)&&S!==_&&p(h[S],S);_&&!b&&(u+=`	end
`)}p(h[""]??[],"");for(const y in h)!y.includes(":")&&y!==""&&p(h[y],y);return a&&(u+=Cde(i??{})),u}async function xde(n,e){return kde(n,{...e,imageType:"png"})}async function kde(n,e){let t=(e==null?void 0:e.backgroundColor)??"white";const r=e==null?void 0:e.imageType,s=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const i=`https://mermaid.ink/img/${s}?bgColor=${t}&type=${r}`,a=await fetch(i);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}function rE(n,e,t){function r(o,l){var u;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(u=o._zod).traits??(u.traits=new Set),o._zod.traits.add(n),e(o,l);for(const h in a.prototype)h in o||Object.defineProperty(o,h,{value:a.prototype[h].bind(o)});o._zod.constr=a,o._zod.def=l}const s=(t==null?void 0:t.Parent)??Object;class i extends s{}Object.defineProperty(i,"name",{value:n});function a(o){var l;const u=t!=null&&t.Parent?new i:this;r(u,o),(l=u._zod).deferred??(l.deferred=[]);for(const h of u._zod.deferred)h();return u}return Object.defineProperty(a,"init",{value:r}),Object.defineProperty(a,Symbol.hasInstance,{value:o=>{var l,u;return t!=null&&t.Parent&&o instanceof t.Parent?!0:(u=(l=o==null?void 0:o._zod)==null?void 0:l.traits)==null?void 0:u.has(n)}}),Object.defineProperty(a,"name",{value:n}),a}class Aw extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const Pde={};function sE(n){return Pde}function Ade(n){const e=Object.values(n).filter(r=>typeof r=="number");return Object.entries(n).filter(([r,s])=>e.indexOf(+r)===-1).map(([r,s])=>s)}function Rde(n,e){return typeof e=="bigint"?e.toString():e}const aj=Error.captureStackTrace?Error.captureStackTrace:(...n)=>{};function Rw(n,e,t){const r=new n._zod.constr(e??n._zod.def);return(!e||t!=null&&t.parent)&&(r._zod.parent=n),r}function Nde(n){return{}}function B2(n,e=0){var t;for(let r=e;r<n.issues.length;r++)if(((t=n.issues[r])==null?void 0:t.continue)!==!0)return!0;return!1}function _0(n){return typeof n=="string"?n:n==null?void 0:n.message}function iE(n,e,t){var s,i,a,o,l,u;const r={...n,path:n.path??[]};if(!n.message){const h=_0((a=(i=(s=n.inst)==null?void 0:s._zod.def)==null?void 0:i.error)==null?void 0:a.call(i,n))??_0((o=e==null?void 0:e.error)==null?void 0:o.call(e,n))??_0((l=t.customError)==null?void 0:l.call(t,n))??_0((u=t.localeError)==null?void 0:u.call(t,n))??"Invalid input";r.message=h}return delete r.inst,delete r.continue,e!=null&&e.reportInput||delete r.input,r}const oj=(n,e)=>{n.name="$ZodError",Object.defineProperty(n,"_zod",{value:n._zod,enumerable:!1}),Object.defineProperty(n,"issues",{value:e,enumerable:!1}),Object.defineProperty(n,"message",{get(){return JSON.stringify(e,Rde,2)},enumerable:!0}),Object.defineProperty(n,"toString",{value:()=>n.message,enumerable:!1})},Ode=rE("$ZodError",oj),aE=rE("$ZodError",oj,{Parent:Error}),Lde=n=>(e,t,r,s)=>{const i=r?Object.assign(r,{async:!1}):{async:!1},a=e._zod.run({value:t,issues:[]},i);if(a instanceof Promise)throw new Aw;if(a.issues.length){const o=new((s==null?void 0:s.Err)??n)(a.issues.map(l=>iE(l,i,sE())));throw aj(o,s==null?void 0:s.callee),o}return a.value},lj=Lde(aE),Mde=n=>async(e,t,r,s)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let a=e._zod.run({value:t,issues:[]},i);if(a instanceof Promise&&(a=await a),a.issues.length){const o=new((s==null?void 0:s.Err)??n)(a.issues.map(l=>iE(l,i,sE())));throw aj(o,s==null?void 0:s.callee),o}return a.value},Dde=Mde(aE),Fde=n=>(e,t,r)=>{const s=r?{...r,async:!1}:{async:!1},i=e._zod.run({value:t,issues:[]},s);if(i instanceof Promise)throw new Aw;return i.issues.length?{success:!1,error:new(n??Ode)(i.issues.map(a=>iE(a,s,sE())))}:{success:!0,data:i.value}},$de=Fde(aE),jde=n=>async(e,t,r)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let i=e._zod.run({value:t,issues:[]},s);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new n(i.issues.map(a=>iE(a,s,sE())))}:{success:!0,data:i.value}},Ude=jde(aE),Vde={major:4,minor:0,patch:0},Bde=rE("$ZodType",(n,e)=>{var s;var t;n??(n={}),n._zod.def=e,n._zod.bag=n._zod.bag||{},n._zod.version=Vde;const r=[...n._zod.def.checks??[]];n._zod.traits.has("$ZodCheck")&&r.unshift(n);for(const i of r)for(const a of i._zod.onattach)a(n);if(r.length===0)(t=n._zod).deferred??(t.deferred=[]),(s=n._zod.deferred)==null||s.push(()=>{n._zod.run=n._zod.parse});else{const i=(a,o,l)=>{let u=B2(a),h;for(const f of o){if(f._zod.def.when){if(!f._zod.def.when(a))continue}else if(u)continue;const p=a.issues.length,y=f._zod.check(a);if(y instanceof Promise&&(l==null?void 0:l.async)===!1)throw new Aw;if(h||y instanceof Promise)h=(h??Promise.resolve()).then(async()=>{await y,a.issues.length!==p&&(u||(u=B2(a,p)))});else{if(a.issues.length===p)continue;u||(u=B2(a,p))}}return h?h.then(()=>a):a};n._zod.run=(a,o)=>{const l=n._zod.parse(a,o);if(l instanceof Promise){if(o.async===!1)throw new Aw;return l.then(u=>i(u,r,o))}return i(l,r,o)}}n["~standard"]={validate:i=>{var a;try{const o=$de(n,i);return o.success?{value:o.data}:{issues:(a=o.error)==null?void 0:a.issues}}catch{return Ude(n,i).then(l=>{var u;return l.success?{value:l.data}:{issues:(u=l.error)==null?void 0:u.issues}})}},vendor:"zod",version:1}}),zde=rE("$ZodNever",(n,e)=>{Bde.init(n,e),n._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:n}),t)});class uj{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){const r=t[0];if(this._map.set(e,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&typeof t=="object"&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const r={...this.get(t)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function Gde(){return new uj}const Gl=Gde();function Wde(n,e){return new n({type:"never",...Nde()})}class T9{constructor(e){this.counter=0,this.metadataRegistry=(e==null?void 0:e.metadata)??Gl,this.target=(e==null?void 0:e.target)??"draft-2020-12",this.unrepresentable=(e==null?void 0:e.unrepresentable)??"throw",this.override=(e==null?void 0:e.override)??(()=>{}),this.io=(e==null?void 0:e.io)??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var f,p,y;var r;const s=e._zod.def,i={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},a=this.seen.get(e);if(a)return a.count++,t.schemaPath.includes(e)&&(a.cycle=t.path),a.schema;const o={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,o);const l=(p=(f=e._zod).toJSONSchema)==null?void 0:p.call(f);if(l)o.schema=l;else{const _={...t,schemaPath:[...t.schemaPath,e],path:t.path},b=e._zod.parent;if(b)o.ref=b,this.process(b,_),this.seen.get(b).isParent=!0;else{const S=o.schema;switch(s.type){case"string":{const E=S;E.type="string";const{minimum:C,maximum:v,format:I,patterns:L,contentEncoding:R}=e._zod.bag;if(typeof C=="number"&&(E.minLength=C),typeof v=="number"&&(E.maxLength=v),I&&(E.format=i[I]??I,E.format===""&&delete E.format),R&&(E.contentEncoding=R),L&&L.size>0){const P=[...L];P.length===1?E.pattern=P[0].source:P.length>1&&(o.schema.allOf=[...P.map(x=>({...this.target==="draft-7"?{type:"string"}:{},pattern:x.source}))])}break}case"number":{const E=S,{minimum:C,maximum:v,format:I,multipleOf:L,exclusiveMaximum:R,exclusiveMinimum:P}=e._zod.bag;typeof I=="string"&&I.includes("int")?E.type="integer":E.type="number",typeof P=="number"&&(E.exclusiveMinimum=P),typeof C=="number"&&(E.minimum=C,typeof P=="number"&&(P>=C?delete E.minimum:delete E.exclusiveMinimum)),typeof R=="number"&&(E.exclusiveMaximum=R),typeof v=="number"&&(E.maximum=v,typeof R=="number"&&(R<=v?delete E.maximum:delete E.exclusiveMaximum)),typeof L=="number"&&(E.multipleOf=L);break}case"boolean":{const E=S;E.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{S.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{S.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const E=S,{minimum:C,maximum:v}=e._zod.bag;typeof C=="number"&&(E.minItems=C),typeof v=="number"&&(E.maxItems=v),E.type="array",E.items=this.process(s.element,{..._,path:[..._.path,"items"]});break}case"object":{const E=S;E.type="object",E.properties={};const C=s.shape;for(const L in C)E.properties[L]=this.process(C[L],{..._,path:[..._.path,"properties",L]});const v=new Set(Object.keys(C)),I=new Set([...v].filter(L=>{const R=s.shape[L]._zod;return this.io==="input"?R.optin===void 0:R.optout===void 0}));I.size>0&&(E.required=Array.from(I)),((y=s.catchall)==null?void 0:y._zod.def.type)==="never"?E.additionalProperties=!1:s.catchall?s.catchall&&(E.additionalProperties=this.process(s.catchall,{..._,path:[..._.path,"additionalProperties"]})):this.io==="output"&&(E.additionalProperties=!1);break}case"union":{const E=S;E.anyOf=s.options.map((C,v)=>this.process(C,{..._,path:[..._.path,"anyOf",v]}));break}case"intersection":{const E=S,C=this.process(s.left,{..._,path:[..._.path,"allOf",0]}),v=this.process(s.right,{..._,path:[..._.path,"allOf",1]}),I=R=>"allOf"in R&&Object.keys(R).length===1,L=[...I(C)?C.allOf:[C],...I(v)?v.allOf:[v]];E.allOf=L;break}case"tuple":{const E=S;E.type="array";const C=s.items.map((L,R)=>this.process(L,{..._,path:[..._.path,"prefixItems",R]}));if(this.target==="draft-2020-12"?E.prefixItems=C:E.items=C,s.rest){const L=this.process(s.rest,{..._,path:[..._.path,"items"]});this.target==="draft-2020-12"?E.items=L:E.additionalItems=L}s.rest&&(E.items=this.process(s.rest,{..._,path:[..._.path,"items"]}));const{minimum:v,maximum:I}=e._zod.bag;typeof v=="number"&&(E.minItems=v),typeof I=="number"&&(E.maxItems=I);break}case"record":{const E=S;E.type="object",E.propertyNames=this.process(s.keyType,{..._,path:[..._.path,"propertyNames"]}),E.additionalProperties=this.process(s.valueType,{..._,path:[..._.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const E=S,C=Ade(s.entries);C.every(v=>typeof v=="number")&&(E.type="number"),C.every(v=>typeof v=="string")&&(E.type="string"),E.enum=C;break}case"literal":{const E=S,C=[];for(const v of s.values)if(v===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof v=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");C.push(Number(v))}else C.push(v);if(C.length!==0)if(C.length===1){const v=C[0];E.type=v===null?"null":typeof v,E.const=v}else C.every(v=>typeof v=="number")&&(E.type="number"),C.every(v=>typeof v=="string")&&(E.type="string"),C.every(v=>typeof v=="boolean")&&(E.type="string"),C.every(v=>v===null)&&(E.type="null"),E.enum=C;break}case"file":{const E=S,C={type:"string",format:"binary",contentEncoding:"binary"},{minimum:v,maximum:I,mime:L}=e._zod.bag;v!==void 0&&(C.minLength=v),I!==void 0&&(C.maxLength=I),L?L.length===1?(C.contentMediaType=L[0],Object.assign(E,C)):E.anyOf=L.map(R=>({...C,contentMediaType:R})):Object.assign(E,C);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const E=this.process(s.innerType,_);S.anyOf=[E,{type:"null"}];break}case"nonoptional":{this.process(s.innerType,_),o.ref=s.innerType;break}case"success":{const E=S;E.type="boolean";break}case"default":{this.process(s.innerType,_),o.ref=s.innerType,S.default=JSON.parse(JSON.stringify(s.defaultValue));break}case"prefault":{this.process(s.innerType,_),o.ref=s.innerType,this.io==="input"&&(S._prefault=JSON.parse(JSON.stringify(s.defaultValue)));break}case"catch":{this.process(s.innerType,_),o.ref=s.innerType;let E;try{E=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}S.default=E;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const E=S,C=e._zod.pattern;if(!C)throw new Error("Pattern not found in template literal");E.type="string",E.pattern=C.source;break}case"pipe":{const E=this.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;this.process(E,_),o.ref=E;break}case"readonly":{this.process(s.innerType,_),o.ref=s.innerType,S.readOnly=!0;break}case"promise":{this.process(s.innerType,_),o.ref=s.innerType;break}case"optional":{this.process(s.innerType,_),o.ref=s.innerType;break}case"lazy":{const E=e._zod.innerType;this.process(E,_),o.ref=E;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const u=this.metadataRegistry.get(e);return u&&Object.assign(o.schema,u),this.io==="input"&&Xn(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((r=o.schema).default??(r.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,t){var h,f,p,y,_,b;const r={cycles:(t==null?void 0:t.cycles)??"ref",reused:(t==null?void 0:t.reused)??"inline",external:(t==null?void 0:t.external)??void 0},s=this.seen.get(e);if(!s)throw new Error("Unprocessed schema. This is a bug in Zod.");const i=S=>{var L;const E=this.target==="draft-2020-12"?"$defs":"definitions";if(r.external){const R=(L=r.external.registry.get(S[0]))==null?void 0:L.id,P=r.external.uri??(N=>N);if(R)return{ref:P(R)};const x=S[1].defId??S[1].schema.id??`schema${this.counter++}`;return S[1].defId=x,{defId:x,ref:`${P("__shared")}#/${E}/${x}`}}if(S[1]===s)return{ref:"#"};const v=`#/${E}/`,I=S[1].schema.id??`__schema${this.counter++}`;return{defId:I,ref:v+I}},a=S=>{if(S[1].schema.$ref)return;const E=S[1],{ref:C,defId:v}=i(S);E.def={...E.schema},v&&(E.defId=v);const I=E.schema;for(const L in I)delete I[L];I.$ref=C};if(r.cycles==="throw")for(const S of this.seen.entries()){const E=S[1];if(E.cycle)throw new Error(`Cycle detected: #/${(h=E.cycle)==null?void 0:h.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const S of this.seen.entries()){const E=S[1];if(e===S[0]){a(S);continue}if(r.external){const v=(f=r.external.registry.get(S[0]))==null?void 0:f.id;if(e!==S[0]&&v){a(S);continue}}if((p=this.metadataRegistry.get(S[0]))==null?void 0:p.id){a(S);continue}if(E.cycle){a(S);continue}if(E.count>1&&r.reused==="ref"){a(S);continue}}const o=(S,E)=>{const C=this.seen.get(S),v=C.def??C.schema,I={...v};if(C.ref===null)return;const L=C.ref;if(C.ref=null,L){o(L,E);const R=this.seen.get(L).schema;R.$ref&&E.target==="draft-7"?(v.allOf=v.allOf??[],v.allOf.push(R)):(Object.assign(v,R),Object.assign(v,I))}C.isParent||this.override({zodSchema:S,jsonSchema:v,path:C.path??[]})};for(const S of[...this.seen.entries()].reverse())o(S[0],{target:this.target});const l={};if(this.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?l.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),(y=r.external)!=null&&y.uri){const S=(_=r.external.registry.get(e))==null?void 0:_.id;if(!S)throw new Error("Schema is missing an `id` property");l.$id=r.external.uri(S)}Object.assign(l,s.def);const u=((b=r.external)==null?void 0:b.defs)??{};for(const S of this.seen.entries()){const E=S[1];E.def&&E.defId&&(u[E.defId]=E.def)}r.external||Object.keys(u).length>0&&(this.target==="draft-2020-12"?l.$defs=u:l.definitions=u);try{return JSON.parse(JSON.stringify(l))}catch{throw new Error("Error converting schema to JSON.")}}}function CI(n,e){if(n instanceof uj){const r=new T9(e),s={};for(const o of n._idmap.entries()){const[l,u]=o;r.process(u)}const i={},a={registry:n,uri:e==null?void 0:e.uri,defs:s};for(const o of n._idmap.entries()){const[l,u]=o;i[l]=r.emit(u,{...e,external:a})}if(Object.keys(s).length>0){const o=r.target==="draft-2020-12"?"$defs":"definitions";i.__shared={[o]:s}}return{schemas:i}}const t=new T9(e);return t.process(n),t.emit(n,e)}function Xn(n,e){const t=e??{seen:new Set};if(t.seen.has(n))return!1;t.seen.add(n);const s=n._zod.def;switch(s.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return Xn(s.element,t);case"object":{for(const i in s.shape)if(Xn(s.shape[i],t))return!0;return!1}case"union":{for(const i of s.options)if(Xn(i,t))return!0;return!1}case"intersection":return Xn(s.left,t)||Xn(s.right,t);case"tuple":{for(const i of s.items)if(Xn(i,t))return!0;return!!(s.rest&&Xn(s.rest,t))}case"record":return Xn(s.keyType,t)||Xn(s.valueType,t);case"map":return Xn(s.keyType,t)||Xn(s.valueType,t);case"set":return Xn(s.valueType,t);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return Xn(s.innerType,t);case"lazy":return Xn(s.getter(),t);case"default":return Xn(s.innerType,t);case"prefault":return Xn(s.innerType,t);case"custom":return!1;case"transform":return!0;case"pipe":return Xn(s.in,t)||Xn(s.out,t);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${s.type}`)}const Hde=Symbol("Let zodToJsonSchema decide on which parser to use"),qde={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Kde=n=>({...qde,...n}),Qde=n=>{const e=Kde(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function cj(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function Wt(n,e,t,r,s){n[e]=t,cj(n,e,r,s)}const dj=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")};function ui(n){if(n.target!=="openAi")return{};const e=[...n.basePath,n.definitionPath,n.openAiAnyTypeName];return n.flags.hasReferencedOpenAiAnyType=!0,{$ref:n.$refStrategy==="relative"?dj(e,n.currentPath):e.join("/")}}function Yde(n,e){var r,s,i;const t={type:"array"};return(r=n.type)!=null&&r._def&&((i=(s=n.type)==null?void 0:s._def)==null?void 0:i.typeName)!==ie.ZodAny&&(t.items=zt(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&Wt(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&Wt(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(Wt(t,"minItems",n.exactLength.value,n.exactLength.message,e),Wt(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Jde(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Wt(t,"minimum",r.value,r.message,e):Wt(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Wt(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Wt(t,"maximum",r.value,r.message,e):Wt(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Wt(t,"maximum",r.value,r.message,e));break;case"multipleOf":Wt(t,"multipleOf",r.value,r.message,e);break}return t}function Xde(){return{type:"boolean"}}function hj(n,e){return zt(n.type._def,e)}const Zde=(n,e)=>zt(n.innerType._def,e);function fj(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>fj(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return ehe(n,e)}}const ehe=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":Wt(t,"minimum",r.value,r.message,e);break;case"max":Wt(t,"maximum",r.value,r.message,e);break}return t};function the(n,e){return{...zt(n.innerType._def,e),default:n.defaultValue()}}function nhe(n,e){return e.effectStrategy==="input"?zt(n.schema._def,e):ui(e)}function rhe(n){return{type:"string",enum:Array.from(n.values)}}const she=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function ihe(n,e){const t=[zt(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),zt(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(she(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...l}=i;a=l}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function ahe(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let z2;const Gi={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(z2===void 0&&(z2=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),z2),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function pj(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":Wt(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":Wt(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Wi(t,"email",r.message,e);break;case"format:idn-email":Wi(t,"idn-email",r.message,e);break;case"pattern:zod":ms(t,Gi.email,r.message,e);break}break;case"url":Wi(t,"uri",r.message,e);break;case"uuid":Wi(t,"uuid",r.message,e);break;case"regex":ms(t,r.regex,r.message,e);break;case"cuid":ms(t,Gi.cuid,r.message,e);break;case"cuid2":ms(t,Gi.cuid2,r.message,e);break;case"startsWith":ms(t,RegExp(`^${G2(r.value,e)}`),r.message,e);break;case"endsWith":ms(t,RegExp(`${G2(r.value,e)}$`),r.message,e);break;case"datetime":Wi(t,"date-time",r.message,e);break;case"date":Wi(t,"date",r.message,e);break;case"time":Wi(t,"time",r.message,e);break;case"duration":Wi(t,"duration",r.message,e);break;case"length":Wt(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),Wt(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{ms(t,RegExp(G2(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Wi(t,"ipv4",r.message,e),r.version!=="v4"&&Wi(t,"ipv6",r.message,e);break}case"base64url":ms(t,Gi.base64url,r.message,e);break;case"jwt":ms(t,Gi.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&ms(t,Gi.ipv4Cidr,r.message,e),r.version!=="v4"&&ms(t,Gi.ipv6Cidr,r.message,e);break}case"emoji":ms(t,Gi.emoji(),r.message,e);break;case"ulid":{ms(t,Gi.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Wi(t,"binary",r.message,e);break}case"contentEncoding:base64":{Wt(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{ms(t,Gi.base64,r.message,e);break}}break}case"nanoid":ms(t,Gi.nanoid,r.message,e)}return t}function G2(n,e){return e.patternStrategy==="escape"?lhe(n):n}const ohe=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function lhe(n){let e="";for(let t=0;t<n.length;t++)ohe.has(n[t])||(e+="\\"),e+=n[t];return e}function Wi(n,e,t,r){var s;n.format||(s=n.anyOf)!=null&&s.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):Wt(n,"format",e,t,r)}function ms(n,e,t,r){var s;n.pattern||(s=n.allOf)!=null&&s.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:C9(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):Wt(n,"pattern",C9(e,r),t,r)}function C9(n,e){var l;if(!e.applyRegexFlags||!n.flags)return n.source;const t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source;let s="",i=!1,a=!1,o=!1;for(let u=0;u<r.length;u++){if(i){s+=r[u],i=!1;continue}if(t.i){if(a){if(r[u].match(/[a-z]/)){o?(s+=r[u],s+=`${r[u-2]}-${r[u]}`.toUpperCase(),o=!1):r[u+1]==="-"&&((l=r[u+2])!=null&&l.match(/[a-z]/))?(s+=r[u],o=!0):s+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){s+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(t.m){if(r[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&r[u]==="."){s+=a?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}s+=r[u],r[u]==="\\"?i=!0:a&&r[u]==="]"?a=!1:!a&&r[u]==="["&&(a=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return s}function mj(n,e){var r,s,i,a,o,l;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===ie.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((u,h)=>({...u,[h]:zt(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",h]})??ui(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:zt(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((s=n.keyType)==null?void 0:s._def.typeName)===ie.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const{type:u,...h}=pj(n.keyType._def,e);return{...t,propertyNames:h}}else{if(((a=n.keyType)==null?void 0:a._def.typeName)===ie.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(((o=n.keyType)==null?void 0:o._def.typeName)===ie.ZodBranded&&n.keyType._def.type._def.typeName===ie.ZodString&&((l=n.keyType._def.type._def.checks)!=null&&l.length)){const{type:u,...h}=hj(n.keyType._def,e);return{...t,propertyNames:h}}}return t}function uhe(n,e){if(e.mapStrategy==="record")return mj(n,e);const t=zt(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||ui(e),r=zt(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||ui(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function che(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function dhe(n){return n.target==="openAi"?void 0:{not:ui({...n,currentPath:[...n.currentPath,"not"]})}}function hhe(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Nw={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function fhe(n,e){if(e.target==="openApi3")return I9(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in Nw&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,i)=>{const a=Nw[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return I9(n,e)}const I9=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>zt(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function phe(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:Nw[n.innerType._def.typeName],nullable:!0}:{type:[Nw[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=zt(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=zt(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function mhe(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",cj(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Wt(t,"minimum",r.value,r.message,e):Wt(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Wt(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Wt(t,"maximum",r.value,r.message,e):Wt(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Wt(t,"maximum",r.value,r.message,e));break;case"multipleOf":Wt(t,"multipleOf",r.value,r.message,e);break}return t}function ghe(n,e){const t=e.target==="openAi",r={type:"object",properties:{}},s=[],i=n.shape();for(const o in i){let l=i[o];if(l===void 0||l._def===void 0)continue;let u=yhe(l);u&&t&&(l._def.typeName==="ZodOptional"&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),u=!1);const h=zt(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});h!==void 0&&(r.properties[o]=h,u||s.push(o))}s.length&&(r.required=s);const a=_he(n,e);return a!==void 0&&(r.additionalProperties=a),r}function _he(n,e){if(n.catchall._def.typeName!=="ZodNever")return zt(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function yhe(n){try{return n.isOptional()}catch{return!0}}const vhe=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return zt(n.innerType._def,e);const t=zt(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:ui(e)},t]}:ui(e)},whe=(n,e)=>{if(e.pipeStrategy==="input")return zt(n.in._def,e);if(e.pipeStrategy==="output")return zt(n.out._def,e);const t=zt(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=zt(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function bhe(n,e){return zt(n.type._def,e)}function Ehe(n,e){const r={type:"array",uniqueItems:!0,items:zt(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&Wt(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&Wt(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function She(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>zt(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:zt(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>zt(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function The(n){return{not:ui(n)}}function Che(n){return ui(n)}const Ihe=(n,e)=>zt(n.innerType._def,e),xhe=(n,e,t)=>{switch(e){case ie.ZodString:return pj(n,t);case ie.ZodNumber:return mhe(n,t);case ie.ZodObject:return ghe(n,t);case ie.ZodBigInt:return Jde(n,t);case ie.ZodBoolean:return Xde();case ie.ZodDate:return fj(n,t);case ie.ZodUndefined:return The(t);case ie.ZodNull:return hhe(t);case ie.ZodArray:return Yde(n,t);case ie.ZodUnion:case ie.ZodDiscriminatedUnion:return fhe(n,t);case ie.ZodIntersection:return ihe(n,t);case ie.ZodTuple:return She(n,t);case ie.ZodRecord:return mj(n,t);case ie.ZodLiteral:return ahe(n,t);case ie.ZodEnum:return rhe(n);case ie.ZodNativeEnum:return che(n);case ie.ZodNullable:return phe(n,t);case ie.ZodOptional:return vhe(n,t);case ie.ZodMap:return uhe(n,t);case ie.ZodSet:return Ehe(n,t);case ie.ZodLazy:return()=>n.getter()._def;case ie.ZodPromise:return bhe(n,t);case ie.ZodNaN:case ie.ZodNever:return dhe(t);case ie.ZodEffects:return nhe(n,t);case ie.ZodAny:return ui(t);case ie.ZodUnknown:return Che(t);case ie.ZodDefault:return the(n,t);case ie.ZodBranded:return hj(n,t);case ie.ZodReadonly:return Ihe(n,t);case ie.ZodCatch:return Zde(n,t);case ie.ZodPipeline:return whe(n,t);case ie.ZodFunction:case ie.ZodVoid:case ie.ZodSymbol:return;default:return(r=>{})()}};function zt(n,e,t=!1){var o;const r=e.seen.get(n);if(e.override){const l=(o=e.override)==null?void 0:o.call(e,n,e,r,t);if(l!==Hde)return l}if(r&&!t){const l=khe(r,e);if(l!==void 0)return l}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const i=xhe(n,n.typeName,e),a=typeof i=="function"?zt(i(),e):i;if(a&&Phe(n,e,a),e.postProcess){const l=e.postProcess(a,n,e);return s.jsonSchema=a,l}return s.jsonSchema=a,a}const khe=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:dj(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),ui(e)):e.$refStrategy==="seen"?ui(e):void 0}},Phe=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),Ahe=(n,e)=>{const t=Qde(e);let r;const s=e==null?void 0:e.name,i=zt(n._def,t,!1)??ui(t);t.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[t.openAiAnyTypeName]||(r[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));const a=s===void 0?r?{...i,[t.definitionPath]:r}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...r,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function Lh(n,e){const t=typeof n;if(t!==typeof e)return!1;if(Array.isArray(n)){if(!Array.isArray(e))return!1;const r=n.length;if(r!==e.length)return!1;for(let s=0;s<r;s++)if(!Lh(n[s],e[s]))return!1;return!0}if(t==="object"){if(!n||!e)return n===e;const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(const a of r)if(!Lh(n[a],e[a]))return!1;return!0}return n===e}function Yi(n){return encodeURI(Rhe(n))}function Rhe(n){return n.replace(/~/g,"~0").replace(/\//g,"~1")}const Nhe={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},Ohe={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},Lhe={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let Mhe=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function im(n,e=Object.create(null),t=Mhe,r=""){if(n&&typeof n=="object"&&!Array.isArray(n)){const i=n.$id||n.id;if(i){const a=new URL(i,t.href);a.hash.length>1?e[a.href]=n:(a.hash="",r===""?t=a:im(n,e,t))}}else if(n!==!0&&n!==!1)return e;const s=t.href+(r?"#"+r:"");if(e[s]!==void 0)throw new Error(`Duplicate schema URI "${s}".`);if(e[s]=n,n===!0||n===!1)return e;if(n.__absolute_uri__===void 0&&Object.defineProperty(n,"__absolute_uri__",{enumerable:!1,value:s}),n.$ref&&n.__absolute_ref__===void 0){const i=new URL(n.$ref,t.href);i.hash=i.hash,Object.defineProperty(n,"__absolute_ref__",{enumerable:!1,value:i.href})}if(n.$recursiveRef&&n.__absolute_recursive_ref__===void 0){const i=new URL(n.$recursiveRef,t.href);i.hash=i.hash,Object.defineProperty(n,"__absolute_recursive_ref__",{enumerable:!1,value:i.href})}if(n.$anchor){const i=new URL("#"+n.$anchor,t.href);e[i.href]=n}for(let i in n){if(Lhe[i])continue;const a=`${r}/${Yi(i)}`,o=n[i];if(Array.isArray(o)){if(Nhe[i]){const l=o.length;for(let u=0;u<l;u++)im(o[u],e,t,`${a}/${u}`)}}else if(Ohe[i])for(let l in o)im(o[l],e,t,`${a}/${Yi(l)}`);else im(o,e,t,a)}return e}const Dhe=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Fhe=[0,31,28,31,30,31,30,31,31,30,31,30,31],$he=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,jhe=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Uhe=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,Vhe=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,Bhe=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,zhe=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,Ghe=/^(?:\/(?:[^~/]|~0|~1)*)*$/,Whe=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,Hhe=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,qhe=n=>{if(n[0]==='"')return!1;const[e,t,...r]=n.split("@");return!e||!t||r.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},Khe=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,Qhe=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,Yhe=n=>n.length>1&&n.length<80&&(/^P\d+([.,]\d+)?W$/.test(n)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(n)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(n));function Oa(n){return n.test.bind(n)}const x9={date:gj,time:_j.bind(void 0,!1),"date-time":Zhe,duration:Yhe,uri:nfe,"uri-reference":Oa(Uhe),"uri-template":Oa(Vhe),url:Oa(Bhe),email:qhe,hostname:Oa(jhe),ipv4:Oa(Khe),ipv6:Oa(Qhe),regex:sfe,uuid:Oa(zhe),"json-pointer":Oa(Ghe),"json-pointer-uri-fragment":Oa(Whe),"relative-json-pointer":Oa(Hhe)};function Jhe(n){return n%4===0&&(n%100!==0||n%400===0)}function gj(n){const e=n.match(Dhe);if(!e)return!1;const t=+e[1],r=+e[2],s=+e[3];return r>=1&&r<=12&&s>=1&&s<=(r==2&&Jhe(t)?29:Fhe[r])}function _j(n,e){const t=e.match($he);if(!t)return!1;const r=+t[1],s=+t[2],i=+t[3],a=!!t[5];return(r<=23&&s<=59&&i<=59||r==23&&s==59&&i==60)&&(!n||a)}const Xhe=/t|\s/i;function Zhe(n){const e=n.split(Xhe);return e.length==2&&gj(e[0])&&_j(!0,e[1])}const efe=/\/|:/,tfe=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function nfe(n){return efe.test(n)&&tfe.test(n)}const rfe=/[^\\]\\Z/;function sfe(n){if(rfe.test(n))return!1;try{return new RegExp(n,"u"),!0}catch{return!1}}function ife(n){let e=0,t=n.length,r=0,s;for(;r<t;)e++,s=n.charCodeAt(r++),s>=55296&&s<=56319&&r<t&&(s=n.charCodeAt(r),(s&64512)==56320&&r++);return e}function gn(n,e,t="2019-09",r=im(e),s=!0,i=null,a="#",o="#",l=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:a,keyword:"false",keywordLocation:a,error:"False boolean schema."}]};const u=typeof n;let h;switch(u){case"boolean":case"number":case"string":h=u;break;case"object":n===null?h="null":Array.isArray(n)?h="array":h="object";break;default:throw new Error(`Instances of "${u}" type are not supported.`)}const{$ref:f,$recursiveRef:p,$recursiveAnchor:y,type:_,const:b,enum:S,required:E,not:C,anyOf:v,allOf:I,oneOf:L,if:R,then:P,else:x,format:N,properties:M,patternProperties:D,additionalProperties:F,unevaluatedProperties:$,minProperties:H,maxProperties:G,propertyNames:ue,dependentRequired:ae,dependentSchemas:z,dependencies:Q,prefixItems:ee,items:se,additionalItems:le,unevaluatedItems:ye,contains:ve,minContains:de,maxContains:Me,minItems:B,maxItems:Z,uniqueItems:be,minimum:Ce,maximum:Le,exclusiveMinimum:et,exclusiveMaximum:ht,multipleOf:cn,minLength:ot,maxLength:Gn,pattern:Wn,__absolute_ref__:Ir,__absolute_recursive_ref__:Is}=e,we=[];if(y===!0&&i===null&&(i=e),p==="#"){const Ge=i===null?r[Is]:i,Pe=`${o}/$recursiveRef`,$e=gn(n,i===null?e:i,t,r,s,Ge,a,Pe,l);$e.valid||we.push({instanceLocation:a,keyword:"$recursiveRef",keywordLocation:Pe,error:"A subschema had errors."},...$e.errors)}if(f!==void 0){const Pe=r[Ir||f];if(Pe===void 0){let fe=`Unresolved $ref "${f}".`;throw Ir&&Ir!==f&&(fe+=`  Absolute URI "${Ir}".`),fe+=`
Known schemas:
- ${Object.keys(r).join(`
- `)}`,new Error(fe)}const $e=`${o}/$ref`,Se=gn(n,Pe,t,r,s,i,a,$e,l);if(Se.valid||we.push({instanceLocation:a,keyword:"$ref",keywordLocation:$e,error:"A subschema had errors."},...Se.errors),t==="4"||t==="7")return{valid:we.length===0,errors:we}}if(Array.isArray(_)){let Ge=_.length,Pe=!1;for(let $e=0;$e<Ge;$e++)if(h===_[$e]||_[$e]==="integer"&&h==="number"&&n%1===0&&n===n){Pe=!0;break}Pe||we.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${h}" is invalid. Expected "${_.join('", "')}".`})}else _==="integer"?(h!=="number"||n%1||n!==n)&&we.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${h}" is invalid. Expected "${_}".`}):_!==void 0&&h!==_&&we.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${h}" is invalid. Expected "${_}".`});if(b!==void 0&&(h==="object"||h==="array"?Lh(n,b)||we.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(b)}.`}):n!==b&&we.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(b)}.`})),S!==void 0&&(h==="object"||h==="array"?S.some(Ge=>Lh(n,Ge))||we.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(S)}.`}):S.some(Ge=>n===Ge)||we.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(S)}.`})),C!==void 0){const Ge=`${o}/not`;gn(n,C,t,r,s,i,a,Ge).valid&&we.push({instanceLocation:a,keyword:"not",keywordLocation:Ge,error:'Instance matched "not" schema.'})}let xs=[];if(v!==void 0){const Ge=`${o}/anyOf`,Pe=we.length;let $e=!1;for(let Se=0;Se<v.length;Se++){const fe=v[Se],Ne=Object.create(l),Be=gn(n,fe,t,r,s,y===!0?i:null,a,`${Ge}/${Se}`,Ne);we.push(...Be.errors),$e=$e||Be.valid,Be.valid&&xs.push(Ne)}$e?we.length=Pe:we.splice(Pe,0,{instanceLocation:a,keyword:"anyOf",keywordLocation:Ge,error:"Instance does not match any subschemas."})}if(I!==void 0){const Ge=`${o}/allOf`,Pe=we.length;let $e=!0;for(let Se=0;Se<I.length;Se++){const fe=I[Se],Ne=Object.create(l),Be=gn(n,fe,t,r,s,y===!0?i:null,a,`${Ge}/${Se}`,Ne);we.push(...Be.errors),$e=$e&&Be.valid,Be.valid&&xs.push(Ne)}$e?we.length=Pe:we.splice(Pe,0,{instanceLocation:a,keyword:"allOf",keywordLocation:Ge,error:"Instance does not match every subschema."})}if(L!==void 0){const Ge=`${o}/oneOf`,Pe=we.length,$e=L.filter((Se,fe)=>{const Ne=Object.create(l),Be=gn(n,Se,t,r,s,y===!0?i:null,a,`${Ge}/${fe}`,Ne);return we.push(...Be.errors),Be.valid&&xs.push(Ne),Be.valid}).length;$e===1?we.length=Pe:we.splice(Pe,0,{instanceLocation:a,keyword:"oneOf",keywordLocation:Ge,error:`Instance does not match exactly one subschema (${$e} matches).`})}if((h==="object"||h==="array")&&Object.assign(l,...xs),R!==void 0){const Ge=`${o}/if`;if(gn(n,R,t,r,s,i,a,Ge,l).valid){if(P!==void 0){const $e=gn(n,P,t,r,s,i,a,`${o}/then`,l);$e.valid||we.push({instanceLocation:a,keyword:"if",keywordLocation:Ge,error:'Instance does not match "then" schema.'},...$e.errors)}}else if(x!==void 0){const $e=gn(n,x,t,r,s,i,a,`${o}/else`,l);$e.valid||we.push({instanceLocation:a,keyword:"if",keywordLocation:Ge,error:'Instance does not match "else" schema.'},...$e.errors)}}if(h==="object"){if(E!==void 0)for(const Se of E)Se in n||we.push({instanceLocation:a,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${Se}".`});const Ge=Object.keys(n);if(H!==void 0&&Ge.length<H&&we.push({instanceLocation:a,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${H} properties.`}),G!==void 0&&Ge.length>G&&we.push({instanceLocation:a,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${G} properties.`}),ue!==void 0){const Se=`${o}/propertyNames`;for(const fe in n){const Ne=`${a}/${Yi(fe)}`,Be=gn(fe,ue,t,r,s,i,Ne,Se);Be.valid||we.push({instanceLocation:a,keyword:"propertyNames",keywordLocation:Se,error:`Property name "${fe}" does not match schema.`},...Be.errors)}}if(ae!==void 0){const Se=`${o}/dependantRequired`;for(const fe in ae)if(fe in n){const Ne=ae[fe];for(const Be of Ne)Be in n||we.push({instanceLocation:a,keyword:"dependentRequired",keywordLocation:Se,error:`Instance has "${fe}" but does not have "${Be}".`})}}if(z!==void 0)for(const Se in z){const fe=`${o}/dependentSchemas`;if(Se in n){const Ne=gn(n,z[Se],t,r,s,i,a,`${fe}/${Yi(Se)}`,l);Ne.valid||we.push({instanceLocation:a,keyword:"dependentSchemas",keywordLocation:fe,error:`Instance has "${Se}" but does not match dependant schema.`},...Ne.errors)}}if(Q!==void 0){const Se=`${o}/dependencies`;for(const fe in Q)if(fe in n){const Ne=Q[fe];if(Array.isArray(Ne))for(const Be of Ne)Be in n||we.push({instanceLocation:a,keyword:"dependencies",keywordLocation:Se,error:`Instance has "${fe}" but does not have "${Be}".`});else{const Be=gn(n,Ne,t,r,s,i,a,`${Se}/${Yi(fe)}`);Be.valid||we.push({instanceLocation:a,keyword:"dependencies",keywordLocation:Se,error:`Instance has "${fe}" but does not match dependant schema.`},...Be.errors)}}}const Pe=Object.create(null);let $e=!1;if(M!==void 0){const Se=`${o}/properties`;for(const fe in M){if(!(fe in n))continue;const Ne=`${a}/${Yi(fe)}`,Be=gn(n[fe],M[fe],t,r,s,i,Ne,`${Se}/${Yi(fe)}`);if(Be.valid)l[fe]=Pe[fe]=!0;else if($e=s,we.push({instanceLocation:a,keyword:"properties",keywordLocation:Se,error:`Property "${fe}" does not match schema.`},...Be.errors),$e)break}}if(!$e&&D!==void 0){const Se=`${o}/patternProperties`;for(const fe in D){const Ne=new RegExp(fe,"u"),Be=D[fe];for(const Hn in n){if(!Ne.test(Hn))continue;const zu=`${a}/${Yi(Hn)}`,_d=gn(n[Hn],Be,t,r,s,i,zu,`${Se}/${Yi(fe)}`);_d.valid?l[Hn]=Pe[Hn]=!0:($e=s,we.push({instanceLocation:a,keyword:"patternProperties",keywordLocation:Se,error:`Property "${Hn}" matches pattern "${fe}" but does not match associated schema.`},..._d.errors))}}}if(!$e&&F!==void 0){const Se=`${o}/additionalProperties`;for(const fe in n){if(Pe[fe])continue;const Ne=`${a}/${Yi(fe)}`,Be=gn(n[fe],F,t,r,s,i,Ne,Se);Be.valid?l[fe]=!0:($e=s,we.push({instanceLocation:a,keyword:"additionalProperties",keywordLocation:Se,error:`Property "${fe}" does not match additional properties schema.`},...Be.errors))}}else if(!$e&&$!==void 0){const Se=`${o}/unevaluatedProperties`;for(const fe in n)if(!l[fe]){const Ne=`${a}/${Yi(fe)}`,Be=gn(n[fe],$,t,r,s,i,Ne,Se);Be.valid?l[fe]=!0:we.push({instanceLocation:a,keyword:"unevaluatedProperties",keywordLocation:Se,error:`Property "${fe}" does not match unevaluated properties schema.`},...Be.errors)}}}else if(h==="array"){Z!==void 0&&n.length>Z&&we.push({instanceLocation:a,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${n.length} > ${Z}).`}),B!==void 0&&n.length<B&&we.push({instanceLocation:a,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${n.length} < ${B}).`});const Ge=n.length;let Pe=0,$e=!1;if(ee!==void 0){const Se=`${o}/prefixItems`,fe=Math.min(ee.length,Ge);for(;Pe<fe;Pe++){const Ne=gn(n[Pe],ee[Pe],t,r,s,i,`${a}/${Pe}`,`${Se}/${Pe}`);if(l[Pe]=!0,!Ne.valid&&($e=s,we.push({instanceLocation:a,keyword:"prefixItems",keywordLocation:Se,error:"Items did not match schema."},...Ne.errors),$e))break}}if(se!==void 0){const Se=`${o}/items`;if(Array.isArray(se)){const fe=Math.min(se.length,Ge);for(;Pe<fe;Pe++){const Ne=gn(n[Pe],se[Pe],t,r,s,i,`${a}/${Pe}`,`${Se}/${Pe}`);if(l[Pe]=!0,!Ne.valid&&($e=s,we.push({instanceLocation:a,keyword:"items",keywordLocation:Se,error:"Items did not match schema."},...Ne.errors),$e))break}}else for(;Pe<Ge;Pe++){const fe=gn(n[Pe],se,t,r,s,i,`${a}/${Pe}`,Se);if(l[Pe]=!0,!fe.valid&&($e=s,we.push({instanceLocation:a,keyword:"items",keywordLocation:Se,error:"Items did not match schema."},...fe.errors),$e))break}if(!$e&&le!==void 0){const fe=`${o}/additionalItems`;for(;Pe<Ge;Pe++){const Ne=gn(n[Pe],le,t,r,s,i,`${a}/${Pe}`,fe);l[Pe]=!0,Ne.valid||($e=s,we.push({instanceLocation:a,keyword:"additionalItems",keywordLocation:fe,error:"Items did not match additional items schema."},...Ne.errors))}}}if(ve!==void 0)if(Ge===0&&de===void 0)we.push({instanceLocation:a,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(de!==void 0&&Ge<de)we.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${Ge}) than minContains (${de}).`});else{const Se=`${o}/contains`,fe=we.length;let Ne=0;for(let Be=0;Be<Ge;Be++){const Hn=gn(n[Be],ve,t,r,s,i,`${a}/${Be}`,Se);Hn.valid?(l[Be]=!0,Ne++):we.push(...Hn.errors)}Ne>=(de||0)&&(we.length=fe),de===void 0&&Me===void 0&&Ne===0?we.splice(fe,0,{instanceLocation:a,keyword:"contains",keywordLocation:Se,error:"Array does not contain item matching schema."}):de!==void 0&&Ne<de?we.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${de} items matching schema. Only ${Ne} items were found.`}):Me!==void 0&&Ne>Me&&we.push({instanceLocation:a,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${Me} items matching schema. ${Ne} items were found.`})}if(!$e&&ye!==void 0){const Se=`${o}/unevaluatedItems`;for(Pe;Pe<Ge;Pe++){if(l[Pe])continue;const fe=gn(n[Pe],ye,t,r,s,i,`${a}/${Pe}`,Se);l[Pe]=!0,fe.valid||we.push({instanceLocation:a,keyword:"unevaluatedItems",keywordLocation:Se,error:"Items did not match unevaluated items schema."},...fe.errors)}}if(be)for(let Se=0;Se<Ge;Se++){const fe=n[Se],Ne=typeof fe=="object"&&fe!==null;for(let Be=0;Be<Ge;Be++){if(Se===Be)continue;const Hn=n[Be];(fe===Hn||Ne&&(typeof Hn=="object"&&Hn!==null)&&Lh(fe,Hn))&&(we.push({instanceLocation:a,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${Se} and ${Be}.`}),Se=Number.MAX_SAFE_INTEGER,Be=Number.MAX_SAFE_INTEGER)}}}else if(h==="number"){if(t==="4"?(Ce!==void 0&&(et===!0&&n<=Ce||n<Ce)&&we.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${n} is less than ${et?"or equal to ":""} ${Ce}.`}),Le!==void 0&&(ht===!0&&n>=Le||n>Le)&&we.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${n} is greater than ${ht?"or equal to ":""} ${Le}.`})):(Ce!==void 0&&n<Ce&&we.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${n} is less than ${Ce}.`}),Le!==void 0&&n>Le&&we.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${n} is greater than ${Le}.`}),et!==void 0&&n<=et&&we.push({instanceLocation:a,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${n} is less than ${et}.`}),ht!==void 0&&n>=ht&&we.push({instanceLocation:a,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${n} is greater than or equal to ${ht}.`})),cn!==void 0){const Ge=n%cn;Math.abs(0-Ge)>=11920929e-14&&Math.abs(cn-Ge)>=11920929e-14&&we.push({instanceLocation:a,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${n} is not a multiple of ${cn}.`})}}else if(h==="string"){const Ge=ot===void 0&&Gn===void 0?0:ife(n);ot!==void 0&&Ge<ot&&we.push({instanceLocation:a,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${Ge} < ${ot}).`}),Gn!==void 0&&Ge>Gn&&we.push({instanceLocation:a,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${Ge} > ${Gn}).`}),Wn!==void 0&&!new RegExp(Wn,"u").test(n)&&we.push({instanceLocation:a,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),N!==void 0&&x9[N]&&!x9[N](n)&&we.push({instanceLocation:a,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${N}".`})}return{valid:we.length===0,errors:we}}function ga(n){if(typeof n!="object"||n===null)return!1;const e=n;if(!("_zod"in e))return!1;const t=e._zod;return typeof t=="object"&&t!==null&&"def"in t}function ro(n){if(typeof n!="object"||n===null)return!1;const e=n;if(!("_def"in e)||"_zod"in e)return!1;const t=e._def;return typeof t=="object"&&t!=null&&"typeName"in t}function Wl(n){return!n||typeof n!="object"||Array.isArray(n)?!1:!!(ga(n)||ro(n))}async function afe(n,e){if(ga(n))try{return{success:!0,data:await Dde(n,e)}}catch(t){return{success:!1,error:t}}if(ro(n))return n.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function pA(n,e){if(ga(n))return lj(n,e);if(ro(n))return n.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function mA(n){var e;if(ga(n))return(e=Gl.get(n))==null?void 0:e.description;if(ro(n)||"description"in n&&typeof n.description=="string")return n.description}function ofe(n){return Wl(n)?ro(n)?n._def.typeName==="ZodString":ga(n)?n._zod.def.type==="string":!1:!1}function Wm(n){return ga(n)?typeof n=="object"&&n!==null&&"_zod"in n&&typeof n._zod=="object"&&n._zod!==null&&"def"in n._zod&&typeof n._zod.def=="object"&&n._zod.def!==null&&"type"in n._zod.def&&n._zod.def.type==="object":!1}function yj(n){return ga(n)?typeof n=="object"&&n!==null&&"_zod"in n&&typeof n._zod=="object"&&n._zod!==null&&"def"in n._zod&&typeof n._zod.def=="object"&&n._zod.def!==null&&"type"in n._zod.def&&n._zod.def.type==="array":!1}function II(n,e=!1){if(ro(n))return n.strict();if(Wm(n)){const t=n._zod.def.shape;if(e)for(const[i,a]of Object.entries(n._zod.def.shape)){if(Wm(a)){const l=II(a,e);t[i]=l}else if(yj(a)){let l=a._zod.def.element;Wm(l)&&(l=II(l,e)),t[i]=Rw(a,{...a._zod.def,element:l})}else t[i]=a;const o=Gl.get(a);o&&Gl.add(t[i],o)}const r=Rw(n,{...n._zod.def,shape:t,catchall:Wde(zde)}),s=Gl.get(n);return s&&Gl.add(r,s),r}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function lfe(n){return ro(n)&&"typeName"in n._def&&n._def.typeName==="ZodEffects"}function ufe(n){return ga(n)&&n._zod.def.type==="pipe"}function am(n,e=!1){if(ro(n))return lfe(n)?am(n._def.schema,e):n;if(ga(n)){let t=n;if(ufe(n)&&(t=am(n._zod.def.in,e)),e){if(Wm(t)){const s=t._zod.def.shape;for(const[i,a]of Object.entries(t._zod.def.shape))s[i]=am(a,e);t=Rw(t,{...t._zod.def,shape:s})}else if(yj(t)){const s=am(t._zod.def.element,e);t=Rw(t,{...t._zod.def,element:s})}}const r=Gl.get(n);return r&&Gl.add(t,r),t}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Hl(n){if(ga(n)){const e=am(n,!0);if(Wm(e)){const t=II(e,!0);return CI(t)}else return CI(n)}return ro(n)?Ahe(n):n}function cfe(n,e){if(n!==void 0&&!$m(n))return n;if(fA(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function dfe(n){return fA(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...Hl(n.data.schema),title:n.data.name}}}class oE{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=$m(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...dfe(t)})),edges:this.edges.map(t=>{const r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const s=t??rs(),i={id:s,data:e,name:cfe(t,e),metadata:r};return this.nodes[s]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const i={source:e.id,target:t.id,data:r,conditional:s};return this.edges.push(i),i}firstNode(){return k9(this)}lastNode(){return P9(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(u=>u.id).every($m)&&(r="");const i=u=>r?`${r}:${u}`:u;Object.entries(e.nodes).forEach(([u,h])=>{this.nodes[i(u)]={...h,id:i(u)}});const a=e.edges.map(u=>({...u,source:i(u.source),target:i(u.target)}));this.edges=[...this.edges,...a];const o=e.firstNode(),l=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,l?{id:i(l.id),data:l.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&k9(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&P9(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),t=new Map;Object.values(e).forEach(s=>{t.set(s,(t.get(s)||0)+1)});const r=s=>{const i=e[s];return $m(s)&&t.get(i)===1?i:s};return new oE({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,i])=>[r(s),{...i,id:r(s)}])),edges:this.edges.map(s=>({...s,source:r(s.source),target:r(s.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:r,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},a=this.reid(),o=a.firstNode(),l=a.lastNode();return Ide(a.nodes,a.edges,{firstNode:o==null?void 0:o.id,lastNode:l==null?void 0:l.id,withStyles:t,curveStyle:r,nodeColors:s,wrapLabelNWords:i})}async drawMermaidPng(e){const t=this.drawMermaid(e);return xde(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function k9(n,e=[]){const t=new Set(n.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),r=[];for(const s of Object.values(n.nodes))!e.includes(s.id)&&!t.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function P9(n,e=[]){const t=new Set(n.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),r=[];for(const s of Object.values(n.nodes))!e.includes(s.id)&&!t.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function hfe(n){const e=new TextEncoder,t=new ReadableStream({async start(r){for await(const s of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return li.fromReadableStream(t)}function A9(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}const ffe=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function";function xI(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*R9(n,e){for(;;){const{value:t,done:r}=Cu.runWithConfig(pf(n),e.next.bind(e),!0);if(r)break;yield t}}async function*kI(n,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:r,done:s}=await Cu.runWithConfig(pf(n),t.next.bind(e),!0);if(s)break;yield r}}function Er(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}class Nn extends qc{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new Pc({bound:this,kwargs:e,config:{}})}map(){return new Ow({bound:this})}withRetry(e){return new vj({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new Pc({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new mfe({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(jt);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,i)=>jt(i===0?e:r))}return Array.from({length:t},()=>jt(e))}async batch(e,t,r){var l;const s=this._getOptionsList(t??{},e.length),i=((l=s[0])==null?void 0:l.maxConcurrency)??(r==null?void 0:r.maxConcurrency),a=new hA({maxConcurrency:i,onFailedAttempt:u=>{throw u}}),o=e.map((u,h)=>a.call(async()=>{try{return await this.invoke(u,s[h])}catch(f){if(r!=null&&r.returnExceptions)return f;throw f}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=jt(t),s=new Gf({generator:this._streamIterator(e,r),config:r});return await s.setup,li.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=jt(e):t=jt({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){const s=jt(r),i=await ua(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),Er(t,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const l=e.call(this,t,s,a);o=await Iu(l,r==null?void 0:r.signal)}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}return await(a==null?void 0:a.handleChainEnd(Er(o,"output"))),o}async _batchWithConfig(e,t,r,s){var u;const i=this._getOptionsList(r??{},t.length),a=await Promise.all(i.map(ua)),o=await Promise.all(a.map(async(h,f)=>{const p=await(h==null?void 0:h.handleChainStart(this.toJSON(),Er(t[f],"input"),i[f].runId,i[f].runType,void 0,void 0,i[f].runName??this.getName()));return delete i[f].runId,p}));let l;try{const h=e.call(this,t,i,o,s);l=await Iu(h,(u=i==null?void 0:i[0])==null?void 0:u.signal)}catch(h){throw await Promise.all(o.map(f=>f==null?void 0:f.handleChainError(h))),h}return await Promise.all(o.map(h=>h==null?void 0:h.handleChainEnd(Er(l,"output")))),l}_concatOutputChunks(e,t){return nE(e,t)}async*_transformStreamWithConfig(e,t,r){let s,i=!0,a,o=!0;const l=jt(r),u=await ua(l),h=this;async function*f(){for await(const y of e){if(i)if(s===void 0)s=y;else try{s=h._concatOutputChunks(s,y)}catch{s=void 0,i=!1}yield y}}let p;try{const y=await gde(t.bind(this),f(),async()=>u==null?void 0:u.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),r==null?void 0:r.signal,l);delete l.runId,p=y.setup;const _=p==null?void 0:p.handlers.find(vde);let b=y.output;_!==void 0&&p!==void 0&&(b=_.tapOutputIterable(p.runId,b));const S=p==null?void 0:p.handlers.find(_de);S!==void 0&&p!==void 0&&(b=S.tapOutputIterable(p.runId,b));for await(const E of b)if(yield E,o)if(a===void 0)a=E;else try{a=this._concatOutputChunks(a,E)}catch{a=void 0,o=!1}}catch(y){throw await(p==null?void 0:p.handleChainError(y,void 0,void 0,void 0,{inputs:Er(s,"input")})),y}await(p==null?void 0:p.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:Er(s,"input")}))}getGraph(e){const t=new oE,r=t.addNode({name:`${this.getName()}Input`,schema:F5()}),s=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:F5()});return t.addEdge(r,s),t.addEdge(s,i),t}pipe(e){return new Oo({first:this,last:Sc(e)})}pick(e){return this.pipe(new gfe(e))}assign(e){return this.pipe(new wj(new Wf({steps:e})))}async*transform(e,t){let r;for await(const s of e)r===void 0?r=s:r=this._concatOutputChunks(r,s);yield*this._streamIterator(r,jt(t))}async*streamLog(e,t,r){const s=new E9({...r,autoClose:!1,_schemaFormat:"original"}),i=jt(t);yield*this._streamLog(e,s,i)}async*_streamLog(e,t,r){const{callbacks:s}=r;if(s===void 0)r.callbacks=[t];else if(Array.isArray(s))r.callbacks=s.concat([t]);else{const l=s.copy();l.addHandler(t,!0),r.callbacks=l}const i=this.stream(e,r);async function a(){try{const l=await i;for await(const u of l){const h=new Al({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await t.writer.write(h)}}finally{await t.writer.close()}}const o=a();try{for await(const l of t)yield l}finally{await o}}streamEvents(e,t,r){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,r);else if(t.version==="v2")s=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?hfe(s):li.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,r){var _;const s=new wde({...r,autoClose:!1}),i=jt(t),a=i.runId??rs();i.runId=a;const o=i.callbacks;if(o===void 0)i.callbacks=[s];else if(Array.isArray(o))i.callbacks=o.concat(s);else{const b=o.copy();b.addHandler(s,!0),i.callbacks=b}const l=new AbortController,u=this;async function h(){let b,S=null;try{t!=null&&t.signal?"any"in AbortSignal?b=AbortSignal.any([l.signal,t.signal]):(b=t.signal,S=()=>{l.abort()},t.signal.addEventListener("abort",S,{once:!0})):b=l.signal;const E=await u.stream(e,{...i,signal:b}),C=s.tapOutputIterable(a,E);for await(const v of C)if(l.signal.aborted)break}finally{await s.finish(),b&&S&&b.removeEventListener("abort",S)}}const f=h();let p=!1,y;try{for await(const b of s){if(!p){b.data.input=e,p=!0,y=b.run_id,yield b;continue}b.run_id===y&&b.event.endsWith("_end")&&(_=b.data)!=null&&_.input&&delete b.data.input,yield b}}finally{l.abort(),await f}}async*_streamEventsV1(e,t,r){let s,i=!1;const a=jt(t),o=a.tags??[],l=a.metadata??{},u=a.runName??this.getName(),h=new E9({...r,autoClose:!1,_schemaFormat:"streaming_events"}),f=new Sde({...r}),p=this._streamLog(e,h,a);for await(const _ of p){if(s?s=s.concat(_):s=zg.fromRunLogPatch(_),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const C={...s.state},v={run_id:C.id,event:`on_${C.type}_start`,name:u,tags:o,metadata:l,data:{input:e}};f.includeEvent(v,C.type)&&(yield v)}const b=_.ops.filter(C=>C.path.startsWith("/logs/")).map(C=>C.path.split("/")[2]),S=[...new Set(b)];for(const C of S){let v,I={};const L=s.state.logs[C];if(L.end_time===void 0?L.streamed_output.length>0?v="stream":v="start":v="end",v==="start")L.inputs!==void 0&&(I.input=L.inputs);else if(v==="end")L.inputs!==void 0&&(I.input=L.inputs),I.output=L.final_output;else if(v==="stream"){const R=L.streamed_output.length;if(R!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${R} instead. Encountered in: "${L.name}"`);I={chunk:L.streamed_output[0]},L.streamed_output=[]}yield{event:`on_${L.type}_${v}`,name:L.name,run_id:L.id,tags:L.tags,metadata:L.metadata,data:I}}const{state:E}=s;if(E.streamed_output.length>0){const C=E.streamed_output.length;if(C!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${C} instead. Encountered in: "${E.name}"`);const v={chunk:E.streamed_output[0]};E.streamed_output=[];const I={event:`on_${E.type}_stream`,run_id:E.id,tags:o,metadata:l,name:u,data:v};f.includeEvent(I,E.type)&&(yield I)}}const y=s==null?void 0:s.state;if(y!==void 0){const _={event:`on_${y.type}_end`,name:u,run_id:y.id,tags:o,metadata:l,data:{output:y.final_output}};f.includeEvent(_,y.type)&&(yield _)}}static isRunnable(e){return fA(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new Pc({bound:this,config:{},configFactories:[s=>({callbacks:[new ij({config:s,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return _fe(this,e)}}class Pc extends Nn{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=TI(this.config,...e);return TI(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new vj({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(jt(t),this.kwargs))}async batch(e,t,r){const s=Array.isArray(t)?await Promise.all(t.map(async i=>this._mergeConfig(jt(i),this.kwargs))):await this._mergeConfig(jt(t),this.kwargs);return this.bound.batch(e,s,r)}_concatOutputChunks(e,t){return this.bound._concatOutputChunks(e,t)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(jt(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(jt(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(jt(t),this.kwargs))}streamEvents(e,t,r){const s=this,i=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(jt(t),s.kwargs),version:t.version},r)};return li.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&Nn.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new Pc({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new ij({config:s,onStart:e,onEnd:t,onError:r})]})]})}}class Ow extends Nn{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Ow({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,ss(t,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new Ow({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class vj extends Pc{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const s=e>1?`retry:attempt:${e}`:void 0;return ss(t,{callbacks:r==null?void 0:r.getChild(s)})}async _invoke(e,t,r){return Tw(s=>super.invoke(e,this._patchConfigForRetry(s,t,r)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,s){const i={};try{await Tw(async a=>{const o=e.map((p,y)=>y).filter(p=>i[p.toString()]===void 0||i[p.toString()]instanceof Error),l=o.map(p=>e[p]),u=o.map(p=>this._patchConfigForRetry(a,t==null?void 0:t[p],r==null?void 0:r[p])),h=await super.batch(l,u,{...s,returnExceptions:!0});let f;for(let p=0;p<h.length;p+=1){const y=h[p],_=o[p];y instanceof Error&&f===void 0&&(f=y,f.input=l[p]),i[_.toString()]=y}if(f)throw f;return h},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((s==null?void 0:s.returnExceptions)!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class Oo extends Nn{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var l;const r=jt(t),s=await ua(r),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),Er(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let a=e,o;try{const u=[this.first,...this.middle];for(let h=0;h<u.length;h+=1){const p=u[h].invoke(a,ss(r,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${h+1}`)}));a=await Iu(p,t==null?void 0:t.signal)}if((l=t==null?void 0:t.signal)!=null&&l.aborted)throw new Error("Aborted");o=await this.last.invoke(a,ss(r,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(u){throw await(i==null?void 0:i.handleChainError(u)),u}return await(i==null?void 0:i.handleChainEnd(Er(o,"output"))),o}async batch(e,t,r){var l;const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(ua)),a=await Promise.all(i.map(async(u,h)=>{const f=await(u==null?void 0:u.handleChainStart(this.toJSON(),Er(e[h],"input"),s[h].runId,void 0,void 0,void 0,s[h].runName));return delete s[h].runId,f}));let o=e;try{for(let u=0;u<this.steps.length;u+=1){const f=this.steps[u].batch(o,a.map((p,y)=>{const _=p==null?void 0:p.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`);return ss(s[y],{callbacks:_})}),r);o=await Iu(f,(l=s[0])==null?void 0:l.signal)}}catch(u){throw await Promise.all(a.map(h=>h==null?void 0:h.handleChainError(u))),u}return await Promise.all(a.map(u=>u==null?void 0:u.handleChainEnd(Er(o,"output")))),o}_concatOutputChunks(e,t){return this.last._concatOutputChunks(e,t)}async*_streamIterator(e,t){var f;const r=await ua(t),{runId:s,...i}=t??{},a=await(r==null?void 0:r.handleChainStart(this.toJSON(),Er(e,"input"),s,void 0,void 0,void 0,i==null?void 0:i.runName)),o=[this.first,...this.middle,this.last];let l=!0,u;async function*h(){yield e}try{let p=o[0].transform(h(),ss(i,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let y=1;y<o.length;y+=1)p=await o[y].transform(p,ss(i,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${y+1}`)}));for await(const y of p)if((f=t==null?void 0:t.signal)==null||f.throwIfAborted(),yield y,l)if(u===void 0)u=y;else try{u=this._concatOutputChunks(u,y)}catch{u=void 0,l=!1}}catch(p){throw await(a==null?void 0:a.handleChainError(p)),p}await(a==null?void 0:a.handleChainEnd(Er(u,"output")))}getGraph(e){const t=new oE;let r=null;return this.steps.forEach((s,i)=>{const a=s.getGraph(e);i!==0&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);const o=a.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);r&&t.addEdge(r,o),r=a.lastNode()}),t}pipe(e){return Oo.isRunnableSequence(e)?new Oo({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new Oo({first:this.first,middle:[...this.middle,this.last],last:Sc(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Nn.isRunnable(e)}static from([e,...t],r){let s={};return typeof r=="string"?s.name=r:r!==void 0&&(s=r),new Oo({...s,first:Sc(e),middle:t.slice(0,-1).map(Sc),last:Sc(t[t.length-1])})}}class Wf extends Nn{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=Sc(r)}static from(e){return new Wf({steps:e})}async invoke(e,t){const r=jt(t),s=await ua(r),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const a={};try{const o=Object.entries(this.steps).map(async([l,u])=>{a[l]=await u.invoke(e,ss(r,{callbacks:i==null?void 0:i.getChild(`map:key:${l}`)}))});await Iu(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(a)),a}async*_transform(e,t,r){const s={...this.steps},i=sj(e,Object.keys(s).length),a=new Map(Object.entries(s).map(([o,l],u)=>{const h=l.transform(i[u],ss(r,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,h.next().then(f=>({key:o,gen:h,result:f}))]}));for(;a.size;){const o=Promise.race(a.values()),{key:l,result:u,gen:h}=await Iu(o,r==null?void 0:r.signal);a.delete(l),u.done||(yield{[l]:u.value},a.set(l,h.next().then(f=>({key:l,gen:h,result:f}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=jt(t),i=new Gf({generator:this.transform(r(),s),config:s});return await i.setup,li.fromAsyncGenerator(i)}}class gA extends Nn{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!tA(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[r]=this._getOptionsList(t??{},1),s=await ua(r),i=this.func(ss(r,{callbacks:s}),e);return Iu(i,r==null?void 0:r.signal)}async*_streamIterator(e,t){var i,a;const[r]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(xI(s)){for await(const o of s)(i=r==null?void 0:r.signal)==null||i.throwIfAborted(),yield o;return}if(ffe(s)){for(;;){(a=r==null?void 0:r.signal)==null||a.throwIfAborted();const o=s.next();if(o.done)break;yield o.value}return}yield s}static from(e){return new gA({func:e})}}function pfe(n){if(tA(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class Hf extends Nn{static lc_name(){return"RunnableLambda"}constructor(e){if(tA(e.func))return gA.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),pfe(e.func),this.func=e.func}static from(e){return new Hf({func:e})}async _invoke(e,t,r){return new Promise((s,i)=>{const a=ss(t,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??U2)-1});Cu.runWithConfig(pf(a),async()=>{var o,l;try{let u=await this.func(e,{...a});if(u&&Nn.isRunnable(u)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");u=await u.invoke(e,{...a,recursionLimit:(a.recursionLimit??U2)-1})}else if(xI(u)){let h;for await(const f of kI(a,u))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),h===void 0)h=f;else try{h=this._concatOutputChunks(h,f)}catch{h=f}u=h}else if(A9(u)){let h;for(const f of R9(a,u))if((l=t==null?void 0:t.signal)==null||l.throwIfAborted(),h===void 0)h=f;else try{h=this._concatOutputChunks(h,f)}catch{h=f}u=h}s(u)}catch(u){i(u)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,r){var o,l;let s;for await(const u of e)if(s===void 0)s=u;else try{s=this._concatOutputChunks(s,u)}catch{s=u}const i=ss(r,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??U2)-1}),a=await new Promise((u,h)=>{Cu.runWithConfig(pf(i),async()=>{try{const f=await this.func(s,{...i,config:i});u(f)}catch(f){h(f)}})});if(a&&Nn.isRunnable(a)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const u=await a.stream(s,i);for await(const h of u)yield h}else if(xI(a))for await(const u of kI(i,a))(o=r==null?void 0:r.signal)==null||o.throwIfAborted(),yield u;else if(A9(a))for(const u of R9(i,a))(l=r==null?void 0:r.signal)==null||l.throwIfAborted(),yield u;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=jt(t),i=new Gf({generator:this.transform(r(),s),config:s});return await i.setup,li.fromAsyncGenerator(i)}}class mfe extends Nn{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=jt(t),s=await ua(r),{runId:i,...a}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Er(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName)),l=ss(a,{callbacks:o==null?void 0:o.getChild()});return await Cu.runWithConfig(l,async()=>{var f;let h;for(const p of this.runnables()){(f=r==null?void 0:r.signal)==null||f.throwIfAborted();try{const y=await p.invoke(e,l);return await(o==null?void 0:o.handleChainEnd(Er(y,"output"))),y}catch(y){h===void 0&&(h=y)}}throw h===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(h)),h)})}async*_streamIterator(e,t){var f;const r=jt(t),s=await ua(r),{runId:i,...a}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Er(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName));let l,u;for(const p of this.runnables()){(f=r==null?void 0:r.signal)==null||f.throwIfAborted();const y=ss(a,{callbacks:o==null?void 0:o.getChild()});try{const _=await p.stream(e,y);u=kI(y,_);break}catch(_){l===void 0&&(l=_)}}if(u===void 0){const p=l??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(p)),p}let h;try{for await(const p of u){yield p;try{h=h===void 0?h:this._concatOutputChunks(h,p)}catch{h=void 0}}}catch(p){throw await(o==null?void 0:o.handleChainError(p)),p}await(o==null?void 0:o.handleChainEnd(Er(h,"output")))}async batch(e,t,r){var l;if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(u=>ua(u))),a=await Promise.all(i.map(async(u,h)=>{const f=await(u==null?void 0:u.handleChainStart(this.toJSON(),Er(e[h],"input"),s[h].runId,void 0,void 0,void 0,s[h].runName));return delete s[h].runId,f}));let o;for(const u of this.runnables()){(l=s[0].signal)==null||l.throwIfAborted();try{const h=await u.batch(e,a.map((f,p)=>ss(s[p],{callbacks:f==null?void 0:f.getChild()})),r);return await Promise.all(a.map((f,p)=>f==null?void 0:f.handleChainEnd(Er(h[p],"output")))),h}catch(h){o===void 0&&(o=h)}}throw o?(await Promise.all(a.map(u=>u==null?void 0:u.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function Sc(n){if(typeof n=="function")return new Hf({func:n});if(Nn.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=Sc(r);return new Wf({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class wj extends Nn{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Wf&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const s=this.mapper.getStepsKeys(),[i,a]=sj(e),o=this.mapper.transform(a,ss(r,{callbacks:t==null?void 0:t.getChild()})),l=o.next();for await(const u of i){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);const h=Object.fromEntries(Object.entries(u).filter(([f])=>!s.includes(f)));Object.keys(h).length>0&&(yield h)}yield(await l).value;for await(const u of o)yield u}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=jt(t),i=new Gf({generator:this.transform(r(),s),config:s});return await i.setup,li.fromAsyncGenerator(i)}}class gfe extends Nn{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=jt(t),i=new Gf({generator:this.transform(r(),s),config:s});return await i.setup,li.fromAsyncGenerator(i)}}class N9 extends Pc{constructor(e){const t=Oo.from([Hf.from(async r=>{let s;if(Bm(r))try{s=await pA(this.schema,r.args)}catch{throw new bI("Received tool input did not match expected schema",JSON.stringify(r.args))}else s=r;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function _fe(n,e){const t=e.name??n.getName(),r=e.description??mA(e.schema);return ofe(e.schema)?new N9({name:t,description:r,schema:eA({input:ZP()}).transform(s=>s.input),bound:n}):new N9({name:t,description:r,schema:e.schema,bound:n})}class _A extends Nn{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[i,a]of Object.entries(t))typeof a=="string"?r[i]=a:r[i]=await a();return{...r,...e}}async invoke(e,t){const r={...this.metadata,...t==null?void 0:t.metadata},s=[...this.tags??[],...(t==null?void 0:t.tags)??[]];return this._callWithConfig(i=>this.formatPromptValue(i),e,{...t,tags:s,metadata:r,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Fm(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>M9);return{PromptTemplate:r}},void 0);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Fm(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>M9);return{PromptTemplate:r}},void 0);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Fm(async()=>{const{FewShotPromptTemplate:r}=await import("./few_shot-B6y1m8cK.js");return{FewShotPromptTemplate:r}},[]);return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class yA extends qc{}class bj extends yA{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new zf(this.value)]}}class Ej extends yA{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return tj(this.messages)}toChatMessages(){return this.messages}}class yfe extends yA{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new zf({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}class PI extends _A{async formatPromptValue(e){const t=await this.format(e);return new bj(t)}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var vfe=Object.prototype.toString,qf=Array.isArray||function(e){return vfe.call(e)==="[object Array]"};function vA(n){return typeof n=="function"}function wfe(n){return qf(n)?"array":typeof n}function W2(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function O9(n,e){return n!=null&&typeof n=="object"&&e in n}function bfe(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var Efe=RegExp.prototype.test;function Sfe(n,e){return Efe.call(n,e)}var Tfe=/\S/;function Cfe(n){return!Sfe(Tfe,n)}var Ife={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function xfe(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return Ife[t]})}var kfe=/\s*/,Pfe=/\s+/,L9=/\s*=/,Afe=/\s*\}/,Rfe=/#|\^|\/|>|\{|&|=|!/;function Nfe(n,e){if(!n)return[];var t=!1,r=[],s=[],i=[],a=!1,o=!1,l="",u=0;function h(){if(a&&!o)for(;i.length;)delete s[i.pop()];else i=[];a=!1,o=!1}var f,p,y;function _(x){if(typeof x=="string"&&(x=x.split(Pfe,2)),!qf(x)||x.length!==2)throw new Error("Invalid tags: "+x);f=new RegExp(W2(x[0])+"\\s*"),p=new RegExp("\\s*"+W2(x[1])),y=new RegExp("\\s*"+W2("}"+x[1]))}_(e||qs.tags);for(var b=new P_(n),S,E,C,v,I,L;!b.eos();){if(S=b.pos,C=b.scanUntil(f),C)for(var R=0,P=C.length;R<P;++R)v=C.charAt(R),Cfe(v)?(i.push(s.length),l+=v):(o=!0,t=!0,l+=" "),s.push(["text",v,S,S+1]),S+=1,v===`
`&&(h(),l="",u=0,t=!1);if(!b.scan(f))break;if(a=!0,E=b.scan(Rfe)||"name",b.scan(kfe),E==="="?(C=b.scanUntil(L9),b.scan(L9),b.scanUntil(p)):E==="{"?(C=b.scanUntil(y),b.scan(Afe),b.scanUntil(p),E="&"):C=b.scanUntil(p),!b.scan(p))throw new Error("Unclosed tag at "+b.pos);if(E==">"?I=[E,C,S,b.pos,l,u,t]:I=[E,C,S,b.pos],u++,s.push(I),E==="#"||E==="^")r.push(I);else if(E==="/"){if(L=r.pop(),!L)throw new Error('Unopened section "'+C+'" at '+S);if(L[1]!==C)throw new Error('Unclosed section "'+L[1]+'" at '+S)}else E==="name"||E==="{"||E==="&"?o=!0:E==="="&&_(C)}if(h(),L=r.pop(),L)throw new Error('Unclosed section "'+L[1]+'" at '+b.pos);return Lfe(Ofe(s))}function Ofe(n){for(var e=[],t,r,s=0,i=n.length;s<i;++s)t=n[s],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function Lfe(n){for(var e=[],t=e,r=[],s,i,a=0,o=n.length;a<o;++a)switch(s=n[a],s[0]){case"#":case"^":t.push(s),r.push(s),t=s[4]=[];break;case"/":i=r.pop(),i[5]=s[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(s)}return e}function P_(n){this.string=n,this.tail=n,this.pos=0}P_.prototype.eos=function(){return this.tail===""};P_.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};P_.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function gf(n,e){this.view=n,this.cache={".":this.view},this.parent=e}gf.prototype.push=function(e){return new gf(e,this)};gf.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var s=this,i,a,o,l=!1;s;){if(e.indexOf(".")>0)for(i=s.view,a=e.split("."),o=0;i!=null&&o<a.length;)o===a.length-1&&(l=O9(i,a[o])||bfe(i,a[o])),i=i[a[o++]];else i=s.view[e],l=O9(s.view,e);if(l){r=i;break}s=s.parent}t[e]=r}return vA(r)&&(r=r.call(this.view)),r};function Cs(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}Cs.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};Cs.prototype.parse=function(e,t){var r=this.templateCache,s=e+":"+(t||qs.tags).join(":"),i=typeof r<"u",a=i?r.get(s):void 0;return a==null&&(a=Nfe(e,t),i&&r.set(s,a)),a};Cs.prototype.render=function(e,t,r,s){var i=this.getConfigTags(s),a=this.parse(e,i),o=t instanceof gf?t:new gf(t,void 0);return this.renderTokens(a,o,r,e,s)};Cs.prototype.renderTokens=function(e,t,r,s,i){for(var a="",o,l,u,h=0,f=e.length;h<f;++h)u=void 0,o=e[h],l=o[0],l==="#"?u=this.renderSection(o,t,r,s,i):l==="^"?u=this.renderInverted(o,t,r,s,i):l===">"?u=this.renderPartial(o,t,r,i):l==="&"?u=this.unescapedValue(o,t):l==="name"?u=this.escapedValue(o,t,i):l==="text"&&(u=this.rawValue(o)),u!==void 0&&(a+=u);return a};Cs.prototype.renderSection=function(e,t,r,s,i){var a=this,o="",l=t.lookup(e[1]);function u(p){return a.render(p,t,r,i)}if(l){if(qf(l))for(var h=0,f=l.length;h<f;++h)o+=this.renderTokens(e[4],t.push(l[h]),r,s,i);else if(typeof l=="object"||typeof l=="string"||typeof l=="number")o+=this.renderTokens(e[4],t.push(l),r,s,i);else if(vA(l)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");l=l.call(t.view,s.slice(e[3],e[5]),u),l!=null&&(o+=l)}else o+=this.renderTokens(e[4],t,r,s,i);return o}};Cs.prototype.renderInverted=function(e,t,r,s,i){var a=t.lookup(e[1]);if(!a||qf(a)&&a.length===0)return this.renderTokens(e[4],t,r,s,i)};Cs.prototype.indentPartial=function(e,t,r){for(var s=t.replace(/[^ \t]/g,""),i=e.split(`
`),a=0;a<i.length;a++)i[a].length&&(a>0||!r)&&(i[a]=s+i[a]);return i.join(`
`)};Cs.prototype.renderPartial=function(e,t,r,s){if(r){var i=this.getConfigTags(s),a=vA(r)?r(e[1]):r[e[1]];if(a!=null){var o=e[6],l=e[5],u=e[4],h=a;l==0&&u&&(h=this.indentPartial(a,u,o));var f=this.parse(h,i);return this.renderTokens(f,t,r,h,s)}}};Cs.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};Cs.prototype.escapedValue=function(e,t,r){var s=this.getConfigEscape(r)||qs.escape,i=t.lookup(e[1]);if(i!=null)return typeof i=="number"&&s===qs.escape?String(i):s(i)};Cs.prototype.rawValue=function(e){return e[1]};Cs.prototype.getConfigTags=function(e){return qf(e)?e:e&&typeof e=="object"?e.tags:void 0};Cs.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!qf(e))return e.escape};var qs={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){Gg.templateCache=n},get templateCache(){return Gg.templateCache}},Gg=new Cs;qs.clearCache=function(){return Gg.clearCache()};qs.parse=function(e,t){return Gg.parse(e,t)};qs.render=function(e,t,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+wfe(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Gg.render(e,t,r,s)};qs.escape=xfe;qs.Scanner=P_;qs.Context=gf;qs.Writer=Cs;function Sj(){qs.escape=n=>n}const Lw=n=>{const e=n.split(""),t=[],r=(i,a)=>{for(let o=a;o<e.length;o+=1)if(i.includes(e[o]))return o;return-1};let s=0;for(;s<e.length;)if(e[s]==="{"&&s+1<e.length&&e[s+1]==="{")t.push({type:"literal",text:"{"}),s+=2;else if(e[s]==="}"&&s+1<e.length&&e[s+1]==="}")t.push({type:"literal",text:"}"}),s+=2;else if(e[s]==="{"){const i=r("}",s);if(i<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(s+1,i).join("")}),s=i+1}else{if(e[s]==="}")throw new Error("Single '}' in template.");{const i=r("{}",s),a=(i<0?e.slice(s):e.slice(s,i)).join("");t.push({type:"literal",text:a}),s=i<0?e.length:i}}return t},Tj=(n,e=[])=>{const t=[];for(const r of n)if(r[0]==="name"){const s=r[1].includes(".")?r[1].split(".")[0]:r[1];t.push({type:"variable",name:s})}else if(["#","&","^",">"].includes(r[0])){if(t.push({type:"variable",name:r[1]}),r[0]==="#"&&r.length>4&&Array.isArray(r[4])){const s=[...e,r[1]],i=Tj(r[4],s);t.push(...i)}}else t.push({type:"literal",text:r[1]});return t},AI=n=>{Sj();const e=qs.parse(n);return Tj(e)},Mfe=(n,e)=>Lw(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e){const s=typeof e[r.name]=="string"?e[r.name]:JSON.stringify(e[r.name]);return t+s}throw new Error(`(f-string) Missing value for input ${r.name}`)}return t+r.text},""),Dfe=(n,e)=>(Sj(),qs.render(n,e)),RI={"f-string":Mfe,mustache:Dfe},Ffe={"f-string":Lw,mustache:AI},ql=(n,e,t)=>{try{return RI[e](n,t)}catch(r){throw Yb(r,"INVALID_PROMPT_INPUT")}},NI=(n,e)=>Ffe[e](n),Cj=(n,e,t)=>{if(!(e in RI)){const r=Object.keys(RI);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=t.reduce((s,i)=>(s[i]="foo",s),{});Array.isArray(n)?n.forEach(s=>{if(s.type==="text")ql(s.text,e,r);else if(s.type==="image_url")if(typeof s.image_url=="string")ql(s.image_url,e,r);else{const i=s.image_url.url;ql(i,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(s,null,2)}`)}):ql(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class xi extends PI{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Cj(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return ql(this.template,this.templateFormat,t)}static fromExamples(e,t,r,s=`

`,i=""){const a=[i,...e,t].join(s);return new xi({inputVariables:r,template:a})}static fromTemplate(e,t){const{templateFormat:r="f-string",...s}=t??{},i=new Set;return NI(e,r).forEach(a=>{a.type==="variable"&&i.add(a.name)}),new xi({inputVariables:[...i],templateFormat:r,template:e,...s})}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new xi(s)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new xi({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const M9=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:xi},Symbol.toStringTag,{value:"Module"}));class Hm extends _A{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Cj([{type:"image_url",image_url:this.template}],this.templateFormat,t)}}_getPromptType(){return"prompt"}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new Hm(s)}async format(e){const t={};for(const[a,o]of Object.entries(this.template))typeof o=="string"?t[a]=ql(o,this.templateFormat,e):t[a]=o;const r=e.url||t.url,s=e.detail||t.detail;if(!r)throw new Error("Must provide either an image URL.");if(typeof r!="string")throw new Error("url must be a string.");const i={url:r};return s&&(i.detail=s),i}async formatPromptValue(e){const t=await this.format(e);return new yfe(t)}}class D9 extends Nn{static lc_name(){return"DictPromptTemplate"}constructor(e){const t=e.templateFormat??"f-string",r=OI(e.template,t);super({inputVariables:r,...e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","dict"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=t,this.inputVariables=r}async format(e){return LI(this.template,e,this.templateFormat)}async invoke(e){return await this._callWithConfig(this.format.bind(this),e,{runType:"prompt"})}}function OI(n,e){const t=[];for(const r of Object.values(n))if(typeof r=="string")NI(r,e).forEach(s=>{s.type==="variable"&&t.push(s.name)});else if(Array.isArray(r))for(const s of r)typeof s=="string"?NI(s,e).forEach(i=>{i.type==="variable"&&t.push(i.name)}):typeof s=="object"&&t.push(...OI(s,e));else typeof r=="object"&&r!==null&&t.push(...OI(r,e));return Array.from(new Set(t))}function LI(n,e,t){const r={};for(const[s,i]of Object.entries(n))if(typeof i=="string")r[s]=ql(i,t,e);else if(Array.isArray(i)){const a=[];for(const o of i)typeof o=="string"?a.push(ql(o,t,e)):typeof o=="object"&&a.push(LI(o,e,t));r[s]=a}else typeof i=="object"&&i!==null?r[s]=LI(i,e,t):r[s]=i;return r}class wA extends Nn{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(r=>this.formatMessages(r),e,{...t,runType:"prompt"})}}class F9 extends wA{static lc_name(){return"MessagesPlaceholder"}constructor(e){typeof e=="string"&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){const t=e[this.variableName];if(this.optional&&!t)return[];if(!t){const s=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw s.name="InputFormatError",s}let r;try{Array.isArray(t)?r=t.map(zl):r=[zl(t)]}catch(s){const i=typeof t=="string"?t:JSON.stringify(t,null,2),a=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${i}`,`Additional message: ${s.message}`].join(`

`));throw a.name="InputFormatError",a.lc_error_code=s.lc_error_code,a}return r}}class $fe extends wA{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class jfe extends _A{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new Ej(t)}}class Ufe extends $fe{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new gd(await this.prompt.format(e),this.role)}static fromTemplate(e,t,r){return new this(xi.fromTemplate(e,{templateFormat:r==null?void 0:r.templateFormat}),t)}}function Vfe(n){return n===null||typeof n!="object"||Array.isArray(n)?!1:Object.keys(n).length===1&&"text"in n&&typeof n.text=="string"}function Bfe(n){return n===null||typeof n!="object"||Array.isArray(n)?!1:"image_url"in n&&(typeof n.image_url=="string"||typeof n.image_url=="object"&&n.image_url!==null&&"url"in n.image_url&&typeof n.image_url.url=="string")}class bA extends wA{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let r=[];this.prompt.forEach(s=>{"inputVariables"in s&&(r=r.concat(s.inputVariables))}),this.inputVariables=r}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){const t=this.constructor;if(t._messageClass()){const r=t._messageClass();return new r({content:e})}else if(t.chatMessageClass){const r=t.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if(typeof e=="string")return new this(xi.fromTemplate(e,t));const r=[];for(const s of e)if(typeof s=="string")r.push(xi.fromTemplate(s,t));else if(s!==null)if(Vfe(s)){let i="";typeof s.text=="string"&&(i=s.text??"");const a={...t,additionalContentFields:s};r.push(xi.fromTemplate(i,a))}else if(Bfe(s)){let i=s.image_url??"",a,o=[];if(typeof i=="string"){let l;(t==null?void 0:t.templateFormat)==="mustache"?l=AI(i):l=Lw(i);const u=l.flatMap(h=>h.type==="variable"?[h.name]:[]);if(((u==null?void 0:u.length)??0)>0){if(u.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${u}
From: ${i}`);o=[u[0]]}else o=[];i={url:i},a=new Hm({template:i,inputVariables:o,templateFormat:t==null?void 0:t.templateFormat,additionalContentFields:s})}else if(typeof i=="object"){if("url"in i){let l;(t==null?void 0:t.templateFormat)==="mustache"?l=AI(i.url):l=Lw(i.url),o=l.flatMap(u=>u.type==="variable"?[u.name]:[])}else o=[];a=new Hm({template:i,inputVariables:o,templateFormat:t==null?void 0:t.templateFormat,additionalContentFields:s})}else throw new Error("Invalid image template");r.push(a)}else typeof s=="object"&&r.push(new D9({template:s,templateFormat:t==null?void 0:t.templateFormat}));return new this({prompt:r,additionalOptions:t})}async format(e){if(this.prompt instanceof PI){const t=await this.prompt.format(e);return this.createMessage(t)}else{const t=[];for(const r of this.prompt){let s={};if(!("inputVariables"in r))throw new Error(`Prompt ${r} does not have inputVariables defined.`);for(const i of r.inputVariables)s||(s={[i]:e[i]}),s={...s,[i]:e[i]};if(r instanceof PI){const i=await r.format(s);let a;"additionalContentFields"in r&&(a=r.additionalContentFields),i!==""&&t.push({...a,type:"text",text:i})}else if(r instanceof Hm){const i=await r.format(s);let a;"additionalContentFields"in r&&(a=r.additionalContentFields),t.push({...a,type:"image_url",image_url:i})}else if(r instanceof D9){const i=await r.format(s);let a;"additionalContentFields"in r&&(a=r.additionalContentFields),t.push({...a,...i})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}}class Ij extends bA{static _messageClass(){return zf}static lc_name(){return"HumanMessagePromptTemplate"}}class zfe extends bA{static _messageClass(){return ff}static lc_name(){return"AIMessagePromptTemplate"}}class Gfe extends bA{static _messageClass(){return SI}static lc_name(){return"SystemMessagePromptTemplate"}}function Wfe(n){return typeof n.formatMessages=="function"}function Hfe(n,e){if(Wfe(n)||x_(n))return n;if(Array.isArray(n)&&n[0]==="placeholder"){const s=n[1];if((e==null?void 0:e.templateFormat)==="mustache"&&typeof s=="string"&&s.slice(0,2)==="{{"&&s.slice(-2)==="}}"){const i=s.slice(2,-2);return new F9({variableName:i,optional:!0})}else if(typeof s=="string"&&s[0]==="{"&&s[s.length-1]==="}"){const i=s.slice(1,-1);return new F9({variableName:i,optional:!0})}throw new Error(`Invalid placeholder template for format ${(e==null?void 0:e.templateFormat)??'"f-string"'}: "${n[1]}". Expected a variable name surrounded by ${(e==null?void 0:e.templateFormat)==="mustache"?"double":"single"} curly braces.`)}const t=zl(n);let r;if(typeof t.content=="string"?r=t.content:r=t.content.map(s=>"text"in s?{...s,text:s.text}:"image_url"in s?{...s,image_url:s.image_url}:s),t._getType()==="human")return Ij.fromTemplate(r,e);if(t._getType()==="ai")return zfe.fromTemplate(r,e);if(t._getType()==="system")return Gfe.fromTemplate(r,e);if(gd.isInstance(t))return Ufe.fromTemplate(t.content,t.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}function qfe(n){return n.constructor.lc_name()==="MessagesPlaceholder"}class Mh extends jfe{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){const t=new Set;for(const o of this.promptMessages)if(!(o instanceof Ya))for(const l of o.inputVariables)t.add(l);const r=this.inputVariables,s=new Set(this.partialVariables?r.concat(Object.keys(this.partialVariables)):r),i=new Set([...s].filter(o=>!t.has(o)));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are not used in any of the prompt messages.`);const a=new Set([...t].filter(o=>!s.has(o)));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if(typeof e.content=="string")return e;const r=await Promise.all(e.content.map(async s=>{if(s.type!=="image_url")return s;let i="";typeof s.image_url=="string"?i=s.image_url:i=s.image_url.url;const o=await xi.fromTemplate(i,{templateFormat:this.templateFormat}).format(t);return typeof s.image_url!="string"&&"url"in s.image_url?s.image_url.url=o:s.image_url=o,s}));return e.content=r,e}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=[];for(const s of this.promptMessages)if(s instanceof Ya)r.push(await this._parseImagePrompts(s,t));else{let i;this.templateFormat==="mustache"?i={...t}:i=s.inputVariables.reduce((o,l)=>{if(!(l in t)&&!(qfe(s)&&s.optional))throw Yb(new Error(`Missing value for input variable \`${l.toString()}\``),"INVALID_PROMPT_INPUT");return o[l]=t[l],o},{});const a=await s.formatMessages(i);r=r.concat(a)}return r}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new Mh(s)}static fromTemplate(e,t){const r=xi.fromTemplate(e,t),s=new Ij({prompt:r});return this.fromMessages([s])}static fromMessages(e,t){const r=e.reduce((a,o)=>a.concat(o instanceof Mh?o.promptMessages:[Hfe(o,t)]),[]),s=e.reduce((a,o)=>o instanceof Mh?Object.assign(a,o.partialVariables):a,Object.create(null)),i=new Set;for(const a of r)if(!(a instanceof Ya))for(const o of a.inputVariables)o in s||i.add(o);return new this({...t,inputVariables:[...i],promptMessages:r,partialVariables:s,templateFormat:t==null?void 0:t.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}function Ke(n,e,t,r,s){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}function J(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}let xj=function(){const{crypto:n}=globalThis;if(n!=null&&n.randomUUID)return xj=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function MI(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const DI=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};class qe extends Error{}class zr extends qe{constructor(e,t,r,s){super(`${zr.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.requestID=s==null?void 0:s.get("x-request-id"),this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new lE({message:r,cause:DI(t)});const i=t==null?void 0:t.error;return e===400?new kj(e,i,r,s):e===401?new Pj(e,i,r,s):e===403?new Aj(e,i,r,s):e===404?new Rj(e,i,r,s):e===409?new Nj(e,i,r,s):e===422?new Oj(e,i,r,s):e===429?new Lj(e,i,r,s):e>=500?new Mj(e,i,r,s):new zr(e,i,r,s)}}class ni extends zr{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class lE extends zr{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class uE extends lE{constructor({message:e}={}){super({message:e??"Request timed out."})}}class kj extends zr{}class Pj extends zr{}class Aj extends zr{}class Rj extends zr{}class Nj extends zr{}class Oj extends zr{}class Lj extends zr{}class Mj extends zr{}class Dj extends qe{constructor(){super("Could not parse response content as the length limit was reached")}}class Fj extends qe{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class om extends Error{constructor(e){super(e)}}const Kfe=/^[a-z][a-z0-9+.-]*:/i,Qfe=n=>Kfe.test(n);let $s=n=>($s=Array.isArray,$s(n)),$9=$s;function Yfe(n){return typeof n!="object"?{}:n??{}}function Jfe(n){if(!n)return!0;for(const e in n)return!1;return!0}function Xfe(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function H2(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}const Zfe=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new qe(`${n} must be an integer`);if(e<0)throw new qe(`${n} must be a positive integer`);return e},epe=n=>{try{return JSON.parse(n)}catch{return}},A_=n=>new Promise(e=>setTimeout(e,n)),th="5.12.2",tpe=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function npe(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const rpe=()=>{var t;const n=npe();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":th,"X-Stainless-OS":U9(Deno.build.os),"X-Stainless-Arch":j9(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":th,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":th,"X-Stainless-OS":U9(globalThis.process.platform??"unknown"),"X-Stainless-Arch":j9(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=spe();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":th,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":th,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function spe(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const j9=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",U9=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let V9;const ipe=()=>V9??(V9=rpe());function ape(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function $j(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function jj(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return $j({start(){},async pull(t){const{done:r,value:s}=await e.next();r?t.close():t.enqueue(s)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function Uj(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function ope(n){var r,s;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((s=(r=n[Symbol.asyncIterator]()).return)==null?void 0:s.call(r));return}const e=n.getReader(),t=e.cancel();e.releaseLock(),await t}const lpe=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),Vj="RFC3986",Bj=n=>String(n),B9={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:Bj},upe="RFC1738";let FI=(n,e)=>(FI=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),FI(n,e));const La=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),q2=1024,cpe=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=q2){const l=i.length>=q2?i.slice(o,o+q2):i,u=[];for(let h=0;h<l.length;++h){let f=l.charCodeAt(h);if(f===45||f===46||f===95||f===126||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||s===upe&&(f===40||f===41)){u[u.length]=l.charAt(h);continue}if(f<128){u[u.length]=La[f];continue}if(f<2048){u[u.length]=La[192|f>>6]+La[128|f&63];continue}if(f<55296||f>=57344){u[u.length]=La[224|f>>12]+La[128|f>>6&63]+La[128|f&63];continue}h+=1,f=65536+((f&1023)<<10|l.charCodeAt(h)&1023),u[u.length]=La[240|f>>18]+La[128|f>>12&63]+La[128|f>>6&63]+La[128|f&63]}a+=u.join("")}return a};function dpe(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function z9(n,e){if($s(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const zj={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},Gj=function(n,e){Array.prototype.push.apply(n,$s(e)?e:[e])};let G9;const Zn={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:cpe,encodeValuesOnly:!1,format:Vj,formatter:Bj,indices:!1,serializeDate(n){return(G9??(G9=Function.prototype.call.bind(Date.prototype.toISOString)))(n)},skipNulls:!1,strictNullHandling:!1};function hpe(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const K2={};function Wj(n,e,t,r,s,i,a,o,l,u,h,f,p,y,_,b,S,E){let C=n,v=E,I=0,L=!1;for(;(v=v.get(K2))!==void 0&&!L;){const M=v.get(n);if(I+=1,typeof M<"u"){if(M===I)throw new RangeError("Cyclic object value");L=!0}typeof v.get(K2)>"u"&&(I=0)}if(typeof u=="function"?C=u(e,C):C instanceof Date?C=p==null?void 0:p(C):t==="comma"&&$s(C)&&(C=z9(C,function(M){return M instanceof Date?p==null?void 0:p(M):M})),C===null){if(i)return l&&!b?l(e,Zn.encoder,S,"key",y):e;C=""}if(hpe(C)||dpe(C)){if(l){const M=b?e:l(e,Zn.encoder,S,"key",y);return[(_==null?void 0:_(M))+"="+(_==null?void 0:_(l(C,Zn.encoder,S,"value",y)))]}return[(_==null?void 0:_(e))+"="+(_==null?void 0:_(String(C)))]}const R=[];if(typeof C>"u")return R;let P;if(t==="comma"&&$s(C))b&&l&&(C=z9(C,l)),P=[{value:C.length>0?C.join(",")||null:void 0}];else if($s(u))P=u;else{const M=Object.keys(C);P=h?M.sort(h):M}const x=o?String(e).replace(/\./g,"%2E"):String(e),N=r&&$s(C)&&C.length===1?x+"[]":x;if(s&&$s(C)&&C.length===0)return N+"[]";for(let M=0;M<P.length;++M){const D=P[M],F=typeof D=="object"&&typeof D.value<"u"?D.value:C[D];if(a&&F===null)continue;const $=f&&o?D.replace(/\./g,"%2E"):D,H=$s(C)?typeof t=="function"?t(N,$):N:N+(f?"."+$:"["+$+"]");E.set(n,I);const G=new WeakMap;G.set(K2,E),Gj(R,Wj(F,H,t,r,s,i,a,o,t==="comma"&&b&&$s(C)?null:l,u,h,f,p,y,_,b,S,G))}return R}function fpe(n=Zn){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||Zn.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Vj;if(typeof n.format<"u"){if(!FI(B9,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=B9[t];let s=Zn.filter;(typeof n.filter=="function"||$s(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in zj?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=Zn.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:Zn.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:Zn.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:Zn.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:Zn.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?Zn.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:Zn.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:Zn.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:Zn.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:Zn.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:Zn.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:Zn.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:Zn.strictNullHandling}}function ppe(n,e={}){let t=n;const r=fpe(e);let s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):$s(r.filter)&&(i=r.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=zj[r.arrayFormat],l=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);const u=new WeakMap;for(let p=0;p<s.length;++p){const y=s[p];r.skipNulls&&t[y]===null||Gj(a,Wj(t[y],y,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}const h=a.join(r.delimiter);let f=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),h.length>0?f+h:""}function mpe(n){let e=0;for(const s of n)e+=s.length;const t=new Uint8Array(e);let r=0;for(const s of n)t.set(s,r),r+=s.length;return t}let W9;function EA(n){let e;return(W9??(e=new globalThis.TextEncoder,W9=e.encode.bind(e)))(n)}let H9;function q9(n){let e;return(H9??(e=new globalThis.TextDecoder,H9=e.decode.bind(e)))(n)}var Ys,Js;class cE{constructor(){Ys.set(this,void 0),Js.set(this,void 0),Ke(this,Ys,new Uint8Array),Ke(this,Js,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?EA(e):e;Ke(this,Ys,mpe([J(this,Ys,"f"),t]));const r=[];let s;for(;(s=gpe(J(this,Ys,"f"),J(this,Js,"f")))!=null;){if(s.carriage&&J(this,Js,"f")==null){Ke(this,Js,s.index);continue}if(J(this,Js,"f")!=null&&(s.index!==J(this,Js,"f")+1||s.carriage)){r.push(q9(J(this,Ys,"f").subarray(0,J(this,Js,"f")-1))),Ke(this,Ys,J(this,Ys,"f").subarray(J(this,Js,"f"))),Ke(this,Js,null);continue}const i=J(this,Js,"f")!==null?s.preceding-1:s.preceding,a=q9(J(this,Ys,"f").subarray(0,i));r.push(a),Ke(this,Ys,J(this,Ys,"f").subarray(s.index)),Ke(this,Js,null)}return r}flush(){return J(this,Ys,"f").length?this.decode(`
`):[]}}Ys=new WeakMap,Js=new WeakMap;cE.NEWLINE_CHARS=new Set([`
`,"\r"]);cE.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function gpe(n,e){for(let s=e??0;s<n.length;s++){if(n[s]===10)return{preceding:s,index:s+1,carriage:!1};if(n[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function _pe(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}const Mw={off:0,error:200,warn:300,info:400,debug:500},K9=(n,e,t)=>{if(n){if(Xfe(Mw,n))return n;Mr(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(Mw))}`)}};function lm(){}function y0(n,e,t){return!e||Mw[n]>Mw[t]?lm:e[n].bind(e)}const ype={error:lm,warn:lm,info:lm,debug:lm};let Q9=new WeakMap;function Mr(n){const e=n.logger,t=n.logLevel??"off";if(!e)return ype;const r=Q9.get(e);if(r&&r[0]===t)return r[1];const s={error:y0("error",e,t),warn:y0("warn",e,t),info:y0("info",e,t),debug:y0("debug",e,t)};return Q9.set(e,[t,s]),s}const pc=n=>(n.options&&(n.options={...n.options},delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);var qp;class za{constructor(e,t,r){this.iterator=e,qp.set(this,void 0),this.controller=t,Ke(this,qp,r)}static fromSSEResponse(e,t,r){let s=!1;const i=r?Mr(r):console;async function*a(){if(s)throw new qe("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(const l of vpe(e,t))if(!o){if(l.data.startsWith("[DONE]")){o=!0;continue}if(l.event===null||!l.event.startsWith("thread.")){let u;try{u=JSON.parse(l.data)}catch(h){throw i.error("Could not parse message into JSON:",l.data),i.error("From chunk:",l.raw),h}if(u&&u.error)throw new zr(void 0,u.error,void 0,e.headers);yield u}else{let u;try{u=JSON.parse(l.data)}catch(h){throw console.error("Could not parse message into JSON:",l.data),console.error("From chunk:",l.raw),h}if(l.event=="error")throw new zr(void 0,u.error,u.message,void 0);yield{event:l.event,data:u}}}o=!0}catch(l){if(MI(l))return;throw l}finally{o||t.abort()}}return new za(a,t,r)}static fromReadableStream(e,t,r){let s=!1;async function*i(){const o=new cE,l=Uj(e);for await(const u of l)for(const h of o.decode(u))yield h;for(const u of o.flush())yield u}async function*a(){if(s)throw new qe("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(const l of i())o||l&&(yield JSON.parse(l));o=!0}catch(l){if(MI(l))return;throw l}finally{o||t.abort()}}return new za(a,t,r)}[(qp=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new za(()=>s(e),this.controller,J(this,qp,"f")),new za(()=>s(t),this.controller,J(this,qp,"f"))]}toReadableStream(){const e=this;let t;return $j({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{const{value:s,done:i}=await t.next();if(i)return r.close();const a=EA(JSON.stringify(s)+`
`);r.enqueue(a)}catch(s){r.error(s)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}}async function*vpe(n,e){if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new qe("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new qe("Attempted to iterate over a response with no body");const t=new bpe,r=new cE,s=Uj(n.body);for await(const i of wpe(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*wpe(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?EA(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=_pe(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}class bpe{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=Epe(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function Epe(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}async function Hj(n,e){const{response:t,requestLogID:r,retryOfRequestLogID:s,startTime:i}=e,a=await(async()=>{var f;if(e.options.stream)return Mr(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,n):za.fromSSEResponse(t,e.controller,n);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const o=t.headers.get("content-type"),l=(f=o==null?void 0:o.split(";")[0])==null?void 0:f.trim();if((l==null?void 0:l.includes("application/json"))||(l==null?void 0:l.endsWith("+json"))){const p=await t.json();return qj(p,t)}return await t.text()})();return Mr(n).debug(`[${r}] response parsed`,pc({retryOfRequestLogID:s,url:t.url,status:t.status,body:a,durationMs:Date.now()-i})),a}function qj(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var um;class dE extends Promise{constructor(e,t,r=Hj){super(s=>{s(null)}),this.responsePromise=t,this.parseResponse=r,um.set(this,void 0),Ke(this,um,e)}_thenUnwrap(e){return new dE(J(this,um,"f"),this.responsePromise,async(t,r)=>qj(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(J(this,um,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}um=new WeakMap;var v0;class Kj{constructor(e,t,r,s){v0.set(this,void 0),Ke(this,v0,e),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new qe("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await J(this,v0,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(v0=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Spe extends dE{constructor(e,t,r){super(e,t,async(s,i)=>new r(s,i.response,await Hj(s,i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class hE extends Kj{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class zn extends Kj{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var r;const e=this.getPaginatedItems(),t=(r=e[e.length-1])==null?void 0:r.id;return t?{...this.options,query:{...Yfe(this.options.query),after:t}}:null}}const Qj=()=>{var n;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((n=e==null?void 0:e.versions)==null?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function qm(n,e,t){return Qj(),new File(n,e??"unknown_file",t)}function tv(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const Yj=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Yc=async(n,e)=>({...n,body:await Cpe(n.body,e)}),Y9=new WeakMap;function Tpe(n){const e=typeof n=="function"?n:n.fetch,t=Y9.get(e);if(t)return t;const r=(async()=>{try{const s="Response"in e?e.Response:(await e("data:,")).constructor,i=new FormData;return i.toString()!==await new s(i).text()}catch{return!0}})();return Y9.set(e,r),r}const Cpe=async(n,e)=>{if(!await Tpe(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(n||{}).map(([r,s])=>$I(t,r,s))),t},Ipe=n=>n instanceof Blob&&"name"in n,$I=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(t instanceof Response)n.append(e,qm([await t.blob()],tv(t)));else if(Yj(t))n.append(e,qm([await new Response(jj(t)).blob()],tv(t)));else if(Ipe(t))n.append(e,t,tv(t));else if(Array.isArray(t))await Promise.all(t.map(r=>$I(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>$I(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},Jj=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",xpe=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Jj(n),kpe=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function Ppe(n,e,t){if(Qj(),n=await n,xpe(n))return n instanceof File?n:qm([await n.arrayBuffer()],n.name);if(kpe(n)){const s=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),qm(await jI(s),e,t)}const r=await jI(n);if(e||(e=tv(n)),!(t!=null&&t.type)){const s=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof s=="string"&&(t={...t,type:s})}return qm(r,e,t)}async function jI(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Jj(n))e.push(n instanceof Blob?n:await n.arrayBuffer());else if(Yj(n))for await(const r of n)e.push(...await jI(r));else{const r=(t=n==null?void 0:n.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof n}${r?`; constructor: ${r}`:""}${Ape(n)}`)}return e}function Ape(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}class Ze{constructor(e){this._client=e}}function Xj(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const J9=Object.freeze(Object.create(null)),Rpe=(n=Xj)=>function(t,...r){if(t.length===1)return t[0];let s=!1;const i=[],a=t.reduce((h,f,p)=>{var b;/[?#]/.test(f)&&(s=!0);const y=r[p];let _=(s?encodeURIComponent:n)(""+y);return p!==r.length&&(y==null||typeof y=="object"&&y.toString===((b=Object.getPrototypeOf(Object.getPrototypeOf(y.hasOwnProperty??J9)??J9))==null?void 0:b.toString))&&(_=y+"",i.push({start:h.length+f.length,length:_.length,error:`Value of type ${Object.prototype.toString.call(y).slice(8,-1)} is not a valid path parameter`})),h+f+(p===r.length?"":_)},""),o=a.split(/[?#]/,1)[0],l=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let u;for(;(u=l.exec(o))!==null;)i.push({start:u.index,length:u[0].length,error:`Value "${u[0]}" can't be safely passed as a path parameter`});if(i.sort((h,f)=>h.start-f.start),i.length>0){let h=0;const f=i.reduce((p,y)=>{const _=" ".repeat(y.start-h),b="^".repeat(y.length);return h=y.start+y.length,p+_+b},"");throw new qe(`Path parameters result in path with invalid segments:
${i.map(p=>p.error).join(`
`)}
${a}
${f}`)}return a},Ee=Rpe(Xj);let Zj=class extends Ze{list(e,t={},r){return this._client.getAPIList(Ee`/chat/completions/${e}/messages`,zn,{query:t,...r})}};function Dw(n){return n!==void 0&&"function"in n&&n.function!==void 0}function Npe(n,e){const t={...n};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function SA(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function R_(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function Ope(n,e){return!e||!eU(e)?{...n,choices:n.choices.map(t=>(tU(t.message.tool_calls),{...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:TA(n,e)}function TA(n,e){const t=n.choices.map(r=>{var s;if(r.finish_reason==="length")throw new Dj;if(r.finish_reason==="content_filter")throw new Fj;return tU(r.message.tool_calls),{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>Mpe(e,i)))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?Lpe(e,r.message.content):null}}});return{...n,choices:t}}function Lpe(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function Mpe(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return Dw(s)&&((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:R_(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function Dpe(n,e){var r;if(!n||!("tools"in n)||!n.tools)return!1;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return Dw(s)&&((i=s.function)==null?void 0:i.name)===e.function.name});return Dw(t)&&(R_(t)||(t==null?void 0:t.function.strict)||!1)}function eU(n){var e;return SA(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>R_(t)||t.type==="function"&&t.function.strict===!0))??!1}function tU(n){for(const e of n||[])if(e.type!=="function")throw new qe(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function Fpe(n){for(const e of n??[]){if(e.type!=="function")throw new qe(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new qe(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const Fw=n=>(n==null?void 0:n.role)==="assistant",nU=n=>(n==null?void 0:n.role)==="tool";var UI,nv,rv,cm,dm,sv,hm,So,fm,$w,jw,nh,rU;class CA{constructor(){UI.add(this),this.controller=new AbortController,nv.set(this,void 0),rv.set(this,()=>{}),cm.set(this,()=>{}),dm.set(this,void 0),sv.set(this,()=>{}),hm.set(this,()=>{}),So.set(this,{}),fm.set(this,!1),$w.set(this,!1),jw.set(this,!1),nh.set(this,!1),Ke(this,nv,new Promise((e,t)=>{Ke(this,rv,e,"f"),Ke(this,cm,t,"f")})),Ke(this,dm,new Promise((e,t)=>{Ke(this,sv,e,"f"),Ke(this,hm,t,"f")})),J(this,nv,"f").catch(()=>{}),J(this,dm,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},J(this,UI,"m",rU).bind(this))},0)}_connected(){this.ended||(J(this,rv,"f").call(this),this._emit("connect"))}get ended(){return J(this,fm,"f")}get errored(){return J(this,$w,"f")}get aborted(){return J(this,jw,"f")}abort(){this.controller.abort()}on(e,t){return(J(this,So,"f")[e]||(J(this,So,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=J(this,So,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(J(this,So,"f")[e]||(J(this,So,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Ke(this,nh,!0),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Ke(this,nh,!0),await J(this,dm,"f")}_emit(e,...t){if(J(this,fm,"f"))return;e==="end"&&(Ke(this,fm,!0),J(this,sv,"f").call(this));const r=J(this,So,"f")[e];if(r&&(J(this,So,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!J(this,nh,"f")&&!(r!=null&&r.length)&&Promise.reject(s),J(this,cm,"f").call(this,s),J(this,hm,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!J(this,nh,"f")&&!(r!=null&&r.length)&&Promise.reject(s),J(this,cm,"f").call(this,s),J(this,hm,"f").call(this,s),this._emit("end")}}_emitFinal(){}}nv=new WeakMap,rv=new WeakMap,cm=new WeakMap,dm=new WeakMap,sv=new WeakMap,hm=new WeakMap,So=new WeakMap,fm=new WeakMap,$w=new WeakMap,jw=new WeakMap,nh=new WeakMap,UI=new WeakSet,rU=function(e){if(Ke(this,$w,!0),e instanceof Error&&e.name==="AbortError"&&(e=new ni),e instanceof ni)return Ke(this,jw,!0),this._emit("abort",e);if(e instanceof qe)return this._emit("error",e);if(e instanceof Error){const t=new qe(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new qe(String(e)))};function $pe(n){return typeof n.parse=="function"}var gs,VI,Uw,BI,zI,GI,sU,iU;const jpe=10;class aU extends CA{constructor(){super(...arguments),gs.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),nU(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Fw(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionToolCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new qe("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),J(this,gs,"m",VI).call(this)}async finalMessage(){return await this.done(),J(this,gs,"m",Uw).call(this)}async finalFunctionToolCall(){return await this.done(),J(this,gs,"m",BI).call(this)}async finalFunctionToolCallResult(){return await this.done(),J(this,gs,"m",zI).call(this)}async totalUsage(){return await this.done(),J(this,gs,"m",GI).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=J(this,gs,"m",Uw).call(this);t&&this._emit("finalMessage",t);const r=J(this,gs,"m",VI).call(this);r&&this._emit("finalContent",r);const s=J(this,gs,"m",BI).call(this);s&&this._emit("finalFunctionToolCall",s);const i=J(this,gs,"m",zI).call(this);i!=null&&this._emit("finalFunctionToolCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",J(this,gs,"m",GI).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),J(this,gs,"m",sU).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(TA(i,t))}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){var y,_,b;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,l=typeof i!="string"&&i.type==="function"&&((y=i==null?void 0:i.function)==null?void 0:y.name),{maxChatCompletions:u=jpe}=r||{},h=t.tools.map(S=>{if(R_(S)){if(!S.$callback)throw new qe("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:S.$callback,name:S.function.name,description:S.function.description||"",parameters:S.function.parameters,parse:S.$parseRaw,strict:!0}}}return S}),f={};for(const S of h)S.type==="function"&&(f[S.function.name||S.function.function.name]=S.function);const p="tools"in t?h.map(S=>S.type==="function"?{type:"function",function:{name:S.function.name||S.function.function.name,parameters:S.function.parameters,description:S.function.description,strict:S.function.strict}}:S):void 0;for(const S of t.messages)this._addMessage(S,!1);for(let S=0;S<u;++S){const C=(_=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:p,messages:[...this.messages]},r)).choices[0])==null?void 0:_.message;if(!C)throw new qe("missing message in ChatCompletion response");if(!((b=C.tool_calls)!=null&&b.length))return;for(const v of C.tool_calls){if(v.type!=="function")continue;const I=v.id,{name:L,arguments:R}=v.function,P=f[L];if(P){if(l&&l!==L){const D=`Invalid tool_call: ${JSON.stringify(L)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:I,content:D});continue}}else{const D=`Invalid tool_call: ${JSON.stringify(L)}. Available options are: ${Object.keys(f).map(F=>JSON.stringify(F)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:I,content:D});continue}let x;try{x=$pe(P)?await P.parse(R):R}catch(D){const F=D instanceof Error?D.message:String(D);this._addMessage({role:s,tool_call_id:I,content:F});continue}const N=await P.function(x,this),M=J(this,gs,"m",iU).call(this,N);if(this._addMessage({role:s,tool_call_id:I,content:M}),l)return}}}}gs=new WeakSet,VI=function(){return J(this,gs,"m",Uw).call(this).content??null},Uw=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Fw(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new qe("stream ended without producing a ChatCompletionMessage with role=assistant")},BI=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(Fw(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.filter(i=>i.type==="function").at(-1))==null?void 0:t.function}},zI=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(nU(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},GI=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},sU=function(e){if(e.n!=null&&e.n>1)throw new qe("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},iU=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class IA extends aU{static runTools(e,t,r){const s=new IA,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),Fw(e)&&e.content&&this._emit("content",e.content)}}const oU=1,lU=2,uU=4,cU=8,dU=16,hU=32,fU=64,pU=128,mU=256,gU=pU|mU,_U=dU|hU|gU|fU,yU=oU|lU|_U,vU=uU|cU,Upe=yU|vU,mr={STR:oU,NUM:lU,ARR:uU,OBJ:cU,NULL:dU,BOOL:hU,NAN:fU,INFINITY:pU,MINUS_INFINITY:mU,INF:gU,SPECIAL:_U,ATOM:yU,COLLECTION:vU,ALL:Upe};class Vpe extends Error{}class Bpe extends Error{}function zpe(n,e=mr.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return Gpe(n.trim(),e)}const Gpe=(n,e)=>{const t=n.length;let r=0;const s=p=>{throw new Vpe(`${p} at position ${r}`)},i=p=>{throw new Bpe(`${p} at position ${r}`)},a=()=>(f(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?l():n[r]==="["?u():n.substring(r,r+4)==="null"||mr.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||mr.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||mr.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||mr.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||mr.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||mr.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):h()),o=()=>{const p=r;let y=!1;for(r++;r<t&&(n[r]!=='"'||y&&n[r-1]==="\\");)y=n[r]==="\\"?!y:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(p,++r-Number(y)))}catch(_){i(String(_))}else if(mr.STR&e)try{return JSON.parse(n.substring(p,r-Number(y))+'"')}catch{return JSON.parse(n.substring(p,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{r++,f();const p={};try{for(;n[r]!=="}";){if(f(),r>=t&&mr.OBJ&e)return p;const y=o();f(),r++;try{const _=a();Object.defineProperty(p,y,{value:_,writable:!0,enumerable:!0,configurable:!0})}catch(_){if(mr.OBJ&e)return p;throw _}f(),n[r]===","&&r++}}catch{if(mr.OBJ&e)return p;s("Expected '}' at end of object")}return r++,p},u=()=>{r++;const p=[];try{for(;n[r]!=="]";)p.push(a()),f(),n[r]===","&&r++}catch{if(mr.ARR&e)return p;s("Expected ']' at end of array")}return r++,p},h=()=>{if(r===0){n==="-"&&mr.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(y){if(mr.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(y))}}const p=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(mr.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(p,r))}catch{n.substring(p,r)==="-"&&mr.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(p,n.lastIndexOf("e")))}catch(_){i(String(_))}}},f=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return a()},X9=n=>zpe(n,mr.ALL^mr.NUM);var Jn,wo,Hd,Tl,Q2,w0,Y2,J2,X2,b0,Z2,Z9;class Wg extends aU{constructor(e){super(),Jn.add(this),wo.set(this,void 0),Hd.set(this,void 0),Tl.set(this,void 0),Ke(this,wo,e),Ke(this,Hd,[])}get currentChatCompletionSnapshot(){return J(this,Tl,"f")}static fromReadableStream(e){const t=new Wg(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new Wg(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var a;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),J(this,Jn,"m",Q2).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)J(this,Jn,"m",Y2).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new ni;return this._addChatCompletion(J(this,Jn,"m",b0).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),J(this,Jn,"m",Q2).call(this),this._connected();const s=za.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(J(this,Jn,"m",b0).call(this)),J(this,Jn,"m",Y2).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new ni;return this._addChatCompletion(J(this,Jn,"m",b0).call(this))}[(wo=new WeakMap,Hd=new WeakMap,Tl=new WeakMap,Jn=new WeakSet,Q2=function(){this.ended||Ke(this,Tl,void 0)},w0=function(t){let r=J(this,Hd,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},J(this,Hd,"f")[t.index]=r,r)},Y2=function(t){var s,i,a,o,l,u,h,f,p,y,_,b,S,E,C;if(this.ended)return;const r=J(this,Jn,"m",Z9).call(this,t);this._emit("chunk",t,r);for(const v of t.choices){const I=r.choices[v.index];v.delta.content!=null&&((s=I.message)==null?void 0:s.role)==="assistant"&&((i=I.message)!=null&&i.content)&&(this._emit("content",v.delta.content,I.message.content),this._emit("content.delta",{delta:v.delta.content,snapshot:I.message.content,parsed:I.message.parsed})),v.delta.refusal!=null&&((a=I.message)==null?void 0:a.role)==="assistant"&&((o=I.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:v.delta.refusal,snapshot:I.message.refusal}),((l=v.logprobs)==null?void 0:l.content)!=null&&((u=I.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(h=v.logprobs)==null?void 0:h.content,snapshot:((f=I.logprobs)==null?void 0:f.content)??[]}),((p=v.logprobs)==null?void 0:p.refusal)!=null&&((y=I.message)==null?void 0:y.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(_=v.logprobs)==null?void 0:_.refusal,snapshot:((b=I.logprobs)==null?void 0:b.refusal)??[]});const L=J(this,Jn,"m",w0).call(this,I);I.finish_reason&&(J(this,Jn,"m",X2).call(this,I),L.current_tool_call_index!=null&&J(this,Jn,"m",J2).call(this,I,L.current_tool_call_index));for(const R of v.delta.tool_calls??[])L.current_tool_call_index!==R.index&&(J(this,Jn,"m",X2).call(this,I),L.current_tool_call_index!=null&&J(this,Jn,"m",J2).call(this,I,L.current_tool_call_index)),L.current_tool_call_index=R.index;for(const R of v.delta.tool_calls??[]){const P=(S=I.message.tool_calls)==null?void 0:S[R.index];P!=null&&P.type&&((P==null?void 0:P.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(E=P.function)==null?void 0:E.name,index:R.index,arguments:P.function.arguments,parsed_arguments:P.function.parsed_arguments,arguments_delta:((C=R.function)==null?void 0:C.arguments)??""}):(P==null||P.type,void 0))}}},J2=function(t,r){var a,o,l;if(J(this,Jn,"m",w0).call(this,t).done_tool_calls.has(r))return;const i=(a=t.message.tool_calls)==null?void 0:a[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const u=(l=(o=J(this,wo,"f"))==null?void 0:o.tools)==null?void 0:l.find(h=>Dw(h)&&h.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:R_(u)?u.$parseRaw(i.function.arguments):u!=null&&u.function.strict?JSON.parse(i.function.arguments):null})}else i.type},X2=function(t){var s,i;const r=J(this,Jn,"m",w0).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const a=J(this,Jn,"m",Z2).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},b0=function(){if(this.ended)throw new qe("stream has ended, this shouldn't happen");const t=J(this,Tl,"f");if(!t)throw new qe("request ended without sending any chunks");return Ke(this,Tl,void 0),Ke(this,Hd,[]),Wpe(t,J(this,wo,"f"))},Z2=function(){var r;const t=(r=J(this,wo,"f"))==null?void 0:r.response_format;return SA(t)?t:null},Z9=function(t){var r,s,i,a;let o=J(this,Tl,"f");const{choices:l,...u}=t;o?Object.assign(o,u):o=Ke(this,Tl,{...u,choices:[]});for(const{delta:h,finish_reason:f,index:p,logprobs:y=null,..._}of t.choices){let b=o.choices[p];if(b||(b=o.choices[p]={finish_reason:f,index:p,message:{},logprobs:y,..._}),y)if(!b.logprobs)b.logprobs=Object.assign({},y);else{const{content:R,refusal:P,...x}=y;Object.assign(b.logprobs,x),R&&((r=b.logprobs).content??(r.content=[]),b.logprobs.content.push(...R)),P&&((s=b.logprobs).refusal??(s.refusal=[]),b.logprobs.refusal.push(...P))}if(f&&(b.finish_reason=f,J(this,wo,"f")&&eU(J(this,wo,"f")))){if(f==="length")throw new Dj;if(f==="content_filter")throw new Fj}if(Object.assign(b,_),!h)continue;const{content:S,refusal:E,function_call:C,role:v,tool_calls:I,...L}=h;if(Object.assign(b.message,L),E&&(b.message.refusal=(b.message.refusal||"")+E),v&&(b.message.role=v),C&&(b.message.function_call?(C.name&&(b.message.function_call.name=C.name),C.arguments&&((i=b.message.function_call).arguments??(i.arguments=""),b.message.function_call.arguments+=C.arguments)):b.message.function_call=C),S&&(b.message.content=(b.message.content||"")+S,!b.message.refusal&&J(this,Jn,"m",Z2).call(this)&&(b.message.parsed=X9(b.message.content))),I){b.message.tool_calls||(b.message.tool_calls=[]);for(const{index:R,id:P,type:x,function:N,...M}of I){const D=(a=b.message.tool_calls)[R]??(a[R]={});Object.assign(D,M),P&&(D.id=P),x&&(D.type=x),N&&(D.function??(D.function={name:N.name??"",arguments:""})),N!=null&&N.name&&(D.function.name=N.name),N!=null&&N.arguments&&(D.function.arguments+=N.arguments,Dpe(J(this,wo,"f"),D)&&(D.function.parsed_arguments=X9(D.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new za(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Wpe(n,e){const{id:t,choices:r,created:s,model:i,system_fingerprint:a,...o}=n,l={...o,id:t,choices:r.map(({message:u,finish_reason:h,index:f,logprobs:p,...y})=>{if(!h)throw new qe(`missing finish_reason for choice ${f}`);const{content:_=null,function_call:b,tool_calls:S,...E}=u,C=u.role;if(!C)throw new qe(`missing role for choice ${f}`);if(b){const{arguments:v,name:I}=b;if(v==null)throw new qe(`missing function_call.arguments for choice ${f}`);if(!I)throw new qe(`missing function_call.name for choice ${f}`);return{...y,message:{content:_,function_call:{arguments:v,name:I},role:C,refusal:u.refusal??null},finish_reason:h,index:f,logprobs:p}}return S?{...y,index:f,finish_reason:h,logprobs:p,message:{...E,role:C,content:_,refusal:u.refusal??null,tool_calls:S.map((v,I)=>{const{function:L,type:R,id:P,...x}=v,{arguments:N,name:M,...D}=L||{};if(P==null)throw new qe(`missing choices[${f}].tool_calls[${I}].id
${E0(n)}`);if(R==null)throw new qe(`missing choices[${f}].tool_calls[${I}].type
${E0(n)}`);if(M==null)throw new qe(`missing choices[${f}].tool_calls[${I}].function.name
${E0(n)}`);if(N==null)throw new qe(`missing choices[${f}].tool_calls[${I}].function.arguments
${E0(n)}`);return{...x,id:P,type:R,function:{...D,name:M,arguments:N}}})}}:{...y,message:{...E,content:_,role:C,refusal:u.refusal??null},finish_reason:h,index:f,logprobs:p}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return Ope(l,e)}function E0(n){return JSON.stringify(n)}class Vw extends Wg{static fromReadableStream(e){const t=new Vw(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){const s=new Vw(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let xA=class extends Ze{constructor(){super(...arguments),this.messages=new Zj(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(Ee`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(Ee`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",zn,{query:e,...t})}delete(e,t){return this._client.delete(Ee`/chat/completions/${e}`,t)}parse(e,t){return Fpe(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(r=>TA(r,e))}runTools(e,t){return e.stream?Vw.runTools(this._client,e,t):IA.runTools(this._client,e,t)}stream(e,t){return Wg.createChatCompletion(this._client,e,t)}};xA.Messages=Zj;class kA extends Ze{constructor(){super(...arguments),this.completions=new xA(this._client)}}kA.Completions=xA;const wU=Symbol("brand.privateNullableHeaders");function*Hpe(n){if(!n)return;if(wU in n){const{values:r,nulls:s}=n;yield*r.entries();for(const i of s)yield[i,null];return}let e=!1,t;n instanceof Headers?t=n.entries():$9(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let r of t){const s=r[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");const i=$9(r[1])?r[1]:[r[1]];let a=!1;for(const o of i)o!==void 0&&(e&&!a&&(a=!0,yield[s,null]),yield[s,o])}}const ze=n=>{const e=new Headers,t=new Set;for(const r of n){const s=new Set;for(const[i,a]of Hpe(r)){const o=i.toLowerCase();s.has(o)||(e.delete(i),s.add(o)),a===null?(e.delete(i),t.add(o)):(e.append(i,a),t.delete(o))}}return{[wU]:!0,values:e,nulls:t}};class bU extends Ze{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:ze([{Accept:"application/octet-stream"},t==null?void 0:t.headers]),__binaryResponse:!0})}}class EU extends Ze{create(e,t){return this._client.post("/audio/transcriptions",Yc({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class SU extends Ze{create(e,t){return this._client.post("/audio/translations",Yc({body:e,...t,__metadata:{model:e.model}},this._client))}}class N_ extends Ze{constructor(){super(...arguments),this.transcriptions=new EU(this._client),this.translations=new SU(this._client),this.speech=new bU(this._client)}}N_.Transcriptions=EU;N_.Translations=SU;N_.Speech=bU;class TU extends Ze{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(Ee`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",zn,{query:e,...t})}cancel(e,t){return this._client.post(Ee`/batches/${e}/cancel`,t)}}class CU extends Ze{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(Ee`/assistants/${e}`,{...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,r){return this._client.post(Ee`/assistants/${e}`,{body:t,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e={},t){return this._client.getAPIList("/assistants",zn,{query:e,...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(Ee`/assistants/${e}`,{...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class IU extends Ze{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class xU extends Ze{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class fE extends Ze{constructor(){super(...arguments),this.sessions=new IU(this._client),this.transcriptionSessions=new xU(this._client)}}fE.Sessions=IU;fE.TranscriptionSessions=xU;class kU extends Ze{create(e,t,r){return this._client.post(Ee`/threads/${e}/messages`,{body:t,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,t,r){const{thread_id:s}=t;return this._client.get(Ee`/threads/${s}/messages/${e}`,{...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,t,r){const{thread_id:s,...i}=t;return this._client.post(Ee`/threads/${s}/messages/${e}`,{body:i,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t={},r){return this._client.getAPIList(Ee`/threads/${e}/messages`,zn,{query:t,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,t,r){const{thread_id:s}=t;return this._client.delete(Ee`/threads/${s}/messages/${e}`,{...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}class PU extends Ze{retrieve(e,t,r){const{thread_id:s,run_id:i,...a}=t;return this._client.get(Ee`/threads/${s}/runs/${i}/steps/${e}`,{query:a,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t,r){const{thread_id:s,...i}=t;return this._client.getAPIList(Ee`/threads/${s}/runs/${e}/steps`,zn,{query:i,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}const qpe=n=>{if(typeof Buffer<"u"){const e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(n),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return Array.from(new Float32Array(r.buffer))}};var eT={};const qd=n=>{var e,t,r,s;if(typeof globalThis.process<"u")return((e=eT==null?void 0:eT[n])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(s=(r=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:r.call(t,n))==null?void 0:s.trim()};var Dr,Tc,WI,Fa,iv,Xi,Cc,wh,mc,Bw,Xs,av,ov,Km,pm,mm,e6,t6,n6,r6,s6,i6,a6;class Qm extends CA{constructor(){super(...arguments),Dr.add(this),WI.set(this,[]),Fa.set(this,{}),iv.set(this,{}),Xi.set(this,void 0),Cc.set(this,void 0),wh.set(this,void 0),mc.set(this,void 0),Bw.set(this,void 0),Xs.set(this,void 0),av.set(this,void 0),ov.set(this,void 0),Km.set(this,void 0)}[(WI=new WeakMap,Fa=new WeakMap,iv=new WeakMap,Xi=new WeakMap,Cc=new WeakMap,wh=new WeakMap,mc=new WeakMap,Bw=new WeakMap,Xs=new WeakMap,av=new WeakMap,ov=new WeakMap,Km=new WeakMap,Dr=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Tc;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=za.fromReadableStream(e,this.controller);for await(const a of s)J(this,Dr,"m",pm).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new ni;return this._addRun(J(this,Dr,"m",mm).call(this))}toReadableStream(){return new za(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s){const i=new Tc;return i._run(()=>i._runToolAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.submitToolOutputs(t,a,{...s,signal:this.controller.signal});this._connected();for await(const u of o)J(this,Dr,"m",pm).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new ni;return this._addRun(J(this,Dr,"m",mm).call(this))}static createThreadAssistantStream(e,t,r){const s=new Tc;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new Tc;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return J(this,av,"f")}currentRun(){return J(this,ov,"f")}currentMessageSnapshot(){return J(this,Xi,"f")}currentRunStepSnapshot(){return J(this,Km,"f")}async finalRunSteps(){return await this.done(),Object.values(J(this,Fa,"f"))}async finalMessages(){return await this.done(),Object.values(J(this,iv,"f"))}async finalRun(){if(await this.done(),!J(this,Cc,"f"))throw Error("Final run was not received.");return J(this,Cc,"f")}async _createThreadAssistantStream(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const l of a)J(this,Dr,"m",pm).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new ni;return this._addRun(J(this,Dr,"m",mm).call(this))}async _createAssistantStream(e,t,r,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const u of o)J(this,Dr,"m",pm).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new ni;return this._addRun(J(this,Dr,"m",mm).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(H2(i)&&H2(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!H2(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=i[o];l==null?i.push(a):i[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s){return await this._createToolAssistantStream(t,e,r,s)}}Tc=Qm,pm=function(e){if(!this.ended)switch(Ke(this,av,e),J(this,Dr,"m",n6).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":J(this,Dr,"m",a6).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":J(this,Dr,"m",t6).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":J(this,Dr,"m",e6).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},mm=function(){if(this.ended)throw new qe("stream has ended, this shouldn't happen");if(!J(this,Cc,"f"))throw Error("Final run has not been received");return J(this,Cc,"f")},e6=function(e){const[t,r]=J(this,Dr,"m",s6).call(this,e,J(this,Xi,"f"));Ke(this,Xi,t),J(this,iv,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=J(this,wh,"f")){if(J(this,mc,"f"))switch(J(this,mc,"f").type){case"text":this._emit("textDone",J(this,mc,"f").text,J(this,Xi,"f"));break;case"image_file":this._emit("imageFileDone",J(this,mc,"f").image_file,J(this,Xi,"f"));break}Ke(this,wh,s.index)}Ke(this,mc,t.content[s.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(J(this,wh,"f")!==void 0){const s=e.data.content[J(this,wh,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,J(this,Xi,"f"));break;case"text":this._emit("textDone",s.text,J(this,Xi,"f"));break}}J(this,Xi,"f")&&this._emit("messageDone",e.data),Ke(this,Xi,void 0)}},t6=function(e){const t=J(this,Dr,"m",r6).call(this,e);switch(Ke(this,Km,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==J(this,Bw,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(J(this,Xs,"f")&&this._emit("toolCallDone",J(this,Xs,"f")),Ke(this,Bw,i.index),Ke(this,Xs,t.step_details.tool_calls[i.index]),J(this,Xs,"f")&&this._emit("toolCallCreated",J(this,Xs,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ke(this,Km,void 0),e.data.step_details.type=="tool_calls"&&J(this,Xs,"f")&&(this._emit("toolCallDone",J(this,Xs,"f")),Ke(this,Xs,void 0)),this._emit("runStepDone",e.data,t);break}},n6=function(e){J(this,WI,"f").push(e),this._emit("event",e)},r6=function(e){switch(e.event){case"thread.run.step.created":return J(this,Fa,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=J(this,Fa,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=Tc.accumulateDelta(t,r.delta);J(this,Fa,"f")[e.data.id]=s}return J(this,Fa,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":J(this,Fa,"f")[e.data.id]=e.data;break}if(J(this,Fa,"f")[e.data.id])return J(this,Fa,"f")[e.data.id];throw new Error("No snapshot available")},s6=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=J(this,Dr,"m",i6).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},i6=function(e,t){return Tc.accumulateDelta(t,e)},a6=function(e){switch(Ke(this,ov,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":Ke(this,Cc,e.data),J(this,Xs,"f")&&(this._emit("toolCallDone",J(this,Xs,"f")),Ke(this,Xs,void 0));break}};let PA=class extends Ze{constructor(){super(...arguments),this.steps=new PU(this._client)}create(e,t,r){const{include:s,...i}=t;return this._client.post(Ee`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:t.stream??!1})}retrieve(e,t,r){const{thread_id:s}=t;return this._client.get(Ee`/threads/${s}/runs/${e}`,{...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,t,r){const{thread_id:s,...i}=t;return this._client.post(Ee`/threads/${s}/runs/${e}`,{body:i,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t={},r){return this._client.getAPIList(Ee`/threads/${e}/runs`,zn,{query:t,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}cancel(e,t,r){const{thread_id:s}=t;return this._client.post(Ee`/threads/${s}/runs/${e}/cancel`,{...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(s.id,{thread_id:e},r)}createAndStream(e,t,r){return Qm.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){var i;const s=ze([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((i=r==null?void 0:r.pollIntervalMs)==null?void 0:i.toString())??void 0}]);for(;;){const{data:a,response:o}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let l=5e3;if(r!=null&&r.pollIntervalMs)l=r.pollIntervalMs;else{const u=o.headers.get("openai-poll-after-ms");if(u){const h=parseInt(u);isNaN(h)||(l=h)}}await A_(l);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,r){return Qm.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){const{thread_id:s,...i}=t;return this._client.post(Ee`/threads/${s}/runs/${e}/submit_tool_outputs`,{body:i,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){const s=await this.submitToolOutputs(e,t,r);return await this.poll(s.id,t,r)}submitToolOutputsStream(e,t,r){return Qm.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}};PA.Steps=PU;class pE extends Ze{constructor(){super(...arguments),this.runs=new PA(this._client),this.messages=new kU(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(Ee`/threads/${e}`,{...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,r){return this._client.post(Ee`/threads/${e}`,{body:t,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,t){return this._client.delete(Ee`/threads/${e}`,{...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return Qm.createThreadAssistantStream(e,this._client.beta.threads,t)}}pE.Runs=PA;pE.Messages=kU;class O_ extends Ze{constructor(){super(...arguments),this.realtime=new fE(this._client),this.assistants=new CU(this._client),this.threads=new pE(this._client)}}O_.Realtime=fE;O_.Assistants=CU;O_.Threads=pE;class AU extends Ze{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class RU extends Ze{retrieve(e,t,r){const{container_id:s}=t;return this._client.get(Ee`/containers/${s}/files/${e}/content`,{...r,headers:ze([{Accept:"application/binary"},r==null?void 0:r.headers]),__binaryResponse:!0})}}let AA=class extends Ze{constructor(){super(...arguments),this.content=new RU(this._client)}create(e,t,r){return this._client.post(Ee`/containers/${e}/files`,Yc({body:t,...r},this._client))}retrieve(e,t,r){const{container_id:s}=t;return this._client.get(Ee`/containers/${s}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList(Ee`/containers/${e}/files`,zn,{query:t,...r})}delete(e,t,r){const{container_id:s}=t;return this._client.delete(Ee`/containers/${s}/files/${e}`,{...r,headers:ze([{Accept:"*/*"},r==null?void 0:r.headers])})}};AA.Content=RU;class RA extends Ze{constructor(){super(...arguments),this.files=new AA(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(Ee`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",zn,{query:e,...t})}delete(e,t){return this._client.delete(Ee`/containers/${e}`,{...t,headers:ze([{Accept:"*/*"},t==null?void 0:t.headers])})}}RA.Files=AA;class NU extends Ze{create(e,t){const r=!!e.encoding_format;let s=r?e.encoding_format:"base64";r&&Mr(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const i=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return r?i:(Mr(this._client).debug("embeddings/decoding base64 embeddings from base64"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{const l=o.embedding;o.embedding=qpe(l)}),a)))}}class OU extends Ze{retrieve(e,t,r){const{eval_id:s,run_id:i}=t;return this._client.get(Ee`/evals/${s}/runs/${i}/output_items/${e}`,r)}list(e,t,r){const{eval_id:s,...i}=t;return this._client.getAPIList(Ee`/evals/${s}/runs/${e}/output_items`,zn,{query:i,...r})}}class NA extends Ze{constructor(){super(...arguments),this.outputItems=new OU(this._client)}create(e,t,r){return this._client.post(Ee`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){const{eval_id:s}=t;return this._client.get(Ee`/evals/${s}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList(Ee`/evals/${e}/runs`,zn,{query:t,...r})}delete(e,t,r){const{eval_id:s}=t;return this._client.delete(Ee`/evals/${s}/runs/${e}`,r)}cancel(e,t,r){const{eval_id:s}=t;return this._client.post(Ee`/evals/${s}/runs/${e}`,r)}}NA.OutputItems=OU;class OA extends Ze{constructor(){super(...arguments),this.runs=new NA(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(Ee`/evals/${e}`,t)}update(e,t,r){return this._client.post(Ee`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",zn,{query:e,...t})}delete(e,t){return this._client.delete(Ee`/evals/${e}`,t)}}OA.Runs=NA;let LU=class extends Ze{create(e,t){return this._client.post("/files",Yc({body:e,...t},this._client))}retrieve(e,t){return this._client.get(Ee`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",zn,{query:e,...t})}delete(e,t){return this._client.delete(Ee`/files/${e}`,t)}content(e,t){return this._client.get(Ee`/files/${e}/content`,{...t,headers:ze([{Accept:"application/binary"},t==null?void 0:t.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await A_(t),a=await this.retrieve(e),Date.now()-i>r)throw new uE({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}};class MU extends Ze{}let DU=class extends Ze{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class LA extends Ze{constructor(){super(...arguments),this.graders=new DU(this._client)}}LA.Graders=DU;class FU extends Ze{create(e,t,r){return this._client.getAPIList(Ee`/fine_tuning/checkpoints/${e}/permissions`,hE,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get(Ee`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){const{fine_tuned_model_checkpoint:s}=t;return this._client.delete(Ee`/fine_tuning/checkpoints/${s}/permissions/${e}`,r)}}let MA=class extends Ze{constructor(){super(...arguments),this.permissions=new FU(this._client)}};MA.Permissions=FU;class $U extends Ze{list(e,t={},r){return this._client.getAPIList(Ee`/fine_tuning/jobs/${e}/checkpoints`,zn,{query:t,...r})}}class DA extends Ze{constructor(){super(...arguments),this.checkpoints=new $U(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(Ee`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",zn,{query:e,...t})}cancel(e,t){return this._client.post(Ee`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList(Ee`/fine_tuning/jobs/${e}/events`,zn,{query:t,...r})}pause(e,t){return this._client.post(Ee`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(Ee`/fine_tuning/jobs/${e}/resume`,t)}}DA.Checkpoints=$U;class Kf extends Ze{constructor(){super(...arguments),this.methods=new MU(this._client),this.jobs=new DA(this._client),this.checkpoints=new MA(this._client),this.alpha=new LA(this._client)}}Kf.Methods=MU;Kf.Jobs=DA;Kf.Checkpoints=MA;Kf.Alpha=LA;class jU extends Ze{}class FA extends Ze{constructor(){super(...arguments),this.graderModels=new jU(this._client)}}FA.GraderModels=jU;class UU extends Ze{createVariation(e,t){return this._client.post("/images/variations",Yc({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Yc({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class VU extends Ze{retrieve(e,t){return this._client.get(Ee`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",hE,e)}delete(e,t){return this._client.delete(Ee`/models/${e}`,t)}}class BU extends Ze{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function Kpe(n,e){return!e||!Ype(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:zU(n,e)}function zU(n,e){const t=n.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:Zpe(e,s)};if(s.type==="message"){const i=s.content.map(a=>a.type==="output_text"?{...a,parsed:Qpe(e,a.text)}:a);return{...s,content:i}}return s}),r=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||HI(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const s of r.output)if(s.type==="message"){for(const i of s.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),r}function Qpe(n,e){var t,r,s,i;return((r=(t=n.text)==null?void 0:t.format)==null?void 0:r.type)!=="json_schema"?null:"$parseRaw"in((s=n.text)==null?void 0:s.format)?((i=n.text)==null?void 0:i.format).$parseRaw(e):JSON.parse(e)}function Ype(n){var e;return!!SA((e=n.text)==null?void 0:e.format)}function Jpe(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function Xpe(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function Zpe(n,e){const t=Xpe(n.tools??[],e.name);return{...e,...e,parsed_arguments:Jpe(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function HI(n){const e=[];for(const t of n.output)if(t.type==="message")for(const r of t.content)r.type==="output_text"&&e.push(r.text);n.output_text=e.join("")}var Kd,S0,Cl,T0,o6,l6,u6,c6;class $A extends CA{constructor(e){super(),Kd.add(this),S0.set(this,void 0),Cl.set(this,void 0),T0.set(this,void 0),Ke(this,S0,e)}static createResponse(e,t,r){const s=new $A(t);return s._run(()=>s._createOrRetrieveResponse(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),J(this,Kd,"m",o6).call(this);let i,a=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(const l of i)J(this,Kd,"m",l6).call(this,l,a);if((o=i.controller.signal)!=null&&o.aborted)throw new ni;return J(this,Kd,"m",u6).call(this)}[(S0=new WeakMap,Cl=new WeakMap,T0=new WeakMap,Kd=new WeakSet,o6=function(){this.ended||Ke(this,Cl,void 0)},l6=function(t,r){if(this.ended)return;const s=(a,o)=>{(r==null||o.sequence_number>r)&&this._emit(a,o)},i=J(this,Kd,"m",c6).call(this,t);switch(s("event",t),t.type){case"response.output_text.delta":{const a=i.output[t.output_index];if(!a)throw new qe(`missing output at index ${t.output_index}`);if(a.type==="message"){const o=a.content[t.content_index];if(!o)throw new qe(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new qe(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{const a=i.output[t.output_index];if(!a)throw new qe(`missing output at index ${t.output_index}`);a.type==="function_call"&&s("response.function_call_arguments.delta",{...t,snapshot:a.arguments});break}default:s(t.type,t);break}},u6=function(){if(this.ended)throw new qe("stream has ended, this shouldn't happen");const t=J(this,Cl,"f");if(!t)throw new qe("request ended without sending any events");Ke(this,Cl,void 0);const r=eme(t,J(this,S0,"f"));return Ke(this,T0,r),r},c6=function(t){let r=J(this,Cl,"f");if(!r){if(t.type!=="response.created")throw new qe(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=Ke(this,Cl,t.response),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{const s=r.output[t.output_index];if(!s)throw new qe(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{const s=r.output[t.output_index];if(!s)throw new qe(`missing output at index ${t.output_index}`);if(s.type==="message"){const i=s.content[t.content_index];if(!i)throw new qe(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new qe(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{const s=r.output[t.output_index];if(!s)throw new qe(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{Ke(this,Cl,t.response);break}}return r},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=J(this,T0,"f");if(!e)throw new qe("stream ended without producing a ChatCompletion");return e}}function eme(n,e){return Kpe(n,e)}class GU extends Ze{list(e,t={},r){return this._client.getAPIList(Ee`/responses/${e}/input_items`,zn,{query:t,...r})}}class jA extends Ze{constructor(){super(...arguments),this.inputItems=new GU(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&HI(r),r))}retrieve(e,t={},r){return this._client.get(Ee`/responses/${e}`,{query:t,...r,stream:(t==null?void 0:t.stream)??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&HI(s),s))}delete(e,t){return this._client.delete(Ee`/responses/${e}`,{...t,headers:ze([{Accept:"*/*"},t==null?void 0:t.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>zU(r,e))}stream(e,t){return $A.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(Ee`/responses/${e}/cancel`,t)}}jA.InputItems=GU;class WU extends Ze{create(e,t,r){return this._client.post(Ee`/uploads/${e}/parts`,Yc({body:t,...r},this._client))}}class UA extends Ze{constructor(){super(...arguments),this.parts=new WU(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(Ee`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(Ee`/uploads/${e}/complete`,{body:t,...r})}}UA.Parts=WU;const tme=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};class HU extends Ze{create(e,t,r){return this._client.post(Ee`/vector_stores/${e}/file_batches`,{body:t,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,t,r){const{vector_store_id:s}=t;return this._client.get(Ee`/vector_stores/${s}/file_batches/${e}`,{...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}cancel(e,t,r){const{vector_store_id:s}=t;return this._client.post(Ee`/vector_stores/${s}/file_batches/${e}/cancel`,{...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r){const{vector_store_id:s,...i}=t;return this._client.getAPIList(Ee`/vector_stores/${s}/file_batches/${e}/files`,zn,{query:i,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async poll(e,t,r){var i;const s=ze([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((i=r==null?void 0:r.pollIntervalMs)==null?void 0:i.toString())??void 0}]);for(;;){const{data:a,response:o}=await this.retrieve(t,{vector_store_id:e},{...r,headers:s}).withResponse();switch(a.status){case"in_progress":let l=5e3;if(r!=null&&r.pollIntervalMs)l=r.pollIntervalMs;else{const u=o.headers.get("openai-poll-after-ms");if(u){const h=parseInt(u);isNaN(h)||(l=h)}}await A_(l);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,l=t.values(),u=[...r];async function h(p){for(let y of p){const _=await o.files.create({file:y,purpose:"assistants"},s);u.push(_.id)}}const f=Array(a).fill(l).map(h);return await tme(f),await this.createAndPoll(e,{file_ids:u})}}class qU extends Ze{create(e,t,r){return this._client.post(Ee`/vector_stores/${e}/files`,{body:t,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,t,r){const{vector_store_id:s}=t;return this._client.get(Ee`/vector_stores/${s}/files/${e}`,{...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,t,r){const{vector_store_id:s,...i}=t;return this._client.post(Ee`/vector_stores/${s}/files/${e}`,{body:i,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t={},r){return this._client.getAPIList(Ee`/vector_stores/${e}/files`,zn,{query:t,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,t,r){const{vector_store_id:s}=t;return this._client.delete(Ee`/vector_stores/${s}/files/${e}`,{...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){var i;const s=ze([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((i=r==null?void 0:r.pollIntervalMs)==null?void 0:i.toString())??void 0}]);for(;;){const a=await this.retrieve(t,{vector_store_id:e},{...r,headers:s}).withResponse(),o=a.data;switch(o.status){case"in_progress":let l=5e3;if(r!=null&&r.pollIntervalMs)l=r.pollIntervalMs;else{const u=a.response.headers.get("openai-poll-after-ms");if(u){const h=parseInt(u);isNaN(h)||(l=h)}}await A_(l);break;case"failed":case"completed":return o}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}content(e,t,r){const{vector_store_id:s}=t;return this._client.getAPIList(Ee`/vector_stores/${s}/files/${e}/content`,hE,{...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}class mE extends Ze{constructor(){super(...arguments),this.files=new qU(this._client),this.fileBatches=new HU(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(Ee`/vector_stores/${e}`,{...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,r){return this._client.post(Ee`/vector_stores/${e}`,{body:t,...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",zn,{query:e,...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(Ee`/vector_stores/${e}`,{...t,headers:ze([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}search(e,t,r){return this._client.getAPIList(Ee`/vector_stores/${e}/search`,hE,{body:t,method:"post",...r,headers:ze([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}mE.Files=qU;mE.FileBatches=HU;var rh,KU,lv;class QU extends Ze{constructor(){super(...arguments),rh.add(this)}async unwrap(e,t,r=this._client.webhookSecret,s=300){return await this.verifySignature(e,t,r,s),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,s=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");J(this,rh,"m",KU).call(this,r);const i=ze([t]).values,a=J(this,rh,"m",lv).call(this,i,"webhook-signature"),o=J(this,rh,"m",lv).call(this,i,"webhook-timestamp"),l=J(this,rh,"m",lv).call(this,i,"webhook-id"),u=parseInt(o,10);if(isNaN(u))throw new om("Invalid webhook timestamp format");const h=Math.floor(Date.now()/1e3);if(h-u>s)throw new om("Webhook timestamp is too old");if(u>h+s)throw new om("Webhook timestamp is too new");const f=a.split(" ").map(b=>b.startsWith("v1,")?b.substring(3):b),p=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),y=l?`${l}.${o}.${e}`:`${o}.${e}`,_=await crypto.subtle.importKey("raw",p,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const b of f)try{const S=Buffer.from(b,"base64");if(await crypto.subtle.verify("HMAC",_,S,new TextEncoder().encode(y)))return}catch{continue}throw new om("The given webhook signature does not match the expected signature")}}rh=new WeakSet,KU=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},lv=function(e,t){if(!e)throw new Error("Headers are required");const r=e.get(t);if(r==null)throw new Error(`Missing required header: ${t}`);return r};var qI,VA,uv,YU;let vt=class{constructor({baseURL:e=qd("OPENAI_BASE_URL"),apiKey:t=qd("OPENAI_API_KEY"),organization:r=qd("OPENAI_ORG_ID")??null,project:s=qd("OPENAI_PROJECT_ID")??null,webhookSecret:i=qd("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(qI.add(this),uv.set(this,void 0),this.completions=new AU(this),this.chat=new kA(this),this.embeddings=new NU(this),this.files=new LU(this),this.images=new UU(this),this.audio=new N_(this),this.moderations=new BU(this),this.models=new VU(this),this.fineTuning=new Kf(this),this.graders=new FA(this),this.vectorStores=new mE(this),this.webhooks=new QU(this),this.beta=new O_(this),this.batches=new TU(this),this.uploads=new UA(this),this.responses=new jA(this),this.evals=new OA(this),this.containers=new RA(this),t===void 0)throw new qe("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:r,project:s,webhookSecret:i,...a,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&tpe())throw new qe(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=o.baseURL,this.timeout=o.timeout??VA.DEFAULT_TIMEOUT,this.logger=o.logger??console;const l="warn";this.logLevel=l,this.logLevel=K9(o.logLevel,"ClientOptions.logLevel",this)??K9(qd("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??l,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??ape(),Ke(this,uv,lpe),this._options=o,this.apiKey=t,this.organization=r,this.project=s,this.webhookSecret=i}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return ze([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return ppe(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${th}`}defaultIdempotencyKey(){return`stainless-node-retry-${xj()}`}makeStatusError(e,t,r,s){return zr.generate(e,t,r,s)}buildURL(e,t,r){const s=!J(this,qI,"m",YU).call(this)&&r||this.baseURL,i=Qfe(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return Jfe(a)||(t={...a,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new dE(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){var E,C;const s=await e,i=s.maxRetries??this.maxRetries;t==null&&(t=i),await this.prepareOptions(s);const{req:a,url:o,timeout:l}=await this.buildRequest(s,{retryCount:i-t});await this.prepareRequest(a,{url:o,options:s});const u="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),h=r===void 0?"":`, retryOf: ${r}`,f=Date.now();if(Mr(this).debug(`[${u}] sending request`,pc({retryOfRequestLogID:r,method:s.method,url:o,options:s,headers:a.headers})),(E=s.signal)!=null&&E.aborted)throw new ni;const p=new AbortController,y=await this.fetchWithTimeout(o,a,l,p).catch(DI),_=Date.now();if(y instanceof Error){const v=`retrying, ${t} attempts remaining`;if((C=s.signal)!=null&&C.aborted)throw new ni;const I=MI(y)||/timed? ?out/i.test(String(y)+("cause"in y?String(y.cause):""));if(t)return Mr(this).info(`[${u}] connection ${I?"timed out":"failed"} - ${v}`),Mr(this).debug(`[${u}] connection ${I?"timed out":"failed"} (${v})`,pc({retryOfRequestLogID:r,url:o,durationMs:_-f,message:y.message})),this.retryRequest(s,t,r??u);throw Mr(this).info(`[${u}] connection ${I?"timed out":"failed"} - error; no more retries left`),Mr(this).debug(`[${u}] connection ${I?"timed out":"failed"} (error; no more retries left)`,pc({retryOfRequestLogID:r,url:o,durationMs:_-f,message:y.message})),I?new uE:new lE({cause:y})}const b=[...y.headers.entries()].filter(([v])=>v==="x-request-id").map(([v,I])=>", "+v+": "+JSON.stringify(I)).join(""),S=`[${u}${h}${b}] ${a.method} ${o} ${y.ok?"succeeded":"failed"} with status ${y.status} in ${_-f}ms`;if(!y.ok){const v=await this.shouldRetry(y);if(t&&v){const N=`retrying, ${t} attempts remaining`;return await ope(y.body),Mr(this).info(`${S} - ${N}`),Mr(this).debug(`[${u}] response error (${N})`,pc({retryOfRequestLogID:r,url:y.url,status:y.status,headers:y.headers,durationMs:_-f})),this.retryRequest(s,t,r??u,y.headers)}const I=v?"error; no more retries left":"error; not retryable";Mr(this).info(`${S} - ${I}`);const L=await y.text().catch(N=>DI(N).message),R=epe(L),P=R?void 0:L;throw Mr(this).debug(`[${u}] response error (${I})`,pc({retryOfRequestLogID:r,url:y.url,status:y.status,headers:y.headers,message:P,durationMs:Date.now()-f})),this.makeStatusError(y.status,R,P,y.headers)}return Mr(this).info(S),Mr(this).debug(`[${u}] response start`,pc({retryOfRequestLogID:r,url:y.url,status:y.status,headers:y.headers,durationMs:_-f})),{response:y,options:s,controller:p,requestLogID:u,retryOfRequestLogID:r,startTime:f}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){const r=this.makeRequest(t,null,void 0);return new Spe(this,r,e)}async fetchWithTimeout(e,t,r,s){const{signal:i,method:a,...o}=t||{};i&&i.addEventListener("abort",()=>s.abort());const l=setTimeout(()=>s.abort(),r),u=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,h={signal:s.signal,...u?{duplex:"half"}:{},method:"GET",...o};a&&(h.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,h)}finally{clearTimeout(l)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r,s){let i;const a=s==null?void 0:s.get("retry-after-ms");if(a){const l=parseFloat(a);Number.isNaN(l)||(i=l)}const o=s==null?void 0:s.get("retry-after");if(o&&!i){const l=parseFloat(o);Number.isNaN(l)?i=Date.parse(o)-Date.now():i=l*1e3}if(!(i&&0<=i&&i<60*1e3)){const l=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,l)}return await A_(i),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}async buildRequest(e,{retryCount:t=0}={}){const r={...e},{method:s,path:i,query:a,defaultBaseURL:o}=r,l=this.buildURL(i,a,o);"timeout"in r&&Zfe("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const{bodyHeaders:u,body:h}=this.buildBody({options:r}),f=await this.buildHeaders({options:e,method:s,bodyHeaders:u,retryCount:t});return{req:{method:s,headers:f,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&h instanceof globalThis.ReadableStream&&{duplex:"half"},...h&&{body:h},...this.fetchOptions??{},...r.fetchOptions??{}},url:l,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:s}){let i={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const a=ze([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...ipe(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const r=ze([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:jj(e)}:J(this,uv,"f").call(this,{body:e,headers:r})}};VA=vt,uv=new WeakMap,qI=new WeakSet,YU=function(){return this.baseURL!=="https://api.openai.com/v1"};vt.OpenAI=VA;vt.DEFAULT_TIMEOUT=6e5;vt.OpenAIError=qe;vt.APIError=zr;vt.APIConnectionError=lE;vt.APIConnectionTimeoutError=uE;vt.APIUserAbortError=ni;vt.NotFoundError=Rj;vt.ConflictError=Nj;vt.RateLimitError=Lj;vt.BadRequestError=kj;vt.AuthenticationError=Pj;vt.InternalServerError=Mj;vt.PermissionDeniedError=Aj;vt.UnprocessableEntityError=Oj;vt.InvalidWebhookSignatureError=om;vt.toFile=Ppe;vt.Completions=AU;vt.Chat=kA;vt.Embeddings=NU;vt.Files=LU;vt.Images=UU;vt.Audio=N_;vt.Moderations=BU;vt.Models=VU;vt.FineTuning=Kf;vt.Graders=FA;vt.VectorStores=mE;vt.Webhooks=QU;vt.Beta=O_;vt.Batches=TU;vt.Uploads=UA;vt.Responses=jA;vt.Evals=OA;vt.Containers=RA;/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var nme=typeof window=="object"?window:{},ut="0123456789abcdef".split(""),rme=[-2147483648,8388608,32768,128],Hi=[24,16,8,0],pr=[];function fa(n){n?(pr[0]=pr[16]=pr[1]=pr[2]=pr[3]=pr[4]=pr[5]=pr[6]=pr[7]=pr[8]=pr[9]=pr[10]=pr[11]=pr[12]=pr[13]=pr[14]=pr[15]=0,this.blocks=pr):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}fa.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===nme.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,s,i=n.length||0,a=this.blocks;r<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;r<i&&s<64;++r)a[s>>2]|=n[r]<<Hi[s++&3];else for(s=this.start;r<i&&s<64;++r)t=n.charCodeAt(r),t<128?a[s>>2]|=t<<Hi[s++&3]:t<2048?(a[s>>2]|=(192|t>>6)<<Hi[s++&3],a[s>>2]|=(128|t&63)<<Hi[s++&3]):t<55296||t>=57344?(a[s>>2]|=(224|t>>12)<<Hi[s++&3],a[s>>2]|=(128|t>>6&63)<<Hi[s++&3],a[s>>2]|=(128|t&63)<<Hi[s++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),a[s>>2]|=(240|t>>18)<<Hi[s++&3],a[s>>2]|=(128|t>>12&63)<<Hi[s++&3],a[s>>2]|=(128|t>>6&63)<<Hi[s++&3],a[s>>2]|=(128|t&63)<<Hi[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};fa.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=rme[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};fa.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4,i,a,o,l=this.blocks;for(a=16;a<80;++a)o=l[a-3]^l[a-8]^l[a-14]^l[a-16],l[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)i=e&t|~e&r,o=n<<5|n>>>27,s=o+i+s+1518500249+l[a]<<0,e=e<<30|e>>>2,i=n&e|~n&t,o=s<<5|s>>>27,r=o+i+r+1518500249+l[a+1]<<0,n=n<<30|n>>>2,i=s&n|~s&e,o=r<<5|r>>>27,t=o+i+t+1518500249+l[a+2]<<0,s=s<<30|s>>>2,i=r&s|~r&n,o=t<<5|t>>>27,e=o+i+e+1518500249+l[a+3]<<0,r=r<<30|r>>>2,i=t&r|~t&s,o=e<<5|e>>>27,n=o+i+n+1518500249+l[a+4]<<0,t=t<<30|t>>>2;for(;a<40;a+=5)i=e^t^r,o=n<<5|n>>>27,s=o+i+s+1859775393+l[a]<<0,e=e<<30|e>>>2,i=n^e^t,o=s<<5|s>>>27,r=o+i+r+1859775393+l[a+1]<<0,n=n<<30|n>>>2,i=s^n^e,o=r<<5|r>>>27,t=o+i+t+1859775393+l[a+2]<<0,s=s<<30|s>>>2,i=r^s^n,o=t<<5|t>>>27,e=o+i+e+1859775393+l[a+3]<<0,r=r<<30|r>>>2,i=t^r^s,o=e<<5|e>>>27,n=o+i+n+1859775393+l[a+4]<<0,t=t<<30|t>>>2;for(;a<60;a+=5)i=e&t|e&r|t&r,o=n<<5|n>>>27,s=o+i+s-1894007588+l[a]<<0,e=e<<30|e>>>2,i=n&e|n&t|e&t,o=s<<5|s>>>27,r=o+i+r-1894007588+l[a+1]<<0,n=n<<30|n>>>2,i=s&n|s&e|n&e,o=r<<5|r>>>27,t=o+i+t-1894007588+l[a+2]<<0,s=s<<30|s>>>2,i=r&s|r&n|s&n,o=t<<5|t>>>27,e=o+i+e-1894007588+l[a+3]<<0,r=r<<30|r>>>2,i=t&r|t&s|r&s,o=e<<5|e>>>27,n=o+i+n-1894007588+l[a+4]<<0,t=t<<30|t>>>2;for(;a<80;a+=5)i=e^t^r,o=n<<5|n>>>27,s=o+i+s-899497514+l[a]<<0,e=e<<30|e>>>2,i=n^e^t,o=s<<5|s>>>27,r=o+i+r-899497514+l[a+1]<<0,n=n<<30|n>>>2,i=s^n^e,o=r<<5|r>>>27,t=o+i+t-899497514+l[a+2]<<0,s=s<<30|s>>>2,i=r^s^n,o=t<<5|t>>>27,e=o+i+e-899497514+l[a+3]<<0,r=r<<30|r>>>2,i=t^r^s,o=e<<5|e>>>27,n=o+i+n-899497514+l[a+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0};fa.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return ut[n>>28&15]+ut[n>>24&15]+ut[n>>20&15]+ut[n>>16&15]+ut[n>>12&15]+ut[n>>8&15]+ut[n>>4&15]+ut[n&15]+ut[e>>28&15]+ut[e>>24&15]+ut[e>>20&15]+ut[e>>16&15]+ut[e>>12&15]+ut[e>>8&15]+ut[e>>4&15]+ut[e&15]+ut[t>>28&15]+ut[t>>24&15]+ut[t>>20&15]+ut[t>>16&15]+ut[t>>12&15]+ut[t>>8&15]+ut[t>>4&15]+ut[t&15]+ut[r>>28&15]+ut[r>>24&15]+ut[r>>20&15]+ut[r>>16&15]+ut[r>>12&15]+ut[r>>8&15]+ut[r>>4&15]+ut[r&15]+ut[s>>28&15]+ut[s>>24&15]+ut[s>>20&15]+ut[s>>16&15]+ut[s>>12&15]+ut[s>>8&15]+ut[s>>4&15]+ut[s&15]};fa.prototype.toString=fa.prototype.hex;fa.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255]};fa.prototype.array=fa.prototype.digest;fa.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};let d6=!1;const sme=n=>(d6||(console.warn(["The default method for hashing keys is insecure and will be replaced in a future version,","but hasn't been replaced yet as to not break existing caches. It's recommended that you use","a more secure hashing algorithm to avoid cache poisoning.","","See this page for more information:","|","└> https://js.langchain.com/docs/troubleshooting/warnings/insecure-cache-algorithm"].join(`
`)),d6=!0),new fa(!0).update(n).hex()),ime=(...n)=>sme(n.join("_"));class ame{constructor(){Object.defineProperty(this,"keyEncoder",{enumerable:!0,configurable:!0,writable:!0,value:ime})}makeDefaultKeyEncoder(e){this.keyEncoder=e}}const ome=new Map;class BA extends ame{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(this.keyEncoder(e,t))??null)}async update(e,t,r){this.cache.set(this.keyEncoder(e,t),r)}static global(){return new BA(ome)}}var gE={};gE.byteLength=cme;gE.toByteArray=hme;gE.fromByteArray=mme;var Va=[],Ei=[],lme=typeof Uint8Array<"u"?Uint8Array:Array,tT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Qd=0,ume=tT.length;Qd<ume;++Qd)Va[Qd]=tT[Qd],Ei[tT.charCodeAt(Qd)]=Qd;Ei[45]=62;Ei[95]=63;function JU(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function cme(n){var e=JU(n),t=e[0],r=e[1];return(t+r)*3/4-r}function dme(n,e,t){return(e+t)*3/4-t}function hme(n){var e,t=JU(n),r=t[0],s=t[1],i=new lme(dme(n,r,s)),a=0,o=s>0?r-4:r,l;for(l=0;l<o;l+=4)e=Ei[n.charCodeAt(l)]<<18|Ei[n.charCodeAt(l+1)]<<12|Ei[n.charCodeAt(l+2)]<<6|Ei[n.charCodeAt(l+3)],i[a++]=e>>16&255,i[a++]=e>>8&255,i[a++]=e&255;return s===2&&(e=Ei[n.charCodeAt(l)]<<2|Ei[n.charCodeAt(l+1)]>>4,i[a++]=e&255),s===1&&(e=Ei[n.charCodeAt(l)]<<10|Ei[n.charCodeAt(l+1)]<<4|Ei[n.charCodeAt(l+2)]>>2,i[a++]=e>>8&255,i[a++]=e&255),i}function fme(n){return Va[n>>18&63]+Va[n>>12&63]+Va[n>>6&63]+Va[n&63]}function pme(n,e,t){for(var r,s=[],i=e;i<t;i+=3)r=(n[i]<<16&16711680)+(n[i+1]<<8&65280)+(n[i+2]&255),s.push(fme(r));return s.join("")}function mme(n){for(var e,t=n.length,r=t%3,s=[],i=16383,a=0,o=t-r;a<o;a+=i)s.push(pme(n,a,a+i>o?o:a+i));return r===1?(e=n[t-1],s.push(Va[e>>2]+Va[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],s.push(Va[e>>10]+Va[e>>4&63]+Va[e<<2&63]+"=")),s.join("")}var gme=Object.defineProperty,_me=(n,e,t)=>e in n?gme(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,yme=(n,e,t)=>(_me(n,e+"",t),t);function vme(n,e){let t=Array.from({length:n.length},(r,s)=>({start:s,end:s+1}));for(;t.length>1;){let r=null;for(let s=0;s<t.length-1;s++){const i=n.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(r==null||a<r[0])&&(r=[a,s])}if(r!=null){const s=r[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function wme(n,e){return n.length===1?[e.get(n.join(","))]:vme(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function bme(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var KI=class{constructor(n,e){Ct(this,"specialTokens");Ct(this,"inverseSpecialTokens");Ct(this,"patStr");Ct(this,"textEncoder",new TextEncoder);Ct(this,"textDecoder",new TextDecoder("utf-8"));Ct(this,"rankMap",new Map);Ct(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[i,a,...o]=s.split(" "),l=Number.parseInt(a,10);return o.forEach((u,h)=>r[u]=l+h),r},{});for(const[r,s]of Object.entries(t)){const i=gE.toByteArray(r);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,i])=>(r[i]=this.textEncoder.encode(s),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),s=KI.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!a.has(u)):t);if(o.size>0){const u=KI.specialTokenRegex([...o]),h=n.match(u);if(h!=null)throw new Error(`The text contains a special token that is not allowed: ${h[0]}`)}let l=0;for(;;){let u=null,h=l;for(;s.lastIndex=h,u=s.exec(n),!(u==null||a.has(u[0]));)h=u.index+1;const f=(u==null?void 0:u.index)??n.length;for(const y of n.substring(l,f).matchAll(r)){const _=this.textEncoder.encode(y[0]),b=this.rankMap.get(_.join(","));if(b!=null){i.push(b);continue}i.push(...wme(_,this.rankMap))}if(u==null)break;let p=this.specialTokens[u[0]];i.push(p),l=u.index+u[0].length}return i}decode(n){const e=[];let t=0;for(let i=0;i<n.length;++i){const a=n[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let s=0;for(const i of e)r.set(i,s),s+=i.length;return this.textDecoder.decode(r)}},XU=KI;yme(XU,"specialTokenRegex",n=>new RegExp(n.map(e=>bme(e)).join("|"),"g"));function Eme(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}const C0={},Sme=new hA({});async function Tme(n){return n in C0||(C0[n]=Sme.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new XU(e)).catch(e=>{throw delete C0[n],e})),await C0[n]}async function Cme(n){return Tme(Eme(n))}const Ime=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n;function ZU(n){return typeof n!="object"||!n?!1:!!("type"in n&&n.type==="function"&&"function"in n&&typeof n.function=="object"&&n.function&&"name"in n.function&&"parameters"in n.function)}const xme=()=>!1;class eV extends Nn{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??xme(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class kme extends eV{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){const{cache:s,...i}=r;super({callbacks:e??t,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=BA.global():this.cache=void 0,this.caller=new hA(r??{})}async getNumTokens(e){let t;typeof e=="string"?t=e:t=e.map(s=>typeof s=="string"?s:s.type==="text"&&"text"in s?s.text:"").join("");let r=Math.ceil(t.length/4);if(!this._encoding)try{this._encoding=await Cme("modelName"in this?Ime(this.modelName):"gpt2")}catch(s){console.warn("Failed to calculate number of tokens, falling back to approximate count",s)}if(this._encoding)try{r=this._encoding.encode(t).length}catch(s){console.warn("Failed to calculate number of tokens, falling back to approximate count",s)}return r}static _convertInputToPromptValue(e){return typeof e=="string"?new bj(e):Array.isArray(e)?new Ej(e.map(zl)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class zw extends Nn{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const r=jt(t);return this.func&&await this.func(e,r),this._callWithConfig(s=>Promise.resolve(s),e,r)}async*transform(e,t){const r=jt(t);let s,i=!0;for await(const a of this._transformStreamWithConfig(e,o=>o,r))if(yield a,i)if(s===void 0)s=a;else try{s=nE(s,a)}catch{s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,r)}static assign(e){return new wj(new Wf({steps:e}))}}function nT(n){const e=[];for(const t of n){let r=t;if(Array.isArray(t.content))for(let s=0;s<t.content.length;s++){const i=t.content[s];(Uce(i)||Vce(i))&&r===t&&(r=new t.constructor({...r,content:[...t.content.slice(0,s),Bce(i),...t.content.slice(s+1)]}))}e.push(r)}return e}class Rl extends kme{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(e,t){const r=Rl._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){var r;if(this._streamResponseChunks===Rl.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const i=Rl._convertInputToPromptValue(e).toChatMessages(),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(t),l={...a.metadata,...this.getLsParams(o)},u=await vs.configure(a.callbacks,this.callbacks,a.tags,this.tags,l,this.metadata,{verbose:this.verbose}),h={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},f=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),[nT(i)],a.runId,void 0,h,void 0,void 0,a.runName));let p,y;try{for await(const _ of this._streamResponseChunks(i,o,f==null?void 0:f[0])){if(_.message.id==null){const b=(r=f==null?void 0:f.at(0))==null?void 0:r.runId;b!=null&&_.message._updateId(`run-${b}`)}_.message.response_metadata={..._.generationInfo,..._.message.response_metadata},yield _.message,p?p=p.concat(_):p=_,_9(_.message)&&_.message.usage_metadata!==void 0&&(y={tokenUsage:{promptTokens:_.message.usage_metadata.input_tokens,completionTokens:_.message.usage_metadata.output_tokens,totalTokens:_.message.usage_metadata.total_tokens}})}}catch(_){throw await Promise.all((f??[]).map(b=>b==null?void 0:b.handleLLMError(_))),_}await Promise.all((f??[]).map(_=>_==null?void 0:_.handleLLMEnd({generations:[[p]],llmOutput:y})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,r,s){var f,p;const i=e.map(y=>y.map(zl));let a;if(s!==void 0&&s.length===i.length)a=s;else{const y={...r.metadata,...this.getLsParams(t)},_=await vs.configure(r.callbacks,this.callbacks,r.tags,this.tags,y,this.metadata,{verbose:this.verbose}),b={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1};a=await(_==null?void 0:_.handleChatModelStart(this.toJSON(),i.map(nT),r.runId,void 0,b,void 0,void 0,r.runName))}const o=[],l=[];if(!!(a!=null&&a[0].handlers.find(Mce))&&!this.disableStreaming&&i.length===1&&this._streamResponseChunks!==Rl.prototype._streamResponseChunks)try{const y=await this._streamResponseChunks(i[0],t,a==null?void 0:a[0]);let _,b;for await(const S of y){if(S.message.id==null){const E=(f=a==null?void 0:a.at(0))==null?void 0:f.runId;E!=null&&S.message._updateId(`run-${E}`)}_===void 0?_=S:_=nE(_,S),_9(S.message)&&S.message.usage_metadata!==void 0&&(b={tokenUsage:{promptTokens:S.message.usage_metadata.input_tokens,completionTokens:S.message.usage_metadata.output_tokens,totalTokens:S.message.usage_metadata.total_tokens}})}if(_===void 0)throw new Error("Received empty response from chat model call.");o.push([_]),await(a==null?void 0:a[0].handleLLMEnd({generations:o,llmOutput:b}))}catch(y){throw await(a==null?void 0:a[0].handleLLMError(y)),y}else{const y=await Promise.allSettled(i.map((_,b)=>this._generate(_,{...t,promptIndex:b},a==null?void 0:a[b])));await Promise.all(y.map(async(_,b)=>{var S,E,C;if(_.status==="fulfilled"){const v=_.value;for(const I of v.generations){if(I.message.id==null){const L=(S=a==null?void 0:a.at(0))==null?void 0:S.runId;L!=null&&I.message._updateId(`run-${L}`)}I.message.response_metadata={...I.generationInfo,...I.message.response_metadata}}return v.generations.length===1&&(v.generations[0].message.response_metadata={...v.llmOutput,...v.generations[0].message.response_metadata}),o[b]=v.generations,l[b]=v.llmOutput,(E=a==null?void 0:a[b])==null?void 0:E.handleLLMEnd({generations:[v.generations],llmOutput:v.llmOutput})}else return await((C=a==null?void 0:a[b])==null?void 0:C.handleLLMError(_.reason)),Promise.reject(_.reason)}))}const h={generations:o,llmOutput:l.length?(p=this._combineLLMOutput)==null?void 0:p.call(this,...l):void 0};return Object.defineProperty(h,S9,{value:a?{runIds:a==null?void 0:a.map(y=>y.runId)}:void 0,configurable:!0}),h}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:s,handledOptions:i}){const a=e.map(S=>S.map(zl)),o={...i.metadata,...this.getLsParams(s)},l=await vs.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},h=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),a.map(nT),i.runId,void 0,u,void 0,void 0,i.runName)),f=[],y=(await Promise.allSettled(a.map(async(S,E)=>{const C=Rl._convertInputToPromptValue(S).toString(),v=await t.lookup(C,r);return v==null&&f.push(E),v}))).map((S,E)=>({result:S,runManager:h==null?void 0:h[E]})).filter(({result:S})=>S.status==="fulfilled"&&S.value!=null||S.status==="rejected"),_=[];await Promise.all(y.map(async({result:S,runManager:E},C)=>{if(S.status==="fulfilled"){const v=S.value;return _[C]=v.map(I=>("message"in I&&x_(I.message)&&k_(I.message)&&(I.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),I.generationInfo={...I.generationInfo,tokenUsage:{}},I)),v.length&&await(E==null?void 0:E.handleLLMNewToken(v[0].text)),E==null?void 0:E.handleLLMEnd({generations:[v]},void 0,void 0,void 0,{cached:!0})}else return await(E==null?void 0:E.handleLLMError(S.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(S.reason)}));const b={generations:_,missingPromptIndices:f,startedRunManagers:h};return Object.defineProperty(b,S9,{value:h?{runIds:h==null?void 0:h.map(S=>S.runId)}:void 0,configurable:!0}),b}async generate(e,t,r){let s;Array.isArray(t)?s={stop:t}:s=t;const i=e.map(_=>_.map(zl)),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(a.callbacks=a.callbacks??r,!this.cache)return this._generateUncached(i,o,a);const{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:h,missingPromptIndices:f,startedRunManagers:p}=await this._generateCached({messages:i,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:a});let y={};if(f.length>0){const _=await this._generateUncached(f.map(b=>i[b]),o,a,p!==void 0?f.map(b=>p==null?void 0:p[b]):void 0);await Promise.all(_.generations.map(async(b,S)=>{const E=f[S];h[E]=b;const C=Rl._convertInputToPromptValue(i[E]).toString();return l.update(C,u,b)})),y=_.llmOutput??{}}return{generations:h,llmOutput:y}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){const s=e.map(i=>i.toChatMessages());return this.generate(s,t,r)}async call(e,t,r){return(await this.generate([e.map(zl)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const s=e.toChatMessages();return this.call(s,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const s=new zf(e),i=await this.call([s],t,r);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const r=e,s=t==null?void 0:t.name,i=mA(r)??"A function available to call.",a=t==null?void 0:t.method,o=t==null?void 0:t.includeRaw;if(a==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=s??"extract",u;Wl(r)?u=[{type:"function",function:{name:l,description:i,parameters:Hl(r)}}]:("name"in r&&(l=r.name),u=[{type:"function",function:{name:l,description:i,parameters:r}}]);const h=this.bindTools(u),f=Hf.from(b=>{if(!b.tool_calls||b.tool_calls.length===0)throw new Error("No tool calls found in the response.");const S=b.tool_calls.find(E=>E.name===l);if(!S)throw new Error(`No tool call found with name ${l}.`);return S.args});if(!o)return h.pipe(f).withConfig({runName:"StructuredOutput"});const p=zw.assign({parsed:(b,S)=>f.invoke(b.raw,S)}),y=zw.assign({parsed:()=>null}),_=p.withFallbacks({fallbacks:[y]});return Oo.from([{raw:h},_]).withConfig({runName:"StructuredOutputRunnable"})}}class Pme extends Nn{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(r,s)=>this.parseResult([{text:r}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(r,s)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"})}}class tV extends Pme{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class zA extends Error{constructor(e,t,r,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=s,s&&(r===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");Yb(this,"OUTPUT_PARSING_FAILURE")}}class Ame extends tV{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class nV extends Ame{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,r;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(qce(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new Qc({message:s,text:s.content})}else if(x_(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new Qc({message:Zce(s),text:s.content})}else i=new mf({text:s});r===void 0?r=i:r=r.concat(i);const a=await this.parsePartialResult([r]);a!=null&&!Lh(a,t)&&(this.diff?yield this._diff(t,a):yield a,t=a)}}getFormatInstructions(){return""}}class h6 extends tV{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=eA(Object.fromEntries(Object.entries(e).map(([r,s])=>[r,ZP().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Hl(this.schema))}
\`\`\`
`}async parse(e){var t,r;try{const s=e.trim(),a=(((t=s.match(/^```(?:json)?\s*([\s\S]*?)```/))==null?void 0:t[1])||((r=s.match(/```json\s*([\s\S]*?)```/))==null?void 0:r[1])||s).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(o,l)=>`"${l.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await pA(this.schema,JSON.parse(a))}catch(s){throw new zA(`Failed to parse. Text: "${e}". Error: ${s}`,e)}}}class f6 extends nV{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_concatOutputChunks(e,t){return this.diff?super._concatOutputChunks(e,t):t}_diff(e,t){if(t)return e?Yoe(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return p9(e[0].text)}async parse(e){return p9(e,JSON.parse)}getFormatInstructions(){return""}}function GA(n,e){if(n.function===void 0)return;let t;if(e!=null&&e.partial)try{t=cA(n.function.arguments??"{}")}catch{return}else try{t=JSON.parse(n.function.arguments)}catch(s){throw new zA([`Function "${n.function.name}" arguments:`,"",n.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const r={name:n.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(r.id=n.id),r}function Rme(n){if(n.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:n.id,type:"function",function:{name:n.name,arguments:JSON.stringify(n.args)}}}function QI(n,e){var t,r;return{name:(t=n.function)==null?void 0:t.name,args:(r=n.function)==null?void 0:r.arguments,id:n.id,error:e,type:"invalid_tool_call"}}class Nme extends nV{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var a;const r=e[0].message;let s;if(k_(r)&&((a=r.tool_calls)!=null&&a.length)?s=r.tool_calls.map(o=>{const{id:l,...u}=o;return this.returnId?{id:l,...u}:u}):r.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(l=>GA(l,{returnId:this.returnId,partial:t}))),!s)return[];const i=[];for(const o of s)if(o!==void 0){const l={type:o.name,args:o.args,id:o.id};i.push(l)}return i}}class p6 extends Nme{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){var r;if(this.zodSchema===void 0)return e;const t=await afe(this.zodSchema,e);if(t.success)return t.data;throw new zA(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify((r=t.error)==null?void 0:r.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const r=(await super.parsePartialResult(e)).filter(i=>i.type===this.keyName);let s=r;if(r.length)return this.returnId||(s=r.map(i=>i.args)),this.returnSingle?s[0]:s}async parseResult(e){const r=(await super.parsePartialResult(e,!1)).filter(a=>a.type===this.keyName);let s=r;return r.length?(this.returnId||(s=r.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))):void 0}}function Ome(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=n;if((r||a)&&s&&e)return`${s}/${e}`;if((r||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(r||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function Lme(n){return n!==void 0&&Array.isArray(n.lc_namespace)}function Mme(n){return n!==void 0&&Nn.isRunnable(n)&&"lc_name"in n.constructor&&typeof n.constructor.lc_name=="function"&&n.constructor.lc_name()==="RunnableToolLike"}function Dme(n){return!!n&&typeof n=="object"&&"name"in n&&"schema"in n&&(Wl(n.schema)||n.schema!=null&&typeof n.schema=="object"&&"type"in n.schema&&typeof n.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(n.schema.type))}function rV(n){return Dme(n)||Mme(n)||Lme(n)}function Fme(n,e){return{name:n.name,description:n.description,parameters:Hl(n.schema)}}function $me(n,e){let t;return rV(n)?t={type:"function",function:Fme(n)}:t=n,t}const jme=Symbol("Let zodToJsonSchema decide on which parser to use"),m6={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Ume=n=>typeof n=="string"?{...m6,basePath:["#"],definitions:{},name:n}:{...m6,basePath:["#"],definitions:{},...n},YI=n=>"_def"in n?n._def:n;function Vme(n){if(!n)return!0;for(const e in n)return!1;return!0}const Bme=n=>{const e=Ume(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[YI(s),{def:YI(s),path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function sV(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function Ht(n,e,t,r,s){n[e]=t,sV(n,e,r,s)}function zme(){return{}}function Gme(n,e){var r,s;const t={type:"array"};return((s=(r=n.type)==null?void 0:r._def)==null?void 0:s.typeName)!==ie.ZodAny&&(t.items=$t(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&Ht(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&Ht(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(Ht(t,"minItems",n.exactLength.value,n.exactLength.message,e),Ht(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Wme(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Ht(t,"minimum",r.value,r.message,e):Ht(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Ht(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ht(t,"maximum",r.value,r.message,e):Ht(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Ht(t,"maximum",r.value,r.message,e));break;case"multipleOf":Ht(t,"multipleOf",r.value,r.message,e);break}return t}function Hme(){return{type:"boolean"}}function qme(n,e){return $t(n.type._def,e)}const Kme=(n,e)=>$t(n.innerType._def,e);function iV(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>iV(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Qme(n,e)}}const Qme=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":Ht(t,"minimum",r.value,r.message,e);break;case"max":Ht(t,"maximum",r.value,r.message,e);break}return t};function Yme(n,e){return{...$t(n.innerType._def,e),default:n.defaultValue()}}function Jme(n,e,t){return e.effectStrategy==="input"?$t(n.schema._def,e,t):{}}function Xme(n){return{type:"string",enum:[...n.values]}}const Zme=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function ege(n,e){const t=[$t(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),$t(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(Zme(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...l}=i;a=l}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function tge(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let rT;const lc={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(rT===void 0&&(rT=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),rT),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function aV(n,e){const t={type:"string"};function r(s){return e.patternStrategy==="escape"?nge(s):s}if(n.checks)for(const s of n.checks)switch(s.kind){case"min":Ht(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":Ht(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":qi(t,"email",s.message,e);break;case"format:idn-email":qi(t,"idn-email",s.message,e);break;case"pattern:zod":Ki(t,lc.email,s.message,e);break}break;case"url":qi(t,"uri",s.message,e);break;case"uuid":qi(t,"uuid",s.message,e);break;case"regex":Ki(t,s.regex,s.message,e);break;case"cuid":Ki(t,lc.cuid,s.message,e);break;case"cuid2":Ki(t,lc.cuid2,s.message,e);break;case"startsWith":Ki(t,RegExp(`^${r(s.value)}`),s.message,e);break;case"endsWith":Ki(t,RegExp(`${r(s.value)}$`),s.message,e);break;case"datetime":qi(t,"date-time",s.message,e);break;case"date":qi(t,"date",s.message,e);break;case"time":qi(t,"time",s.message,e);break;case"duration":qi(t,"duration",s.message,e);break;case"length":Ht(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),Ht(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{Ki(t,RegExp(r(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&qi(t,"ipv4",s.message,e),s.version!=="v4"&&qi(t,"ipv6",s.message,e);break}case"emoji":Ki(t,lc.emoji,s.message,e);break;case"ulid":{Ki(t,lc.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{qi(t,"binary",s.message,e);break}case"contentEncoding:base64":{Ht(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{Ki(t,lc.base64,s.message,e);break}}break}case"nanoid":Ki(t,lc.nanoid,s.message,e)}return t}const nge=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),qi=(n,e,t,r)=>{var s;n.format||(s=n.anyOf)!=null&&s.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):Ht(n,"format",e,t,r)},Ki=(n,e,t,r)=>{var s;n.pattern||(s=n.allOf)!=null&&s.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:g6(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):Ht(n,"pattern",g6(e,r),t,r)},g6=(n,e)=>{var u;const t=typeof n=="function"?n():n;if(!e.applyRegexFlags||!t.flags)return t.source;const r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=r.i?t.source.toLowerCase():t.source;let i="",a=!1,o=!1,l=!1;for(let h=0;h<s.length;h++){if(a){i+=s[h],a=!1;continue}if(r.i){if(o){if(s[h].match(/[a-z]/)){l?(i+=s[h],i+=`${s[h-2]}-${s[h]}`.toUpperCase(),l=!1):s[h+1]==="-"&&((u=s[h+2])!=null&&u.match(/[a-z]/))?(i+=s[h],l=!0):i+=`${s[h]}${s[h].toUpperCase()}`;continue}}else if(s[h].match(/[a-z]/)){i+=`[${s[h]}${s[h].toUpperCase()}]`;continue}}if(r.m){if(s[h]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(s[h]==="$"){i+=`($|(?=[\r
]))`;continue}}if(r.s&&s[h]==="."){i+=o?`${s[h]}\r
`:`[${s[h]}\r
]`;continue}i+=s[h],s[h]==="\\"?a=!0:o&&s[h]==="]"?o=!1:!o&&s[h]==="["&&(o=!0)}try{const h=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function oV(n,e){var r,s,i,a;if(e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===ie.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((o,l)=>({...o,[l]:$t(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:$t(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=n.keyType)==null?void 0:s._def.typeName)===ie.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const o=Object.entries(aV(n.keyType._def,e)).reduce((l,[u,h])=>u==="type"?l:{...l,[u]:h},{});return{...t,propertyNames:o}}else if(((a=n.keyType)==null?void 0:a._def.typeName)===ie.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};return t}function rge(n,e){if(e.mapStrategy==="record")return oV(n,e);const t=$t(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=$t(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function sge(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function ige(){return{not:{}}}function age(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Gw={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function oge(n,e){if(e.target==="openApi3")return _6(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in Gw&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,i)=>{const a=Gw[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return _6(n,e)}const _6=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>$t(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function lge(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:Gw[n.innerType._def.typeName],nullable:!0}:{type:[Gw[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=$t(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=$t(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function uge(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",sV(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Ht(t,"minimum",r.value,r.message,e):Ht(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Ht(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ht(t,"maximum",r.value,r.message,e):Ht(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Ht(t,"maximum",r.value,r.message,e));break;case"multipleOf":Ht(t,"multipleOf",r.value,r.message,e);break}return t}function cge(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":$t(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":$t(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function dge(n,e){const t={type:"object",...Object.entries(n.shape()).reduce((r,[s,i])=>{var l;if(i===void 0||i._def===void 0)return r;const a=[...e.currentPath,"properties",s],o=$t(i._def,{...e,currentPath:a,propertyPath:a});if(o===void 0)return r;if(e.openaiStrictMode&&i.isOptional()&&!i.isNullable()&&typeof((l=i._def)==null?void 0:l.defaultValue)>"u")throw new Error(`Zod field at \`${a.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...r.properties,[s]:o},required:i.isOptional()&&!e.openaiStrictMode?r.required:[...r.required,s]}},{properties:{},required:[]}),additionalProperties:cge(n,e)};return t.required.length||delete t.required,t}const hge=(n,e)=>{if(e.propertyPath&&e.currentPath.slice(0,e.propertyPath.length).toString()===e.propertyPath.toString())return $t(n.innerType._def,{...e,currentPath:e.currentPath});const t=$t(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},fge=(n,e)=>{if(e.pipeStrategy==="input")return $t(n.in._def,e);if(e.pipeStrategy==="output")return $t(n.out._def,e);const t=$t(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=$t(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function pge(n,e){return $t(n.type._def,e)}function mge(n,e){const r={type:"array",uniqueItems:!0,items:$t(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&Ht(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&Ht(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function gge(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>$t(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:$t(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>$t(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function _ge(){return{not:{}}}function yge(){return{}}const vge=(n,e)=>$t(n.innerType._def,e);function $t(n,e,t=!1){var a;const r=e.seen.get(n);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,n,e,r,t);if(o!==jme)return o}if(r&&!t){const o=wge(r,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const i=Ege(n,n.typeName,e,t);return i&&Sge(n,e,i),s.jsonSchema=i,i}const wge=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"extract-to-root":const t=n.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=n.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:bge(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((r,s)=>e.currentPath[s]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},bge=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},Ege=(n,e,t,r)=>{switch(e){case ie.ZodString:return aV(n,t);case ie.ZodNumber:return uge(n,t);case ie.ZodObject:return dge(n,t);case ie.ZodBigInt:return Wme(n,t);case ie.ZodBoolean:return Hme();case ie.ZodDate:return iV(n,t);case ie.ZodUndefined:return _ge();case ie.ZodNull:return age(t);case ie.ZodArray:return Gme(n,t);case ie.ZodUnion:case ie.ZodDiscriminatedUnion:return oge(n,t);case ie.ZodIntersection:return ege(n,t);case ie.ZodTuple:return gge(n,t);case ie.ZodRecord:return oV(n,t);case ie.ZodLiteral:return tge(n,t);case ie.ZodEnum:return Xme(n);case ie.ZodNativeEnum:return sge(n);case ie.ZodNullable:return lge(n,t);case ie.ZodOptional:return hge(n,t);case ie.ZodMap:return rge(n,t);case ie.ZodSet:return mge(n,t);case ie.ZodLazy:return $t(n.getter()._def,t);case ie.ZodPromise:return pge(n,t);case ie.ZodNaN:case ie.ZodNever:return ige();case ie.ZodEffects:return Jme(n,t,r);case ie.ZodAny:return zme();case ie.ZodUnknown:return yge();case ie.ZodDefault:return Yme(n,t);case ie.ZodBranded:return qme(n,t);case ie.ZodReadonly:return vge(n,t);case ie.ZodCatch:return Kme(n,t);case ie.ZodPipeline:return fge(n,t);case ie.ZodFunction:case ie.ZodVoid:case ie.ZodSymbol:return;default:return(s=>{})()}},Sge=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),Tge=(n,e)=>{const t=Bme(e),r=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=$t(n._def,r===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,r]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i);const a=(()=>{if(Vme(t.definitions))return;const l={},u=new Set;for(let h=0;h<500;h++){const f=Object.entries(t.definitions).filter(([p])=>!u.has(p));if(f.length===0)break;for(const[p,y]of f)l[p]=$t(YI(y),{...t,currentPath:[...t.basePath,t.definitionPath,p]},!0)??{},u.add(p)}return l})(),o=r===void 0?a?{...s,[t.definitionPath]:a}:s:t.nameStrategy==="duplicate-ref"?{...s,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[r]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,r].join("/"),[t.definitionPath]:{...a,[r]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function Cge(n,e){return Tge(n,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function Ige(n,e,t){return Npe({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:Cge(n,{name:e})}},r=>n.parse(JSON.parse(r)))}function I0(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function lV(n){let e;return n.constructor.name===uE.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===ni.name?(e=new Error(n.message),e.name="AbortError"):n.status===400&&n.message.includes("tool_calls")?e=I0(n,"INVALID_TOOL_RESULTS"):n.status===401?e=I0(n,"MODEL_AUTHENTICATION"):n.status===429?e=I0(n,"MODEL_RATE_LIMIT"):n.status===404?e=I0(n,"MODEL_NOT_FOUND"):e=n,e}function uV(n){if(n)return n==="any"||n==="required"?"required":n==="auto"?"auto":n==="none"?"none":typeof n=="string"?{type:"function",function:{name:n}}:n}function xge(n,e){const t={...n};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function kge(n,e,t){if(ro(n))return Ige(n,e,t);if(ga(n))return xge({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:CI(n,{cycles:"ref",reused:"ref",override(r){r.jsonSchema.title=e}})}},r=>lj(n,JSON.parse(r)));throw new Error("Unsupported schema response format")}function Pge(n){return n.anyOf!==void 0&&Array.isArray(n.anyOf)}function Age(n){const e=["namespace functions {",""];for(const t of n)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(cV(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function cV(n,e){var r;const t=[];for(const[s,i]of Object.entries(n.properties??{}))i.description&&e<2&&t.push(`// ${i.description}`),(r=n.required)!=null&&r.includes(s)?t.push(`${s}: ${Ww(i,e)},`):t.push(`${s}?: ${Ww(i,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function Ww(n,e){if(Pge(n))return n.anyOf.map(t=>Ww(t,e)).join(" | ");switch(n.type){case"string":return n.enum?n.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",cV(n,e+2),"}"].join(`
`);case"array":return n.items?`${Ww(n.items,e)}[]`:"any[]";default:return""}}function Rge(n,e){let t;return rV(n)?t=$me(n):t=n,t.type==="function"&&(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function WA(n){return"type"in n&&n.type!=="function"&&n.type!=="custom"}function Nge(n){return n!=null&&typeof n=="object"&&"type"in n&&n.type!=="function"}function Oge(n){return typeof n=="object"&&n!==null&&"metadata"in n&&typeof n.metadata=="object"&&n.metadata!==null&&"customTool"in n.metadata&&typeof n.metadata.customTool=="object"&&n.metadata.customTool!==null}function dV(n){return"type"in n&&n.type==="custom"&&"custom"in n&&typeof n.custom=="object"&&n.custom!==null}function Lge(n){if(n.type==="custom_tool_call")return{...n,type:"tool_call",call_id:n.id,id:n.call_id,name:n.name,isCustomTool:!0,args:{input:n.input}}}function Mge(n){return n.type==="tool_call"&&"isCustomTool"in n&&n.isCustomTool===!0}function Dge(n){const e=()=>{if(n.custom.format){if(n.custom.format.type==="grammar")return{type:"grammar",definition:n.custom.format.grammar.definition,syntax:n.custom.format.grammar.syntax};if(n.custom.format.type==="text")return{type:"text"}}};return{type:"custom",name:n.custom.name,description:n.custom.description,format:e()}}function Fge(n){const e=()=>{if(n.format){if(n.format.type==="grammar")return{type:"grammar",grammar:{definition:n.format.definition,syntax:n.format.syntax}};if(n.format.type==="text")return{type:"text"}}};return{type:"custom",custom:{name:n.name,description:n.description,format:e()}}}function $ge(n,e){if(e&&typeof e=="object"&&"images"in e&&Array.isArray(e.images)){const t=e.images.filter(r=>{var s;return typeof((s=r==null?void 0:r.image_url)==null?void 0:s.url)=="string"}).map(r=>({type:"image",url:r.image_url.url,source_type:"url"}));return[{type:"text",text:n,source_type:"text"},...t]}return n}function y6(n){var r,s,i,a;const e={...((r=n==null?void 0:n.input_tokens_details)==null?void 0:r.cached_tokens)!=null&&{cache_read:(s=n==null?void 0:n.input_tokens_details)==null?void 0:s.cached_tokens}},t={...((i=n==null?void 0:n.output_tokens_details)==null?void 0:i.reasoning_tokens)!=null&&{reasoning:(a=n==null?void 0:n.output_tokens_details)==null?void 0:a.reasoning_tokens}};return{input_tokens:(n==null?void 0:n.input_tokens)??0,output_tokens:(n==null?void 0:n.output_tokens)??0,total_tokens:(n==null?void 0:n.total_tokens)??0,input_token_details:e,output_token_details:t}}const Yd="__openai_function_call_ids__";function _E(n){return n?!!(/^o\d/.test(n??"")||n.startsWith("gpt-5")&&!n.startsWith("gpt-5-chat")):!1}function jge(n){return n!==void 0&&typeof n.schema=="object"}function Uge(n){return n.role!=="system"&&n.role!=="developer"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&n.role!=="tool"&&console.warn(`Unknown message role: ${n.role}`),n.role}function HA(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!gd.isInstance(n))throw new Error("Invalid generic chat message");return Uge(n)}default:throw new Error(`Unknown message type: ${e}`)}}const hV={providerName:"ChatOpenAI",fromStandardTextBlock(n){return{type:"text",text:n.text}},fromStandardImageBlock(n){var e,t;if(n.source_type==="url")return{type:"image_url",image_url:{url:n.url,...(e=n.metadata)!=null&&e.detail?{detail:n.metadata.detail}:{}}};if(n.source_type==="base64")return{type:"image_url",image_url:{url:`data:${n.mime_type??""};base64,${n.data}`,...(t=n.metadata)!=null&&t.detail?{detail:n.metadata.detail}:{}}};throw new Error(`Image content blocks with source_type ${n.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(n){if(n.source_type==="url"){const e=g9({dataUrl:n.url});if(!e)throw new Error(`URL audio blocks with source_type ${n.source_type} must be formatted as a data URL for ChatOpenAI`);const t=e.mime_type||n.mime_type||"";let r;try{r=m9(t)}catch{throw new Error(`Audio blocks with source_type ${n.source_type} must have mime type of audio/wav or audio/mp3`)}if(r.type!=="audio"||r.subtype!=="wav"&&r.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${n.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:r.subtype,data:e.data}}}if(n.source_type==="base64"){let e;try{e=m9(n.mime_type??"")}catch{throw new Error(`Audio blocks with source_type ${n.source_type} must have mime type of audio/wav or audio/mp3`)}if(e.type!=="audio"||e.subtype!=="wav"&&e.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${n.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:e.subtype,data:n.data}}}throw new Error(`Audio content blocks with source_type ${n.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(n){var e,t,r,s,i,a,o,l,u,h;if(n.source_type==="url"){if(!g9({dataUrl:n.url}))throw new Error(`URL file blocks with source_type ${n.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:n.url,...(e=n.metadata)!=null&&e.filename||(t=n.metadata)!=null&&t.name?{filename:((r=n.metadata)==null?void 0:r.filename)||((s=n.metadata)==null?void 0:s.name)}:{}}}}if(n.source_type==="base64")return{type:"file",file:{file_data:`data:${n.mime_type??""};base64,${n.data}`,...(i=n.metadata)!=null&&i.filename||(a=n.metadata)!=null&&a.name||(o=n.metadata)!=null&&o.title?{filename:((l=n.metadata)==null?void 0:l.filename)||((u=n.metadata)==null?void 0:u.name)||((h=n.metadata)==null?void 0:h.title)}:{}}};if(n.source_type==="id")return{type:"file",file:{file_id:n.id}};throw new Error(`File content blocks with source_type ${n.source_type} are not supported for ChatOpenAI`)}};function v6(n,e){return n.flatMap(t=>{var a;let r=HA(t);r==="system"&&_E(e)&&(r="developer");const s=typeof t.content=="string"?t.content:t.content.map(o=>Kc(o)?ej(o,hV):o),i={role:r,content:s};if(t.name!=null&&(i.name=t.name),t.additional_kwargs.function_call!=null&&(i.function_call=t.additional_kwargs.function_call,i.content=""),k_(t)&&((a=t.tool_calls)!=null&&a.length)?(i.tool_calls=t.tool_calls.map(Rme),i.content=""):(t.additional_kwargs.tool_calls!=null&&(i.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(i.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const o={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[i,o]}return i})}class qA extends Rl{_llmType(){return"openai"}static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning","reasoningEffort","service_tier"]}get lc_secrets(){return{apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{apiKey:"openai_api_key",modelName:"model",reasoningEffort:"reasoning_effort"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","model","modelName","modelKwargs","stop","stopSequences","timeout","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","zdrEnabled","reasoning","reasoningEffort","promptCacheKey","verbosity"]}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}constructor(e){var t,r;super(e??{}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zdrEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"service_tier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"promptCacheKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbosity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.apiKey=(e==null?void 0:e.apiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??lu("OPENAI_API_KEY"),this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??lu("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoning=(e==null?void 0:e.reasoning)??(e==null?void 0:e.reasoningEffort)?{effort:e.reasoningEffort}:void 0,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.disableStreaming=(e==null?void 0:e.disableStreaming)===!0,this.streaming=(e==null?void 0:e.streaming)===!0,this.promptCacheKey=(e==null?void 0:e.promptCacheKey)??this.promptCacheKey,this.verbosity=(e==null?void 0:e.verbosity)??this.verbosity,(e==null?void 0:e.streaming)===!1&&(this.disableStreaming=!0),this.disableStreaming===!0&&(this.streaming=!1),this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),(e==null?void 0:e.service_tier)!==void 0&&(this.service_tier=e.service_tier),this.zdrEnabled=(e==null?void 0:e.zdrEnabled)??!1}_getReasoningParams(e){if(!_E(this.model))return;let t;return this.reasoning!==void 0&&(t={...t,...this.reasoning}),(e==null?void 0:e.reasoning)!==void 0&&(t={...t,...e.reasoning}),t}_getResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Wl(e.json_schema.schema)?kge(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}_combineCallOptions(e){return{...this.defaultOptions,...e??{}}}_getClientOptions(e){if(!this.client){const r={baseURL:this.clientConfig.baseURL},s=Ome(r),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new vt(i)}return{...this.clientConfig,...e}}_convertChatOpenAIToolToCompletionsTool(e,t){return Oge(e)?Fge(e.metadata.customTool):ZU(e)?(t==null?void 0:t.strict)!==void 0?{...e,function:{...e.function,strict:t.strict}}:e:Rge(e,t)}bindTools(e,t){let r;return(t==null?void 0:t.strict)!==void 0?r=t.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this.withConfig({tools:e.map(s=>WA(s)?s:this._convertChatOpenAIToolToCompletionsTool(s,{strict:r})),...t})}async stream(e,t){return super.stream(e,this._combineCallOptions(t))}async invoke(e,t){return super.invoke(e,this._combineCallOptions(t))}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}async getNumTokensFromMessages(e){let t=0,r=0,s=0;this.model==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);const i=await Promise.all(e.map(async a=>{var p,y,_,b,S,E;const o=await this.getNumTokens(a.content),l=await this.getNumTokens(HA(a)),u=a.name!==void 0?s+await this.getNumTokens(a.name):0;let h=o+r+l+u;const f=a;if(f._getType()==="function"&&(h-=2),(p=f.additional_kwargs)!=null&&p.function_call&&(h+=3),(y=f==null?void 0:f.additional_kwargs.function_call)!=null&&y.name&&(h+=await this.getNumTokens((_=f.additional_kwargs.function_call)==null?void 0:_.name)),(b=f.additional_kwargs.function_call)!=null&&b.arguments)try{h+=await this.getNumTokens(JSON.stringify(JSON.parse((S=f.additional_kwargs.function_call)==null?void 0:S.arguments)))}catch(C){console.error("Error parsing function arguments",C,JSON.stringify(f.additional_kwargs.function_call)),h+=await this.getNumTokens((E=f.additional_kwargs.function_call)==null?void 0:E.arguments)}return t+=h,h}));return t+=3,{totalCount:t,countPerMessage:i}}async _getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var s;return(s=r.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,s)=>r+s,0)}async _getEstimatedTokenCountFromPrompt(e,t,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&r!=="auto"){const i=Age(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}_getStructuredOutputMethod(e){const t={...e};if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"){if((t==null?void 0:t.method)===void 0)return"jsonSchema"}else t.method==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`);return t.method}withStructuredOutput(e,t){let r,s,i,a;jge(e)?(r=e.schema,s=e.name,i=e.method,a=e.includeRaw):(r=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,l;if((t==null?void 0:t.strict)!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(i=this._getStructuredOutputMethod({...t,method:i}),i==="jsonMode"){Wl(r)?l=h6.fromZodSchema(r):l=new f6;const p=Hl(r);o=this.withConfig({response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"json_mode"},schema:{title:s??"extract",...p}}})}else if(i==="jsonSchema"){const p={name:s??"extract",description:mA(r),schema:r,strict:t==null?void 0:t.strict},y=Hl(p.schema);if(o=this.withConfig({response_format:{type:"json_schema",json_schema:p},ls_structured_output_format:{kwargs:{method:"json_schema"},schema:{title:p.name,description:p.description,...y}}}),Wl(r)){const _=h6.fromZodSchema(r);l=Hf.from(b=>"parsed"in b.additional_kwargs?b.additional_kwargs.parsed:_)}else l=new f6}else{let p=s??"extract";if(Wl(r)){const y=Hl(r);o=this.withConfig({tools:[{type:"function",function:{name:p,description:y.description,parameters:y}}],tool_choice:{type:"function",function:{name:p}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:p,...y}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new p6({returnSingle:!0,keyName:p,zodSchema:r})}else{let y;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(y=r,p=r.name):(p=r.title??p,y={name:p,description:r.description??"",parameters:r});const _=Hl(r);o=this.withConfig({tools:[{type:"function",function:y}],tool_choice:{type:"function",function:{name:p}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:p,..._}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new p6({returnSingle:!0,keyName:p})}}if(!a)return o.pipe(l);const u=zw.assign({parsed:(p,y)=>l.invoke(p.raw,y)}),h=zw.assign({parsed:()=>null}),f=u.withFallbacks({fallbacks:[h]});return Oo.from([{raw:o},f])}}class Vge extends qA{invocationParams(e){var i;let t;(e==null?void 0:e.strict)!==void 0?t=e.strict:this.supportsStrictToolCalling!==void 0&&(t=this.supportsStrictToolCalling);const r={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(i=e==null?void 0:e.tools)!=null&&i.length?this._reduceChatOpenAITools(e.tools,{stream:this.streaming,strict:t}):void 0,tool_choice:Nge(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const a=uV(e==null?void 0:e.tool_choice);if(typeof a=="object"&&"type"in a){if(a.type==="function")return{type:"function",name:a.function.name};if(a.type==="allowed_tools")return{type:"allowed_tools",mode:a.allowed_tools.mode,tools:a.allowed_tools.tools};if(a.type==="custom")return{type:"custom",name:a.custom.name}}})(),text:(()=>{if(e!=null&&e.text)return e.text;const a=this._getResponseFormat(e==null?void 0:e.response_format);return(a==null?void 0:a.type)==="json_schema"?a.json_schema.schema!=null?{format:{type:"json_schema",schema:a.json_schema.schema,description:a.json_schema.description,name:a.json_schema.name,strict:a.json_schema.strict},verbosity:e==null?void 0:e.verbosity}:void 0:{format:a,verbosity:e==null?void 0:e.verbosity}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,prompt_cache_key:(e==null?void 0:e.promptCacheKey)??this.promptCacheKey,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},s=this._getReasoningParams(e);return s!==void 0&&(r.reasoning=s),r}async _generate(e,t){var s;const r=this.invocationParams(t);if(r.stream){const i=this._streamResponseChunks(e,t);let a;for await(const o of i)o.message.response_metadata={...o.generationInfo,...o.message.response_metadata},a=(a==null?void 0:a.concat(o))??o;return{generations:a?[a]:[],llmOutput:{estimatedTokenUsage:(s=a==null?void 0:a.message)==null?void 0:s.usage_metadata}}}else{const i=this._convertMessagesToResponsesParams(e),a=await this.completionWithRetry({input:i,...r,stream:!1},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:a.output_text,message:this._convertResponsesMessageToBaseMessage(a)}],llmOutput:{id:a.id,estimatedTokenUsage:a.usage?{promptTokens:a.usage.input_tokens,completionTokens:a.usage.output_tokens,totalTokens:a.usage.total_tokens}:void 0}}}}async*_streamResponseChunks(e,t,r){const s=await this.completionWithRetry({...this.invocationParams(t),input:this._convertMessagesToResponsesParams(e),stream:!0},t);for await(const i of s){const a=this._convertResponsesDeltaToBaseMessageChunk(i);a!=null&&(yield a,await(r==null?void 0:r.handleLLMNewToken(a.text||"",{prompt:t.promptIndex??0,completion:0},void 0,void 0,void 0,{chunk:a})))}}async completionWithRetry(e,t){return this.caller.call(async()=>{var s,i;const r=this._getClientOptions(t);try{return((i=(s=e.text)==null?void 0:s.format)==null?void 0:i.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,r):await this.client.responses.create(e,r)}catch(a){throw lV(a)}})}_convertResponsesMessageToBaseMessage(e){if(e.error){const l=new Error(e.error.message);throw l.name=e.error.code,l}let t;const r=[],s=[],i=[],a={model:e.model,created_at:e.created_at,id:e.id,incomplete_details:e.incomplete_details,metadata:e.metadata,object:e.object,status:e.status,user:e.user,service_tier:e.service_tier,model_name:e.model},o={};for(const l of e.output)if(l.type==="message")t=l.id,r.push(...l.content.flatMap(u=>u.type==="output_text"?("parsed"in u&&u.parsed!=null&&(o.parsed=u.parsed),{type:"text",text:u.text,annotations:u.annotations}):u.type==="refusal"?(o.refusal=u.refusal,[]):u));else if(l.type==="function_call"){const u={function:{name:l.name,arguments:l.arguments},id:l.call_id};try{s.push(GA(u,{returnId:!0}))}catch(h){let f;typeof h=="object"&&h!=null&&"message"in h&&typeof h.message=="string"&&(f=h.message),i.push(QI(u,f))}o[Yd]??(o[Yd]={}),l.id&&(o[Yd][l.call_id]=l.id)}else if(l.type==="reasoning")o.reasoning=l;else if(l.type==="custom_tool_call"){const u=Lge(l);u?s.push(u):i.push(QI(l,"Malformed custom tool call"))}else o.tool_outputs??(o.tool_outputs=[]),o.tool_outputs.push(l);return new ff({id:t,content:r,tool_calls:s,invalid_tool_calls:i,usage_metadata:y6(e.usage),additional_kwargs:o,response_metadata:a})}_convertResponsesDeltaToBaseMessageChunk(e){var u,h;const t=[];let r={},s;const i=[],a={},o={};let l;if(e.type==="response.output_text.delta")t.push({type:"text",text:e.delta,index:e.content_index});else if(e.type==="response.output_text.annotation.added")t.push({type:"text",text:"",annotations:[e.annotation],index:e.content_index});else if(e.type==="response.output_item.added"&&e.item.type==="message")l=e.item.id;else if(e.type==="response.output_item.added"&&e.item.type==="function_call")i.push({type:"tool_call_chunk",name:e.item.name,args:e.item.arguments,id:e.item.call_id,index:e.output_index}),o[Yd]={[e.item.call_id]:e.item.id};else if(e.type==="response.output_item.done"&&["web_search_call","file_search_call","computer_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","image_generation_call","custom_tool_call"].includes(e.item.type))o.tool_outputs=[e.item];else if(e.type==="response.created")a.id=e.response.id,a.model_name=e.response.model,a.model=e.response.model;else if(e.type==="response.completed"){const f=this._convertResponsesMessageToBaseMessage(e.response);s=y6(e.response.usage),((h=(u=e.response.text)==null?void 0:u.format)==null?void 0:h.type)==="json_schema"&&(o.parsed??(o.parsed=JSON.parse(f.text)));for(const[p,y]of Object.entries(e.response))p!=="id"&&(a[p]=y)}else if(e.type==="response.function_call_arguments.delta"||e.type==="response.custom_tool_call_input.delta")i.push({type:"tool_call_chunk",args:e.delta,index:e.output_index});else if(e.type==="response.web_search_call.completed"||e.type==="response.file_search_call.completed")r={tool_outputs:{id:e.item_id,type:e.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(e.type==="response.refusal.done")o.refusal=e.refusal;else if(e.type==="response.output_item.added"&&"item"in e&&e.item.type==="reasoning"){const f=e.item.summary?e.item.summary.map((p,y)=>({...p,index:y})):void 0;o.reasoning={id:e.item.id,type:e.item.type,...f?{summary:f}:{}}}else if(e.type==="response.reasoning_summary_part.added")o.reasoning={type:"reasoning",summary:[{...e.part,index:e.summary_index}]};else if(e.type==="response.reasoning_summary_text.delta")o.reasoning={type:"reasoning",summary:[{text:e.delta,type:"summary_text",index:e.summary_index}]};else return e.type==="response.image_generation_call.partial_image",null;return new Qc({text:t.map(f=>f.text).join(""),message:new Tu({id:l,content:t,tool_call_chunks:i,usage_metadata:s,additional_kwargs:o,response_metadata:a}),generationInfo:r})}_convertMessagesToResponsesParams(e){return e.flatMap(t=>{var i,a,o,l;const r=t.additional_kwargs;let s=HA(t);if(s==="system"&&_E(this.model)&&(s="developer"),s==="function")throw new Error("Function messages are not supported in Responses API");if(s==="tool"){const u=t;return(r==null?void 0:r.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof u.content=="string")return{type:"computer_screenshot",image_url:u.content};if(Array.isArray(u.content)){const f=u.content.find(y=>y.type==="computer_screenshot");if(f)return f;const p=u.content.find(y=>y.type==="image_url");if(p)return{type:"computer_screenshot",image_url:typeof p.image_url=="string"?p.image_url:p.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:u.tool_call_id}:(i=u.metadata)!=null&&i.customTool?{type:"custom_tool_call_output",call_id:u.tool_call_id,output:u.content}:{type:"function_call_output",call_id:u.tool_call_id,id:(a=u.id)!=null&&a.startsWith("fc_")?u.id:void 0,output:typeof u.content!="string"?JSON.stringify(u.content):u.content}}if(s==="assistant"){if(!this.zdrEnabled&&t.response_metadata.output!=null&&Array.isArray(t.response_metadata.output)&&t.response_metadata.output.length>0&&t.response_metadata.output.every(_=>"type"in _))return t.response_metadata.output;const u=[];if(r!=null&&r.reasoning&&!this.zdrEnabled){const _=this._convertReasoningSummary(r.reasoning);u.push(_)}let{content:h}=t;r!=null&&r.refusal&&(typeof h=="string"&&(h=[{type:"output_text",text:h,annotations:[]}]),h=[...h,{type:"refusal",refusal:r.refusal}]),(typeof h=="string"||h.length>0)&&u.push({type:"message",role:"assistant",...t.id&&!this.zdrEnabled&&t.id.startsWith("msg_")?{id:t.id}:{},content:typeof h=="string"?h:h.flatMap(_=>_.type==="text"?{type:"output_text",text:_.text,annotations:_.annotations??[]}:_.type==="output_text"||_.type==="refusal"?_:[])});const f=r==null?void 0:r[Yd];k_(t)&&((o=t.tool_calls)!=null&&o.length)?u.push(...t.tool_calls.map(_=>Mge(_)?{type:"custom_tool_call",id:_.call_id,call_id:_.id??"",input:_.args.input,name:_.name}:{type:"function_call",name:_.name,arguments:JSON.stringify(_.args),call_id:_.id,...this.zdrEnabled?{id:f==null?void 0:f[_.id]}:{}})):r!=null&&r.tool_calls&&u.push(...r.tool_calls.map(_=>({type:"function_call",name:_.function.name,call_id:_.id,arguments:_.function.arguments,...this.zdrEnabled?{id:f==null?void 0:f[_.id]}:{}})));const p=(l=t.response_metadata.output)!=null&&l.length?t.response_metadata.output:r.tool_outputs,y=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(p!=null){const _=p,b=_==null?void 0:_.filter(S=>y.includes(S.type));b.length>0&&u.push(...b)}return u}if(s==="user"||s==="system"||s==="developer"){if(typeof t.content=="string")return{type:"message",role:s,content:t.content};const u=[],h=t.content.flatMap(f=>(f.type==="mcp_approval_response"&&u.push({type:"mcp_approval_response",approval_request_id:f.approval_request_id,approve:f.approve}),Kc(f)?ej(f,hV):f.type==="text"?{type:"input_text",text:f.text}:f.type==="image_url"?{type:"input_image",image_url:typeof f.image_url=="string"?f.image_url:f.image_url.url,detail:typeof f.image_url=="string"?"auto":f.image_url.detail}:f.type==="input_text"||f.type==="input_image"||f.type==="input_file"?f:[]));return h.length>0&&u.push({type:"message",role:s,content:h}),u}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${s}`),[]})}_convertReasoningSummary(e){const t=(e.summary.length>1?e.summary.reduce((r,s)=>{const i=r.at(-1);return i.index===s.index?i.text+=s.text:r.push(s),r},[{...e.summary[0]}]):e.summary).map(r=>Object.fromEntries(Object.entries(r).filter(([s])=>s!=="index")));return{...e,summary:t}}_reduceChatOpenAITools(e,t){const r=[];for(const s of e)WA(s)?(s.type==="image_generation"&&(t!=null&&t.stream)&&(s.partial_images=1),r.push(s)):ZU(s)?r.push({type:"function",name:s.function.name,parameters:s.function.parameters,description:s.function.description,strict:(t==null?void 0:t.strict)??null}):dV(s)&&r.push(Dge(s));return r}}class Bge extends qA{invocationParams(e,t){var o;let r;(e==null?void 0:e.strict)!==void 0?r=e.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling);let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(l=>this._convertChatOpenAIToolToCompletionsTool(l,{strict:r})):void 0,tool_choice:uV(e==null?void 0:e.tool_choice),response_format:this._getResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs,prompt_cache_key:(e==null?void 0:e.promptCacheKey)??this.promptCacheKey,verbosity:(e==null?void 0:e.verbosity)??this.verbosity};(e==null?void 0:e.prediction)!==void 0&&(i.prediction=e.prediction),this.service_tier!==void 0&&(i.service_tier=this.service_tier),(e==null?void 0:e.service_tier)!==void 0&&(i.service_tier=e.service_tier);const a=this._getReasoningParams(e);return a!==void 0&&a.effort!==void 0&&(i.reasoning_effort=a.effort),_E(i.model)?i.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:i.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,i}async _generate(e,t,r){var o,l;const s={},i=this.invocationParams(t),a=v6(e,this.model);if(i.stream){const u=this._streamResponseChunks(e,t,r),h={};for await(const S of u){S.message.response_metadata={...S.generationInfo,...S.message.response_metadata};const E=((o=S.generationInfo)==null?void 0:o.completion)??0;h[E]===void 0?h[E]=S:h[E]=h[E].concat(S)}const f=Object.entries(h).sort(([S],[E])=>parseInt(S,10)-parseInt(E,10)).map(([S,E])=>E),{functions:p,function_call:y}=this.invocationParams(t),_=await this._getEstimatedTokenCountFromPrompt(e,p,y),b=await this._getNumTokensFromGenerations(f);return s.input_tokens=_,s.output_tokens=b,s.total_tokens=_+b,{generations:f,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{const u=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}),{completion_tokens:h,prompt_tokens:f,total_tokens:p,prompt_tokens_details:y,completion_tokens_details:_}=(u==null?void 0:u.usage)??{};h&&(s.output_tokens=(s.output_tokens??0)+h),f&&(s.input_tokens=(s.input_tokens??0)+f),p&&(s.total_tokens=(s.total_tokens??0)+p),((y==null?void 0:y.audio_tokens)!==null||(y==null?void 0:y.cached_tokens)!==null)&&(s.input_token_details={...(y==null?void 0:y.audio_tokens)!==null&&{audio:y==null?void 0:y.audio_tokens},...(y==null?void 0:y.cached_tokens)!==null&&{cache_read:y==null?void 0:y.cached_tokens}}),((_==null?void 0:_.audio_tokens)!==null||(_==null?void 0:_.reasoning_tokens)!==null)&&(s.output_token_details={...(_==null?void 0:_.audio_tokens)!==null&&{audio:_==null?void 0:_.audio_tokens},...(_==null?void 0:_.reasoning_tokens)!==null&&{reasoning:_==null?void 0:_.reasoning_tokens}});const b=[];for(const S of(u==null?void 0:u.choices)??[]){const C={text:((l=S.message)==null?void 0:l.content)??"",message:this._convertCompletionsMessageToBaseMessage(S.message??{role:"assistant"},u)};C.generationInfo={...S.finish_reason?{finish_reason:S.finish_reason}:{},...S.logprobs?{logprobs:S.logprobs}:{}},k_(C.message)&&(C.message.usage_metadata=s),C.message=new ff(Object.fromEntries(Object.entries(C.message).filter(([v])=>!v.startsWith("lc_")))),b.push(C)}return{generations:b,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async*_streamResponseChunks(e,t,r){var u,h,f,p,y,_,b,S,E,C;const s=v6(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);let l;for await(const v of o){const I=(u=v==null?void 0:v.choices)==null?void 0:u[0];if(v.usage&&(l=v.usage),!I)continue;const{delta:L}=I;if(!L)continue;const R=this._convertCompletionsDeltaToBaseMessageChunk(L,v,a);a=L.role??a;const P={prompt:t.promptIndex??0,completion:I.index??0};if(typeof R.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const x={...P};I.finish_reason!=null&&(x.finish_reason=I.finish_reason,x.system_fingerprint=v.system_fingerprint,x.model_name=v.model,x.service_tier=v.service_tier),this.logprobs&&(x.logprobs=I.logprobs);const N=new Qc({message:R,text:R.content,generationInfo:x});yield N,await(r==null?void 0:r.handleLLMNewToken(N.text??"",P,void 0,void 0,void 0,{chunk:N}))}if(l){const v={...((h=l.prompt_tokens_details)==null?void 0:h.audio_tokens)!==null&&{audio:(f=l.prompt_tokens_details)==null?void 0:f.audio_tokens},...((p=l.prompt_tokens_details)==null?void 0:p.cached_tokens)!==null&&{cache_read:(y=l.prompt_tokens_details)==null?void 0:y.cached_tokens}},I={...((_=l.completion_tokens_details)==null?void 0:_.audio_tokens)!==null&&{audio:(b=l.completion_tokens_details)==null?void 0:b.audio_tokens},...((S=l.completion_tokens_details)==null?void 0:S.reasoning_tokens)!==null&&{reasoning:(E=l.completion_tokens_details)==null?void 0:E.reasoning_tokens}};yield new Qc({message:new Tu({content:"",response_metadata:{usage:{...l}},usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens,...Object.keys(v).length>0&&{input_token_details:v},...Object.keys(I).length>0&&{output_token_details:I}}}),text:""})}if((C=t.signal)!=null&&C.aborted)throw new Error("AbortError")}async completionWithRetry(e,t){const r=this._getClientOptions(t),s=e.response_format&&e.response_format.type==="json_schema";return this.caller.call(async()=>{try{return s&&!e.stream?await this.client.chat.completions.parse(e,r):await this.client.chat.completions.create(e,r)}catch(i){throw lV(i)}})}_convertCompletionsMessageToBaseMessage(e,t){var s,i;const r=e.tool_calls;switch(e.role){case"assistant":{const a=[],o=[];for(const f of r??[])try{a.push(GA(f,{returnId:!0}))}catch(p){o.push(QI(f,p.message))}const l={function_call:e.function_call,tool_calls:r};this.__includeRawResponse!==void 0&&(l.__raw_response=t);const u={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};e.audio&&(l.audio=e.audio);const h=$ge(e.content||"",(i=(s=t.choices)==null?void 0:s[0])==null?void 0:i.message);return new ff({content:h,tool_calls:a,invalid_tool_calls:o,additional_kwargs:l,response_metadata:u,id:t.id})}default:return new gd(e.content||"",e.role??"unknown")}}_convertCompletionsDeltaToBaseMessageChunk(e,t,r){var l,u;const s=e.role??r,i=e.content??"";let a;e.function_call?a={function_call:e.function_call}:e.tool_calls?a={tool_calls:e.tool_calls}:a={},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new eE({content:i,response_metadata:o});if(s==="assistant"){const h=[];if(Array.isArray(e.tool_calls))for(const f of e.tool_calls)h.push({name:(l=f.function)==null?void 0:l.name,args:(u=f.function)==null?void 0:u.arguments,id:f.id,index:f.index,type:"tool_call_chunk"});return new Tu({content:i,tool_call_chunks:h,additional_kwargs:a,id:t.id,response_metadata:o})}else return s==="system"?new Vg({content:i,response_metadata:o}):s==="developer"?new Vg({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new Zb({content:i,additional_kwargs:a,name:e.name,response_metadata:o}):s==="tool"?new dA({content:i,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:o}):new Xb({content:i,role:s,response_metadata:o})}}class KA extends qA{get lc_serializable_keys(){return[...super.lc_serializable_keys,"useResponsesApi"]}constructor(e){super(e),Object.defineProperty(this,"fields",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"completions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??!1,this.responses=(e==null?void 0:e.responses)??new Vge(e),this.completions=(e==null?void 0:e.completions)??new Bge(e)}_useResponsesApi(e){var i,a,o,l;const t=(i=e==null?void 0:e.tools)==null?void 0:i.some(WA),r=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null||((a=e==null?void 0:e.reasoning)==null?void 0:a.summary)!=null||((o=this.reasoning)==null?void 0:o.summary)!=null,s=(l=e==null?void 0:e.tools)==null?void 0:l.some(dV);return this.useResponsesApi||t||r||s}getLsParams(e){const t=this._combineCallOptions(e);return this._useResponsesApi(e)?this.responses.getLsParams(t):this.completions.getLsParams(t)}invocationParams(e){const t=this._combineCallOptions(e);return this._useResponsesApi(e)?this.responses.invocationParams(t):this.completions.invocationParams(t)}async _generate(e,t,r){return this._useResponsesApi(t)?this.responses._generate(e,t):this.completions._generate(e,t,r)}async*_streamResponseChunks(e,t,r){if(this._useResponsesApi(t)){yield*this.responses._streamResponseChunks(e,this._combineCallOptions(t),r);return}yield*this.completions._streamResponseChunks(e,this._combineCallOptions(t),r)}withConfig(e){const t=new KA(this.fields);return t.defaultOptions={...this.defaultOptions,...e},t}}class zge extends eV{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),Object.defineProperty(this,"defaultConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verboseParsingErrors=(e==null?void 0:e.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(e==null?void 0:e.responseFormat)??this.responseFormat,this.defaultConfig=(e==null?void 0:e.defaultConfig)??this.defaultConfig,this.metadata=(e==null?void 0:e.metadata)??this.metadata}async invoke(e,t){let r,s=jt(TI(this.defaultConfig,t));return Bm(e)?(r=e.args,s={...s,toolCall:e}):r=e,this.call(r,s)}async call(e,t,r){const s=Bm(e)?e.args:e;let i;if(Wl(this.schema))try{i=await pA(this.schema,s)}catch(_){let b="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(b=`${b}
Details: ${_.message}`),new bI(b,JSON.stringify(e))}else{const _=gn(s,this.schema);if(!_.valid){let b="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(b=`${b}
Details: ${_.errors.map(S=>`${S.keywordLocation}: ${S.error}`).join(`
`)}`),new bI(b,JSON.stringify(e))}i=s}const a=ode(t),o=vs.configure(a.callbacks,this.callbacks,a.tags||r,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),l=await(o==null?void 0:o.handleToolStart(this.toJSON(),typeof e=="string"?e:JSON.stringify(e),a.runId,void 0,void 0,void 0,a.runName));delete a.runId;let u;try{u=await this._call(i,l,a)}catch(_){throw await(l==null?void 0:l.handleToolError(_)),_}let h,f;if(this.responseFormat==="content_and_artifact")if(Array.isArray(u)&&u.length===2)[h,f]=u;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(u)}`);else h=u;let p;Bm(e)&&(p=e.id),!p&&jce(a)&&(p=a.toolCall.id);const y=Gge({content:h,artifact:f,toolCallId:p,name:this.name,metadata:this.metadata});return await(l==null?void 0:l.handleToolEnd(y)),y}}class Qf extends zge{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:eA({input:ZP().optional()}).transform(t=>t.input)})}call(e,t){const r=typeof e=="string"||e==null?{input:e}:e;return super.call(r,t)}}function Gge(n){const{content:e,artifact:t,toolCallId:r,metadata:s}=n;return r&&!Kce(e)?typeof e=="string"||Array.isArray(e)&&e.every(i=>typeof i=="object")?new EI({status:"success",content:e,artifact:t,tool_call_id:r,name:n.name,metadata:s}):new EI({status:"success",content:Wge(e),artifact:t,tool_call_id:r,name:n.name,metadata:s}):e}function Wge(n){try{return JSON.stringify(n,null,2)??""}catch{return`${n}`}}const Hge=!1;function qge(){return console.error(`🚨 SECURITY ERROR: Cannot access OpenAI key directly in production!
You must call your backend API endpoint instead of using the key directly.
See SECURITY.md for implementation details.`),null}function Kge(){return Hge}function Qge(){return!0}const x0={model:"gpt-4o-mini",temperature:.1,streaming:!0,maxTokens:500};function Yge(n={}){if(!n.openaiApiKey)throw new Error("Agent features require a backend API in production. See SECURITY.md for implementation details.");const e=n.openaiApiKey||qge();if(console.log("🔑 Environment check:",{hasConfigKey:!!n.openaiApiKey,isSecureEnv:Kge(),isDev:!1}),!e)throw new Error("OpenAI API key not found. Agent features require a backend API. See SECURITY.md for details.");if(!e.startsWith("sk-"))throw console.error('❌ OpenAI API key format looks incorrect. Expected to start with "sk-"'),console.error("Key starts with:",e.substring(0,10)),new Error('Invalid OpenAI API key format. Key should start with "sk-"');const t={modelName:n.model||x0.model,temperature:n.temperature??x0.temperature,streaming:n.streaming??x0.streaming,maxTokens:x0.maxTokens,apiKey:e,configuration:{baseURL:"https://api.openai.com/v1"}};return console.log("🤖 Initializing LLM:",{model:t.modelName,temperature:t.temperature,streaming:t.streaming,apiKey:"✓ Set ("+e.substring(0,10)+"...)",keyLength:e.length}),new KA(t)}let sT=null;function fV(){return sT||(sT=Yge()),sT}const Jge=`You are a CollabCanvas AI that creates and arranges shapes via JSON commands.

CANVAS INFO:
- Size: 5000×5000px | Types: rectangle, circle | Colors: red, green, blue, yellow, purple, pink, teal, grey
- Defaults: position (300, 300), size 100×100px, color grey, spacing 120px

JSON OUTPUT (required):
{{
  "reasoning": "brief",
  "actions": [{{ "type": "CREATE|MOVE|RESIZE|DELETE|ARRANGE|UPDATE", "shape": "rectangle|circle", "x": num, "y": num, "width": num, "height": num, "fill": "#hex", "shapeId": "id", "shapeIds": ["id1","id2"], "layout": "horizontal|vertical|grid", "spacing": num }}],
  "summary": "what you did"
}}

RULES:
- Use actual shape IDs from context (never "shape1", "shape2")
- Keep positions 0-5000, sizes 20-1000
- Default to x:300, y:300 if no position specified
- For ARRANGE: use real shape IDs

EXAMPLES:
User: "Create red circle"
{{"reasoning":"create circle at default position","actions":[{{"type":"CREATE","shape":"circle","x":300,"y":300,"fill":"#ef4444"}}],"summary":"Created red circle"}}

User: "Create blue rectangle at 500, 600"
{{"reasoning":"create rectangle at specified position","actions":[{{"type":"CREATE","shape":"rectangle","x":500,"y":600,"fill":"#3b82f6"}}],"summary":"Created blue rectangle"}}

User: "Arrange all horizontally"  [Context: shapes "abc123", "def456" exist]
{{"reasoning":"arrange existing","actions":[{{"type":"ARRANGE","shapeIds":["abc123","def456"],"layout":"horizontal","spacing":120}}],"summary":"Arranged 2 shapes horizontally"}}`;function pV(n,e){const t=Jge;let r="";return n.shapes.length===0?r="empty":n.shapes.length<=8?r=n.shapes.map(s=>`"${s.id}"`).join(", "):r=n.shapes.slice(0,8).map(s=>`"${s.id}"`).join(", ")+` +${n.shapes.length-8}more`,t+`

CONTEXT: ${r}`}function mV(){const{shapes:n}=Gt.getState();return{shapes:n.map(e=>({id:e.id,type:e.type,x:e.x,y:e.y,width:e.width,height:e.height,fill:e.fill,text:e.text||"",isLocked:e.isLocked,lockedBy:e.lockedBy||void 0})),canvasWidth:5e3,canvasHeight:5e3}}const Xge=5e3,Zge=5e3,Hw=20,qw=1e3;function QA(n,e,t=100,r=100){return n>=0&&e>=0&&n+t<=Xge&&e+r<=Zge}function gV(n,e){return n>=Hw&&n<=qw&&e>=Hw&&e<=qw}function e_e(n){const e=n.toLowerCase().trim();return e.startsWith("#")?e:{red:"#ef4444",green:"#22c55e",blue:"#3b82f6",yellow:"#f59e0b",purple:"#8b5cf6",pink:"#ec4899",teal:"#14b8a6",grey:"#CCCCCC",gray:"#CCCCCC"}[e]||"#CCCCCC"}class t_e extends Qf{constructor(){super(...arguments);Ct(this,"name","create_shape");Ct(this,"description",`Create a new shape on the canvas. 
    Input should be a JSON string with:
    type (rectangle or circle), x (0-5000), y (0-5000), width (20-1000, optional, default 100), height (20-1000, optional, default 100), fill (color hex or name, optional, default grey), userId (required), displayName (required).
    Returns the ID of the created shape.`)}async _call(t){try{const r=JSON.parse(t),{type:s,x:i,y:a,width:o=100,height:l=100,fill:u="#CCCCCC",userId:h,displayName:f}=r;if(!["rectangle","circle"].includes(s))return JSON.stringify({error:'Invalid shape type. Must be "rectangle" or "circle"'});if(!h||!f)return JSON.stringify({error:"userId and displayName are required"});if(!QA(i,a,o,l))return JSON.stringify({error:"Shape position is out of canvas bounds"});if(!gV(o,l))return JSON.stringify({error:`Size must be between ${Hw} and ${qw}`});const p=e_e(u),y=await zb(i,a,s,p,h,f);return JSON.stringify({success:!0,shapeId:y,message:`Created ${s} at (${i}, ${a})`})}catch(r){return JSON.stringify({error:r instanceof Error?r.message:"Failed to create shape"})}}}class n_e extends Qf{constructor(){super(...arguments);Ct(this,"name","move_shape");Ct(this,"description",`Move a shape to a new position.
    Input should be a JSON string with: shapeId (string), x (0-5000), y (0-5000), userId (required).
    Returns success status.`)}async _call(t){try{const r=JSON.parse(t),{shapeId:s,x:i,y:a,userId:o}=r;if(!s||!o)return JSON.stringify({error:"shapeId and userId are required"});const{shapes:l}=Gt.getState(),u=l.find(h=>h.id===s);return u?QA(i,a,u.width,u.height)?(await ar(s,{x:i,y:a},o),JSON.stringify({success:!0,message:`Moved shape to (${i}, ${a})`})):JSON.stringify({error:"New position is out of canvas bounds"}):JSON.stringify({error:"Shape not found"})}catch(r){return JSON.stringify({error:r instanceof Error?r.message:"Failed to move shape"})}}}class r_e extends Qf{constructor(){super(...arguments);Ct(this,"name","resize_shape");Ct(this,"description",`Resize a shape.
    Input should be a JSON string with: shapeId (string), width (20-1000), height (20-1000), userId (required).
    Returns success status.`)}async _call(t){try{const r=JSON.parse(t),{shapeId:s,width:i,height:a,userId:o}=r;if(!s||!o)return JSON.stringify({error:"shapeId and userId are required"});if(!gV(i,a))return JSON.stringify({error:`Size must be between ${Hw} and ${qw}`});const{shapes:l}=Gt.getState(),u=l.find(h=>h.id===s);return u?QA(u.x,u.y,i,a)?(await ar(s,{width:i,height:a},o),JSON.stringify({success:!0,message:`Resized shape to ${i}×${a}`})):JSON.stringify({error:"New size would exceed canvas bounds"}):JSON.stringify({error:"Shape not found"})}catch(r){return JSON.stringify({error:r instanceof Error?r.message:"Failed to resize shape"})}}}class s_e extends Qf{constructor(){super(...arguments);Ct(this,"name","delete_shape");Ct(this,"description",`Delete a shape from the canvas.
    Input should be a JSON string with: shapeId (string).
    Returns success status.`)}async _call(t){try{const r=JSON.parse(t),{shapeId:s}=r;return s?(await YP(s),JSON.stringify({success:!0,message:"Shape deleted successfully"})):JSON.stringify({error:"shapeId is required"})}catch(r){return JSON.stringify({error:r instanceof Error?r.message:"Failed to delete shape"})}}}class i_e extends Qf{constructor(){super(...arguments);Ct(this,"name","arrange_shapes");Ct(this,"description",`Arrange multiple shapes in a layout pattern.
    Input should be a JSON string with: shapeIds (array of strings), layout (horizontal, vertical, or grid), startX (optional, default 100), startY (optional, default 100), spacing (optional, default 120), userId (required).
    Returns success status with new positions.`)}async _call(t){try{const r=JSON.parse(t),{shapeIds:s,layout:i,startX:a=100,startY:o=100,spacing:l=120,userId:u}=r;if(!s||!Array.isArray(s)||s.length===0)return JSON.stringify({error:"shapeIds array is required and must not be empty"});if(!["horizontal","vertical","grid"].includes(i))return JSON.stringify({error:'layout must be "horizontal", "vertical", or "grid"'});if(!u)return JSON.stringify({error:"userId is required"});const{shapes:h}=Gt.getState(),f=h.filter(y=>s.includes(y.id));if(f.length===0)return JSON.stringify({error:"No valid shapes found with provided IDs"});const p=[];if(i==="horizontal"){let y=a;for(const _ of f)p.push({shapeId:_.id,x:y,y:o}),await ar(_.id,{x:y,y:o},u),y+=l}else if(i==="vertical"){let y=o;for(const _ of f)p.push({shapeId:_.id,x:a,y}),await ar(_.id,{x:a,y},u),y+=l}else if(i==="grid"){const y=Math.ceil(Math.sqrt(f.length));let _=0;for(const b of f){const S=_%y,E=Math.floor(_/y),C=a+S*l,v=o+E*l;p.push({shapeId:b.id,x:C,y:v}),await ar(b.id,{x:C,y:v},u),_++}}return JSON.stringify({success:!0,message:`Arranged ${f.length} shapes in ${i} layout`,updates:p})}catch(r){return JSON.stringify({error:r instanceof Error?r.message:"Failed to arrange shapes"})}}}class a_e extends Qf{constructor(){super(...arguments);Ct(this,"name","get_canvas_state");Ct(this,"description",`Get the current state of the canvas including all shapes and their properties.
    Input: empty string
    Returns: Canvas state with all shapes`)}async _call(t){try{const r=mV();return JSON.stringify({success:!0,state:r})}catch(r){return JSON.stringify({error:r instanceof Error?r.message:"Failed to get canvas state"})}}}new t_e,new n_e,new r_e,new s_e,new i_e,new a_e;function _V(n,e=[]){return{canvasState:mV(),userContext:n,recentMessages:e.slice(-5),timestamp:new Date}}async function o_e(n,e,t=[]){const r=Date.now();try{console.log("⏱️ Starting LLM request...");const s=fV(),i=_V(e,t),a=pV(i.canvasState,e),u=await Mh.fromMessages([["system",a],["human","{input}"]]).pipe(s).invoke({input:n}),h=typeof u.content=="string"?u.content:JSON.stringify(u.content),f=Date.now()-r;return console.log(`✅ LLM responded in ${f}ms`),yV(h)}catch(s){throw console.error("Agent execution error:",s),s instanceof Error?s.message.includes("ERR_NAME_NOT_RESOLVED")?new Error("Cannot reach OpenAI API. Check your internet connection or network firewall."):s.message.includes("fetch")?new Error("Network error connecting to OpenAI. Please check your connection."):new Error(`Agent failed: ${s.message}`):new Error("Unknown agent error")}}function yV(n){try{const e=n.match(/\{[\s\S]*\}/);if(e){const t=JSON.parse(e[0]);return{actions:t.actions||[],summary:t.summary||n,reasoning:t.reasoning}}}catch(e){console.warn("Failed to parse JSON from LLM output:",e)}return{actions:[],summary:n}}async function l_e(n,e,t,r=[]){const s=Date.now();try{console.log("🌊 Starting streaming execution...");const i=fV();console.log(`⏱️ [${Date.now()-s}ms] LLM initialized`);const a=_V(e,r);console.log(`⏱️ [${Date.now()-s}ms] Context built with ${a.canvasState.shapes.length} shapes`);const o=pV(a.canvasState,e);console.log(`⏱️ [${Date.now()-s}ms] System prompt created`);const u=Mh.fromMessages([["system",o],["human","{input}"]]).pipe(i);console.log(`⏱️ [${Date.now()-s}ms] Chain created, starting stream...`);let h="";const f=await u.stream({input:n});console.log(`⏱️ [${Date.now()-s}ms] Stream started, processing chunks...`);for await(const y of f){const _=y.content;typeof _=="string"&&_&&(h+=_,t(_))}console.log(`⏱️ [${Date.now()-s}ms] Streaming complete, parsing response...`),console.log("✅ Streaming complete"),console.log("📝 Full response length:",h.length);const p=yV(h);return console.log(`⏱️ [${Date.now()-s}ms] Response parsed, returning`),p}catch(i){throw console.error("Streaming execution error:",i),i instanceof Error?i.message.includes("ERR_NAME_NOT_RESOLVED")?new Error("Cannot reach OpenAI API. Check your internet connection or network firewall."):i.message.includes("fetch")?new Error("Network error connecting to OpenAI. Please check your connection."):new Error(`Streaming execution failed: ${i.message}`):new Error("Unknown streaming error")}}function u_e(){return""}async function c_e(n){const t=`${u_e()}/api/agent/chat`;try{console.log("Sending agent request to:",t);const r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const i=await r.json().catch(()=>({}));throw new Error(i.message||`API request failed with status ${r.status}`)}return await r.json()}catch(r){return console.error("Agent API error:",r),{success:!1,message:"Failed to communicate with agent service",error:r instanceof Error?r.message:"Unknown error"}}}async function vV(n,e,t=[]){var r,s,i,a,o,l,u,h;console.log("🌐 Executing command via backend API");try{const f={shapes:((r=e.canvasState)==null?void 0:r.shapes)||[],selectedShapes:((s=e.canvasState)==null?void 0:s.selectedShapeIds)||[],viewport:{x:((a=(i=e.canvasState)==null?void 0:i.viewport)==null?void 0:a.x)||0,y:((l=(o=e.canvasState)==null?void 0:o.viewport)==null?void 0:l.y)||0,scale:((h=(u=e.canvasState)==null?void 0:u.viewport)==null?void 0:h.scale)||1}},p=await c_e({message:n,canvasContext:f,userId:e.userId});if(!p.success)throw new Error(p.error||p.message);const y={actions:p.action?[p.action.properties]:[],summary:p.message};return console.log("✅ Backend response received:",y),y}catch(f){return console.error("❌ Backend executor error:",f),{actions:[],summary:f instanceof Error?`Error: ${f.message}`:"An unknown error occurred"}}}async function d_e(n,e,t,r=[]){console.log("ℹ️ Streaming not yet supported via backend, using standard execution");const s=await vV(n,e,r);return t(s.summary),s}async function h_e(n,e,t){const r=new Promise((s,i)=>{setTimeout(()=>{i(new Error(`Action ${t} timed out after ${e}ms - possible Firebase connection issue`))},e)});return Promise.race([n,r])}async function f_e(n,e){const t=[];let r=0,s=0;console.log(`🤖 Executing ${n.actions.length} actions from agent`);for(const a of n.actions)try{const o=await h_e(p_e(a,e),1e4,a.type);t.push(o),o.success?(r++,console.log(`✅ Action ${a.type} succeeded:`,o.message)):(s++,console.error(`❌ Action ${a.type} failed:`,o.error))}catch(o){const l=o instanceof Error?o.message:"Unknown error";console.error("❌ Action execution failed:",o),t.push({success:!1,action:a,error:l}),s++}const i=s===0&&r>0;return console.log(`✅ Execution complete: ${r} succeeded, ${s} failed`),{overallSuccess:i,results:t,successCount:r,failureCount:s,totalActions:n.actions.length}}async function p_e(n,e){switch(console.log(`🔨 Executing ${n.type} action:`,JSON.stringify(n,null,2)),n.type){case"CREATE":return await m_e(n,e);case"MOVE":return await g_e(n,e);case"RESIZE":return await __e(n,e);case"DELETE":return await y_e(n);case"ARRANGE":return await v_e(n,e);case"UPDATE":return await w_e(n,e);default:return{success:!1,action:n,error:`Unknown action type: ${n.type}`}}}async function m_e(n,e){if(!n.shape||!["rectangle","circle"].includes(n.shape))return{success:!1,action:n,error:"Invalid or missing shape type"};if(typeof n.x!="number"||typeof n.y!="number")return{success:!1,action:n,error:"Invalid or missing position"};const t=n.width||100,r=n.height||100,s=n.fill||"#CCCCCC";if(n.x<0||n.y<0||n.x+t>5e3||n.y+r>5e3)return{success:!1,action:n,error:"Shape position exceeds canvas bounds"};try{console.log("📝 Calling createShape with:",{x:n.x,y:n.y,type:n.shape,fill:s,userId:e.userId,displayName:e.displayName});const i=await zb(n.x,n.y,n.shape,s,e.userId,e.displayName);console.log(`✅ createShape returned shapeId: ${i}`);try{await ar(i,{isLocked:!0,lockedBy:e.userId,lockedByName:e.displayName,lockedByColor:e.cursorColor},e.userId),console.log("✅ Shape locked for user")}catch(a){console.warn("⚠️ Could not lock shape:",a)}if(n.width!==void 0||n.height!==void 0)try{console.log(`📝 Updating size to ${t}×${r}`),await ar(i,{width:t,height:r},e.userId),console.log("✅ Size updated")}catch(a){console.warn("⚠️ Size update failed (shape created with default size):",a)}if(n.text)try{console.log(`📝 Adding text: ${n.text}`),await ar(i,{text:n.text},e.userId),console.log("✅ Text added")}catch(a){console.warn("⚠️ Text update failed:",a)}return console.log(`✅ Created ${n.shape}: ${i}`),{success:!0,action:n,shapeId:i,message:`Created ${n.shape} at (${n.x}, ${n.y})`}}catch(i){return console.error("❌ CREATE failed with error:",i),{success:!1,action:n,error:i instanceof Error?i.message:"Create failed"}}}async function g_e(n,e){if(!n.shapeId)return{success:!1,action:n,error:"Missing shapeId"};if(typeof n.x!="number"||typeof n.y!="number")return{success:!1,action:n,error:"Invalid or missing position"};const{shapes:t}=Gt.getState(),r=t.find(s=>s.id===n.shapeId);if(!r)return{success:!1,action:n,error:"Shape not found"};if(n.x<0||n.y<0||n.x+r.width>5e3||n.y+r.height>5e3)return{success:!1,action:n,error:"New position exceeds canvas bounds"};try{return await ar(n.shapeId,{x:n.x,y:n.y},e.userId),console.log(`✅ Moved shape ${n.shapeId.slice(-8)} to (${n.x}, ${n.y})`),{success:!0,action:n,message:`Moved shape to (${n.x}, ${n.y})`}}catch(s){return{success:!1,action:n,error:s instanceof Error?s.message:"Move failed"}}}async function __e(n,e){if(!n.shapeId)return{success:!1,action:n,error:"Missing shapeId"};if(typeof n.width!="number"||typeof n.height!="number")return{success:!1,action:n,error:"Invalid or missing dimensions"};if(n.width<20||n.width>1e3||n.height<20||n.height>1e3)return{success:!1,action:n,error:"Size must be between 20 and 1000 pixels"};const{shapes:t}=Gt.getState(),r=t.find(s=>s.id===n.shapeId);if(!r)return{success:!1,action:n,error:"Shape not found"};if(r.x+n.width>5e3||r.y+n.height>5e3)return{success:!1,action:n,error:"New size would exceed canvas bounds"};try{return await ar(n.shapeId,{width:n.width,height:n.height},e.userId),console.log(`✅ Resized shape ${n.shapeId.slice(-8)} to ${n.width}×${n.height}`),{success:!0,action:n,message:`Resized shape to ${n.width}×${n.height}`}}catch(s){return{success:!1,action:n,error:s instanceof Error?s.message:"Resize failed"}}}async function y_e(n){if(!n.shapeId)return{success:!1,action:n,error:"Missing shapeId"};try{return await YP(n.shapeId),console.log(`✅ Deleted shape ${n.shapeId.slice(-8)}`),{success:!0,action:n,message:"Shape deleted successfully"}}catch(e){return{success:!1,action:n,error:e instanceof Error?e.message:"Delete failed"}}}async function v_e(n,e){if(!Array.isArray(n.shapeIds)||n.shapeIds.length===0)return{success:!1,action:n,error:"Missing or empty shapeIds array"};if(!n.layout||!["horizontal","vertical","grid"].includes(n.layout))return{success:!1,action:n,error:"Invalid or missing layout type"};const t=n.x||100,r=n.y||100,s=n.spacing||120,{shapes:i}=Gt.getState(),a=i.filter(o=>n.shapeIds.includes(o.id));if(a.length===0)return{success:!1,action:n,error:"No valid shapes found with provided IDs"};try{if(n.layout==="horizontal"){let o=t;for(const l of a)await ar(l.id,{x:o,y:r},e.userId),o+=s}else if(n.layout==="vertical"){let o=r;for(const l of a)await ar(l.id,{x:t,y:o},e.userId),o+=s}else if(n.layout==="grid"){const o=Math.ceil(Math.sqrt(a.length));let l=0;for(const u of a){const h=l%o,f=Math.floor(l/o),p=t+h*s,y=r+f*s;await ar(u.id,{x:p,y},e.userId),l++}}return console.log(`✅ Arranged ${a.length} shapes in ${n.layout} layout`),{success:!0,action:n,message:`Arranged ${a.length} shapes in ${n.layout} layout`}}catch(o){return{success:!1,action:n,error:o instanceof Error?o.message:"Arrange failed"}}}async function w_e(n,e){if(!n.shapeId)return{success:!1,action:n,error:"Missing shapeId"};const t={};if(n.fill!==void 0&&(t.fill=n.fill),n.text!==void 0&&(t.text=n.text),n.x!==void 0&&(t.x=n.x),n.y!==void 0&&(t.y=n.y),n.width!==void 0&&(t.width=n.width),n.height!==void 0&&(t.height=n.height),Object.keys(t).length===0)return{success:!1,action:n,error:"No properties to update"};try{return await ar(n.shapeId,t,e.userId),console.log(`✅ Updated shape ${n.shapeId.slice(-8)}:`,t),{success:!0,action:n,message:"Updated shape properties"}}catch(r){return{success:!1,action:n,error:r instanceof Error?r.message:"Update failed"}}}function b_e(n){const{userContext:e,onSuccess:t,onError:r,maxHistoryLength:s=50,enableStreaming:i=!0}=n,[a,o]=Y.useState([]),[l,u]=Y.useState(!1),[h,f]=Y.useState(!1),[p,y]=Y.useState(""),[_,b]=Y.useState(null),[S,E]=Y.useState(null),[C,v]=Y.useState(null),I=Y.useRef(null),L=Y.useRef(null),R=Y.useCallback(()=>{console.log("🛑 Canceling current command..."),L.current&&(L.current.abort(),L.current=null),u(!1),f(!1),y(""),b(null),console.log("✅ Command canceled and state reset"),console.log("   isProcessing should now be: false")},[]),P=Y.useCallback((D,F)=>{const $={role:D,content:F,timestamp:new Date};o(H=>{const G=[...H,$];return G.length>s?G.slice(-s):G})},[s]),x=Y.useCallback(async D=>{if(D.trim()){I.current=D,L.current=new AbortController,b(null),y(""),u(!0),P("user",D);try{const F=a.slice(-10);console.log("🤖 Sending command to agent:",D);const $=Qge();console.log(`📡 Using ${$?"backend API":"local LLM"}`);let H;if(i){f(!0);const ae=new Promise((z,Q)=>{setTimeout(()=>Q(new Error("Request timed out after 30 seconds")),3e4)});H=await Promise.race([$?d_e(D,e,z=>{y(Q=>Q+z)},F):l_e(D,e,z=>{y(Q=>Q+z)},F),ae]),f(!1)}else{const ae=new Promise((z,Q)=>{setTimeout(()=>Q(new Error("Request timed out after 30 seconds")),3e4)});H=await Promise.race([$?vV(D,e,F):o_e(D,e,F),ae])}console.log("✅ Agent response received:",H),E(H),y(""),console.log("🔨 Executing actions...");const G=Date.now(),ue=await f_e(H,e);if(console.log(`✅ Execution completed in ${Date.now()-G}ms`),console.log("✅ Execution result:",ue),v(ue),console.log("💬 Adding assistant message:",H.summary),P("assistant",H.summary),console.log("✅ Message added to history"),t&&t(H,ue),ue.failureCount>0){const ae=`Note: ${ue.failureCount} of ${ue.totalActions} actions failed to execute.`;P("assistant",ae)}}catch(F){if(F instanceof Error&&F.name==="AbortError"){console.log("⏹️ Command was canceled by user");return}const $=F instanceof Error?F.message:"Unknown error occurred";console.error("❌ Agent error:",F),b($),P("assistant",`Sorry, I encountered an error: ${$}`),r&&F instanceof Error&&r(F)}finally{console.log("🏁 Cleaning up: setting isProcessing to false"),L.current=null,u(!1),f(!1),y(""),b(null),console.log("✅ Agent command flow complete - UI should be ready for next command")}}},[a,e,P,t,r,i]),N=Y.useCallback(async()=>{I.current&&await x(I.current)},[x]),M=Y.useCallback(()=>{o([]),b(null),E(null),v(null),I.current=null},[]);return{messages:a,isProcessing:l,isStreaming:h,streamingText:p,error:_,sendCommand:x,clearHistory:M,retryLastCommand:N,cancelCurrentCommand:R,lastResponse:S,lastExecutionResult:C}}function E_e(){return["Create a red circle at 200, 300","Make a login form","Create a 3x3 grid of shapes","Arrange all shapes horizontally","Create a navigation bar","Make a blue rectangle","Create a color palette","Design a card layout"]}const wV=()=>{const{setUser:n,setLoading:e,setError:t,clearUser:r}=wu();return Y.useEffect(()=>{const s=nq(nf,async i=>{try{if(i){const a=hae(i);n(a,i),console.log("🔥 User authenticated:",a.displayName),await h$(a)}else r(),console.log("🔥 User signed out")}catch(a){console.error("Auth state change error:",a),t("Authentication error occurred")}finally{e(!1)}},i=>{console.error("Auth state observer error:",i),t("Failed to initialize authentication"),e(!1)});return()=>s()},[n,e,t,r]),wu()};function S_e({message:n,isUser:e,userName:t}){const r=s=>s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return V.jsx("div",{className:`flex ${e?"justify-end":"justify-start"}`,children:V.jsxs("div",{className:`max-w-[80%] ${e?"order-2":"order-1"}`,children:[V.jsxs("div",{className:`flex items-center gap-2 mb-1 text-xs text-gray-500 ${e?"justify-end":"justify-start"}`,children:[V.jsx("span",{className:"font-medium",children:t}),V.jsx("span",{children:r(n.timestamp)})]}),V.jsx("div",{className:`px-4 py-2 rounded-lg ${e?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"}`,children:V.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:n.content})})]})})}function T_e({isOpen:n,onClose:e}){const{user:t}=wV(),[r,s]=Y.useState(""),i=Y.useRef(null),a=Y.useRef(null),o=E_e(),[l,u]=Y.useState(!0),h=t?{userId:t.uid,displayName:t.displayName,cursorColor:t.cursorColor}:null,{messages:f,isProcessing:p,isStreaming:y,streamingText:_,error:b,sendCommand:S,cancelCurrentCommand:E,lastExecutionResult:C}=b_e({userContext:h,enableStreaming:!0,onSuccess:(R,P)=>{console.log("✅ Command executed successfully:",P)},onError:R=>{console.error("❌ Command failed:",R)}});Y.useEffect(()=>{var R;(R=i.current)==null||R.scrollIntoView({behavior:"smooth"})},[f,_]),Y.useEffect(()=>{p||setTimeout(()=>{var R;(R=i.current)==null||R.scrollIntoView({behavior:"smooth"})},100)},[p]),Y.useEffect(()=>{console.log("🔄 Component state changed - isProcessing:",p)},[p]),Y.useEffect(()=>{var R;n&&((R=a.current)==null||R.focus(),p&&(console.log("⚠️ Chat reopened while processing - canceling any stuck state"),E()))},[n,p,E]);const v=async R=>{if(R.preventDefault(),console.log("📝 Form submit - Current state:",{isProcessing:p,inputValue:r.trim(),hasUserContext:!!h}),!r.trim()||!h){console.log("⚠️ Submit blocked:",r.trim()?"no user context":"empty input");return}const P=r.trim();s(""),u(!1),await S(P)},I=R=>{var P;s(R),(P=a.current)==null||P.focus()},L=()=>{E(),e()};return n?t?V.jsxs("div",{className:"fixed bottom-4 right-4 w-96 h-[32rem] bg-white rounded-lg shadow-2xl border border-gray-200 flex flex-col",children:[V.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[V.jsxs("div",{className:"flex items-center gap-2",children:[V.jsx("div",{className:`w-2 h-2 rounded-full ${p?"bg-yellow-500 animate-pulse":"bg-green-500"}`}),V.jsx("h3",{className:"font-semibold text-gray-800",children:"AI Canvas Agent"}),!1,!1]}),V.jsx("div",{className:"flex items-center gap-2",children:V.jsx("button",{onClick:L,className:"text-gray-500 hover:text-gray-700","aria-label":"Close chat",children:V.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]}),V.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[f.length===0&&V.jsxs("div",{className:"text-center py-8",children:[V.jsx("div",{className:"mb-4",children:V.jsx("span",{className:"text-4xl",children:"🤖"})}),V.jsxs("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:["Hi ",t.displayName,"!"]}),V.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"I can help you create and arrange shapes on the canvas."}),l&&V.jsxs("div",{className:"space-y-2",children:[V.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Try these commands:"}),o.slice(0,4).map((R,P)=>V.jsx("button",{onClick:()=>I(R),className:"block w-full text-left px-3 py-2 text-xs bg-gray-50 hover:bg-gray-100 rounded-md text-gray-700 transition-colors",children:R},P))]})]}),f.map((R,P)=>V.jsx(S_e,{message:R,isUser:R.role==="user",userName:R.role==="user"?t.displayName:"AI Agent"},P)),y&&_&&V.jsxs("div",{className:"max-w-[80%]",children:[V.jsxs("div",{className:"flex items-center gap-2 mb-1 text-xs text-gray-500",children:[V.jsx("span",{className:"font-medium",children:"AI Agent"}),V.jsxs("span",{className:"flex gap-1",children:[V.jsx("div",{className:"w-1 h-1 bg-blue-500 rounded-full animate-pulse"}),V.jsx("div",{className:"w-1 h-1 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),V.jsx("div",{className:"w-1 h-1 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]})]}),V.jsx("div",{className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-800",children:V.jsxs("p",{className:"text-sm whitespace-pre-wrap break-words",children:[_,V.jsx("span",{className:"inline-block w-2 h-4 ml-1 bg-blue-500 animate-pulse"})]})})]}),p&&!y&&!_&&V.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[V.jsxs("div",{className:"flex gap-1",children:[V.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),V.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),V.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),V.jsx("span",{children:"Thinking..."})]}),b&&V.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md text-sm text-red-700",children:[V.jsx("strong",{children:"Error:"})," ",b]}),C&&C.failureCount>0&&V.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-md text-xs text-yellow-800",children:["⚠️ ",C.successCount," succeeded, ",C.failureCount," failed"]}),V.jsx("div",{ref:i})]}),V.jsxs("form",{onSubmit:v,className:"p-4 border-t border-gray-200",children:[V.jsxs("div",{className:"flex gap-2",children:[V.jsx("input",{ref:a,type:"text",value:r,onChange:R=>s(R.target.value),placeholder:"Ask me to create shapes...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",disabled:p}),V.jsx("button",{type:"submit",disabled:!r.trim()||p,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors text-sm font-medium",children:"Send"})]}),!l&&f.length>0&&V.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:o.slice(0,3).map((R,P)=>V.jsx("button",{type:"button",onClick:()=>I(R),className:"px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded text-gray-600 transition-colors",children:R},P))})]})]}):V.jsx("div",{className:"fixed bottom-4 right-4 w-96 h-[32rem] bg-white rounded-lg shadow-2xl border border-gray-200 flex items-center justify-center p-6",children:V.jsx("p",{className:"text-gray-500",children:"Please log in to use the AI agent"})}):null}const iT=5e3,aT=5e3,C_e=({width:n,height:e})=>{const t=Y.useRef(null),[r,s]=Y.useState(!1),[i,a]=Y.useState(!1),[o,l]=Y.useState(!1),{user:u}=wu(),{updateCursor:h}=vae(u),{handleWheel:f,handleTouchStart:p,handleTouchMove:y}=bae(t,a);Lae(),Dae();const _=Y.useCallback(async()=>{if(!u)return;const{shapes:ve,deleteShape:de}=Gt.getState(),Me=ve.filter(Z=>Z.lockedBy===u.uid);if(Me.length===0){console.log("No shapes selected for deletion");return}console.log(`🗑️ Deleting ${Me.length} selected shapes`),Me.forEach(Z=>{de(Z.id),console.log(`⚡ Instantly deleted: ${Z.id}`)});const B=Me.map(async Z=>{try{await YP(Z.id),console.log(`🗑️ Deletion synced to Firestore: ${Z.id}`)}catch(be){console.error(`Deletion sync failed for ${Z.id}:`,be);const{addShape:Ce}=Gt.getState();Ce(Z),console.log(`🔄 Restored shape after sync failure: ${Z.id}`)}});await Promise.all(B)},[u]);Y.useEffect(()=>{const ve=B=>{if((B.key==="Delete"||B.key==="Backspace")&&!B.repeat){const Z=B.target;if(Z.tagName==="INPUT"||Z.tagName==="TEXTAREA"||Z.isContentEditable)return;B.preventDefault(),_();return}if(B.code==="Space"&&!B.repeat&&!r){const Z=B.target;if(Z.tagName==="INPUT"||Z.tagName==="TEXTAREA"||Z.isContentEditable)return;B.preventDefault(),B.stopPropagation(),s(!0),document.body.style.overflow="hidden";const be=t.current;be&&(be.find("Rect").forEach(Ce=>Ce.draggable(!1)),be.draggable(!0)),console.log("⌨️ Space pressed - panning mode enabled")}},de=B=>{if(B.code==="Space"){B.preventDefault(),B.stopPropagation(),s(!1),document.body.style.overflow="auto";const Z=t.current;Z&&(Z.draggable(!1),Z.find("Rect").forEach(be=>{const Ce=be.id(),{shapes:Le}=Gt.getState(),et=Le.find(cn=>cn.id===Ce),ht=(et==null?void 0:et.isLocked)&&(et==null?void 0:et.lockedBy)!==(u==null?void 0:u.uid);be.draggable(!ht&&!!u)})),console.log("⌨️ Space released - panning mode disabled")}},Me=()=>{s(!1),document.body.style.overflow="auto";const B=t.current;B&&B.draggable(!1),console.log("🪟 Window blur - reset panning state")};return window.addEventListener("keydown",ve),window.addEventListener("keyup",de),window.addEventListener("blur",Me),()=>{document.body.style.overflow="auto",Q.current&&clearTimeout(Q.current),window.removeEventListener("keydown",ve),window.removeEventListener("keyup",de),window.removeEventListener("blur",Me)}},[r,u,_]);const b=Y.useCallback(ve=>{const de=n-iT,Me=e-aT;return{x:Math.max(de,Math.min(0,ve.x)),y:Math.max(Me,Math.min(0,ve.y))}},[n,e]),[S,E]=Y.useState("rectangle"),[C,v]=Y.useState("#CCCCCC"),[I,L]=Y.useState("#9333ea"),[R,P]=Y.useState(!1),[x,N]=Y.useState(null),[M,D]=Y.useState("rectangle"),[F,$]=Y.useState("#CCCCCC"),H=Y.useCallback(ve=>{if(P(!0),E(ve),x||D(ve),u){const{shapes:de,updateShapeOptimistic:Me}=Gt.getState(),B=de.filter(Z=>Z.lockedBy===u.uid);B.length>0&&(B.forEach(Z=>{Me(Z.id,{type:ve,isLocked:!0,lockedBy:u.uid,lockedByName:u.displayName,lockedByColor:u.cursorColor})}),Promise.all(B.map(Z=>ar(Z.id,{type:ve},u.uid))))}setTimeout(()=>P(!1),100)},[x,u]),G=Y.useCallback(ve=>{if(console.log("handleColorChange called with:",ve,"lastSelectedShapeId:",x),P(!0),v(ve),u){const{shapes:de,updateShapeOptimistic:Me}=Gt.getState(),B=de.filter(Z=>Z.lockedBy===u.uid);console.log("My selected shapes:",B.length),B.length>0&&(B.forEach(Z=>{console.log("Updating shape",Z.id,"to color",ve),Me(Z.id,{fill:ve,isLocked:!0,lockedBy:u.uid,lockedByName:u.displayName,lockedByColor:u.cursorColor})}),Promise.all(B.map(Z=>ar(Z.id,{fill:ve},u.uid)))),$(ve)}setTimeout(()=>{P(!1)},100)},[u,x]),ue=["#ef4444","#22c55e","#3b82f6","#CCCCCC"],{shapes:ae}=Gt();Y.useEffect(()=>{if(u){const ve=ae.filter(de=>de.lockedBy===u.uid);if(ve.length===1){const de=ve[0];de.id!==x&&(N(de.id),de.fill!==C&&(v(de.fill),ue.includes(de.fill.toLowerCase())||L(de.fill)),de.type!==S&&E(de.type))}else ve.length===0&&x&&(N(null),C!==F&&v(F),S!==M&&E(M))}},[ae,u,C,S,x,F,M]),Y.useEffect(()=>{const ve=de=>{if(!(de.target instanceof HTMLInputElement||de.target instanceof HTMLTextAreaElement))switch(de.key.toLowerCase()){case"r":H("rectangle");break;case"c":H("circle");break;case"1":G("#ef4444");break;case"2":G("#22c55e");break;case"3":G("#3b82f6");break;case"4":G("#CCCCCC");break;case"5":G(I);break}};return window.addEventListener("keydown",ve),()=>window.removeEventListener("keydown",ve)},[G,H,I]);const z=Y.useRef(0),Q=Y.useRef(null),ee=Y.useRef(new Set),se=Y.useRef(!1),le=Y.useCallback(async ve=>{if(se.current){se.current=!1;return}const de=ve.target.getType(),Me=ve.target.name?ve.target.name():"";if(!(de==="Stage"||Me==="background-rect")||r||!u||R)return;const{shapes:Z,addShape:be,updateShapeOptimistic:Ce}=Gt.getState(),Le=Z.filter(Is=>Is.lockedBy===u.uid);if(Le.length>0){Le.forEach(Is=>{Ce(Is.id,{isLocked:!1,lockedBy:null,lockedByName:null,lockedByColor:null})}),Promise.all(Le.map(Is=>Z0(Is.id,u.uid,u.displayName))),console.log(`🔓 Deselected ${Le.length} shapes (no creation)`);return}const et=Date.now();if(et-z.current<100)return;z.current=et;const cn=t.current.getRelativePointerPosition(),ot=`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,Gn=Math.max(0,Math.min(iT-100,cn.x)),Wn=Math.max(0,Math.min(aT-100,cn.y)),Ir={id:ot,type:M,x:Gn,y:Wn,width:100,height:100,fill:F,text:"",textColor:"#000000",fontSize:14,createdBy:u.uid,createdAt:new Date,lastModifiedBy:u.uid,lastModifiedAt:new Date,isLocked:!1,lockedBy:null,lockedByName:null,lockedByColor:null};be(Ir),ee.current.add(ot),console.log(`🚀 Created shape instantly: ${ot} at (${Gn}, ${Wn})`),Q.current&&clearTimeout(Q.current),Q.current=setTimeout(async()=>{const Is=Array.from(ee.current);ee.current.clear();const we=Is.map(async xs=>{const Pe=Gt.getState().shapes.find($e=>$e.id===xs);if(Pe)try{const $e=await zb(Pe.x,Pe.y,Pe.type,Pe.fill,u.uid,u.displayName),{updateShapeOptimistic:Se}=Gt.getState();Se(xs,{id:$e})}catch($e){console.error(`Failed to sync shape ${xs}:`,$e);const{deleteShape:Se}=Gt.getState();Se(xs)}});await Promise.allSettled(we)},50)},[r,u,R]),ye=Y.useCallback(ve=>{if(i||r)return;const de=wae(ve.evt,t);de&&u&&h(de.x,de.y)},[h,u,i,r]);return V.jsxs("div",{className:`relative overflow-hidden bg-white border border-gray-300 rounded-lg shadow-sm ${r?"cursor-grab":"cursor-default"}`,onWheel:ve=>ve.preventDefault(),onTouchMove:ve=>ve.preventDefault(),style:{touchAction:"none"},children:[V.jsx(aoe,{currentShapeType:S,onShapeTypeChange:H,currentColor:C,onColorChange:G,customColor:I,onCustomColorChange:L}),!1,V.jsxs($ie,{ref:t,width:n,height:e,draggable:!1,dragBoundFunc:r?b:void 0,onWheel:f,onTouchStart:p,onTouchMove:y,onClick:le,onTap:le,onMouseMove:ye,children:[V.jsx(Fae,{width:iT,height:aT,listening:!1}),V.jsx(jae,{listening:!0,isDragSelectingRef:se}),V.jsx(Uae,{listening:!1}),V.jsx(Vae,{})]}),V.jsxs("div",{className:"absolute top-2 right-2 text-xs text-gray-500 bg-white px-2 py-1 rounded shadow",children:["Scale: ",t.current?(t.current.scaleX()*100).toFixed(0):"100","%"]}),r&&V.jsx("div",{className:"absolute bottom-2 left-2 text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded shadow",children:"Space + Drag to Pan"}),!o&&V.jsx("button",{onClick:()=>l(!0),className:"fixed bottom-4 right-4 w-14 h-14 bg-blue-500 hover:bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center transition-colors",title:"Open AI Agent Chat","aria-label":"Open AI Agent Chat",children:V.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})}),V.jsx(T_e,{isOpen:o,onClose:()=>l(!1)})]})},I_e=async()=>{try{console.log("🧹 Clearing all locks...");const n=rd(Cn,"canvas/global-canvas-v1/shapes"),e=await f_(n),t=e.docs.filter(s=>s.data().isLocked===!0);if(console.log(`Found ${t.length} locked shapes out of ${e.docs.length} total shapes`),t.length===0)return console.log("✅ No locks to clear!"),{success:!0,clearedCount:0};const r=t.map(async s=>{const i=eo(Cn,"canvas/global-canvas-v1/shapes",s.id),a=s.data();await ZD(i,{isLocked:!1,lockedBy:null,lockedByName:null,lockedByColor:null}),console.log(`🔓 Cleared lock for shape: ${s.id} (was locked by: ${a.lockedByName||"unknown"})`)});return await Promise.all(r),console.log(`✅ Cleared ${t.length} locks successfully!`),{success:!0,clearedCount:t.length}}catch(n){return console.error("❌ Error clearing locks:",n),{success:!1,error:n}}},x_e=async()=>{try{console.log("🗑️ Clearing all shapes...");const n=rd(Cn,"canvas/global-canvas-v1/shapes"),e=await f_(n),t=e.docs.map(async r=>{const s=eo(Cn,"canvas/global-canvas-v1/shapes",r.id);await e7(s),console.log(`🗑️ Deleted shape: ${r.id}`)});return await Promise.all(t),console.log(`✅ Deleted ${e.docs.length} shapes successfully!`),{success:!0,deletedCount:e.docs.length}}catch(n){return console.error("❌ Error clearing shapes:",n),{success:!1,error:n}}},k_e=()=>{const{user:n,isAuthenticated:e}=wu(),[t,r]=Y.useState(!1),[s,i]=Y.useState(!1),[a,o]=Y.useState(10),[l,u]=Y.useState(!1),h=async()=>{try{if(n){const{cleanupPresence:_}=await Fm(async()=>{const{cleanupPresence:b}=await Promise.resolve().then(()=>yae);return{cleanupPresence:b}},void 0);await _(n.uid),console.log("🔴 Presence cleaned up before logout")}await rq(nf),console.log("🚪 User signed out successfully")}catch(_){console.error("Error signing out:",_)}},f=async()=>{if(confirm("⚠️ This will delete ALL shapes permanently. Are you sure?")){i(!0);try{const _=await x_e();_.success?alert(`✅ Successfully deleted ${_.deletedCount} shapes!`):alert(`❌ Failed to clear shapes: ${_.error}`)}catch(_){alert(`❌ Error: ${_}`)}i(!1),r(!1)}},p=async()=>{i(!0);try{const _=await I_e();_.success?alert(`✅ Successfully cleared ${_.clearedCount} locks!`):alert(`❌ Failed to clear locks: ${_.error}`)}catch(_){alert(`❌ Error: ${_}`)}i(!1),r(!1)},y=async()=>{if(!(!n||l)){u(!0),console.log(`🎨 Creating ${a} random shapes...`);try{const _=["rectangle","circle"],b=["#4477AA","#EE6677","#228833","#CCBB44","#66CCEE","#AA3377"],S=[];for(let E=0;E<a;E++){const C=Math.random()*4800+100,v=Math.random()*4800+100,I=_[Math.floor(Math.random()*_.length)],L=b[Math.floor(Math.random()*b.length)];S.push(zb(C,v,I,L,n.uid,n.displayName))}await Promise.all(S),console.log(`✅ Created ${a} shapes successfully`),alert(`✅ Created ${a} shapes!`)}catch(_){console.error("Failed to create shapes:",_),alert("❌ Failed to create shapes. Check console for details.")}finally{u(!1),r(!1)}}};return e?V.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 py-3 flex justify-between items-center",children:[V.jsxs("div",{className:"flex items-center space-x-4",children:[V.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"CollabCanvas"}),V.jsx("div",{className:"text-sm text-gray-500",children:"Real-Time Collaborative Design Tool"})]}),V.jsxs("div",{className:"flex items-center space-x-4",children:[V.jsxs("div",{className:"flex items-center space-x-2",children:[V.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:n==null?void 0:n.cursorColor}}),V.jsx("span",{className:"text-sm font-medium text-gray-700",children:n==null?void 0:n.displayName})]}),V.jsxs("div",{className:"relative",children:[V.jsx("button",{onClick:()=>r(!t),className:"text-xs text-gray-400 hover:text-red-600 px-2 py-1 rounded border border-gray-200 hover:border-red-300",title:"Admin Panel",children:"🛠️"}),t&&V.jsxs("div",{className:"absolute right-0 top-8 bg-white border border-gray-300 rounded shadow-lg p-3 z-50 min-w-[250px]",children:[V.jsx("div",{className:"text-xs font-medium text-gray-600 mb-3",children:"🛠️ Admin Panel"}),V.jsxs("div",{className:"mb-3 pb-3 border-b border-gray-200",children:[V.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Create Random Shapes"}),V.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[V.jsx("input",{type:"number",min:"1",max:"500",value:a,onChange:_=>o(parseInt(_.target.value)||1),className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",disabled:l}),V.jsx("button",{onClick:y,disabled:l,className:"flex-1 text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Creating...":"🎨 Create"})]}),V.jsx("div",{className:"text-[10px] text-gray-500",children:"Random rects & circles"})]}),V.jsx("button",{onClick:p,disabled:s||l,className:"w-full text-left text-xs text-blue-600 hover:text-blue-800 px-2 py-1 rounded hover:bg-blue-50 disabled:opacity-50 mb-1",children:"🔓 Clear All Locks"}),V.jsx("button",{onClick:f,disabled:s||l,className:"w-full text-left text-xs text-red-600 hover:text-red-800 px-2 py-1 rounded hover:bg-red-50 disabled:opacity-50",children:"🗑️ Delete All Shapes"}),(s||l)&&V.jsx("div",{className:"text-xs text-gray-500 mt-2 text-center",children:"Working..."})]})]}),V.jsx("button",{onClick:h,className:"text-sm text-gray-500 hover:text-gray-700 px-3 py-1 rounded border border-gray-300 hover:border-gray-400",children:"Sign Out"})]})]}):null},P_e=({children:n,fallback:e})=>{const{isAuthenticated:t,isLoading:r,error:s}=wV();return r?V.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:V.jsx("div",{className:"bg-white rounded-lg shadow-md p-8",children:V.jsxs("div",{className:"text-center",children:[V.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),V.jsx("p",{className:"text-gray-600",children:"Checking authentication..."})]})})}):s?V.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:V.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md",children:[V.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Authentication Error"}),V.jsx("p",{className:"text-gray-700 mb-4",children:"Firebase authentication error:"}),V.jsx("p",{className:"text-sm text-red-600 bg-red-50 p-3 rounded mb-4",children:s}),V.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700",children:"Reload Page"})]})}):t?V.jsx(V.Fragment,{children:n}):V.jsx(V.Fragment,{children:e})};class w6 extends Y.Component{constructor(t){super(t);Ct(this,"handleReload",()=>{window.location.reload()});Ct(this,"handleRetry",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){console.error("🚨 React Error Boundary caught an error:",t),console.error("Error Info:",r),this.setState({error:t,errorInfo:r})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:V.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:V.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:V.jsxs("div",{className:"text-center",children:[V.jsx("div",{className:"text-6xl mb-4",children:"🚨"}),V.jsx("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Something went wrong"}),V.jsx("p",{className:"text-gray-600 mb-6",children:"The canvas encountered an unexpected error. This shouldn't happen often."}),V.jsxs("div",{className:"space-y-3",children:[V.jsx("button",{onClick:this.handleRetry,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"}),V.jsx("button",{onClick:this.handleReload,className:"w-full bg-gray-200 text-gray-900 px-4 py-2 rounded-md hover:bg-gray-300 transition-colors",children:"Reload Page"})]}),!1]})})}):this.props.children}}const A_e=()=>{const[n,e]=Y.useState({isOnline:!0,isConnecting:!1,lastConnected:null});return Y.useEffect(()=>{const t=IP(),r=el(t,".info/connected"),s=y_(r,i=>{const a=i.val()===!0,o=new Date;e(l=>({isOnline:a,isConnecting:!a&&l.isOnline,lastConnected:a?o:l.lastConnected})),console.log(a?"🟢 Firebase connected":"🔴 Firebase disconnected - showing reconnection banner")});return()=>s()},[]),n},R_e=()=>{const{isOnline:n,isConnecting:e}=A_e();return n&&!e?null:V.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-amber-500 text-white px-4 py-2 text-center text-sm font-medium shadow-lg",children:[V.jsxs("div",{className:"flex items-center justify-center gap-2",children:[V.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),V.jsx("span",{children:e?"Reconnecting...":"Connection lost - trying to reconnect"})]}),V.jsx("div",{className:"text-xs mt-1 opacity-90",children:"Changes will sync when connection is restored"})]})},N_e=()=>{const{user:n}=wu(),[e,t]=Y.useState({});Y.useEffect(()=>n?f$(i=>{t(i)}):void 0,[n]);const r=Object.entries(e).filter(([s,i])=>s!==(n==null?void 0:n.uid)&&i.displayName&&i.displayName.trim()!=="");return V.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[V.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:["👥 Other Users",V.jsx("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full",children:r.length})]}),V.jsx("div",{className:"space-y-2",children:r.length===0?V.jsx("div",{className:"text-xs text-gray-500 italic",children:"No other users online"}):r.map(([s,i])=>V.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50",children:[V.jsx("div",{className:"w-3 h-3 rounded-full border border-white shadow-sm",style:{backgroundColor:i.cursorColor}}),V.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:i.displayName}),i.currentlyEditing&&V.jsx("span",{className:"text-xs text-orange-600",children:"✏️"}),V.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full ml-auto"})]},s))})]})},O_e=()=>{const[n,e]=Y.useState(null),[t,r]=Y.useState(!1);return Y.useEffect(()=>{},[]),Y.useEffect(()=>{const s=i=>{(i.ctrlKey||i.metaKey)&&i.key==="p"&&i.shiftKey&&(i.preventDefault(),r(!t))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[t]),null};function L_e(){const[n,e]=Y.useState(!1);return null}function M_e(){const n=V.jsxs("div",{className:"container mx-auto px-4 py-8",children:[V.jsx("h1",{className:"text-4xl font-bold text-center text-gray-800 mb-8",children:"CollabCanvas MVP"}),V.jsxs("div",{className:"text-center mb-8",children:[V.jsx("p",{className:"text-lg text-gray-600 mb-2",children:"Real-Time Collaborative Design Tool"}),V.jsx("p",{className:"text-sm text-gray-500",children:"Please sign in to continue"})]}),V.jsx(Lee,{})]});return V.jsx(w6,{children:V.jsxs("div",{className:"min-h-screen bg-gray-50",children:[V.jsx(L_e,{}),V.jsx(R_e,{}),V.jsx(O_e,{}),V.jsx(P_e,{fallback:n,children:V.jsxs("div",{className:"h-screen flex flex-col",children:[V.jsx(k_e,{}),V.jsx("main",{className:"flex-1 p-4",children:V.jsxs("div",{className:"h-full flex",children:[V.jsx(w6,{fallback:V.jsxs("div",{className:"flex-1 mr-4 bg-white rounded-lg border border-red-200 p-8 text-center",children:[V.jsx("div",{className:"text-4xl mb-4",children:"🎨"}),V.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Canvas Error"}),V.jsx("p",{className:"text-gray-600 mb-4",children:"The canvas encountered an error. Try refreshing the page."}),V.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Reload Canvas"})]}),children:V.jsx("div",{className:"flex-1 mr-4",children:V.jsx(C_e,{width:1200,height:800})})}),V.jsxs("div",{className:"w-64 space-y-4",children:[V.jsx(N_e,{}),V.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[V.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Shortcuts"}),V.jsxs("div",{className:"space-y-1.5 text-xs text-gray-600",children:[V.jsxs("div",{children:[V.jsx("strong",{children:"Click"})," → Create shape"]}),V.jsxs("div",{children:[V.jsx("strong",{children:"Shift+Drag"})," → Marquee select"]}),V.jsxs("div",{children:[V.jsx("strong",{children:"Shift+Click"})," → Multi-select"]}),V.jsxs("div",{children:[V.jsx("strong",{children:"⌘/Ctrl+A"})," → Select all"]}),V.jsxs("div",{children:[V.jsx("strong",{children:"Delete"})," → Delete selected"]}),V.jsxs("div",{children:[V.jsx("strong",{children:"Space+Drag"})," → Pan canvas"]}),V.jsxs("div",{children:[V.jsx("strong",{children:"Scroll"})," → Zoom/Pan"]})]})]})]})]})})]})})]})})}oT.createRoot(document.getElementById("root")).render(V.jsx(It.StrictMode,{children:V.jsx(M_e,{})}));export{PI as B,xi as P,Cj as c,ql as r};
